{"type":"system","subtype":"hook_response","session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"1435a822-b890-4180-9d35-3d617be3a232","hook_name":"SessionStart:resume","hook_event":"SessionStart","stdout":"","stderr":"","exit_code":0}
{"type":"system","subtype":"hook_response","session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"a5913207-bc68-4caa-82ec-dedcbd2e0be3","hook_name":"SessionStart:resume","hook_event":"SessionStart","stdout":"=== RESUMING SESSION - MODIFICATION GUIDANCE ===\n\n## DATA LAYER\n\n- IF you have any data layer related requirements, use the 'database-administrator' subagent\n- Send the user's actual requirements as-is to the subagent.\n\n=== END OF MODIFICATION GUIDANCE ===\n","stderr":"","exit_code":0}
{"type":"system","subtype":"init","cwd":"/home/user/vite-template","session_id":"752928d6-a510-485a-bbfe-46da4a277f96","tools":["Task","Bash","Glob","Grep","ExitPlanMode","Read","Edit","Write","NotebookEdit","WebFetch","TodoWrite","WebSearch","BashOutput","KillShell","Skill","SlashCommand","EnterPlanMode"],"mcp_servers":[],"model":"claude-sonnet-4-5","permissionMode":"bypassPermissions","slash_commands":["compact","context","cost","init","pr-comments","release-notes","todos","review","security-review"],"apiKeySource":"none","claude_code_version":"2.0.53","output_style":"default","agents":["general-purpose","statusline-setup","Explore","Plan","integration-administrator","database-administrator"],"skills":[],"plugins":[],"uuid":"8845735c-db58-42ca-90c6-5a75b2d12538"}
{"type":"assistant","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_vrtx_01HjWHQtv2tvs8Y4eAqaDaE8","type":"message","role":"assistant","content":[{"type":"text","text":"I understand the clock in/out functionality is still not working. Since we've been troubleshooting this for a while without success, let me take a completely different approach and rebuild the clock in/out system from scratch with a simpler, more reliable implementation.\n\nLet me create a brand new, simplified clock in/out interface that focuses on core functionality:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":110636,"cache_read_input_tokens":16310,"cache_creation":{"ephemeral_5m_input_tokens":110636,"ephemeral_1h_input_tokens":0},"output_tokens":1},"context_management":null},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"cc2b3ba9-c9fb-451d-a8be-2a3ce6bea1f5"}
{"type":"assistant","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_vrtx_01HjWHQtv2tvs8Y4eAqaDaE8","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_vrtx_013cGUmA51g3RgSZVQfyZTzS","name":"Edit","input":{"file_path":"/home/user/vite-template/src/routes/index.tsx","old_string":"function EmployeeView({ user, language }: { user: UserModel; language: Language }) {\n\tconst [activeShift, setActiveShift] = useState<TimeCardEntryModel | null>(null);\n\tconst [timeCards, setTimeCards] = useState<TimeCardEntryModel[]>([]);\n\tconst [elapsedTime, setElapsedTime] = useState(0);\n\tconst [location, setLocation] = useState(\"\");\n\tconst [workDescription, setWorkDescription] = useState(\"\");\n\tconst [isOnLunch, setIsOnLunch] = useState(false);\n\tconst [isLoading, setIsLoading] = useState(false);\n\n\tconst t = translations[language];\n\n\tuseEffect(() => {\n\t\tloadTimeCards();\n\t}, [user.id]);","new_string":"function EmployeeView({ user, language }: { user: UserModel; language: Language }) {\n\tconst [timeCards, setTimeCards] = useState<TimeCardEntryModel[]>([]);\n\tconst [currentShift, setCurrentShift] = useState<TimeCardEntryModel | null>(null);\n\tconst [elapsedSeconds, setElapsedSeconds] = useState(0);\n\tconst [locationInput, setLocationInput] = useState(\"\");\n\tconst [descriptionInput, setDescriptionInput] = useState(\"\");\n\tconst [isProcessing, setIsProcessing] = useState(false);\n\n\tconst t = translations[language];\n\n\t// Load time cards on mount and find active shift\n\tuseEffect(() => {\n\t\tloadAllTimeCards();\n\t}, [user.id]);"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":110636,"cache_read_input_tokens":16310,"cache_creation":{"ephemeral_5m_input_tokens":110636,"ephemeral_1h_input_tokens":0},"output_tokens":547},"context_management":null},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"b6abb1c6-fbdc-4895-801f-9bbce362d82c"}
{"type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_vrtx_013cGUmA51g3RgSZVQfyZTzS","type":"tool_result","content":"The file /home/user/vite-template/src/routes/index.tsx has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n   317‚Üí\t\t</div>\n   318‚Üí\t);\n   319‚Üí}\n   320‚Üí\n   321‚Üífunction EmployeeView({ user, language }: { user: UserModel; language: Language }) {\n   322‚Üí\tconst [timeCards, setTimeCards] = useState<TimeCardEntryModel[]>([]);\n   323‚Üí\tconst [currentShift, setCurrentShift] = useState<TimeCardEntryModel | null>(null);\n   324‚Üí\tconst [elapsedSeconds, setElapsedSeconds] = useState(0);\n   325‚Üí\tconst [locationInput, setLocationInput] = useState(\"\");\n   326‚Üí\tconst [descriptionInput, setDescriptionInput] = useState(\"\");\n   327‚Üí\tconst [isProcessing, setIsProcessing] = useState(false);\n   328‚Üí\n   329‚Üí\tconst t = translations[language];\n   330‚Üí\n   331‚Üí\t// Load time cards on mount and find active shift\n   332‚Üí\tuseEffect(() => {\n   333‚Üí\t\tloadAllTimeCards();\n   334‚Üí\t}, [user.id]);\n   335‚Üí\n   336‚Üí\tuseEffect(() => {\n   337‚Üí\t\tlet interval: NodeJS.Timeout;\n   338‚Üí\t\tif (activeShift && !isOnLunch) {"}]},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"cb4eab00-5cc3-4278-91fd-9301ce0b9bf8","tool_use_result":{"filePath":"/home/user/vite-template/src/routes/index.tsx","oldString":"function EmployeeView({ user, language }: { user: UserModel; language: Language }) {\n\tconst [activeShift, setActiveShift] = useState<TimeCardEntryModel | null>(null);\n\tconst [timeCards, setTimeCards] = useState<TimeCardEntryModel[]>([]);\n\tconst [elapsedTime, setElapsedTime] = useState(0);\n\tconst [location, setLocation] = useState(\"\");\n\tconst [workDescription, setWorkDescription] = useState(\"\");\n\tconst [isOnLunch, setIsOnLunch] = useState(false);\n\tconst [isLoading, setIsLoading] = useState(false);\n\n\tconst t = translations[language];\n\n\tuseEffect(() => {\n\t\tloadTimeCards();\n\t}, [user.id]);","newString":"function EmployeeView({ user, language }: { user: UserModel; language: Language }) {\n\tconst [timeCards, setTimeCards] = useState<TimeCardEntryModel[]>([]);\n\tconst [currentShift, setCurrentShift] = useState<TimeCardEntryModel | null>(null);\n\tconst [elapsedSeconds, setElapsedSeconds] = useState(0);\n\tconst [locationInput, setLocationInput] = useState(\"\");\n\tconst [descriptionInput, setDescriptionInput] = useState(\"\");\n\tconst [isProcessing, setIsProcessing] = useState(false);\n\n\tconst t = translations[language];\n\n\t// Load time cards on mount and find active shift\n\tuseEffect(() => {\n\t\tloadAllTimeCards();\n\t}, [user.id]);","originalFile":"import { createFileRoute } from \"@tanstack/react-router\";\nimport { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from \"@/components/ui/dialog\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Clock, Users, CalendarDays, Timer, Languages, Coffee, UserPlus, FileText, AlertCircle, Plus, Trash2 } from \"lucide-react\";\nimport { UserORM, type UserModel, UserRole } from \"@/sdk/database/orm/orm_user\";\nimport { TimeCardEntryORM, type TimeCardEntryModel } from \"@/sdk/database/orm/orm_time_card_entry\";\n\nexport const Route = createFileRoute(\"/\")({\n\tcomponent: App,\n});\n\ntype Language = 'en' | 'es';\n\nconst translations = {\n\ten: {\n\t\tappTitle: \"Employee Time Tracking\",\n\t\tselectAccount: \"Select your account to continue\",\n\t\tselectUser: \"Select User\",\n\t\tchooseAccount: \"Choose your account\",\n\t\tmanager: \"Manager\",\n\t\temployee: \"Employee\",\n\t\tswitchUser: \"Switch User\",\n\t\ttimeTrackingSystem: \"Time Tracking System\",\n\t\twelcome: \"Welcome\",\n\t\tclockInOut: \"Clock In/Out\",\n\t\tcurrentlyClocked: \"Currently Clocked In\",\n\t\tsince: \"Since\",\n\t\telapsedTime: \"Elapsed Time\",\n\t\tclockOut: \"Clock Out\",\n\t\tnotClocked: \"Not currently clocked in\",\n\t\tclockIn: \"Clock In\",\n\t\ttimeCardHistory: \"Time Card History\",\n\t\trecentRecords: \"Your recent clock in/out records\",\n\t\tnoTimeCards: \"No time cards yet\",\n\t\tclockInTime: \"Clock In\",\n\t\tclockOutTime: \"Clock Out\",\n\t\thours: \"Hours\",\n\t\tstatus: \"Status\",\n\t\tcompleted: \"Completed\",\n\t\tactive: \"Active\",\n\t\ttotalEmployees: \"Total Employees\",\n\t\thoursToday: \"Hours Today\",\n\t\thoursThisWeek: \"Hours This Week\",\n\t\tallEmployeeTimeCards: \"All Employee Time Cards\",\n\t\tviewManageRecords: \"View and manage all employee time records\",\n\t\tfilterByEmployee: \"Filter by Employee\",\n\t\tallEmployees: \"All Employees\",\n\t\tfilterByDate: \"Filter by Date\",\n\t\tclearFilters: \"Clear Filters\",\n\t\tnoTimeCardsFound: \"No time cards found\",\n\t\temployeeName: \"Employee\",\n\t\tactions: \"Actions\",\n\t\tedit: \"Edit\",\n\t\teditTimeCard: \"Edit Time Card\",\n\t\tcancel: \"Cancel\",\n\t\tsaveChanges: \"Save Changes\",\n\t\tlocation: \"Location\",\n\t\twhereWorked: \"Where did you work?\",\n\t\tworkDescription: \"Work Description\",\n\t\twhatDid: \"What did you do today?\",\n\t\tlocationPlaceholder: \"e.g., Office, Remote, Client Site\",\n\t\tdescriptionPlaceholder: \"Describe your work activities...\",\n\t\tstartLunch: \"Start Lunch Break\",\n\t\tendLunch: \"End Lunch Break\",\n\t\tonLunchBreak: \"On Lunch Break\",\n\t\tlunchBreak: \"Lunch Break\",\n\t\tlunchDuration: \"Lunch\",\n\t\tlunchStartTime: \"Lunch Start\",\n\t\tlunchEndTime: \"Lunch End\",\n\t\ttimeCards: \"Time Cards\",\n\t\treports: \"Reports\",\n\t\temployees: \"Employees\",\n\t\taddEmployee: \"Add Employee\",\n\t\teditEmployee: \"Edit Employee\",\n\t\tdeleteEmployee: \"Delete Employee\",\n\t\tname: \"Name\",\n\t\temail: \"Email\",\n\t\tphone: \"Phone\",\n\t\trole: \"Role\",\n\t\tdelete: \"Delete\",\n\t\tweeklyReport: \"Weekly Report\",\n\t\tselectWeek: \"Select Week\",\n\t\tregularHours: \"Regular\",\n\t\tovertimeHours: \"Overtime\",\n\t\ttotalHours: \"Total\",\n\t\tnoReportData: \"No data for selected week\",\n\t\taddTimeCard: \"Add Time Card\",\n\t\tmanualEntry: \"Manual Entry\",\n\t\taddManualEntry: \"Add Manual Time Card\",\n\t\tconfirmDelete: \"Are you sure you want to delete this employee?\",\n\t\tovertimeAlert: \"Overtime Alert\",\n\t\tprintReport: \"Print Report\",\n\t\texportCSV: \"Export to CSV\",\n\t\tdetailedReport: \"Detailed Time Card Report\",\n\t\tdate: \"Date\",\n\t\tday: \"Day\",\n\t\tdeleteTimeCard: \"Delete Time Card\",\n\t\tconfirmDeleteTimeCard: \"Are you sure you want to delete this time card? This action cannot be undone.\",\n\t},\n\tes: {\n\t\tappTitle: \"Registro de Tiempo de Empleados\",\n\t\tselectAccount: \"Selecciona tu cuenta para continuar\",\n\t\tselectUser: \"Seleccionar Usuario\",\n\t\tchooseAccount: \"Elige tu cuenta\",\n\t\tmanager: \"Gerente\",\n\t\temployee: \"Empleado\",\n\t\tswitchUser: \"Cambiar Usuario\",\n\t\ttimeTrackingSystem: \"Sistema de Registro de Tiempo\",\n\t\twelcome: \"Bienvenido\",\n\t\tclockInOut: \"Entrada/Salida\",\n\t\tcurrentlyClocked: \"Actualmente Registrado\",\n\t\tsince: \"Desde\",\n\t\telapsedTime: \"Tiempo Transcurrido\",\n\t\tclockOut: \"Registrar Salida\",\n\t\tnotClocked: \"No est√° registrado actualmente\",\n\t\tclockIn: \"Registrar Entrada\",\n\t\ttimeCardHistory: \"Historial de Tarjetas de Tiempo\",\n\t\trecentRecords: \"Tus registros recientes de entrada/salida\",\n\t\tnoTimeCards: \"No hay tarjetas de tiempo todav√≠a\",\n\t\tclockInTime: \"Entrada\",\n\t\tclockOutTime: \"Salida\",\n\t\thours: \"Horas\",\n\t\tstatus: \"Estado\",\n\t\tcompleted: \"Completado\",\n\t\tactive: \"Activo\",\n\t\ttotalEmployees: \"Total de Empleados\",\n\t\thoursToday: \"Horas Hoy\",\n\t\thoursThisWeek: \"Horas Esta Semana\",\n\t\tallEmployeeTimeCards: \"Todas las Tarjetas de Tiempo\",\n\t\tviewManageRecords: \"Ver y gestionar todos los registros de empleados\",\n\t\tfilterByEmployee: \"Filtrar por Empleado\",\n\t\tallEmployees: \"Todos los Empleados\",\n\t\tfilterByDate: \"Filtrar por Fecha\",\n\t\tclearFilters: \"Limpiar Filtros\",\n\t\tnoTimeCardsFound: \"No se encontraron tarjetas de tiempo\",\n\t\temployeeName: \"Empleado\",\n\t\tactions: \"Acciones\",\n\t\tedit: \"Editar\",\n\t\teditTimeCard: \"Editar Tarjeta de Tiempo\",\n\t\tcancel: \"Cancelar\",\n\t\tsaveChanges: \"Guardar Cambios\",\n\t\tlocation: \"Ubicaci√≥n\",\n\t\twhereWorked: \"¬øD√≥nde trabajaste?\",\n\t\tworkDescription: \"Descripci√≥n del Trabajo\",\n\t\twhatDid: \"¬øQu√© hiciste hoy?\",\n\t\tlocationPlaceholder: \"ej., Oficina, Remoto, Sitio del Cliente\",\n\t\tdescriptionPlaceholder: \"Describe tus actividades laborales...\",\n\t\tstartLunch: \"Iniciar Almuerzo\",\n\t\tendLunch: \"Terminar Almuerzo\",\n\t\tonLunchBreak: \"En Almuerzo\",\n\t\tlunchBreak: \"Almuerzo\",\n\t\tlunchDuration: \"Almuerzo\",\n\t\tlunchStartTime: \"Inicio Almuerzo\",\n\t\tlunchEndTime: \"Fin Almuerzo\",\n\t\ttimeCards: \"Tarjetas de Tiempo\",\n\t\treports: \"Informes\",\n\t\temployees: \"Empleados\",\n\t\taddEmployee: \"Agregar Empleado\",\n\t\teditEmployee: \"Editar Empleado\",\n\t\tdeleteEmployee: \"Eliminar Empleado\",\n\t\tname: \"Nombre\",\n\t\temail: \"Correo\",\n\t\tphone: \"Tel√©fono\",\n\t\trole: \"Rol\",\n\t\tdelete: \"Eliminar\",\n\t\tweeklyReport: \"Informe Semanal\",\n\t\tselectWeek: \"Seleccionar Semana\",\n\t\tregularHours: \"Regular\",\n\t\tovertimeHours: \"Tiempo Extra\",\n\t\ttotalHours: \"Total\",\n\t\tnoReportData: \"No hay datos para la semana seleccionada\",\n\t\taddTimeCard: \"Agregar Tarjeta\",\n\t\tmanualEntry: \"Entrada Manual\",\n\t\taddManualEntry: \"Agregar Tarjeta Manual\",\n\t\tconfirmDelete: \"¬øEst√° seguro de eliminar este empleado?\",\n\t\tovertimeAlert: \"Alerta de Tiempo Extra\",\n\t\tprintReport: \"Imprimir Informe\",\n\t\texportCSV: \"Exportar a CSV\",\n\t\tdetailedReport: \"Informe Detallado de Tarjetas de Tiempo\",\n\t\tdate: \"Fecha\",\n\t\tday: \"D√≠a\",\n\t\tdeleteTimeCard: \"Eliminar Tarjeta de Tiempo\",\n\t\tconfirmDeleteTimeCard: \"¬øEst√° seguro de eliminar esta tarjeta de tiempo? Esta acci√≥n no se puede deshacer.\",\n\t}\n};\n\nfunction App() {\n\tconst [currentUser, setCurrentUser] = useState<UserModel | null>(null);\n\tconst [users, setUsers] = useState<UserModel[]>([]);\n\tconst [showUserSelect, setShowUserSelect] = useState(true);\n\tconst [language, setLanguage] = useState<Language>('en');\n\n\tconst t = translations[language];\n\n\tuseEffect(() => {\n\t\tloadUsers();\n\t}, []);\n\n\tconst loadUsers = async () => {\n\t\tconst userORM = UserORM.getInstance();\n\t\tconst allUsers = await userORM.getAllUser();\n\n\t\t// If no users exist, create demo users\n\t\tif (allUsers.length === 0) {\n\t\t\tconst demoUsers = await userORM.insertUser([\n\t\t\t\t{\n\t\t\t\t\tname: \"John Smith\",\n\t\t\t\t\temail: \"john@example.com\",\n\t\t\t\t\trole: UserRole.Employee,\n\t\t\t\t} as UserModel,\n\t\t\t\t{\n\t\t\t\t\tname: \"Sarah Johnson\",\n\t\t\t\t\temail: \"sarah@example.com\",\n\t\t\t\t\trole: UserRole.Employee,\n\t\t\t\t} as UserModel,\n\t\t\t\t{\n\t\t\t\t\tname: \"Mike Manager\",\n\t\t\t\t\temail: \"mike@example.com\",\n\t\t\t\t\trole: UserRole.Manager,\n\t\t\t\t} as UserModel,\n\t\t\t]);\n\t\t\tsetUsers(demoUsers);\n\t\t} else {\n\t\t\tsetUsers(allUsers);\n\t\t}\n\t};\n\n\tconst handleUserSelect = (userId: string) => {\n\t\tconst user = users.find(u => u.id === userId);\n\t\tif (user) {\n\t\t\tsetCurrentUser(user);\n\t\t\tsetShowUserSelect(false);\n\t\t}\n\t};\n\n\tconst handleLogout = () => {\n\t\tsetCurrentUser(null);\n\t\tsetShowUserSelect(true);\n\t};\n\n\tconst toggleLanguage = () => {\n\t\tsetLanguage(prev => prev === 'en' ? 'es' : 'en');\n\t};\n\n\tif (showUserSelect || !currentUser) {\n\t\treturn (\n\t\t\t<div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800 flex items-center justify-center p-4\">\n\t\t\t\t<div className=\"absolute top-4 right-4\">\n\t\t\t\t\t<Button onClick={toggleLanguage} variant=\"outline\" size=\"sm\">\n\t\t\t\t\t\t<Languages className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t\t{language === 'en' ? 'Espa√±ol' : 'English'}\n\t\t\t\t\t</Button>\n\t\t\t\t</div>\n\t\t\t\t<Card className=\"w-full max-w-md\">\n\t\t\t\t\t<CardHeader>\n\t\t\t\t\t\t<CardTitle className=\"text-2xl\">{t.appTitle}</CardTitle>\n\t\t\t\t\t\t<CardDescription>{t.selectAccount}</CardDescription>\n\t\t\t\t\t</CardHeader>\n\t\t\t\t\t<CardContent className=\"space-y-4\">\n\t\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t\t<Label>{t.selectUser}</Label>\n\t\t\t\t\t\t\t<Select onValueChange={handleUserSelect}>\n\t\t\t\t\t\t\t\t<SelectTrigger className=\"w-full\">\n\t\t\t\t\t\t\t\t\t<SelectValue placeholder={t.chooseAccount} />\n\t\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t\t{users.map((user) => (\n\t\t\t\t\t\t\t\t\t\t<SelectItem key={user.id} value={user.id}>\n\t\t\t\t\t\t\t\t\t\t\t{user.name} - {user.role === UserRole.Manager ? t.manager : t.employee}\n\t\t\t\t\t\t\t\t\t\t</SelectItem>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t\t</Select>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</CardContent>\n\t\t\t\t</Card>\n\t\t\t</div>\n\t\t);\n\t}\n\n\treturn (\n\t\t<div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800\">\n\t\t\t<div className=\"container mx-auto p-6 space-y-6\">\n\t\t\t\t<div className=\"flex justify-between items-center\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<h1 className=\"text-3xl font-bold\">{t.timeTrackingSystem}</h1>\n\t\t\t\t\t\t<p className=\"text-muted-foreground\">\n\t\t\t\t\t\t\t{t.welcome}, {currentUser.name} ({currentUser.role === UserRole.Manager ? t.manager : t.employee})\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"flex gap-2\">\n\t\t\t\t\t\t<Button onClick={toggleLanguage} variant=\"outline\" size=\"sm\">\n\t\t\t\t\t\t\t<Languages className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t\t\t{language === 'en' ? 'Espa√±ol' : 'English'}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button onClick={handleLogout} variant=\"outline\">\n\t\t\t\t\t\t\t{t.switchUser}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t{currentUser.role === UserRole.Employee ? (\n\t\t\t\t\t<EmployeeView user={currentUser} language={language} />\n\t\t\t\t) : (\n\t\t\t\t\t<ManagerView user={currentUser} users={users} language={language} onUsersChange={loadUsers} />\n\t\t\t\t)}\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n\nfunction EmployeeView({ user, language }: { user: UserModel; language: Language }) {\n\tconst [activeShift, setActiveShift] = useState<TimeCardEntryModel | null>(null);\n\tconst [timeCards, setTimeCards] = useState<TimeCardEntryModel[]>([]);\n\tconst [elapsedTime, setElapsedTime] = useState(0);\n\tconst [location, setLocation] = useState(\"\");\n\tconst [workDescription, setWorkDescription] = useState(\"\");\n\tconst [isOnLunch, setIsOnLunch] = useState(false);\n\tconst [isLoading, setIsLoading] = useState(false);\n\n\tconst t = translations[language];\n\n\tuseEffect(() => {\n\t\tloadTimeCards();\n\t}, [user.id]);\n\n\tuseEffect(() => {\n\t\tlet interval: NodeJS.Timeout;\n\t\tif (activeShift && !isOnLunch) {\n\t\t\tinterval = setInterval(() => {\n\t\t\t\tconst clockInTime = parseInt(activeShift.clock_in_timestamp) * 1000;\n\t\t\t\tconst elapsed = Date.now() - clockInTime;\n\t\t\t\tsetElapsedTime(elapsed);\n\t\t\t}, 1000);\n\t\t}\n\t\treturn () => clearInterval(interval);\n\t}, [activeShift, isOnLunch]);\n\n\tconst loadTimeCards = async () => {\n\t\tconsole.log(\"Loading time cards for user:\", user.id);\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tconst userTimeCards = await timeCardORM.getTimeCardEntryByUserId(user.id);\n\n\t\tconsole.log(\"Found\", userTimeCards.length, \"time cards\");\n\n\t\t// Sort by clock in time (newest first)\n\t\tconst sorted = userTimeCards.sort((a, b) =>\n\t\t\tparseInt(b.clock_in_timestamp) - parseInt(a.clock_in_timestamp)\n\t\t);\n\n\t\tsetTimeCards(sorted);\n\n\t\t// Find active shift (no clock out time)\n\t\tconst active = sorted.find(tc => !tc.clock_out_timestamp);\n\t\tconsole.log(\"Active shift found:\", active ? `Yes (ID: ${active.id})` : \"No\");\n\n\t\tsetActiveShift(active || null);\n\t\tif (active) {\n\t\t\tsetLocation(active.location || \"\");\n\t\t\tsetWorkDescription(active.work_description || \"\");\n\t\t\t// Check if on lunch break\n\t\t\tconst onLunch = !!(active.lunch_start_timestamp && !active.lunch_end_timestamp);\n\t\t\tsetIsOnLunch(onLunch);\n\t\t\tconsole.log(\"On lunch:\", onLunch);\n\t\t} else {\n\t\t\tsetIsOnLunch(false);\n\t\t}\n\t};\n\n\tconst handleClockIn = async () => {\n\t\tconsole.log(\"=== CLOCK IN STARTED ===\");\n\t\tconsole.log(\"User ID:\", user.id);\n\t\tconsole.log(\"Location:\", location);\n\t\tconsole.log(\"Work Description:\", workDescription);\n\n\t\tsetIsLoading(true);\n\t\ttry {\n\t\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\t\tconst now = Math.floor(Date.now() / 1000).toString();\n\t\t\tconsole.log(\"Current timestamp:\", now);\n\n\t\t\tconst newEntry = {\n\t\t\t\tuser_id: user.id,\n\t\t\t\tclock_in_timestamp: now,\n\t\t\t\tlocation: location || null,\n\t\t\t\twork_description: workDescription || null,\n\t\t\t} as TimeCardEntryModel;\n\n\t\t\tconsole.log(\"Inserting time card entry:\", newEntry);\n\n\t\t\tconst result = await timeCardORM.insertTimeCardEntry([newEntry]);\n\t\t\tconsole.log(\"Insert result:\", result);\n\n\t\t\tconsole.log(\"Time card entry created successfully!\");\n\n\t\t\t// Clear form\n\t\t\tsetLocation(\"\");\n\t\t\tsetWorkDescription(\"\");\n\n\t\t\t// Reload time cards\n\t\t\tconsole.log(\"Reloading time cards...\");\n\t\t\tawait loadTimeCards();\n\n\t\t\tconsole.log(\"=== CLOCK IN COMPLETED ===\");\n\n\t\t\t// Show success feedback\n\t\t\tif (activeShift) {\n\t\t\t\talert(\"‚úÖ Successfully clocked in! You can now see the CLOCK OUT button.\");\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.error(\"=== CLOCK IN FAILED ===\");\n\t\t\tconsole.error(\"Error details:\", error);\n\t\t\talert(`Error clocking in: ${error instanceof Error ? error.message : 'Unknown error'}. Check console for details.`);\n\t\t} finally {\n\t\t\tsetIsLoading(false);\n\t\t}\n\t};\n\n\tconst handleClockOut = async () => {\n\t\tconsole.log(\"Clock Out clicked - activeShift:\", activeShift);\n\n\t\tif (!activeShift) {\n\t\t\tconsole.error(\"No active shift to clock out!\");\n\t\t\talert(\"Error: No active shift found. Please try clocking in first.\");\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\t\tconst now = Math.floor(Date.now() / 1000).toString();\n\n\t\t\tconst clockInTime = parseInt(activeShift.clock_in_timestamp);\n\t\t\tconst clockOutTime = parseInt(now);\n\t\t\tlet totalHours = (clockOutTime - clockInTime) / 3600;\n\n\t\t\t// Deduct lunch time if lunch was taken\n\t\t\tif (activeShift.lunch_duration_minutes) {\n\t\t\t\ttotalHours -= activeShift.lunch_duration_minutes / 60;\n\t\t\t}\n\n\t\t\tconsole.log(\"Clocking out - Total hours:\", totalHours);\n\n\t\t\tawait timeCardORM.setTimeCardEntryById(activeShift.id, {\n\t\t\t\t...activeShift,\n\t\t\t\tclock_out_timestamp: now,\n\t\t\t\ttotal_hours: totalHours,\n\t\t\t\tlocation: location || activeShift.location,\n\t\t\t\twork_description: workDescription || activeShift.work_description,\n\t\t\t});\n\n\t\t\tconsole.log(\"Clock out successful!\");\n\t\t\tsetLocation(\"\");\n\t\t\tsetWorkDescription(\"\");\n\t\t\tawait loadTimeCards();\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Error clocking out:\", error);\n\t\t\talert(\"Error clocking out. Please try again.\");\n\t\t}\n\t};\n\n\tconst handleStartLunch = async () => {\n\t\tif (!activeShift) return;\n\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tconst now = Math.floor(Date.now() / 1000).toString();\n\n\t\tawait timeCardORM.setTimeCardEntryById(activeShift.id, {\n\t\t\t...activeShift,\n\t\t\tlunch_start_timestamp: now,\n\t\t\tlocation: location || activeShift.location,\n\t\t\twork_description: workDescription || activeShift.work_description,\n\t\t});\n\n\t\tawait loadTimeCards();\n\t};\n\n\tconst handleEndLunch = async () => {\n\t\tif (!activeShift || !activeShift.lunch_start_timestamp) return;\n\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tconst now = Math.floor(Date.now() / 1000).toString();\n\n\t\tconst lunchStartTime = parseInt(activeShift.lunch_start_timestamp);\n\t\tconst lunchEndTime = parseInt(now);\n\t\tconst lunchDurationMinutes = (lunchEndTime - lunchStartTime) / 60;\n\n\t\t// Add to existing lunch duration if there was already one\n\t\tconst totalLunchMinutes = (activeShift.lunch_duration_minutes || 0) + lunchDurationMinutes;\n\n\t\tawait timeCardORM.setTimeCardEntryById(activeShift.id, {\n\t\t\t...activeShift,\n\t\t\tlunch_end_timestamp: now,\n\t\t\tlunch_duration_minutes: totalLunchMinutes,\n\t\t});\n\n\t\tawait loadTimeCards();\n\t};\n\n\tconst formatTime = (ms: number) => {\n\t\tconst seconds = Math.floor(ms / 1000);\n\t\tconst hours = Math.floor(seconds / 3600);\n\t\tconst minutes = Math.floor((seconds % 3600) / 60);\n\t\tconst secs = seconds % 60;\n\t\treturn `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\n\t};\n\n\tconst formatDate = (timestamp: string) => {\n\t\tconst date = new Date(parseInt(timestamp) * 1000);\n\t\treturn date.toLocaleString(language === 'es' ? 'es-ES' : 'en-US');\n\t};\n\n\tconst formatHours = (hours: number | null | undefined) => {\n\t\tif (hours === null || hours === undefined) return \"‚Äî\";\n\t\treturn `${hours.toFixed(2)} ${language === 'es' ? 'hrs' : 'hrs'}`;\n\t};\n\n\tconst formatMinutes = (minutes: number | null | undefined) => {\n\t\tif (minutes === null || minutes === undefined) return \"‚Äî\";\n\t\treturn `${Math.round(minutes)} min`;\n\t};\n\n\treturn (\n\t\t<div className=\"space-y-6\">\n\t\t\t<Card>\n\t\t\t\t<CardHeader>\n\t\t\t\t\t<CardTitle className=\"flex items-center gap-2\">\n\t\t\t\t\t\t<Clock className=\"w-5 h-5\" />\n\t\t\t\t\t\t{t.clockInOut}\n\t\t\t\t\t</CardTitle>\n\t\t\t\t\t<CardDescription>\n\t\t\t\t\t\t{activeShift ? \"‚úÖ You are currently clocked in - Clock out button is below\" : \"‚ùå Not clocked in - Click CLOCK IN button to start\"}\n\t\t\t\t\t</CardDescription>\n\t\t\t\t</CardHeader>\n\t\t\t\t<CardContent className=\"space-y-6\">\n\t\t\t\t\t{/* Show current status */}\n\t\t\t\t\t<div className={`p-6 rounded-lg border-2 ${activeShift ? 'bg-green-50 border-green-300 dark:bg-green-900/20 dark:border-green-700' : 'bg-blue-50 border-blue-300 dark:bg-blue-900/20 dark:border-blue-700'}`}>\n\t\t\t\t\t\t<div className=\"flex items-center justify-between mb-4\">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<p className={`text-2xl font-bold ${activeShift ? 'text-green-700' : 'text-blue-700'}`}>\n\t\t\t\t\t\t\t\t\t{activeShift ? 'üü¢ CLOCKED IN' : '‚ö™ NOT CLOCKED IN'}\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t{!activeShift && (\n\t\t\t\t\t\t\t\t\t<p className=\"text-sm text-blue-600 dark:text-blue-400 mt-2 font-semibold\">\n\t\t\t\t\t\t\t\t\t\tüëá Fill out the form below and click \"CLOCK IN\"\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t{activeShift && (\n\t\t\t\t\t\t\t\t\t<p className=\"text-sm text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\tStarted: {formatDate(activeShift.clock_in_timestamp)}\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t{isOnLunch && (\n\t\t\t\t\t\t\t\t\t<p className=\"text-sm text-orange-600 font-semibold mt-1\">\n\t\t\t\t\t\t\t\t\t\t‚òï On Lunch Break\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{activeShift && !isOnLunch && (\n\t\t\t\t\t\t\t\t<div className=\"text-right\">\n\t\t\t\t\t\t\t\t\t<p className=\"text-3xl font-mono font-bold tabular-nums\">\n\t\t\t\t\t\t\t\t\t\t{formatTime(elapsedTime)}\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t<p className=\"text-xs text-muted-foreground\">Time Elapsed</p>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Main Action Buttons */}\n\t\t\t\t\t{activeShift ? (\n\t\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t\t{/* Clock Out Button - ALWAYS VISIBLE when clocked in */}\n\t\t\t\t\t\t\t<div className=\"bg-red-50 dark:bg-red-950 p-4 rounded-lg border-2 border-red-300 dark:border-red-700\">\n\t\t\t\t\t\t\t\t<p className=\"text-center text-sm font-bold text-red-700 dark:text-red-300 mb-3\">\n\t\t\t\t\t\t\t\t\t‚¨áÔ∏è CLICK HERE TO END YOUR SHIFT ‚¨áÔ∏è\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tonClick={handleClockOut}\n\t\t\t\t\t\t\t\t\tvariant=\"destructive\"\n\t\t\t\t\t\t\t\t\tsize=\"lg\"\n\t\t\t\t\t\t\t\t\tclassName=\"w-full h-20 text-2xl font-black shadow-lg hover:shadow-xl transition-all\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<Clock className=\"w-8 h-8 mr-3\" />\n\t\t\t\t\t\t\t\t\tCLOCK OUT\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t{/* Lunch Buttons */}\n\t\t\t\t\t\t\t<div className=\"border-t pt-4\">\n\t\t\t\t\t\t\t\t<p className=\"text-sm text-muted-foreground mb-3\">Lunch Break (Optional)</p>\n\t\t\t\t\t\t\t\t{isOnLunch ? (\n\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\tonClick={handleEndLunch}\n\t\t\t\t\t\t\t\t\t\tclassName=\"w-full h-12\"\n\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<Coffee className=\"w-5 h-5 mr-2\" />\n\t\t\t\t\t\t\t\t\t\tEnd Lunch Break\n\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\tonClick={handleStartLunch}\n\t\t\t\t\t\t\t\t\t\tclassName=\"w-full h-12\"\n\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<Coffee className=\"w-5 h-5 mr-2\" />\n\t\t\t\t\t\t\t\t\t\tStart Lunch Break\n\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t{/* Location and Description */}\n\t\t\t\t\t\t\t<div className=\"border-t pt-4 space-y-4\">\n\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t<Label>{t.location}</Label>\n\t\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\t\tvalue={location}\n\t\t\t\t\t\t\t\t\t\tonChange={(e) => setLocation(e.target.value)}\n\t\t\t\t\t\t\t\t\t\tplaceholder={t.locationPlaceholder}\n\t\t\t\t\t\t\t\t\t\tclassName=\"mt-2\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t<Label>{t.workDescription}</Label>\n\t\t\t\t\t\t\t\t\t<Textarea\n\t\t\t\t\t\t\t\t\t\tvalue={workDescription}\n\t\t\t\t\t\t\t\t\t\tonChange={(e) => setWorkDescription(e.target.value)}\n\t\t\t\t\t\t\t\t\t\tplaceholder={t.descriptionPlaceholder}\n\t\t\t\t\t\t\t\t\t\trows={3}\n\t\t\t\t\t\t\t\t\t\tclassName=\"mt-2\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t\t{/* Clock In Form */}\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<Label>{t.location}</Label>\n\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\tvalue={location}\n\t\t\t\t\t\t\t\t\tonChange={(e) => setLocation(e.target.value)}\n\t\t\t\t\t\t\t\t\tplaceholder={t.locationPlaceholder}\n\t\t\t\t\t\t\t\t\tclassName=\"mt-2\"\n\t\t\t\t\t\t\t\t\tdisabled={isLoading}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<Label>{t.workDescription}</Label>\n\t\t\t\t\t\t\t\t<Textarea\n\t\t\t\t\t\t\t\t\tvalue={workDescription}\n\t\t\t\t\t\t\t\t\tonChange={(e) => setWorkDescription(e.target.value)}\n\t\t\t\t\t\t\t\t\tplaceholder={t.descriptionPlaceholder}\n\t\t\t\t\t\t\t\t\trows={3}\n\t\t\t\t\t\t\t\t\tclassName=\"mt-2\"\n\t\t\t\t\t\t\t\t\tdisabled={isLoading}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tonClick={handleClockIn}\n\t\t\t\t\t\t\t\tsize=\"lg\"\n\t\t\t\t\t\t\t\tdisabled={isLoading}\n\t\t\t\t\t\t\t\tclassName=\"w-full h-16 text-xl font-bold bg-green-600 hover:bg-green-700 disabled:opacity-50\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Clock className=\"w-6 h-6 mr-2\" />\n\t\t\t\t\t\t\t\t{isLoading ? \"CLOCKING IN...\" : \"CLOCK IN\"}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t{isLoading && (\n\t\t\t\t\t\t\t\t<p className=\"text-center text-sm text-muted-foreground animate-pulse\">\n\t\t\t\t\t\t\t\t\tPlease wait, processing...\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</CardContent>\n\t\t\t</Card>\n\n\t\t\t<Card>\n\t\t\t\t<CardHeader>\n\t\t\t\t\t<CardTitle className=\"flex items-center gap-2\">\n\t\t\t\t\t\t<CalendarDays className=\"w-5 h-5\" />\n\t\t\t\t\t\t{t.timeCardHistory}\n\t\t\t\t\t</CardTitle>\n\t\t\t\t\t<CardDescription>{t.recentRecords}</CardDescription>\n\t\t\t\t</CardHeader>\n\t\t\t\t<CardContent>\n\t\t\t\t\t{timeCards.length === 0 ? (\n\t\t\t\t\t\t<p className=\"text-center text-muted-foreground py-8\">{t.noTimeCards}</p>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<div className=\"overflow-x-auto\">\n\t\t\t\t\t\t\t<Table>\n\t\t\t\t\t\t\t\t<TableHeader>\n\t\t\t\t\t\t\t\t\t<TableRow>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.clockInTime}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.clockOutTime}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.location}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.workDescription}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.lunchDuration}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.hours}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.status}</TableHead>\n\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t</TableHeader>\n\t\t\t\t\t\t\t\t<TableBody>\n\t\t\t\t\t\t\t\t\t{timeCards.map((tc) => (\n\t\t\t\t\t\t\t\t\t\t<TableRow key={tc.id}>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatDate(tc.clock_in_timestamp)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t{tc.clock_out_timestamp ? formatDate(tc.clock_out_timestamp) : \"‚Äî\"}\n\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell>{tc.location || \"‚Äî\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"max-w-xs truncate\">{tc.work_description || \"‚Äî\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatMinutes(tc.lunch_duration_minutes)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatHours(tc.total_hours)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t{tc.clock_out_timestamp ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge variant=\"secondary\">{t.completed}</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t) : tc.lunch_start_timestamp && !tc.lunch_end_timestamp ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge className=\"bg-orange-500\">{t.onLunchBreak}</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge className=\"bg-green-500\">{t.active}</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</TableBody>\n\t\t\t\t\t\t\t</Table>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</CardContent>\n\t\t\t</Card>\n\t\t</div>\n\t);\n}\n\nfunction ManagerView({ user, users, language, onUsersChange }: { user: UserModel; users: UserModel[]; language: Language; onUsersChange: () => void }) {\n\tconst [activeTab, setActiveTab] = useState(\"timecards\");\n\n\tconst t = translations[language];\n\n\treturn (\n\t\t<Tabs value={activeTab} onValueChange={setActiveTab}>\n\t\t\t<TabsList className=\"grid w-full grid-cols-3\">\n\t\t\t\t<TabsTrigger value=\"timecards\">\n\t\t\t\t\t<Clock className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t{t.timeCards}\n\t\t\t\t</TabsTrigger>\n\t\t\t\t<TabsTrigger value=\"reports\">\n\t\t\t\t\t<FileText className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t{t.reports}\n\t\t\t\t</TabsTrigger>\n\t\t\t\t<TabsTrigger value=\"employees\">\n\t\t\t\t\t<Users className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t{t.employees}\n\t\t\t\t</TabsTrigger>\n\t\t\t</TabsList>\n\n\t\t\t<TabsContent value=\"timecards\" className=\"space-y-4\">\n\t\t\t\t<TimeCardsTab users={users} language={language} />\n\t\t\t</TabsContent>\n\n\t\t\t<TabsContent value=\"reports\" className=\"space-y-4\">\n\t\t\t\t<ReportsTab users={users} language={language} />\n\t\t\t</TabsContent>\n\n\t\t\t<TabsContent value=\"employees\" className=\"space-y-4\">\n\t\t\t\t<EmployeesTab users={users} language={language} onUsersChange={onUsersChange} />\n\t\t\t</TabsContent>\n\t\t</Tabs>\n\t);\n}\n\nfunction TimeCardsTab({ users, language }: { users: UserModel[]; language: Language }) {\n\tconst [allTimeCards, setAllTimeCards] = useState<TimeCardEntryModel[]>([]);\n\tconst [filteredCards, setFilteredCards] = useState<TimeCardEntryModel[]>([]);\n\tconst [selectedEmployee, setSelectedEmployee] = useState<string>(\"all\");\n\tconst [dateFilter, setDateFilter] = useState<string>(\"\");\n\tconst [editingCard, setEditingCard] = useState<TimeCardEntryModel | null>(null);\n\tconst [editClockIn, setEditClockIn] = useState(\"\");\n\tconst [editClockOut, setEditClockOut] = useState(\"\");\n\tconst [editLocation, setEditLocation] = useState(\"\");\n\tconst [editWorkDescription, setEditWorkDescription] = useState(\"\");\n\tconst [editLunchStart, setEditLunchStart] = useState(\"\");\n\tconst [editLunchEnd, setEditLunchEnd] = useState(\"\");\n\tconst [showManualEntry, setShowManualEntry] = useState(false);\n\tconst [manualEntryUserId, setManualEntryUserId] = useState<string>(\"\");\n\n\tconst t = translations[language];\n\n\tuseEffect(() => {\n\t\tloadAllTimeCards();\n\t}, []);\n\n\tuseEffect(() => {\n\t\tapplyFilters();\n\t}, [allTimeCards, selectedEmployee, dateFilter]);\n\n\tconst loadAllTimeCards = async () => {\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tconst allCards = await timeCardORM.getAllTimeCardEntry();\n\n\t\t// Sort by clock in time (newest first)\n\t\tconst sorted = allCards.sort((a, b) =>\n\t\t\tparseInt(b.clock_in_timestamp) - parseInt(a.clock_in_timestamp)\n\t\t);\n\n\t\tsetAllTimeCards(sorted);\n\t};\n\n\tconst applyFilters = () => {\n\t\tlet filtered = [...allTimeCards];\n\n\t\t// Filter by employee\n\t\tif (selectedEmployee !== \"all\") {\n\t\t\tfiltered = filtered.filter(tc => tc.user_id === selectedEmployee);\n\t\t}\n\n\t\t// Filter by date\n\t\tif (dateFilter) {\n\t\t\tconst filterDate = new Date(dateFilter);\n\t\t\tconst filterTimestamp = Math.floor(filterDate.getTime() / 1000);\n\t\t\tconst nextDayTimestamp = filterTimestamp + 86400; // +24 hours\n\n\t\t\tfiltered = filtered.filter(tc => {\n\t\t\t\tconst clockIn = parseInt(tc.clock_in_timestamp);\n\t\t\t\treturn clockIn >= filterTimestamp && clockIn < nextDayTimestamp;\n\t\t\t});\n\t\t}\n\n\t\tsetFilteredCards(filtered);\n\t};\n\n\tconst getUserName = (userId: string) => {\n\t\tconst user = users.find(u => u.id === userId);\n\t\treturn user?.name || \"Unknown\";\n\t};\n\n\tconst formatDate = (timestamp: string) => {\n\t\tconst date = new Date(parseInt(timestamp) * 1000);\n\t\treturn date.toLocaleString(language === 'es' ? 'es-ES' : 'en-US');\n\t};\n\n\tconst formatHours = (hours: number | null | undefined) => {\n\t\tif (hours === null || hours === undefined) return \"‚Äî\";\n\t\treturn `${hours.toFixed(2)} ${language === 'es' ? 'hrs' : 'hrs'}`;\n\t};\n\n\tconst formatMinutes = (minutes: number | null | undefined) => {\n\t\tif (minutes === null || minutes === undefined) return \"‚Äî\";\n\t\treturn `${Math.round(minutes)} min`;\n\t};\n\n\tconst calculateTotalHours = (period: 'day' | 'week') => {\n\t\tconst now = Date.now() / 1000;\n\t\tconst periodSeconds = period === 'day' ? 86400 : 604800; // 1 day or 7 days\n\t\tconst startTime = now - periodSeconds;\n\n\t\tconst relevantCards = allTimeCards.filter(tc => {\n\t\t\tconst clockIn = parseInt(tc.clock_in_timestamp);\n\t\t\treturn clockIn >= startTime && tc.total_hours;\n\t\t});\n\n\t\treturn relevantCards.reduce((sum, tc) => sum + (tc.total_hours || 0), 0);\n\t};\n\n\tconst handleEditCard = (card: TimeCardEntryModel) => {\n\t\tsetEditingCard(card);\n\n\t\t// Helper function to safely convert timestamp to ISO string\n\t\tconst safeTimestampToISO = (timestamp: string | null | undefined): string => {\n\t\t\tif (!timestamp) return \"\";\n\t\t\tconst parsed = parseInt(timestamp);\n\t\t\tif (isNaN(parsed) || parsed <= 0) return \"\";\n\t\t\tconst date = new Date(parsed * 1000);\n\t\t\tif (isNaN(date.getTime())) return \"\";\n\t\t\treturn date.toISOString().slice(0, 16);\n\t\t};\n\n\t\tsetEditClockIn(safeTimestampToISO(card.clock_in_timestamp) || new Date().toISOString().slice(0, 16));\n\t\tsetEditClockOut(safeTimestampToISO(card.clock_out_timestamp));\n\t\tsetEditLocation(card.location || \"\");\n\t\tsetEditWorkDescription(card.work_description || \"\");\n\t\tsetEditLunchStart(safeTimestampToISO(card.lunch_start_timestamp));\n\t\tsetEditLunchEnd(safeTimestampToISO(card.lunch_end_timestamp));\n\t};\n\n\tconst handleSaveEdit = async () => {\n\t\tif (!editingCard) return;\n\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tconst clockInTimestamp = Math.floor(new Date(editClockIn).getTime() / 1000).toString();\n\t\tconst clockOutTimestamp = editClockOut\n\t\t\t? Math.floor(new Date(editClockOut).getTime() / 1000).toString()\n\t\t\t: null;\n\t\tconst lunchStartTimestamp = editLunchStart\n\t\t\t? Math.floor(new Date(editLunchStart).getTime() / 1000).toString()\n\t\t\t: null;\n\t\tconst lunchEndTimestamp = editLunchEnd\n\t\t\t? Math.floor(new Date(editLunchEnd).getTime() / 1000).toString()\n\t\t\t: null;\n\n\t\tlet totalHours = null;\n\t\tlet lunchDurationMinutes = null;\n\n\t\t// Calculate lunch duration\n\t\tif (lunchStartTimestamp && lunchEndTimestamp) {\n\t\t\tconst lunchStart = parseInt(lunchStartTimestamp);\n\t\t\tconst lunchEnd = parseInt(lunchEndTimestamp);\n\t\t\tlunchDurationMinutes = (lunchEnd - lunchStart) / 60;\n\t\t}\n\n\t\t// Calculate total hours\n\t\tif (clockOutTimestamp) {\n\t\t\tconst clockInTime = parseInt(clockInTimestamp);\n\t\t\tconst clockOutTime = parseInt(clockOutTimestamp);\n\t\t\ttotalHours = (clockOutTime - clockInTime) / 3600;\n\n\t\t\t// Deduct lunch time\n\t\t\tif (lunchDurationMinutes) {\n\t\t\t\ttotalHours -= lunchDurationMinutes / 60;\n\t\t\t}\n\t\t}\n\n\t\tawait timeCardORM.setTimeCardEntryById(editingCard.id, {\n\t\t\t...editingCard,\n\t\t\tclock_in_timestamp: clockInTimestamp,\n\t\t\tclock_out_timestamp: clockOutTimestamp,\n\t\t\ttotal_hours: totalHours,\n\t\t\tlocation: editLocation || null,\n\t\t\twork_description: editWorkDescription || null,\n\t\t\tlunch_start_timestamp: lunchStartTimestamp,\n\t\t\tlunch_end_timestamp: lunchEndTimestamp,\n\t\t\tlunch_duration_minutes: lunchDurationMinutes,\n\t\t});\n\n\t\tsetEditingCard(null);\n\t\tawait loadAllTimeCards();\n\t};\n\n\tconst handleDeleteTimeCard = async (card: TimeCardEntryModel) => {\n\t\tif (!window.confirm(t.confirmDeleteTimeCard)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tawait timeCardORM.deleteTimeCardEntryById(card.id);\n\t\tawait loadAllTimeCards();\n\t};\n\n\tconst handleAddManualEntry = (userId: string) => {\n\t\tsetManualEntryUserId(userId);\n\t\tsetShowManualEntry(true);\n\t};\n\n\treturn (\n\t\t<>\n\t\t\t<div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n\t\t\t\t<Card>\n\t\t\t\t\t<CardHeader className=\"pb-3\">\n\t\t\t\t\t\t<CardTitle className=\"text-sm font-medium flex items-center gap-2\">\n\t\t\t\t\t\t\t<Users className=\"w-4 h-4\" />\n\t\t\t\t\t\t\t{t.totalEmployees}\n\t\t\t\t\t\t</CardTitle>\n\t\t\t\t\t</CardHeader>\n\t\t\t\t\t<CardContent>\n\t\t\t\t\t\t<div className=\"text-2xl font-bold\">{users.filter(u => u.role === UserRole.Employee).length}</div>\n\t\t\t\t\t</CardContent>\n\t\t\t\t</Card>\n\n\t\t\t\t<Card>\n\t\t\t\t\t<CardHeader className=\"pb-3\">\n\t\t\t\t\t\t<CardTitle className=\"text-sm font-medium flex items-center gap-2\">\n\t\t\t\t\t\t\t<Timer className=\"w-4 h-4\" />\n\t\t\t\t\t\t\t{t.hoursToday}\n\t\t\t\t\t\t</CardTitle>\n\t\t\t\t\t</CardHeader>\n\t\t\t\t\t<CardContent>\n\t\t\t\t\t\t<div className=\"text-2xl font-bold\">{calculateTotalHours('day').toFixed(2)}</div>\n\t\t\t\t\t</CardContent>\n\t\t\t\t</Card>\n\n\t\t\t\t<Card>\n\t\t\t\t\t<CardHeader className=\"pb-3\">\n\t\t\t\t\t\t<CardTitle className=\"text-sm font-medium flex items-center gap-2\">\n\t\t\t\t\t\t\t<CalendarDays className=\"w-4 h-4\" />\n\t\t\t\t\t\t\t{t.hoursThisWeek}\n\t\t\t\t\t\t</CardTitle>\n\t\t\t\t\t</CardHeader>\n\t\t\t\t\t<CardContent>\n\t\t\t\t\t\t<div className=\"text-2xl font-bold\">{calculateTotalHours('week').toFixed(2)}</div>\n\t\t\t\t\t</CardContent>\n\t\t\t\t</Card>\n\t\t\t</div>\n\n\t\t\t<Card>\n\t\t\t\t<CardHeader>\n\t\t\t\t\t<div className=\"flex justify-between items-center\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<CardTitle>{t.allEmployeeTimeCards}</CardTitle>\n\t\t\t\t\t\t\t<CardDescription>{t.viewManageRecords}</CardDescription>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<Button onClick={() => handleAddManualEntry(\"\")} variant=\"outline\" size=\"sm\">\n\t\t\t\t\t\t\t<Plus className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t\t\t{t.addTimeCard}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t</CardHeader>\n\t\t\t\t<CardContent className=\"space-y-4\">\n\t\t\t\t\t<div className=\"flex gap-4 flex-wrap\">\n\t\t\t\t\t\t<div className=\"flex-1 min-w-[200px]\">\n\t\t\t\t\t\t\t<Label>{t.filterByEmployee}</Label>\n\t\t\t\t\t\t\t<Select value={selectedEmployee} onValueChange={setSelectedEmployee}>\n\t\t\t\t\t\t\t\t<SelectTrigger>\n\t\t\t\t\t\t\t\t\t<SelectValue />\n\t\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t\t<SelectItem value=\"all\">{t.allEmployees}</SelectItem>\n\t\t\t\t\t\t\t\t\t{users.filter(u => u.role === UserRole.Employee).map((u) => (\n\t\t\t\t\t\t\t\t\t\t<SelectItem key={u.id} value={u.id}>\n\t\t\t\t\t\t\t\t\t\t\t{u.name}\n\t\t\t\t\t\t\t\t\t\t</SelectItem>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t\t</Select>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div className=\"flex-1 min-w-[200px]\">\n\t\t\t\t\t\t\t<Label>{t.filterByDate}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"date\"\n\t\t\t\t\t\t\t\tvalue={dateFilter}\n\t\t\t\t\t\t\t\tonChange={(e) => setDateFilter(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t{(selectedEmployee !== \"all\" || dateFilter) && (\n\t\t\t\t\t\t\t<div className=\"flex items-end\">\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\t\t\tsetSelectedEmployee(\"all\");\n\t\t\t\t\t\t\t\t\t\tsetDateFilter(\"\");\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{t.clearFilters}\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{filteredCards.length === 0 ? (\n\t\t\t\t\t\t<p className=\"text-center text-muted-foreground py-8\">{t.noTimeCardsFound}</p>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<div className=\"overflow-x-auto\">\n\t\t\t\t\t\t\t<Table>\n\t\t\t\t\t\t\t\t<TableHeader>\n\t\t\t\t\t\t\t\t\t<TableRow>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.employeeName}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.clockInTime}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.clockOutTime}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.location}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.workDescription}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.lunchDuration}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.hours}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.status}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.actions}</TableHead>\n\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t</TableHeader>\n\t\t\t\t\t\t\t\t<TableBody>\n\t\t\t\t\t\t\t\t\t{filteredCards.map((tc) => (\n\t\t\t\t\t\t\t\t\t\t<TableRow key={tc.id}>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"font-medium whitespace-nowrap\">{getUserName(tc.user_id)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatDate(tc.clock_in_timestamp)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t{tc.clock_out_timestamp ? formatDate(tc.clock_out_timestamp) : \"‚Äî\"}\n\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell>{tc.location || \"‚Äî\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"max-w-xs truncate\">{tc.work_description || \"‚Äî\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatMinutes(tc.lunch_duration_minutes)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatHours(tc.total_hours)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t{tc.clock_out_timestamp ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge variant=\"secondary\">{t.completed}</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t) : tc.lunch_start_timestamp && !tc.lunch_end_timestamp ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge className=\"bg-orange-500\">{t.onLunchBreak}</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge className=\"bg-green-500\">{t.active}</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => handleEditCard(tc)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{t.edit}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => handleDeleteTimeCard(tc)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"text-red-600 hover:text-red-700 hover:bg-red-50\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Trash2 className=\"w-4 h-4\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</TableBody>\n\t\t\t\t\t\t\t</Table>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</CardContent>\n\t\t\t</Card>\n\n\t\t\t<Dialog open={!!editingCard} onOpenChange={(open) => !open && setEditingCard(null)}>\n\t\t\t\t<DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n\t\t\t\t\t<DialogHeader>\n\t\t\t\t\t\t<DialogTitle>{t.editTimeCard}</DialogTitle>\n\t\t\t\t\t</DialogHeader>\n\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.employeeName}</Label>\n\t\t\t\t\t\t\t<Input value={editingCard ? getUserName(editingCard.user_id) : \"\"} disabled />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"grid grid-cols-2 gap-4\">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<Label>{t.clockInTime}</Label>\n\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\t\tvalue={editClockIn}\n\t\t\t\t\t\t\t\t\tonChange={(e) => setEditClockIn(e.target.value)}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<Label>{t.clockOutTime}</Label>\n\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\t\tvalue={editClockOut}\n\t\t\t\t\t\t\t\t\tonChange={(e) => setEditClockOut(e.target.value)}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.location}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\tvalue={editLocation}\n\t\t\t\t\t\t\t\tonChange={(e) => setEditLocation(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder={t.locationPlaceholder}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.workDescription}</Label>\n\t\t\t\t\t\t\t<Textarea\n\t\t\t\t\t\t\t\tvalue={editWorkDescription}\n\t\t\t\t\t\t\t\tonChange={(e) => setEditWorkDescription(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder={t.descriptionPlaceholder}\n\t\t\t\t\t\t\t\trows={4}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"grid grid-cols-2 gap-4\">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<Label>{t.lunchStartTime}</Label>\n\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\t\tvalue={editLunchStart}\n\t\t\t\t\t\t\t\t\tonChange={(e) => setEditLunchStart(e.target.value)}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<Label>{t.lunchEndTime}</Label>\n\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\t\tvalue={editLunchEnd}\n\t\t\t\t\t\t\t\t\tonChange={(e) => setEditLunchEnd(e.target.value)}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<DialogFooter>\n\t\t\t\t\t\t<Button variant=\"outline\" onClick={() => setEditingCard(null)}>\n\t\t\t\t\t\t\t{t.cancel}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button onClick={handleSaveEdit}>\n\t\t\t\t\t\t\t{t.saveChanges}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</DialogFooter>\n\t\t\t\t</DialogContent>\n\t\t\t</Dialog>\n\n\t\t\t<ManualEntryDialog\n\t\t\t\topen={showManualEntry}\n\t\t\t\tonClose={() => setShowManualEntry(false)}\n\t\t\t\tuserId={manualEntryUserId}\n\t\t\t\tonSave={loadAllTimeCards}\n\t\t\t\tlanguage={language}\n\t\t\t\tusers={users}\n\t\t\t/>\n\t\t</>\n\t);\n}\n\nfunction ReportsTab({ users, language }: { users: UserModel[]; language: Language }) {\n\tconst [weekStart, setWeekStart] = useState(\"\");\n\tconst [reportData, setReportData] = useState<{ user: UserModel; regularHours: number; overtimeHours: number; totalHours: number }[]>([]);\n\tconst [detailedTimeCards, setDetailedTimeCards] = useState<TimeCardEntryModel[]>([]);\n\n\tconst t = translations[language];\n\n\tuseEffect(() => {\n\t\t// Set default to current week\n\t\tconst today = new Date();\n\t\tconst monday = new Date(today);\n\t\tmonday.setDate(today.getDate() - today.getDay() + 1);\n\t\tsetWeekStart(monday.toISOString().slice(0, 10));\n\t}, []);\n\n\tuseEffect(() => {\n\t\tif (weekStart) {\n\t\t\tloadWeeklyReport();\n\t\t}\n\t}, [weekStart, users]);\n\n\tconst loadWeeklyReport = async () => {\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tconst allCards = await timeCardORM.getAllTimeCardEntry();\n\n\t\tconst weekStartDate = new Date(weekStart);\n\t\tconst weekStartTimestamp = Math.floor(weekStartDate.getTime() / 1000);\n\t\tconst weekEndTimestamp = weekStartTimestamp + 604800; // 7 days\n\n\t\tconst weekCards = allCards.filter(tc => {\n\t\t\tconst clockIn = parseInt(tc.clock_in_timestamp);\n\t\t\treturn clockIn >= weekStartTimestamp && clockIn < weekEndTimestamp && tc.total_hours;\n\t\t});\n\n\t\t// Store detailed time cards\n\t\tsetDetailedTimeCards(weekCards.sort((a, b) => parseInt(a.clock_in_timestamp) - parseInt(b.clock_in_timestamp)));\n\n\t\tconst employeeHours = users\n\t\t\t.filter(u => u.role === UserRole.Employee)\n\t\t\t.map(user => {\n\t\t\t\tconst userCards = weekCards.filter(tc => tc.user_id === user.id);\n\t\t\t\tconst totalHours = userCards.reduce((sum, tc) => sum + (tc.total_hours || 0), 0);\n\t\t\t\tconst regularHours = Math.min(totalHours, 40);\n\t\t\t\tconst overtimeHours = Math.max(totalHours - 40, 0);\n\n\t\t\t\treturn {\n\t\t\t\t\tuser,\n\t\t\t\t\tregularHours,\n\t\t\t\t\tovertimeHours,\n\t\t\t\t\ttotalHours,\n\t\t\t\t};\n\t\t\t});\n\n\t\tsetReportData(employeeHours);\n\t};\n\n\tconst formatHours = (hours: number) => {\n\t\treturn `${hours.toFixed(2)} hrs`;\n\t};\n\n\tconst formatDate = (timestamp: string) => {\n\t\tconst date = new Date(parseInt(timestamp) * 1000);\n\t\treturn date.toLocaleString(language === 'es' ? 'es-ES' : 'en-US');\n\t};\n\n\tconst formatDateOnly = (timestamp: string) => {\n\t\tconst date = new Date(parseInt(timestamp) * 1000);\n\t\treturn date.toLocaleDateString(language === 'es' ? 'es-ES' : 'en-US');\n\t};\n\n\tconst getDayOfWeek = (timestamp: string) => {\n\t\tconst date = new Date(parseInt(timestamp) * 1000);\n\t\treturn date.toLocaleDateString(language === 'es' ? 'es-ES' : 'en-US', { weekday: 'long' });\n\t};\n\n\tconst getUserName = (userId: string) => {\n\t\tconst user = users.find(u => u.id === userId);\n\t\treturn user?.name || \"Unknown\";\n\t};\n\n\tconst handlePrint = () => {\n\t\twindow.print();\n\t};\n\n\tconst handleExportCSV = () => {\n\t\tif (detailedTimeCards.length === 0) return;\n\n\t\t// Create CSV header\n\t\tconst headers = [\n\t\t\tt.employeeName,\n\t\t\tt.date,\n\t\t\tt.day,\n\t\t\tt.clockInTime,\n\t\t\tt.clockOutTime,\n\t\t\tt.location,\n\t\t\tt.workDescription,\n\t\t\tt.lunchDuration,\n\t\t\tt.hours\n\t\t];\n\n\t\t// Create CSV rows\n\t\tconst rows = detailedTimeCards.map(tc => {\n\t\t\tconst userName = getUserName(tc.user_id);\n\t\t\tconst date = formatDateOnly(tc.clock_in_timestamp);\n\t\t\tconst day = getDayOfWeek(tc.clock_in_timestamp);\n\t\t\tconst clockIn = formatDate(tc.clock_in_timestamp);\n\t\t\tconst clockOut = tc.clock_out_timestamp ? formatDate(tc.clock_out_timestamp) : \"‚Äî\";\n\t\t\tconst location = tc.location || \"‚Äî\";\n\t\t\tconst workDescription = (tc.work_description || \"‚Äî\").replace(/\"/g, '\"\"'); // Escape quotes\n\t\t\tconst lunchDuration = tc.lunch_duration_minutes ? `${Math.round(tc.lunch_duration_minutes)} min` : \"‚Äî\";\n\t\t\tconst hours = tc.total_hours ? `${tc.total_hours.toFixed(2)} hrs` : \"‚Äî\";\n\n\t\t\treturn [\n\t\t\t\t`\"${userName}\"`,\n\t\t\t\t`\"${date}\"`,\n\t\t\t\t`\"${day}\"`,\n\t\t\t\t`\"${clockIn}\"`,\n\t\t\t\t`\"${clockOut}\"`,\n\t\t\t\t`\"${location}\"`,\n\t\t\t\t`\"${workDescription}\"`,\n\t\t\t\t`\"${lunchDuration}\"`,\n\t\t\t\t`\"${hours}\"`\n\t\t\t].join(',');\n\t\t});\n\n\t\t// Combine header and rows\n\t\tconst csv = [headers.join(','), ...rows].join('\\n');\n\n\t\t// Create blob and download\n\t\tconst blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });\n\t\tconst link = document.createElement('a');\n\t\tconst url = URL.createObjectURL(blob);\n\t\tlink.setAttribute('href', url);\n\t\tlink.setAttribute('download', `weekly-report-${weekStart}.csv`);\n\t\tlink.style.visibility = 'hidden';\n\t\tdocument.body.appendChild(link);\n\t\tlink.click();\n\t\tdocument.body.removeChild(link);\n\t};\n\n\treturn (\n\t\t<div className=\"space-y-4\">\n\t\t\t<Card>\n\t\t\t\t<CardHeader>\n\t\t\t\t\t<div className=\"flex justify-between items-center\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<CardTitle>{t.weeklyReport}</CardTitle>\n\t\t\t\t\t\t\t<CardDescription>Overtime calculated for hours worked beyond 40 hours/week</CardDescription>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"flex gap-2 print:hidden\">\n\t\t\t\t\t\t\t<Button onClick={handleExportCSV} variant=\"outline\" disabled={detailedTimeCards.length === 0}>\n\t\t\t\t\t\t\t\t<FileText className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t\t\t\t{t.exportCSV}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t<Button onClick={handlePrint} variant=\"outline\" disabled={detailedTimeCards.length === 0}>\n\t\t\t\t\t\t\t\t<FileText className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t\t\t\t{t.printReport}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</CardHeader>\n\t\t\t\t<CardContent className=\"space-y-4\">\n\t\t\t\t\t<div className=\"max-w-xs print:hidden\">\n\t\t\t\t\t\t<Label>{t.selectWeek}</Label>\n\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\ttype=\"date\"\n\t\t\t\t\t\t\tvalue={weekStart}\n\t\t\t\t\t\t\tonChange={(e) => setWeekStart(e.target.value)}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{reportData.length === 0 ? (\n\t\t\t\t\t\t<p className=\"text-center text-muted-foreground py-8\">{t.noReportData}</p>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t{/* Summary Table */}\n\t\t\t\t\t\t\t<div className=\"overflow-x-auto\">\n\t\t\t\t\t\t\t\t<Table>\n\t\t\t\t\t\t\t\t\t<TableHeader>\n\t\t\t\t\t\t\t\t\t\t<TableRow>\n\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.employeeName}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.regularHours}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.overtimeHours}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.totalHours}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.status}</TableHead>\n\t\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t\t</TableHeader>\n\t\t\t\t\t\t\t\t\t<TableBody>\n\t\t\t\t\t\t\t\t\t\t{reportData.map(({ user, regularHours, overtimeHours, totalHours }) => (\n\t\t\t\t\t\t\t\t\t\t\t<TableRow key={user.id}>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"font-medium\">{user.name}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableCell>{formatHours(regularHours)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{overtimeHours > 0 ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-orange-600 font-semibold\">{formatHours(overtimeHours)}</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tformatHours(0)\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"font-semibold\">{formatHours(totalHours)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{overtimeHours > 0 && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge className=\"bg-orange-500\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<AlertCircle className=\"w-3 h-3 mr-1\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{t.overtimeAlert}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t\t</TableBody>\n\t\t\t\t\t\t\t\t</Table>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t{/* Detailed Time Cards Table */}\n\t\t\t\t\t\t\t<div className=\"mt-8\">\n\t\t\t\t\t\t\t\t<h3 className=\"text-lg font-semibold mb-4\">{t.detailedReport}</h3>\n\t\t\t\t\t\t\t\t<div className=\"overflow-x-auto\">\n\t\t\t\t\t\t\t\t\t<Table>\n\t\t\t\t\t\t\t\t\t\t<TableHeader>\n\t\t\t\t\t\t\t\t\t\t\t<TableRow>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.employeeName}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.date}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.day}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.clockInTime}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.clockOutTime}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.location}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.workDescription}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.lunchDuration}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.hours}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t\t\t</TableHeader>\n\t\t\t\t\t\t\t\t\t\t<TableBody>\n\t\t\t\t\t\t\t\t\t\t\t{detailedTimeCards.map((tc) => (\n\t\t\t\t\t\t\t\t\t\t\t\t<TableRow key={tc.id}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"font-medium whitespace-nowrap\">{getUserName(tc.user_id)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatDateOnly(tc.clock_in_timestamp)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{getDayOfWeek(tc.clock_in_timestamp)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatDate(tc.clock_in_timestamp)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{tc.clock_out_timestamp ? formatDate(tc.clock_out_timestamp) : \"‚Äî\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell>{tc.location || \"‚Äî\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"max-w-xs\">{tc.work_description || \"‚Äî\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{tc.lunch_duration_minutes ? `${Math.round(tc.lunch_duration_minutes)} min` : \"‚Äî\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{tc.total_hours ? `${tc.total_hours.toFixed(2)} hrs` : \"‚Äî\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t\t\t</TableBody>\n\t\t\t\t\t\t\t\t\t</Table>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</>\n\t\t\t\t\t)}\n\t\t\t\t</CardContent>\n\t\t\t</Card>\n\t\t</div>\n\t);\n}\n\nfunction EmployeesTab({ users, language, onUsersChange }: { users: UserModel[]; language: Language; onUsersChange: () => void }) {\n\tconst [showAddEmployee, setShowAddEmployee] = useState(false);\n\tconst [editingEmployee, setEditingEmployee] = useState<UserModel | null>(null);\n\tconst [employeeName, setEmployeeName] = useState(\"\");\n\tconst [employeeEmail, setEmployeeEmail] = useState(\"\");\n\tconst [employeePhone, setEmployeePhone] = useState(\"\");\n\tconst [employeeRole, setEmployeeRole] = useState<UserRole>(UserRole.Employee);\n\tconst [deleteConfirm, setDeleteConfirm] = useState<UserModel | null>(null);\n\n\tconst t = translations[language];\n\n\tconst handleAddEmployee = async () => {\n\t\tconst userORM = UserORM.getInstance();\n\t\tawait userORM.insertUser([{\n\t\t\tname: employeeName,\n\t\t\temail: employeeEmail,\n\t\t\tphone: employeePhone || null,\n\t\t\trole: employeeRole,\n\t\t} as UserModel]);\n\n\t\tsetShowAddEmployee(false);\n\t\tsetEmployeeName(\"\");\n\t\tsetEmployeeEmail(\"\");\n\t\tsetEmployeePhone(\"\");\n\t\tsetEmployeeRole(UserRole.Employee);\n\t\tonUsersChange();\n\t};\n\n\tconst handleEditEmployee = async () => {\n\t\tif (!editingEmployee) return;\n\n\t\tconst userORM = UserORM.getInstance();\n\t\tawait userORM.setUserById(editingEmployee.id, {\n\t\t\t...editingEmployee,\n\t\t\tname: employeeName,\n\t\t\temail: employeeEmail,\n\t\t\tphone: employeePhone || null,\n\t\t\trole: employeeRole,\n\t\t});\n\n\t\tsetEditingEmployee(null);\n\t\tsetEmployeeName(\"\");\n\t\tsetEmployeeEmail(\"\");\n\t\tsetEmployeePhone(\"\");\n\t\tsetEmployeeRole(UserRole.Employee);\n\t\tonUsersChange();\n\t};\n\n\tconst handleDeleteEmployee = async (user: UserModel) => {\n\t\tconst userORM = UserORM.getInstance();\n\t\tawait userORM.deleteUserById(user.id);\n\t\tsetDeleteConfirm(null);\n\t\tonUsersChange();\n\t};\n\n\tconst openEditDialog = (user: UserModel) => {\n\t\tsetEditingEmployee(user);\n\t\tsetEmployeeName(user.name);\n\t\tsetEmployeeEmail(user.email);\n\t\tsetEmployeePhone(user.phone || \"\");\n\t\tsetEmployeeRole(user.role);\n\t};\n\n\treturn (\n\t\t<div className=\"space-y-4\">\n\t\t\t<Card>\n\t\t\t\t<CardHeader>\n\t\t\t\t\t<div className=\"flex justify-between items-center\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<CardTitle>{t.employees}</CardTitle>\n\t\t\t\t\t\t\t<CardDescription>Manage employee accounts</CardDescription>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<Button onClick={() => setShowAddEmployee(true)}>\n\t\t\t\t\t\t\t<UserPlus className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t\t\t{t.addEmployee}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t</CardHeader>\n\t\t\t\t<CardContent>\n\t\t\t\t\t<div className=\"overflow-x-auto\">\n\t\t\t\t\t\t<Table>\n\t\t\t\t\t\t\t<TableHeader>\n\t\t\t\t\t\t\t\t<TableRow>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.name}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.email}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.phone}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.role}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.actions}</TableHead>\n\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t</TableHeader>\n\t\t\t\t\t\t\t<TableBody>\n\t\t\t\t\t\t\t\t{users.map((user) => (\n\t\t\t\t\t\t\t\t\t<TableRow key={user.id}>\n\t\t\t\t\t\t\t\t\t\t<TableCell className=\"font-medium\">{user.name}</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell>{user.email}</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell>{user.phone || \"‚Äî\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<Badge variant={user.role === UserRole.Manager ? \"default\" : \"secondary\"}>\n\t\t\t\t\t\t\t\t\t\t\t\t{user.role === UserRole.Manager ? t.manager : t.employee}\n\t\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => openEditDialog(user)}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{t.edit}\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"destructive\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => setDeleteConfirm(user)}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{t.delete}\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</TableBody>\n\t\t\t\t\t\t</Table>\n\t\t\t\t\t</div>\n\t\t\t\t</CardContent>\n\t\t\t</Card>\n\n\t\t\t<Dialog open={showAddEmployee} onOpenChange={setShowAddEmployee}>\n\t\t\t\t<DialogContent>\n\t\t\t\t\t<DialogHeader>\n\t\t\t\t\t\t<DialogTitle>{t.addEmployee}</DialogTitle>\n\t\t\t\t\t</DialogHeader>\n\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.name}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\tvalue={employeeName}\n\t\t\t\t\t\t\t\tonChange={(e) => setEmployeeName(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder=\"John Doe\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.email}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"email\"\n\t\t\t\t\t\t\t\tvalue={employeeEmail}\n\t\t\t\t\t\t\t\tonChange={(e) => setEmployeeEmail(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder=\"john@example.com\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.phone}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"tel\"\n\t\t\t\t\t\t\t\tvalue={employeePhone}\n\t\t\t\t\t\t\t\tonChange={(e) => setEmployeePhone(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder=\"+1 (555) 123-4567\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.role}</Label>\n\t\t\t\t\t\t\t<Select value={employeeRole.toString()} onValueChange={(v) => setEmployeeRole(parseInt(v))}>\n\t\t\t\t\t\t\t\t<SelectTrigger>\n\t\t\t\t\t\t\t\t\t<SelectValue />\n\t\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t\t<SelectItem value={UserRole.Employee.toString()}>{t.employee}</SelectItem>\n\t\t\t\t\t\t\t\t\t<SelectItem value={UserRole.Manager.toString()}>{t.manager}</SelectItem>\n\t\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t\t</Select>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<DialogFooter>\n\t\t\t\t\t\t<Button variant=\"outline\" onClick={() => setShowAddEmployee(false)}>\n\t\t\t\t\t\t\t{t.cancel}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button onClick={handleAddEmployee} disabled={!employeeName || !employeeEmail}>\n\t\t\t\t\t\t\t{t.saveChanges}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</DialogFooter>\n\t\t\t\t</DialogContent>\n\t\t\t</Dialog>\n\n\t\t\t<Dialog open={!!editingEmployee} onOpenChange={(open) => !open && setEditingEmployee(null)}>\n\t\t\t\t<DialogContent>\n\t\t\t\t\t<DialogHeader>\n\t\t\t\t\t\t<DialogTitle>{t.editEmployee}</DialogTitle>\n\t\t\t\t\t</DialogHeader>\n\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.name}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\tvalue={employeeName}\n\t\t\t\t\t\t\t\tonChange={(e) => setEmployeeName(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.email}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"email\"\n\t\t\t\t\t\t\t\tvalue={employeeEmail}\n\t\t\t\t\t\t\t\tonChange={(e) => setEmployeeEmail(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.phone}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"tel\"\n\t\t\t\t\t\t\t\tvalue={employeePhone}\n\t\t\t\t\t\t\t\tonChange={(e) => setEmployeePhone(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder=\"+1 (555) 123-4567\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.role}</Label>\n\t\t\t\t\t\t\t<Select value={employeeRole.toString()} onValueChange={(v) => setEmployeeRole(parseInt(v))}>\n\t\t\t\t\t\t\t\t<SelectTrigger>\n\t\t\t\t\t\t\t\t\t<SelectValue />\n\t\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t\t<SelectItem value={UserRole.Employee.toString()}>{t.employee}</SelectItem>\n\t\t\t\t\t\t\t\t\t<SelectItem value={UserRole.Manager.toString()}>{t.manager}</SelectItem>\n\t\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t\t</Select>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<DialogFooter>\n\t\t\t\t\t\t<Button variant=\"outline\" onClick={() => setEditingEmployee(null)}>\n\t\t\t\t\t\t\t{t.cancel}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button onClick={handleEditEmployee}>\n\t\t\t\t\t\t\t{t.saveChanges}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</DialogFooter>\n\t\t\t\t</DialogContent>\n\t\t\t</Dialog>\n\n\t\t\t<Dialog open={!!deleteConfirm} onOpenChange={(open) => !open && setDeleteConfirm(null)}>\n\t\t\t\t<DialogContent>\n\t\t\t\t\t<DialogHeader>\n\t\t\t\t\t\t<DialogTitle>{t.deleteEmployee}</DialogTitle>\n\t\t\t\t\t</DialogHeader>\n\t\t\t\t\t<p>{t.confirmDelete}</p>\n\t\t\t\t\t<p className=\"font-semibold\">{deleteConfirm?.name}</p>\n\t\t\t\t\t<DialogFooter>\n\t\t\t\t\t\t<Button variant=\"outline\" onClick={() => setDeleteConfirm(null)}>\n\t\t\t\t\t\t\t{t.cancel}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button variant=\"destructive\" onClick={() => deleteConfirm && handleDeleteEmployee(deleteConfirm)}>\n\t\t\t\t\t\t\t{t.delete}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</DialogFooter>\n\t\t\t\t</DialogContent>\n\t\t\t</Dialog>\n\t\t</div>\n\t);\n}\n\nfunction ManualEntryDialog({\n\topen,\n\tonClose,\n\tuserId,\n\tonSave,\n\tlanguage,\n\tusers\n}: {\n\topen: boolean;\n\tonClose: () => void;\n\tuserId: string;\n\tonSave: () => void;\n\tlanguage: Language;\n\tusers?: UserModel[];\n}) {\n\tconst [selectedUser, setSelectedUser] = useState(userId);\n\tconst [clockIn, setClockIn] = useState(\"\");\n\tconst [clockOut, setClockOut] = useState(\"\");\n\tconst [location, setLocation] = useState(\"\");\n\tconst [workDescription, setWorkDescription] = useState(\"\");\n\tconst [lunchStart, setLunchStart] = useState(\"\");\n\tconst [lunchEnd, setLunchEnd] = useState(\"\");\n\n\tconst t = translations[language];\n\n\tuseEffect(() => {\n\t\tif (open) {\n\t\t\tsetSelectedUser(userId);\n\t\t\t// Set default to today\n\t\t\tconst now = new Date();\n\t\t\tconst today = now.toISOString().slice(0, 10);\n\t\t\tsetClockIn(`${today}T09:00`);\n\t\t\tsetClockOut(`${today}T17:00`);\n\t\t\tsetLocation(\"\");\n\t\t\tsetWorkDescription(\"\");\n\t\t\tsetLunchStart(`${today}T12:00`);\n\t\t\tsetLunchEnd(`${today}T13:00`);\n\t\t}\n\t}, [open, userId]);\n\n\tconst handleSave = async () => {\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\n\t\tconst clockInTimestamp = Math.floor(new Date(clockIn).getTime() / 1000).toString();\n\t\tconst clockOutTimestamp = clockOut ? Math.floor(new Date(clockOut).getTime() / 1000).toString() : null;\n\t\tconst lunchStartTimestamp = lunchStart ? Math.floor(new Date(lunchStart).getTime() / 1000).toString() : null;\n\t\tconst lunchEndTimestamp = lunchEnd ? Math.floor(new Date(lunchEnd).getTime() / 1000).toString() : null;\n\n\t\tlet totalHours = null;\n\t\tlet lunchDurationMinutes = null;\n\n\t\t// Calculate lunch duration\n\t\tif (lunchStartTimestamp && lunchEndTimestamp) {\n\t\t\tconst lunchStartTime = parseInt(lunchStartTimestamp);\n\t\t\tconst lunchEndTime = parseInt(lunchEndTimestamp);\n\t\t\tlunchDurationMinutes = (lunchEndTime - lunchStartTime) / 60;\n\t\t}\n\n\t\t// Calculate total hours\n\t\tif (clockOutTimestamp) {\n\t\t\tconst clockInTime = parseInt(clockInTimestamp);\n\t\t\tconst clockOutTime = parseInt(clockOutTimestamp);\n\t\t\ttotalHours = (clockOutTime - clockInTime) / 3600;\n\n\t\t\t// Deduct lunch time\n\t\t\tif (lunchDurationMinutes) {\n\t\t\t\ttotalHours -= lunchDurationMinutes / 60;\n\t\t\t}\n\t\t}\n\n\t\tawait timeCardORM.insertTimeCardEntry([{\n\t\t\tuser_id: selectedUser,\n\t\t\tclock_in_timestamp: clockInTimestamp,\n\t\t\tclock_out_timestamp: clockOutTimestamp,\n\t\t\ttotal_hours: totalHours,\n\t\t\tlocation: location || null,\n\t\t\twork_description: workDescription || null,\n\t\t\tlunch_start_timestamp: lunchStartTimestamp,\n\t\t\tlunch_end_timestamp: lunchEndTimestamp,\n\t\t\tlunch_duration_minutes: lunchDurationMinutes,\n\t\t} as TimeCardEntryModel]);\n\n\t\tonSave();\n\t\tonClose();\n\t};\n\n\treturn (\n\t\t<Dialog open={open} onOpenChange={onClose}>\n\t\t\t<DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n\t\t\t\t<DialogHeader>\n\t\t\t\t\t<DialogTitle>{t.addManualEntry}</DialogTitle>\n\t\t\t\t</DialogHeader>\n\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t{users && (\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.employeeName}</Label>\n\t\t\t\t\t\t\t<Select value={selectedUser} onValueChange={setSelectedUser}>\n\t\t\t\t\t\t\t\t<SelectTrigger>\n\t\t\t\t\t\t\t\t\t<SelectValue />\n\t\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t\t{users.filter(u => u.role === UserRole.Employee).map((u) => (\n\t\t\t\t\t\t\t\t\t\t<SelectItem key={u.id} value={u.id}>\n\t\t\t\t\t\t\t\t\t\t\t{u.name}\n\t\t\t\t\t\t\t\t\t\t</SelectItem>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t\t</Select>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t\t<div className=\"grid grid-cols-2 gap-4\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.clockInTime}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\tvalue={clockIn}\n\t\t\t\t\t\t\t\tonChange={(e) => setClockIn(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.clockOutTime}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\tvalue={clockOut}\n\t\t\t\t\t\t\t\tonChange={(e) => setClockOut(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<Label>{t.location}</Label>\n\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\tvalue={location}\n\t\t\t\t\t\t\tonChange={(e) => setLocation(e.target.value)}\n\t\t\t\t\t\t\tplaceholder={t.locationPlaceholder}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<Label>{t.workDescription}</Label>\n\t\t\t\t\t\t<Textarea\n\t\t\t\t\t\t\tvalue={workDescription}\n\t\t\t\t\t\t\tonChange={(e) => setWorkDescription(e.target.value)}\n\t\t\t\t\t\t\tplaceholder={t.descriptionPlaceholder}\n\t\t\t\t\t\t\trows={4}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"grid grid-cols-2 gap-4\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.lunchStartTime} ({language === 'en' ? 'Optional' : 'Opcional'})</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\tvalue={lunchStart}\n\t\t\t\t\t\t\t\tonChange={(e) => setLunchStart(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.lunchEndTime} ({language === 'en' ? 'Optional' : 'Opcional'})</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\tvalue={lunchEnd}\n\t\t\t\t\t\t\t\tonChange={(e) => setLunchEnd(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<DialogFooter>\n\t\t\t\t\t<Button variant=\"outline\" onClick={onClose}>\n\t\t\t\t\t\t{t.cancel}\n\t\t\t\t\t</Button>\n\t\t\t\t\t<Button onClick={handleSave} disabled={!selectedUser || !clockIn}>\n\t\t\t\t\t\t{t.saveChanges}\n\t\t\t\t\t</Button>\n\t\t\t\t</DialogFooter>\n\t\t\t</DialogContent>\n\t\t</Dialog>\n\t);\n}\n","structuredPatch":[{"oldStart":319,"oldLines":18,"newStart":319,"newLines":18,"lines":[" }"," "," function EmployeeView({ user, language }: { user: UserModel; language: Language }) {","-  const [activeShift, setActiveShift] = useState<TimeCardEntryModel | null>(null);","   const [timeCards, setTimeCards] = useState<TimeCardEntryModel[]>([]);","-  const [elapsedTime, setElapsedTime] = useState(0);","-  const [location, setLocation] = useState(\"\");","-  const [workDescription, setWorkDescription] = useState(\"\");","-  const [isOnLunch, setIsOnLunch] = useState(false);","-  const [isLoading, setIsLoading] = useState(false);","+  const [currentShift, setCurrentShift] = useState<TimeCardEntryModel | null>(null);","+  const [elapsedSeconds, setElapsedSeconds] = useState(0);","+  const [locationInput, setLocationInput] = useState(\"\");","+  const [descriptionInput, setDescriptionInput] = useState(\"\");","+  const [isProcessing, setIsProcessing] = useState(false);"," ","   const t = translations[language];"," ","+  // Load time cards on mount and find active shift","   useEffect(() => {","-    loadTimeCards();","+    loadAllTimeCards();","   }, [user.id]);"," ","   useEffect(() => {"]}],"userModified":false,"replaceAll":false}}
{"type":"assistant","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_vrtx_01SdqPo4Nc9apZtNDarQvcUC","type":"message","role":"assistant","content":[{"type":"text","text":"I see the issue - I need to complete the refactoring properly. Let me fix all the errors by rewriting the entire EmployeeView component with the new variable names:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":3296,"cache_read_input_tokens":126946,"cache_creation":{"ephemeral_5m_input_tokens":3296,"ephemeral_1h_input_tokens":0},"output_tokens":5},"context_management":null},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"14636774-d300-433e-952d-ca6457496f02"}
{"type":"assistant","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_vrtx_01SdqPo4Nc9apZtNDarQvcUC","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_vrtx_012Ed5XKALcNSsVj5YM65vqb","name":"Read","input":{"file_path":"/home/user/vite-template/src/routes/index.tsx","offset":321,"limit":400}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":3296,"cache_read_input_tokens":126946,"cache_creation":{"ephemeral_5m_input_tokens":3296,"ephemeral_1h_input_tokens":0},"output_tokens":141},"context_management":null},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"c38fd015-070d-4f75-bee9-97d193f9728b"}
{"type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_vrtx_012Ed5XKALcNSsVj5YM65vqb","type":"tool_result","content":"   321‚Üífunction EmployeeView({ user, language }: { user: UserModel; language: Language }) {\n   322‚Üí\tconst [timeCards, setTimeCards] = useState<TimeCardEntryModel[]>([]);\n   323‚Üí\tconst [currentShift, setCurrentShift] = useState<TimeCardEntryModel | null>(null);\n   324‚Üí\tconst [elapsedSeconds, setElapsedSeconds] = useState(0);\n   325‚Üí\tconst [locationInput, setLocationInput] = useState(\"\");\n   326‚Üí\tconst [descriptionInput, setDescriptionInput] = useState(\"\");\n   327‚Üí\tconst [isProcessing, setIsProcessing] = useState(false);\n   328‚Üí\n   329‚Üí\tconst t = translations[language];\n   330‚Üí\n   331‚Üí\t// Load time cards on mount and find active shift\n   332‚Üí\tuseEffect(() => {\n   333‚Üí\t\tloadAllTimeCards();\n   334‚Üí\t}, [user.id]);\n   335‚Üí\n   336‚Üí\tuseEffect(() => {\n   337‚Üí\t\tlet interval: NodeJS.Timeout;\n   338‚Üí\t\tif (activeShift && !isOnLunch) {\n   339‚Üí\t\t\tinterval = setInterval(() => {\n   340‚Üí\t\t\t\tconst clockInTime = parseInt(activeShift.clock_in_timestamp) * 1000;\n   341‚Üí\t\t\t\tconst elapsed = Date.now() - clockInTime;\n   342‚Üí\t\t\t\tsetElapsedTime(elapsed);\n   343‚Üí\t\t\t}, 1000);\n   344‚Üí\t\t}\n   345‚Üí\t\treturn () => clearInterval(interval);\n   346‚Üí\t}, [activeShift, isOnLunch]);\n   347‚Üí\n   348‚Üí\tconst loadTimeCards = async () => {\n   349‚Üí\t\tconsole.log(\"Loading time cards for user:\", user.id);\n   350‚Üí\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n   351‚Üí\t\tconst userTimeCards = await timeCardORM.getTimeCardEntryByUserId(user.id);\n   352‚Üí\n   353‚Üí\t\tconsole.log(\"Found\", userTimeCards.length, \"time cards\");\n   354‚Üí\n   355‚Üí\t\t// Sort by clock in time (newest first)\n   356‚Üí\t\tconst sorted = userTimeCards.sort((a, b) =>\n   357‚Üí\t\t\tparseInt(b.clock_in_timestamp) - parseInt(a.clock_in_timestamp)\n   358‚Üí\t\t);\n   359‚Üí\n   360‚Üí\t\tsetTimeCards(sorted);\n   361‚Üí\n   362‚Üí\t\t// Find active shift (no clock out time)\n   363‚Üí\t\tconst active = sorted.find(tc => !tc.clock_out_timestamp);\n   364‚Üí\t\tconsole.log(\"Active shift found:\", active ? `Yes (ID: ${active.id})` : \"No\");\n   365‚Üí\n   366‚Üí\t\tsetActiveShift(active || null);\n   367‚Üí\t\tif (active) {\n   368‚Üí\t\t\tsetLocation(active.location || \"\");\n   369‚Üí\t\t\tsetWorkDescription(active.work_description || \"\");\n   370‚Üí\t\t\t// Check if on lunch break\n   371‚Üí\t\t\tconst onLunch = !!(active.lunch_start_timestamp && !active.lunch_end_timestamp);\n   372‚Üí\t\t\tsetIsOnLunch(onLunch);\n   373‚Üí\t\t\tconsole.log(\"On lunch:\", onLunch);\n   374‚Üí\t\t} else {\n   375‚Üí\t\t\tsetIsOnLunch(false);\n   376‚Üí\t\t}\n   377‚Üí\t};\n   378‚Üí\n   379‚Üí\tconst handleClockIn = async () => {\n   380‚Üí\t\tconsole.log(\"=== CLOCK IN STARTED ===\");\n   381‚Üí\t\tconsole.log(\"User ID:\", user.id);\n   382‚Üí\t\tconsole.log(\"Location:\", location);\n   383‚Üí\t\tconsole.log(\"Work Description:\", workDescription);\n   384‚Üí\n   385‚Üí\t\tsetIsLoading(true);\n   386‚Üí\t\ttry {\n   387‚Üí\t\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n   388‚Üí\t\t\tconst now = Math.floor(Date.now() / 1000).toString();\n   389‚Üí\t\t\tconsole.log(\"Current timestamp:\", now);\n   390‚Üí\n   391‚Üí\t\t\tconst newEntry = {\n   392‚Üí\t\t\t\tuser_id: user.id,\n   393‚Üí\t\t\t\tclock_in_timestamp: now,\n   394‚Üí\t\t\t\tlocation: location || null,\n   395‚Üí\t\t\t\twork_description: workDescription || null,\n   396‚Üí\t\t\t} as TimeCardEntryModel;\n   397‚Üí\n   398‚Üí\t\t\tconsole.log(\"Inserting time card entry:\", newEntry);\n   399‚Üí\n   400‚Üí\t\t\tconst result = await timeCardORM.insertTimeCardEntry([newEntry]);\n   401‚Üí\t\t\tconsole.log(\"Insert result:\", result);\n   402‚Üí\n   403‚Üí\t\t\tconsole.log(\"Time card entry created successfully!\");\n   404‚Üí\n   405‚Üí\t\t\t// Clear form\n   406‚Üí\t\t\tsetLocation(\"\");\n   407‚Üí\t\t\tsetWorkDescription(\"\");\n   408‚Üí\n   409‚Üí\t\t\t// Reload time cards\n   410‚Üí\t\t\tconsole.log(\"Reloading time cards...\");\n   411‚Üí\t\t\tawait loadTimeCards();\n   412‚Üí\n   413‚Üí\t\t\tconsole.log(\"=== CLOCK IN COMPLETED ===\");\n   414‚Üí\n   415‚Üí\t\t\t// Show success feedback\n   416‚Üí\t\t\tif (activeShift) {\n   417‚Üí\t\t\t\talert(\"‚úÖ Successfully clocked in! You can now see the CLOCK OUT button.\");\n   418‚Üí\t\t\t}\n   419‚Üí\t\t} catch (error) {\n   420‚Üí\t\t\tconsole.error(\"=== CLOCK IN FAILED ===\");\n   421‚Üí\t\t\tconsole.error(\"Error details:\", error);\n   422‚Üí\t\t\talert(`Error clocking in: ${error instanceof Error ? error.message : 'Unknown error'}. Check console for details.`);\n   423‚Üí\t\t} finally {\n   424‚Üí\t\t\tsetIsLoading(false);\n   425‚Üí\t\t}\n   426‚Üí\t};\n   427‚Üí\n   428‚Üí\tconst handleClockOut = async () => {\n   429‚Üí\t\tconsole.log(\"Clock Out clicked - activeShift:\", activeShift);\n   430‚Üí\n   431‚Üí\t\tif (!activeShift) {\n   432‚Üí\t\t\tconsole.error(\"No active shift to clock out!\");\n   433‚Üí\t\t\talert(\"Error: No active shift found. Please try clocking in first.\");\n   434‚Üí\t\t\treturn;\n   435‚Üí\t\t}\n   436‚Üí\n   437‚Üí\t\ttry {\n   438‚Üí\t\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n   439‚Üí\t\t\tconst now = Math.floor(Date.now() / 1000).toString();\n   440‚Üí\n   441‚Üí\t\t\tconst clockInTime = parseInt(activeShift.clock_in_timestamp);\n   442‚Üí\t\t\tconst clockOutTime = parseInt(now);\n   443‚Üí\t\t\tlet totalHours = (clockOutTime - clockInTime) / 3600;\n   444‚Üí\n   445‚Üí\t\t\t// Deduct lunch time if lunch was taken\n   446‚Üí\t\t\tif (activeShift.lunch_duration_minutes) {\n   447‚Üí\t\t\t\ttotalHours -= activeShift.lunch_duration_minutes / 60;\n   448‚Üí\t\t\t}\n   449‚Üí\n   450‚Üí\t\t\tconsole.log(\"Clocking out - Total hours:\", totalHours);\n   451‚Üí\n   452‚Üí\t\t\tawait timeCardORM.setTimeCardEntryById(activeShift.id, {\n   453‚Üí\t\t\t\t...activeShift,\n   454‚Üí\t\t\t\tclock_out_timestamp: now,\n   455‚Üí\t\t\t\ttotal_hours: totalHours,\n   456‚Üí\t\t\t\tlocation: location || activeShift.location,\n   457‚Üí\t\t\t\twork_description: workDescription || activeShift.work_description,\n   458‚Üí\t\t\t});\n   459‚Üí\n   460‚Üí\t\t\tconsole.log(\"Clock out successful!\");\n   461‚Üí\t\t\tsetLocation(\"\");\n   462‚Üí\t\t\tsetWorkDescription(\"\");\n   463‚Üí\t\t\tawait loadTimeCards();\n   464‚Üí\t\t} catch (error) {\n   465‚Üí\t\t\tconsole.error(\"Error clocking out:\", error);\n   466‚Üí\t\t\talert(\"Error clocking out. Please try again.\");\n   467‚Üí\t\t}\n   468‚Üí\t};\n   469‚Üí\n   470‚Üí\tconst handleStartLunch = async () => {\n   471‚Üí\t\tif (!activeShift) return;\n   472‚Üí\n   473‚Üí\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n   474‚Üí\t\tconst now = Math.floor(Date.now() / 1000).toString();\n   475‚Üí\n   476‚Üí\t\tawait timeCardORM.setTimeCardEntryById(activeShift.id, {\n   477‚Üí\t\t\t...activeShift,\n   478‚Üí\t\t\tlunch_start_timestamp: now,\n   479‚Üí\t\t\tlocation: location || activeShift.location,\n   480‚Üí\t\t\twork_description: workDescription || activeShift.work_description,\n   481‚Üí\t\t});\n   482‚Üí\n   483‚Üí\t\tawait loadTimeCards();\n   484‚Üí\t};\n   485‚Üí\n   486‚Üí\tconst handleEndLunch = async () => {\n   487‚Üí\t\tif (!activeShift || !activeShift.lunch_start_timestamp) return;\n   488‚Üí\n   489‚Üí\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n   490‚Üí\t\tconst now = Math.floor(Date.now() / 1000).toString();\n   491‚Üí\n   492‚Üí\t\tconst lunchStartTime = parseInt(activeShift.lunch_start_timestamp);\n   493‚Üí\t\tconst lunchEndTime = parseInt(now);\n   494‚Üí\t\tconst lunchDurationMinutes = (lunchEndTime - lunchStartTime) / 60;\n   495‚Üí\n   496‚Üí\t\t// Add to existing lunch duration if there was already one\n   497‚Üí\t\tconst totalLunchMinutes = (activeShift.lunch_duration_minutes || 0) + lunchDurationMinutes;\n   498‚Üí\n   499‚Üí\t\tawait timeCardORM.setTimeCardEntryById(activeShift.id, {\n   500‚Üí\t\t\t...activeShift,\n   501‚Üí\t\t\tlunch_end_timestamp: now,\n   502‚Üí\t\t\tlunch_duration_minutes: totalLunchMinutes,\n   503‚Üí\t\t});\n   504‚Üí\n   505‚Üí\t\tawait loadTimeCards();\n   506‚Üí\t};\n   507‚Üí\n   508‚Üí\tconst formatTime = (ms: number) => {\n   509‚Üí\t\tconst seconds = Math.floor(ms / 1000);\n   510‚Üí\t\tconst hours = Math.floor(seconds / 3600);\n   511‚Üí\t\tconst minutes = Math.floor((seconds % 3600) / 60);\n   512‚Üí\t\tconst secs = seconds % 60;\n   513‚Üí\t\treturn `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\n   514‚Üí\t};\n   515‚Üí\n   516‚Üí\tconst formatDate = (timestamp: string) => {\n   517‚Üí\t\tconst date = new Date(parseInt(timestamp) * 1000);\n   518‚Üí\t\treturn date.toLocaleString(language === 'es' ? 'es-ES' : 'en-US');\n   519‚Üí\t};\n   520‚Üí\n   521‚Üí\tconst formatHours = (hours: number | null | undefined) => {\n   522‚Üí\t\tif (hours === null || hours === undefined) return \"‚Äî\";\n   523‚Üí\t\treturn `${hours.toFixed(2)} ${language === 'es' ? 'hrs' : 'hrs'}`;\n   524‚Üí\t};\n   525‚Üí\n   526‚Üí\tconst formatMinutes = (minutes: number | null | undefined) => {\n   527‚Üí\t\tif (minutes === null || minutes === undefined) return \"‚Äî\";\n   528‚Üí\t\treturn `${Math.round(minutes)} min`;\n   529‚Üí\t};\n   530‚Üí\n   531‚Üí\treturn (\n   532‚Üí\t\t<div className=\"space-y-6\">\n   533‚Üí\t\t\t<Card>\n   534‚Üí\t\t\t\t<CardHeader>\n   535‚Üí\t\t\t\t\t<CardTitle className=\"flex items-center gap-2\">\n   536‚Üí\t\t\t\t\t\t<Clock className=\"w-5 h-5\" />\n   537‚Üí\t\t\t\t\t\t{t.clockInOut}\n   538‚Üí\t\t\t\t\t</CardTitle>\n   539‚Üí\t\t\t\t\t<CardDescription>\n   540‚Üí\t\t\t\t\t\t{activeShift ? \"‚úÖ You are currently clocked in - Clock out button is below\" : \"‚ùå Not clocked in - Click CLOCK IN button to start\"}\n   541‚Üí\t\t\t\t\t</CardDescription>\n   542‚Üí\t\t\t\t</CardHeader>\n   543‚Üí\t\t\t\t<CardContent className=\"space-y-6\">\n   544‚Üí\t\t\t\t\t{/* Show current status */}\n   545‚Üí\t\t\t\t\t<div className={`p-6 rounded-lg border-2 ${activeShift ? 'bg-green-50 border-green-300 dark:bg-green-900/20 dark:border-green-700' : 'bg-blue-50 border-blue-300 dark:bg-blue-900/20 dark:border-blue-700'}`}>\n   546‚Üí\t\t\t\t\t\t<div className=\"flex items-center justify-between mb-4\">\n   547‚Üí\t\t\t\t\t\t\t<div>\n   548‚Üí\t\t\t\t\t\t\t\t<p className={`text-2xl font-bold ${activeShift ? 'text-green-700' : 'text-blue-700'}`}>\n   549‚Üí\t\t\t\t\t\t\t\t\t{activeShift ? 'üü¢ CLOCKED IN' : '‚ö™ NOT CLOCKED IN'}\n   550‚Üí\t\t\t\t\t\t\t\t</p>\n   551‚Üí\t\t\t\t\t\t\t\t{!activeShift && (\n   552‚Üí\t\t\t\t\t\t\t\t\t<p className=\"text-sm text-blue-600 dark:text-blue-400 mt-2 font-semibold\">\n   553‚Üí\t\t\t\t\t\t\t\t\t\tüëá Fill out the form below and click \"CLOCK IN\"\n   554‚Üí\t\t\t\t\t\t\t\t\t</p>\n   555‚Üí\t\t\t\t\t\t\t\t)}\n   556‚Üí\t\t\t\t\t\t\t\t{activeShift && (\n   557‚Üí\t\t\t\t\t\t\t\t\t<p className=\"text-sm text-muted-foreground\">\n   558‚Üí\t\t\t\t\t\t\t\t\t\tStarted: {formatDate(activeShift.clock_in_timestamp)}\n   559‚Üí\t\t\t\t\t\t\t\t\t</p>\n   560‚Üí\t\t\t\t\t\t\t\t)}\n   561‚Üí\t\t\t\t\t\t\t\t{isOnLunch && (\n   562‚Üí\t\t\t\t\t\t\t\t\t<p className=\"text-sm text-orange-600 font-semibold mt-1\">\n   563‚Üí\t\t\t\t\t\t\t\t\t\t‚òï On Lunch Break\n   564‚Üí\t\t\t\t\t\t\t\t\t</p>\n   565‚Üí\t\t\t\t\t\t\t\t)}\n   566‚Üí\t\t\t\t\t\t\t</div>\n   567‚Üí\t\t\t\t\t\t\t{activeShift && !isOnLunch && (\n   568‚Üí\t\t\t\t\t\t\t\t<div className=\"text-right\">\n   569‚Üí\t\t\t\t\t\t\t\t\t<p className=\"text-3xl font-mono font-bold tabular-nums\">\n   570‚Üí\t\t\t\t\t\t\t\t\t\t{formatTime(elapsedTime)}\n   571‚Üí\t\t\t\t\t\t\t\t\t</p>\n   572‚Üí\t\t\t\t\t\t\t\t\t<p className=\"text-xs text-muted-foreground\">Time Elapsed</p>\n   573‚Üí\t\t\t\t\t\t\t\t</div>\n   574‚Üí\t\t\t\t\t\t\t)}\n   575‚Üí\t\t\t\t\t\t</div>\n   576‚Üí\t\t\t\t\t</div>\n   577‚Üí\n   578‚Üí\t\t\t\t\t{/* Main Action Buttons */}\n   579‚Üí\t\t\t\t\t{activeShift ? (\n   580‚Üí\t\t\t\t\t\t<div className=\"space-y-4\">\n   581‚Üí\t\t\t\t\t\t\t{/* Clock Out Button - ALWAYS VISIBLE when clocked in */}\n   582‚Üí\t\t\t\t\t\t\t<div className=\"bg-red-50 dark:bg-red-950 p-4 rounded-lg border-2 border-red-300 dark:border-red-700\">\n   583‚Üí\t\t\t\t\t\t\t\t<p className=\"text-center text-sm font-bold text-red-700 dark:text-red-300 mb-3\">\n   584‚Üí\t\t\t\t\t\t\t\t\t‚¨áÔ∏è CLICK HERE TO END YOUR SHIFT ‚¨áÔ∏è\n   585‚Üí\t\t\t\t\t\t\t\t</p>\n   586‚Üí\t\t\t\t\t\t\t\t<Button\n   587‚Üí\t\t\t\t\t\t\t\t\tonClick={handleClockOut}\n   588‚Üí\t\t\t\t\t\t\t\t\tvariant=\"destructive\"\n   589‚Üí\t\t\t\t\t\t\t\t\tsize=\"lg\"\n   590‚Üí\t\t\t\t\t\t\t\t\tclassName=\"w-full h-20 text-2xl font-black shadow-lg hover:shadow-xl transition-all\"\n   591‚Üí\t\t\t\t\t\t\t\t>\n   592‚Üí\t\t\t\t\t\t\t\t\t<Clock className=\"w-8 h-8 mr-3\" />\n   593‚Üí\t\t\t\t\t\t\t\t\tCLOCK OUT\n   594‚Üí\t\t\t\t\t\t\t\t</Button>\n   595‚Üí\t\t\t\t\t\t\t</div>\n   596‚Üí\n   597‚Üí\t\t\t\t\t\t\t{/* Lunch Buttons */}\n   598‚Üí\t\t\t\t\t\t\t<div className=\"border-t pt-4\">\n   599‚Üí\t\t\t\t\t\t\t\t<p className=\"text-sm text-muted-foreground mb-3\">Lunch Break (Optional)</p>\n   600‚Üí\t\t\t\t\t\t\t\t{isOnLunch ? (\n   601‚Üí\t\t\t\t\t\t\t\t\t<Button\n   602‚Üí\t\t\t\t\t\t\t\t\t\tonClick={handleEndLunch}\n   603‚Üí\t\t\t\t\t\t\t\t\t\tclassName=\"w-full h-12\"\n   604‚Üí\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n   605‚Üí\t\t\t\t\t\t\t\t\t>\n   606‚Üí\t\t\t\t\t\t\t\t\t\t<Coffee className=\"w-5 h-5 mr-2\" />\n   607‚Üí\t\t\t\t\t\t\t\t\t\tEnd Lunch Break\n   608‚Üí\t\t\t\t\t\t\t\t\t</Button>\n   609‚Üí\t\t\t\t\t\t\t\t) : (\n   610‚Üí\t\t\t\t\t\t\t\t\t<Button\n   611‚Üí\t\t\t\t\t\t\t\t\t\tonClick={handleStartLunch}\n   612‚Üí\t\t\t\t\t\t\t\t\t\tclassName=\"w-full h-12\"\n   613‚Üí\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n   614‚Üí\t\t\t\t\t\t\t\t\t>\n   615‚Üí\t\t\t\t\t\t\t\t\t\t<Coffee className=\"w-5 h-5 mr-2\" />\n   616‚Üí\t\t\t\t\t\t\t\t\t\tStart Lunch Break\n   617‚Üí\t\t\t\t\t\t\t\t\t</Button>\n   618‚Üí\t\t\t\t\t\t\t\t)}\n   619‚Üí\t\t\t\t\t\t\t</div>\n   620‚Üí\n   621‚Üí\t\t\t\t\t\t\t{/* Location and Description */}\n   622‚Üí\t\t\t\t\t\t\t<div className=\"border-t pt-4 space-y-4\">\n   623‚Üí\t\t\t\t\t\t\t\t<div>\n   624‚Üí\t\t\t\t\t\t\t\t\t<Label>{t.location}</Label>\n   625‚Üí\t\t\t\t\t\t\t\t\t<Input\n   626‚Üí\t\t\t\t\t\t\t\t\t\tvalue={location}\n   627‚Üí\t\t\t\t\t\t\t\t\t\tonChange={(e) => setLocation(e.target.value)}\n   628‚Üí\t\t\t\t\t\t\t\t\t\tplaceholder={t.locationPlaceholder}\n   629‚Üí\t\t\t\t\t\t\t\t\t\tclassName=\"mt-2\"\n   630‚Üí\t\t\t\t\t\t\t\t\t/>\n   631‚Üí\t\t\t\t\t\t\t\t</div>\n   632‚Üí\t\t\t\t\t\t\t\t<div>\n   633‚Üí\t\t\t\t\t\t\t\t\t<Label>{t.workDescription}</Label>\n   634‚Üí\t\t\t\t\t\t\t\t\t<Textarea\n   635‚Üí\t\t\t\t\t\t\t\t\t\tvalue={workDescription}\n   636‚Üí\t\t\t\t\t\t\t\t\t\tonChange={(e) => setWorkDescription(e.target.value)}\n   637‚Üí\t\t\t\t\t\t\t\t\t\tplaceholder={t.descriptionPlaceholder}\n   638‚Üí\t\t\t\t\t\t\t\t\t\trows={3}\n   639‚Üí\t\t\t\t\t\t\t\t\t\tclassName=\"mt-2\"\n   640‚Üí\t\t\t\t\t\t\t\t\t/>\n   641‚Üí\t\t\t\t\t\t\t\t</div>\n   642‚Üí\t\t\t\t\t\t\t</div>\n   643‚Üí\t\t\t\t\t\t</div>\n   644‚Üí\t\t\t\t\t) : (\n   645‚Üí\t\t\t\t\t\t<div className=\"space-y-4\">\n   646‚Üí\t\t\t\t\t\t\t{/* Clock In Form */}\n   647‚Üí\t\t\t\t\t\t\t<div>\n   648‚Üí\t\t\t\t\t\t\t\t<Label>{t.location}</Label>\n   649‚Üí\t\t\t\t\t\t\t\t<Input\n   650‚Üí\t\t\t\t\t\t\t\t\tvalue={location}\n   651‚Üí\t\t\t\t\t\t\t\t\tonChange={(e) => setLocation(e.target.value)}\n   652‚Üí\t\t\t\t\t\t\t\t\tplaceholder={t.locationPlaceholder}\n   653‚Üí\t\t\t\t\t\t\t\t\tclassName=\"mt-2\"\n   654‚Üí\t\t\t\t\t\t\t\t\tdisabled={isLoading}\n   655‚Üí\t\t\t\t\t\t\t\t/>\n   656‚Üí\t\t\t\t\t\t\t</div>\n   657‚Üí\t\t\t\t\t\t\t<div>\n   658‚Üí\t\t\t\t\t\t\t\t<Label>{t.workDescription}</Label>\n   659‚Üí\t\t\t\t\t\t\t\t<Textarea\n   660‚Üí\t\t\t\t\t\t\t\t\tvalue={workDescription}\n   661‚Üí\t\t\t\t\t\t\t\t\tonChange={(e) => setWorkDescription(e.target.value)}\n   662‚Üí\t\t\t\t\t\t\t\t\tplaceholder={t.descriptionPlaceholder}\n   663‚Üí\t\t\t\t\t\t\t\t\trows={3}\n   664‚Üí\t\t\t\t\t\t\t\t\tclassName=\"mt-2\"\n   665‚Üí\t\t\t\t\t\t\t\t\tdisabled={isLoading}\n   666‚Üí\t\t\t\t\t\t\t\t/>\n   667‚Üí\t\t\t\t\t\t\t</div>\n   668‚Üí\t\t\t\t\t\t\t<Button\n   669‚Üí\t\t\t\t\t\t\t\tonClick={handleClockIn}\n   670‚Üí\t\t\t\t\t\t\t\tsize=\"lg\"\n   671‚Üí\t\t\t\t\t\t\t\tdisabled={isLoading}\n   672‚Üí\t\t\t\t\t\t\t\tclassName=\"w-full h-16 text-xl font-bold bg-green-600 hover:bg-green-700 disabled:opacity-50\"\n   673‚Üí\t\t\t\t\t\t\t>\n   674‚Üí\t\t\t\t\t\t\t\t<Clock className=\"w-6 h-6 mr-2\" />\n   675‚Üí\t\t\t\t\t\t\t\t{isLoading ? \"CLOCKING IN...\" : \"CLOCK IN\"}\n   676‚Üí\t\t\t\t\t\t\t</Button>\n   677‚Üí\t\t\t\t\t\t\t{isLoading && (\n   678‚Üí\t\t\t\t\t\t\t\t<p className=\"text-center text-sm text-muted-foreground animate-pulse\">\n   679‚Üí\t\t\t\t\t\t\t\t\tPlease wait, processing...\n   680‚Üí\t\t\t\t\t\t\t\t</p>\n   681‚Üí\t\t\t\t\t\t\t)}\n   682‚Üí\t\t\t\t\t\t</div>\n   683‚Üí\t\t\t\t\t)}\n   684‚Üí\t\t\t\t</CardContent>\n   685‚Üí\t\t\t</Card>\n   686‚Üí\n   687‚Üí\t\t\t<Card>\n   688‚Üí\t\t\t\t<CardHeader>\n   689‚Üí\t\t\t\t\t<CardTitle className=\"flex items-center gap-2\">\n   690‚Üí\t\t\t\t\t\t<CalendarDays className=\"w-5 h-5\" />\n   691‚Üí\t\t\t\t\t\t{t.timeCardHistory}\n   692‚Üí\t\t\t\t\t</CardTitle>\n   693‚Üí\t\t\t\t\t<CardDescription>{t.recentRecords}</CardDescription>\n   694‚Üí\t\t\t\t</CardHeader>\n   695‚Üí\t\t\t\t<CardContent>\n   696‚Üí\t\t\t\t\t{timeCards.length === 0 ? (\n   697‚Üí\t\t\t\t\t\t<p className=\"text-center text-muted-foreground py-8\">{t.noTimeCards}</p>\n   698‚Üí\t\t\t\t\t) : (\n   699‚Üí\t\t\t\t\t\t<div className=\"overflow-x-auto\">\n   700‚Üí\t\t\t\t\t\t\t<Table>\n   701‚Üí\t\t\t\t\t\t\t\t<TableHeader>\n   702‚Üí\t\t\t\t\t\t\t\t\t<TableRow>\n   703‚Üí\t\t\t\t\t\t\t\t\t\t<TableHead>{t.clockInTime}</TableHead>\n   704‚Üí\t\t\t\t\t\t\t\t\t\t<TableHead>{t.clockOutTime}</TableHead>\n   705‚Üí\t\t\t\t\t\t\t\t\t\t<TableHead>{t.location}</TableHead>\n   706‚Üí\t\t\t\t\t\t\t\t\t\t<TableHead>{t.workDescription}</TableHead>\n   707‚Üí\t\t\t\t\t\t\t\t\t\t<TableHead>{t.lunchDuration}</TableHead>\n   708‚Üí\t\t\t\t\t\t\t\t\t\t<TableHead>{t.hours}</TableHead>\n   709‚Üí\t\t\t\t\t\t\t\t\t\t<TableHead>{t.status}</TableHead>\n   710‚Üí\t\t\t\t\t\t\t\t\t</TableRow>\n   711‚Üí\t\t\t\t\t\t\t\t</TableHeader>\n   712‚Üí\t\t\t\t\t\t\t\t<TableBody>\n   713‚Üí\t\t\t\t\t\t\t\t\t{timeCards.map((tc) => (\n   714‚Üí\t\t\t\t\t\t\t\t\t\t<TableRow key={tc.id}>\n   715‚Üí\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatDate(tc.clock_in_timestamp)}</TableCell>\n   716‚Üí\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">\n   717‚Üí\t\t\t\t\t\t\t\t\t\t\t\t{tc.clock_out_timestamp ? formatDate(tc.clock_out_timestamp) : \"‚Äî\"}\n   718‚Üí\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n   719‚Üí\t\t\t\t\t\t\t\t\t\t\t<TableCell>{tc.location || \"‚Äî\"}</TableCell>\n   720‚Üí\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"max-w-xs truncate\">{tc.work_description || \"‚Äî\"}</TableCell>\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"395000bb-442e-4eb1-950f-8372c1e479e0","tool_use_result":{"type":"text","file":{"filePath":"/home/user/vite-template/src/routes/index.tsx","content":"function EmployeeView({ user, language }: { user: UserModel; language: Language }) {\n\tconst [timeCards, setTimeCards] = useState<TimeCardEntryModel[]>([]);\n\tconst [currentShift, setCurrentShift] = useState<TimeCardEntryModel | null>(null);\n\tconst [elapsedSeconds, setElapsedSeconds] = useState(0);\n\tconst [locationInput, setLocationInput] = useState(\"\");\n\tconst [descriptionInput, setDescriptionInput] = useState(\"\");\n\tconst [isProcessing, setIsProcessing] = useState(false);\n\n\tconst t = translations[language];\n\n\t// Load time cards on mount and find active shift\n\tuseEffect(() => {\n\t\tloadAllTimeCards();\n\t}, [user.id]);\n\n\tuseEffect(() => {\n\t\tlet interval: NodeJS.Timeout;\n\t\tif (activeShift && !isOnLunch) {\n\t\t\tinterval = setInterval(() => {\n\t\t\t\tconst clockInTime = parseInt(activeShift.clock_in_timestamp) * 1000;\n\t\t\t\tconst elapsed = Date.now() - clockInTime;\n\t\t\t\tsetElapsedTime(elapsed);\n\t\t\t}, 1000);\n\t\t}\n\t\treturn () => clearInterval(interval);\n\t}, [activeShift, isOnLunch]);\n\n\tconst loadTimeCards = async () => {\n\t\tconsole.log(\"Loading time cards for user:\", user.id);\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tconst userTimeCards = await timeCardORM.getTimeCardEntryByUserId(user.id);\n\n\t\tconsole.log(\"Found\", userTimeCards.length, \"time cards\");\n\n\t\t// Sort by clock in time (newest first)\n\t\tconst sorted = userTimeCards.sort((a, b) =>\n\t\t\tparseInt(b.clock_in_timestamp) - parseInt(a.clock_in_timestamp)\n\t\t);\n\n\t\tsetTimeCards(sorted);\n\n\t\t// Find active shift (no clock out time)\n\t\tconst active = sorted.find(tc => !tc.clock_out_timestamp);\n\t\tconsole.log(\"Active shift found:\", active ? `Yes (ID: ${active.id})` : \"No\");\n\n\t\tsetActiveShift(active || null);\n\t\tif (active) {\n\t\t\tsetLocation(active.location || \"\");\n\t\t\tsetWorkDescription(active.work_description || \"\");\n\t\t\t// Check if on lunch break\n\t\t\tconst onLunch = !!(active.lunch_start_timestamp && !active.lunch_end_timestamp);\n\t\t\tsetIsOnLunch(onLunch);\n\t\t\tconsole.log(\"On lunch:\", onLunch);\n\t\t} else {\n\t\t\tsetIsOnLunch(false);\n\t\t}\n\t};\n\n\tconst handleClockIn = async () => {\n\t\tconsole.log(\"=== CLOCK IN STARTED ===\");\n\t\tconsole.log(\"User ID:\", user.id);\n\t\tconsole.log(\"Location:\", location);\n\t\tconsole.log(\"Work Description:\", workDescription);\n\n\t\tsetIsLoading(true);\n\t\ttry {\n\t\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\t\tconst now = Math.floor(Date.now() / 1000).toString();\n\t\t\tconsole.log(\"Current timestamp:\", now);\n\n\t\t\tconst newEntry = {\n\t\t\t\tuser_id: user.id,\n\t\t\t\tclock_in_timestamp: now,\n\t\t\t\tlocation: location || null,\n\t\t\t\twork_description: workDescription || null,\n\t\t\t} as TimeCardEntryModel;\n\n\t\t\tconsole.log(\"Inserting time card entry:\", newEntry);\n\n\t\t\tconst result = await timeCardORM.insertTimeCardEntry([newEntry]);\n\t\t\tconsole.log(\"Insert result:\", result);\n\n\t\t\tconsole.log(\"Time card entry created successfully!\");\n\n\t\t\t// Clear form\n\t\t\tsetLocation(\"\");\n\t\t\tsetWorkDescription(\"\");\n\n\t\t\t// Reload time cards\n\t\t\tconsole.log(\"Reloading time cards...\");\n\t\t\tawait loadTimeCards();\n\n\t\t\tconsole.log(\"=== CLOCK IN COMPLETED ===\");\n\n\t\t\t// Show success feedback\n\t\t\tif (activeShift) {\n\t\t\t\talert(\"‚úÖ Successfully clocked in! You can now see the CLOCK OUT button.\");\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.error(\"=== CLOCK IN FAILED ===\");\n\t\t\tconsole.error(\"Error details:\", error);\n\t\t\talert(`Error clocking in: ${error instanceof Error ? error.message : 'Unknown error'}. Check console for details.`);\n\t\t} finally {\n\t\t\tsetIsLoading(false);\n\t\t}\n\t};\n\n\tconst handleClockOut = async () => {\n\t\tconsole.log(\"Clock Out clicked - activeShift:\", activeShift);\n\n\t\tif (!activeShift) {\n\t\t\tconsole.error(\"No active shift to clock out!\");\n\t\t\talert(\"Error: No active shift found. Please try clocking in first.\");\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\t\tconst now = Math.floor(Date.now() / 1000).toString();\n\n\t\t\tconst clockInTime = parseInt(activeShift.clock_in_timestamp);\n\t\t\tconst clockOutTime = parseInt(now);\n\t\t\tlet totalHours = (clockOutTime - clockInTime) / 3600;\n\n\t\t\t// Deduct lunch time if lunch was taken\n\t\t\tif (activeShift.lunch_duration_minutes) {\n\t\t\t\ttotalHours -= activeShift.lunch_duration_minutes / 60;\n\t\t\t}\n\n\t\t\tconsole.log(\"Clocking out - Total hours:\", totalHours);\n\n\t\t\tawait timeCardORM.setTimeCardEntryById(activeShift.id, {\n\t\t\t\t...activeShift,\n\t\t\t\tclock_out_timestamp: now,\n\t\t\t\ttotal_hours: totalHours,\n\t\t\t\tlocation: location || activeShift.location,\n\t\t\t\twork_description: workDescription || activeShift.work_description,\n\t\t\t});\n\n\t\t\tconsole.log(\"Clock out successful!\");\n\t\t\tsetLocation(\"\");\n\t\t\tsetWorkDescription(\"\");\n\t\t\tawait loadTimeCards();\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Error clocking out:\", error);\n\t\t\talert(\"Error clocking out. Please try again.\");\n\t\t}\n\t};\n\n\tconst handleStartLunch = async () => {\n\t\tif (!activeShift) return;\n\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tconst now = Math.floor(Date.now() / 1000).toString();\n\n\t\tawait timeCardORM.setTimeCardEntryById(activeShift.id, {\n\t\t\t...activeShift,\n\t\t\tlunch_start_timestamp: now,\n\t\t\tlocation: location || activeShift.location,\n\t\t\twork_description: workDescription || activeShift.work_description,\n\t\t});\n\n\t\tawait loadTimeCards();\n\t};\n\n\tconst handleEndLunch = async () => {\n\t\tif (!activeShift || !activeShift.lunch_start_timestamp) return;\n\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tconst now = Math.floor(Date.now() / 1000).toString();\n\n\t\tconst lunchStartTime = parseInt(activeShift.lunch_start_timestamp);\n\t\tconst lunchEndTime = parseInt(now);\n\t\tconst lunchDurationMinutes = (lunchEndTime - lunchStartTime) / 60;\n\n\t\t// Add to existing lunch duration if there was already one\n\t\tconst totalLunchMinutes = (activeShift.lunch_duration_minutes || 0) + lunchDurationMinutes;\n\n\t\tawait timeCardORM.setTimeCardEntryById(activeShift.id, {\n\t\t\t...activeShift,\n\t\t\tlunch_end_timestamp: now,\n\t\t\tlunch_duration_minutes: totalLunchMinutes,\n\t\t});\n\n\t\tawait loadTimeCards();\n\t};\n\n\tconst formatTime = (ms: number) => {\n\t\tconst seconds = Math.floor(ms / 1000);\n\t\tconst hours = Math.floor(seconds / 3600);\n\t\tconst minutes = Math.floor((seconds % 3600) / 60);\n\t\tconst secs = seconds % 60;\n\t\treturn `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\n\t};\n\n\tconst formatDate = (timestamp: string) => {\n\t\tconst date = new Date(parseInt(timestamp) * 1000);\n\t\treturn date.toLocaleString(language === 'es' ? 'es-ES' : 'en-US');\n\t};\n\n\tconst formatHours = (hours: number | null | undefined) => {\n\t\tif (hours === null || hours === undefined) return \"‚Äî\";\n\t\treturn `${hours.toFixed(2)} ${language === 'es' ? 'hrs' : 'hrs'}`;\n\t};\n\n\tconst formatMinutes = (minutes: number | null | undefined) => {\n\t\tif (minutes === null || minutes === undefined) return \"‚Äî\";\n\t\treturn `${Math.round(minutes)} min`;\n\t};\n\n\treturn (\n\t\t<div className=\"space-y-6\">\n\t\t\t<Card>\n\t\t\t\t<CardHeader>\n\t\t\t\t\t<CardTitle className=\"flex items-center gap-2\">\n\t\t\t\t\t\t<Clock className=\"w-5 h-5\" />\n\t\t\t\t\t\t{t.clockInOut}\n\t\t\t\t\t</CardTitle>\n\t\t\t\t\t<CardDescription>\n\t\t\t\t\t\t{activeShift ? \"‚úÖ You are currently clocked in - Clock out button is below\" : \"‚ùå Not clocked in - Click CLOCK IN button to start\"}\n\t\t\t\t\t</CardDescription>\n\t\t\t\t</CardHeader>\n\t\t\t\t<CardContent className=\"space-y-6\">\n\t\t\t\t\t{/* Show current status */}\n\t\t\t\t\t<div className={`p-6 rounded-lg border-2 ${activeShift ? 'bg-green-50 border-green-300 dark:bg-green-900/20 dark:border-green-700' : 'bg-blue-50 border-blue-300 dark:bg-blue-900/20 dark:border-blue-700'}`}>\n\t\t\t\t\t\t<div className=\"flex items-center justify-between mb-4\">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<p className={`text-2xl font-bold ${activeShift ? 'text-green-700' : 'text-blue-700'}`}>\n\t\t\t\t\t\t\t\t\t{activeShift ? 'üü¢ CLOCKED IN' : '‚ö™ NOT CLOCKED IN'}\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t{!activeShift && (\n\t\t\t\t\t\t\t\t\t<p className=\"text-sm text-blue-600 dark:text-blue-400 mt-2 font-semibold\">\n\t\t\t\t\t\t\t\t\t\tüëá Fill out the form below and click \"CLOCK IN\"\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t{activeShift && (\n\t\t\t\t\t\t\t\t\t<p className=\"text-sm text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\tStarted: {formatDate(activeShift.clock_in_timestamp)}\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t{isOnLunch && (\n\t\t\t\t\t\t\t\t\t<p className=\"text-sm text-orange-600 font-semibold mt-1\">\n\t\t\t\t\t\t\t\t\t\t‚òï On Lunch Break\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{activeShift && !isOnLunch && (\n\t\t\t\t\t\t\t\t<div className=\"text-right\">\n\t\t\t\t\t\t\t\t\t<p className=\"text-3xl font-mono font-bold tabular-nums\">\n\t\t\t\t\t\t\t\t\t\t{formatTime(elapsedTime)}\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t<p className=\"text-xs text-muted-foreground\">Time Elapsed</p>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Main Action Buttons */}\n\t\t\t\t\t{activeShift ? (\n\t\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t\t{/* Clock Out Button - ALWAYS VISIBLE when clocked in */}\n\t\t\t\t\t\t\t<div className=\"bg-red-50 dark:bg-red-950 p-4 rounded-lg border-2 border-red-300 dark:border-red-700\">\n\t\t\t\t\t\t\t\t<p className=\"text-center text-sm font-bold text-red-700 dark:text-red-300 mb-3\">\n\t\t\t\t\t\t\t\t\t‚¨áÔ∏è CLICK HERE TO END YOUR SHIFT ‚¨áÔ∏è\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tonClick={handleClockOut}\n\t\t\t\t\t\t\t\t\tvariant=\"destructive\"\n\t\t\t\t\t\t\t\t\tsize=\"lg\"\n\t\t\t\t\t\t\t\t\tclassName=\"w-full h-20 text-2xl font-black shadow-lg hover:shadow-xl transition-all\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<Clock className=\"w-8 h-8 mr-3\" />\n\t\t\t\t\t\t\t\t\tCLOCK OUT\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t{/* Lunch Buttons */}\n\t\t\t\t\t\t\t<div className=\"border-t pt-4\">\n\t\t\t\t\t\t\t\t<p className=\"text-sm text-muted-foreground mb-3\">Lunch Break (Optional)</p>\n\t\t\t\t\t\t\t\t{isOnLunch ? (\n\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\tonClick={handleEndLunch}\n\t\t\t\t\t\t\t\t\t\tclassName=\"w-full h-12\"\n\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<Coffee className=\"w-5 h-5 mr-2\" />\n\t\t\t\t\t\t\t\t\t\tEnd Lunch Break\n\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\tonClick={handleStartLunch}\n\t\t\t\t\t\t\t\t\t\tclassName=\"w-full h-12\"\n\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<Coffee className=\"w-5 h-5 mr-2\" />\n\t\t\t\t\t\t\t\t\t\tStart Lunch Break\n\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t{/* Location and Description */}\n\t\t\t\t\t\t\t<div className=\"border-t pt-4 space-y-4\">\n\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t<Label>{t.location}</Label>\n\t\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\t\tvalue={location}\n\t\t\t\t\t\t\t\t\t\tonChange={(e) => setLocation(e.target.value)}\n\t\t\t\t\t\t\t\t\t\tplaceholder={t.locationPlaceholder}\n\t\t\t\t\t\t\t\t\t\tclassName=\"mt-2\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t<Label>{t.workDescription}</Label>\n\t\t\t\t\t\t\t\t\t<Textarea\n\t\t\t\t\t\t\t\t\t\tvalue={workDescription}\n\t\t\t\t\t\t\t\t\t\tonChange={(e) => setWorkDescription(e.target.value)}\n\t\t\t\t\t\t\t\t\t\tplaceholder={t.descriptionPlaceholder}\n\t\t\t\t\t\t\t\t\t\trows={3}\n\t\t\t\t\t\t\t\t\t\tclassName=\"mt-2\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t\t{/* Clock In Form */}\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<Label>{t.location}</Label>\n\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\tvalue={location}\n\t\t\t\t\t\t\t\t\tonChange={(e) => setLocation(e.target.value)}\n\t\t\t\t\t\t\t\t\tplaceholder={t.locationPlaceholder}\n\t\t\t\t\t\t\t\t\tclassName=\"mt-2\"\n\t\t\t\t\t\t\t\t\tdisabled={isLoading}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<Label>{t.workDescription}</Label>\n\t\t\t\t\t\t\t\t<Textarea\n\t\t\t\t\t\t\t\t\tvalue={workDescription}\n\t\t\t\t\t\t\t\t\tonChange={(e) => setWorkDescription(e.target.value)}\n\t\t\t\t\t\t\t\t\tplaceholder={t.descriptionPlaceholder}\n\t\t\t\t\t\t\t\t\trows={3}\n\t\t\t\t\t\t\t\t\tclassName=\"mt-2\"\n\t\t\t\t\t\t\t\t\tdisabled={isLoading}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tonClick={handleClockIn}\n\t\t\t\t\t\t\t\tsize=\"lg\"\n\t\t\t\t\t\t\t\tdisabled={isLoading}\n\t\t\t\t\t\t\t\tclassName=\"w-full h-16 text-xl font-bold bg-green-600 hover:bg-green-700 disabled:opacity-50\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Clock className=\"w-6 h-6 mr-2\" />\n\t\t\t\t\t\t\t\t{isLoading ? \"CLOCKING IN...\" : \"CLOCK IN\"}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t{isLoading && (\n\t\t\t\t\t\t\t\t<p className=\"text-center text-sm text-muted-foreground animate-pulse\">\n\t\t\t\t\t\t\t\t\tPlease wait, processing...\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</CardContent>\n\t\t\t</Card>\n\n\t\t\t<Card>\n\t\t\t\t<CardHeader>\n\t\t\t\t\t<CardTitle className=\"flex items-center gap-2\">\n\t\t\t\t\t\t<CalendarDays className=\"w-5 h-5\" />\n\t\t\t\t\t\t{t.timeCardHistory}\n\t\t\t\t\t</CardTitle>\n\t\t\t\t\t<CardDescription>{t.recentRecords}</CardDescription>\n\t\t\t\t</CardHeader>\n\t\t\t\t<CardContent>\n\t\t\t\t\t{timeCards.length === 0 ? (\n\t\t\t\t\t\t<p className=\"text-center text-muted-foreground py-8\">{t.noTimeCards}</p>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<div className=\"overflow-x-auto\">\n\t\t\t\t\t\t\t<Table>\n\t\t\t\t\t\t\t\t<TableHeader>\n\t\t\t\t\t\t\t\t\t<TableRow>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.clockInTime}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.clockOutTime}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.location}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.workDescription}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.lunchDuration}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.hours}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.status}</TableHead>\n\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t</TableHeader>\n\t\t\t\t\t\t\t\t<TableBody>\n\t\t\t\t\t\t\t\t\t{timeCards.map((tc) => (\n\t\t\t\t\t\t\t\t\t\t<TableRow key={tc.id}>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatDate(tc.clock_in_timestamp)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t{tc.clock_out_timestamp ? formatDate(tc.clock_out_timestamp) : \"‚Äî\"}\n\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell>{tc.location || \"‚Äî\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"max-w-xs truncate\">{tc.work_description || \"‚Äî\"}</TableCell>","numLines":400,"startLine":321,"totalLines":1911}}}
{"type":"assistant","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_vrtx_016PuNuBsihv6FT8MYkFYPti","type":"message","role":"assistant","content":[{"type":"text","text":"I see the problem - the refactoring was incomplete. Let me completely replace the EmployeeView function with corrected variable names:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":5739,"cache_read_input_tokens":130242,"cache_creation":{"ephemeral_5m_input_tokens":5739,"ephemeral_1h_input_tokens":0},"output_tokens":3},"context_management":null},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"2529fd82-a6b1-4f13-b3b2-0fdc43112140"}
{"type":"assistant","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_vrtx_016PuNuBsihv6FT8MYkFYPti","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_vrtx_01Mi4eBzJr1ER5Gad2Cw4xpA","name":"Edit","input":{"file_path":"/home/user/vite-template/src/routes/index.tsx","old_string":"function EmployeeView({ user, language }: { user: UserModel; language: Language }) {\n\tconst [timeCards, setTimeCards] = useState<TimeCardEntryModel[]>([]);\n\tconst [currentShift, setCurrentShift] = useState<TimeCardEntryModel | null>(null);\n\tconst [elapsedSeconds, setElapsedSeconds] = useState(0);\n\tconst [locationInput, setLocationInput] = useState(\"\");\n\tconst [descriptionInput, setDescriptionInput] = useState(\"\");\n\tconst [isProcessing, setIsProcessing] = useState(false);\n\n\tconst t = translations[language];\n\n\t// Load time cards on mount and find active shift\n\tuseEffect(() => {\n\t\tloadAllTimeCards();\n\t}, [user.id]);\n\n\tuseEffect(() => {\n\t\tlet interval: NodeJS.Timeout;\n\t\tif (activeShift && !isOnLunch) {\n\t\t\tinterval = setInterval(() => {\n\t\t\t\tconst clockInTime = parseInt(activeShift.clock_in_timestamp) * 1000;\n\t\t\t\tconst elapsed = Date.now() - clockInTime;\n\t\t\t\tsetElapsedTime(elapsed);\n\t\t\t}, 1000);\n\t\t}\n\t\treturn () => clearInterval(interval);\n\t}, [activeShift, isOnLunch]);\n\n\tconst loadTimeCards = async () => {\n\t\tconsole.log(\"Loading time cards for user:\", user.id);\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tconst userTimeCards = await timeCardORM.getTimeCardEntryByUserId(user.id);\n\n\t\tconsole.log(\"Found\", userTimeCards.length, \"time cards\");\n\n\t\t// Sort by clock in time (newest first)\n\t\tconst sorted = userTimeCards.sort((a, b) =>\n\t\t\tparseInt(b.clock_in_timestamp) - parseInt(a.clock_in_timestamp)\n\t\t);\n\n\t\tsetTimeCards(sorted);\n\n\t\t// Find active shift (no clock out time)\n\t\tconst active = sorted.find(tc => !tc.clock_out_timestamp);\n\t\tconsole.log(\"Active shift found:\", active ? `Yes (ID: ${active.id})` : \"No\");\n\n\t\tsetActiveShift(active || null);\n\t\tif (active) {\n\t\t\tsetLocation(active.location || \"\");\n\t\t\tsetWorkDescription(active.work_description || \"\");\n\t\t\t// Check if on lunch break\n\t\t\tconst onLunch = !!(active.lunch_start_timestamp && !active.lunch_end_timestamp);\n\t\t\tsetIsOnLunch(onLunch);\n\t\t\tconsole.log(\"On lunch:\", onLunch);\n\t\t} else {\n\t\t\tsetIsOnLunch(false);\n\t\t}\n\t};","new_string":"function EmployeeView({ user, language }: { user: UserModel; language: Language }) {\n\tconst [timeCards, setTimeCards] = useState<TimeCardEntryModel[]>([]);\n\tconst [activeShift, setActiveShift] = useState<TimeCardEntryModel | null>(null);\n\tconst [elapsedTime, setElapsedTime] = useState(0);\n\tconst [location, setLocation] = useState(\"\");\n\tconst [workDescription, setWorkDescription] = useState(\"\");\n\tconst [isOnLunch, setIsOnLunch] = useState(false);\n\tconst [isLoading, setIsLoading] = useState(false);\n\n\tconst t = translations[language];\n\n\tuseEffect(() => {\n\t\tloadTimeCards();\n\t}, [user.id]);\n\n\tuseEffect(() => {\n\t\tlet interval: NodeJS.Timeout;\n\t\tif (activeShift && !isOnLunch) {\n\t\t\tinterval = setInterval(() => {\n\t\t\t\tconst clockInTime = parseInt(activeShift.clock_in_timestamp) * 1000;\n\t\t\t\tconst elapsed = Date.now() - clockInTime;\n\t\t\t\tsetElapsedTime(elapsed);\n\t\t\t}, 1000);\n\t\t}\n\t\treturn () => clearInterval(interval);\n\t}, [activeShift, isOnLunch]);\n\n\tconst loadTimeCards = async () => {\n\t\tconsole.log(\"Loading time cards for user:\", user.id);\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tconst userTimeCards = await timeCardORM.getTimeCardEntryByUserId(user.id);\n\n\t\tconsole.log(\"Found\", userTimeCards.length, \"time cards\");\n\n\t\t// Sort by clock in time (newest first)\n\t\tconst sorted = userTimeCards.sort((a, b) =>\n\t\t\tparseInt(b.clock_in_timestamp) - parseInt(a.clock_in_timestamp)\n\t\t);\n\n\t\tsetTimeCards(sorted);\n\n\t\t// Find active shift (no clock out time)\n\t\tconst active = sorted.find(tc => !tc.clock_out_timestamp);\n\t\tconsole.log(\"Active shift found:\", active ? `Yes (ID: ${active.id})` : \"No\");\n\n\t\tsetActiveShift(active || null);\n\t\tif (active) {\n\t\t\tsetLocation(active.location || \"\");\n\t\t\tsetWorkDescription(active.work_description || \"\");\n\t\t\t// Check if on lunch break\n\t\t\tconst onLunch = !!(active.lunch_start_timestamp && !active.lunch_end_timestamp);\n\t\t\tsetIsOnLunch(onLunch);\n\t\t\tconsole.log(\"On lunch:\", onLunch);\n\t\t} else {\n\t\t\tsetIsOnLunch(false);\n\t\t}\n\t};"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":5739,"cache_read_input_tokens":130242,"cache_creation":{"ephemeral_5m_input_tokens":5739,"ephemeral_1h_input_tokens":0},"output_tokens":1411},"context_management":null},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"c709726f-c7ee-4760-8f98-f7f8d5169c23"}
{"type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_vrtx_01Mi4eBzJr1ER5Gad2Cw4xpA","type":"tool_result","content":"The file /home/user/vite-template/src/routes/index.tsx has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n   317‚Üí\t\t</div>\n   318‚Üí\t);\n   319‚Üí}\n   320‚Üí\n   321‚Üífunction EmployeeView({ user, language }: { user: UserModel; language: Language }) {\n   322‚Üí\tconst [timeCards, setTimeCards] = useState<TimeCardEntryModel[]>([]);\n   323‚Üí\tconst [activeShift, setActiveShift] = useState<TimeCardEntryModel | null>(null);\n   324‚Üí\tconst [elapsedTime, setElapsedTime] = useState(0);\n   325‚Üí\tconst [location, setLocation] = useState(\"\");\n   326‚Üí\tconst [workDescription, setWorkDescription] = useState(\"\");\n   327‚Üí\tconst [isOnLunch, setIsOnLunch] = useState(false);\n   328‚Üí\tconst [isLoading, setIsLoading] = useState(false);\n   329‚Üí\n   330‚Üí\tconst t = translations[language];\n   331‚Üí\n   332‚Üí\tuseEffect(() => {\n   333‚Üí\t\tloadTimeCards();\n   334‚Üí\t}, [user.id]);\n   335‚Üí\n   336‚Üí\tuseEffect(() => {\n   337‚Üí\t\tlet interval: NodeJS.Timeout;\n   338‚Üí\t\tif (activeShift && !isOnLunch) {\n   339‚Üí\t\t\tinterval = setInterval(() => {\n   340‚Üí\t\t\t\tconst clockInTime = parseInt(activeShift.clock_in_timestamp) * 1000;\n   341‚Üí\t\t\t\tconst elapsed = Date.now() - clockInTime;\n   342‚Üí\t\t\t\tsetElapsedTime(elapsed);\n   343‚Üí\t\t\t}, 1000);\n   344‚Üí\t\t}\n   345‚Üí\t\treturn () => clearInterval(interval);\n   346‚Üí\t}, [activeShift, isOnLunch]);\n   347‚Üí\n   348‚Üí\tconst loadTimeCards = async () => {\n   349‚Üí\t\tconsole.log(\"Loading time cards for user:\", user.id);\n   350‚Üí\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n   351‚Üí\t\tconst userTimeCards = await timeCardORM.getTimeCardEntryByUserId(user.id);\n   352‚Üí\n   353‚Üí\t\tconsole.log(\"Found\", userTimeCards.length, \"time cards\");\n   354‚Üí\n   355‚Üí\t\t// Sort by clock in time (newest first)\n   356‚Üí\t\tconst sorted = userTimeCards.sort((a, b) =>\n   357‚Üí\t\t\tparseInt(b.clock_in_timestamp) - parseInt(a.clock_in_timestamp)\n   358‚Üí\t\t);\n   359‚Üí\n   360‚Üí\t\tsetTimeCards(sorted);\n   361‚Üí\n   362‚Üí\t\t// Find active shift (no clock out time)\n   363‚Üí\t\tconst active = sorted.find(tc => !tc.clock_out_timestamp);\n   364‚Üí\t\tconsole.log(\"Active shift found:\", active ? `Yes (ID: ${active.id})` : \"No\");\n   365‚Üí\n   366‚Üí\t\tsetActiveShift(active || null);\n   367‚Üí\t\tif (active) {\n   368‚Üí\t\t\tsetLocation(active.location || \"\");\n   369‚Üí\t\t\tsetWorkDescription(active.work_description || \"\");\n   370‚Üí\t\t\t// Check if on lunch break\n   371‚Üí\t\t\tconst onLunch = !!(active.lunch_start_timestamp && !active.lunch_end_timestamp);\n   372‚Üí\t\t\tsetIsOnLunch(onLunch);\n   373‚Üí\t\t\tconsole.log(\"On lunch:\", onLunch);\n   374‚Üí\t\t} else {\n   375‚Üí\t\t\tsetIsOnLunch(false);\n   376‚Üí\t\t}\n   377‚Üí\t};\n   378‚Üí\n   379‚Üí\tconst handleClockIn = async () => {\n   380‚Üí\t\tconsole.log(\"=== CLOCK IN STARTED ===\");\n   381‚Üí\t\tconsole.log(\"User ID:\", user.id);"}]},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"babc9cf7-a159-4afd-bbac-dac97031bf2b","tool_use_result":{"filePath":"/home/user/vite-template/src/routes/index.tsx","oldString":"function EmployeeView({ user, language }: { user: UserModel; language: Language }) {\n\tconst [timeCards, setTimeCards] = useState<TimeCardEntryModel[]>([]);\n\tconst [currentShift, setCurrentShift] = useState<TimeCardEntryModel | null>(null);\n\tconst [elapsedSeconds, setElapsedSeconds] = useState(0);\n\tconst [locationInput, setLocationInput] = useState(\"\");\n\tconst [descriptionInput, setDescriptionInput] = useState(\"\");\n\tconst [isProcessing, setIsProcessing] = useState(false);\n\n\tconst t = translations[language];\n\n\t// Load time cards on mount and find active shift\n\tuseEffect(() => {\n\t\tloadAllTimeCards();\n\t}, [user.id]);\n\n\tuseEffect(() => {\n\t\tlet interval: NodeJS.Timeout;\n\t\tif (activeShift && !isOnLunch) {\n\t\t\tinterval = setInterval(() => {\n\t\t\t\tconst clockInTime = parseInt(activeShift.clock_in_timestamp) * 1000;\n\t\t\t\tconst elapsed = Date.now() - clockInTime;\n\t\t\t\tsetElapsedTime(elapsed);\n\t\t\t}, 1000);\n\t\t}\n\t\treturn () => clearInterval(interval);\n\t}, [activeShift, isOnLunch]);\n\n\tconst loadTimeCards = async () => {\n\t\tconsole.log(\"Loading time cards for user:\", user.id);\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tconst userTimeCards = await timeCardORM.getTimeCardEntryByUserId(user.id);\n\n\t\tconsole.log(\"Found\", userTimeCards.length, \"time cards\");\n\n\t\t// Sort by clock in time (newest first)\n\t\tconst sorted = userTimeCards.sort((a, b) =>\n\t\t\tparseInt(b.clock_in_timestamp) - parseInt(a.clock_in_timestamp)\n\t\t);\n\n\t\tsetTimeCards(sorted);\n\n\t\t// Find active shift (no clock out time)\n\t\tconst active = sorted.find(tc => !tc.clock_out_timestamp);\n\t\tconsole.log(\"Active shift found:\", active ? `Yes (ID: ${active.id})` : \"No\");\n\n\t\tsetActiveShift(active || null);\n\t\tif (active) {\n\t\t\tsetLocation(active.location || \"\");\n\t\t\tsetWorkDescription(active.work_description || \"\");\n\t\t\t// Check if on lunch break\n\t\t\tconst onLunch = !!(active.lunch_start_timestamp && !active.lunch_end_timestamp);\n\t\t\tsetIsOnLunch(onLunch);\n\t\t\tconsole.log(\"On lunch:\", onLunch);\n\t\t} else {\n\t\t\tsetIsOnLunch(false);\n\t\t}\n\t};","newString":"function EmployeeView({ user, language }: { user: UserModel; language: Language }) {\n\tconst [timeCards, setTimeCards] = useState<TimeCardEntryModel[]>([]);\n\tconst [activeShift, setActiveShift] = useState<TimeCardEntryModel | null>(null);\n\tconst [elapsedTime, setElapsedTime] = useState(0);\n\tconst [location, setLocation] = useState(\"\");\n\tconst [workDescription, setWorkDescription] = useState(\"\");\n\tconst [isOnLunch, setIsOnLunch] = useState(false);\n\tconst [isLoading, setIsLoading] = useState(false);\n\n\tconst t = translations[language];\n\n\tuseEffect(() => {\n\t\tloadTimeCards();\n\t}, [user.id]);\n\n\tuseEffect(() => {\n\t\tlet interval: NodeJS.Timeout;\n\t\tif (activeShift && !isOnLunch) {\n\t\t\tinterval = setInterval(() => {\n\t\t\t\tconst clockInTime = parseInt(activeShift.clock_in_timestamp) * 1000;\n\t\t\t\tconst elapsed = Date.now() - clockInTime;\n\t\t\t\tsetElapsedTime(elapsed);\n\t\t\t}, 1000);\n\t\t}\n\t\treturn () => clearInterval(interval);\n\t}, [activeShift, isOnLunch]);\n\n\tconst loadTimeCards = async () => {\n\t\tconsole.log(\"Loading time cards for user:\", user.id);\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tconst userTimeCards = await timeCardORM.getTimeCardEntryByUserId(user.id);\n\n\t\tconsole.log(\"Found\", userTimeCards.length, \"time cards\");\n\n\t\t// Sort by clock in time (newest first)\n\t\tconst sorted = userTimeCards.sort((a, b) =>\n\t\t\tparseInt(b.clock_in_timestamp) - parseInt(a.clock_in_timestamp)\n\t\t);\n\n\t\tsetTimeCards(sorted);\n\n\t\t// Find active shift (no clock out time)\n\t\tconst active = sorted.find(tc => !tc.clock_out_timestamp);\n\t\tconsole.log(\"Active shift found:\", active ? `Yes (ID: ${active.id})` : \"No\");\n\n\t\tsetActiveShift(active || null);\n\t\tif (active) {\n\t\t\tsetLocation(active.location || \"\");\n\t\t\tsetWorkDescription(active.work_description || \"\");\n\t\t\t// Check if on lunch break\n\t\t\tconst onLunch = !!(active.lunch_start_timestamp && !active.lunch_end_timestamp);\n\t\t\tsetIsOnLunch(onLunch);\n\t\t\tconsole.log(\"On lunch:\", onLunch);\n\t\t} else {\n\t\t\tsetIsOnLunch(false);\n\t\t}\n\t};","originalFile":"import { createFileRoute } from \"@tanstack/react-router\";\nimport { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from \"@/components/ui/dialog\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Clock, Users, CalendarDays, Timer, Languages, Coffee, UserPlus, FileText, AlertCircle, Plus, Trash2 } from \"lucide-react\";\nimport { UserORM, type UserModel, UserRole } from \"@/sdk/database/orm/orm_user\";\nimport { TimeCardEntryORM, type TimeCardEntryModel } from \"@/sdk/database/orm/orm_time_card_entry\";\n\nexport const Route = createFileRoute(\"/\")({\n\tcomponent: App,\n});\n\ntype Language = 'en' | 'es';\n\nconst translations = {\n\ten: {\n\t\tappTitle: \"Employee Time Tracking\",\n\t\tselectAccount: \"Select your account to continue\",\n\t\tselectUser: \"Select User\",\n\t\tchooseAccount: \"Choose your account\",\n\t\tmanager: \"Manager\",\n\t\temployee: \"Employee\",\n\t\tswitchUser: \"Switch User\",\n\t\ttimeTrackingSystem: \"Time Tracking System\",\n\t\twelcome: \"Welcome\",\n\t\tclockInOut: \"Clock In/Out\",\n\t\tcurrentlyClocked: \"Currently Clocked In\",\n\t\tsince: \"Since\",\n\t\telapsedTime: \"Elapsed Time\",\n\t\tclockOut: \"Clock Out\",\n\t\tnotClocked: \"Not currently clocked in\",\n\t\tclockIn: \"Clock In\",\n\t\ttimeCardHistory: \"Time Card History\",\n\t\trecentRecords: \"Your recent clock in/out records\",\n\t\tnoTimeCards: \"No time cards yet\",\n\t\tclockInTime: \"Clock In\",\n\t\tclockOutTime: \"Clock Out\",\n\t\thours: \"Hours\",\n\t\tstatus: \"Status\",\n\t\tcompleted: \"Completed\",\n\t\tactive: \"Active\",\n\t\ttotalEmployees: \"Total Employees\",\n\t\thoursToday: \"Hours Today\",\n\t\thoursThisWeek: \"Hours This Week\",\n\t\tallEmployeeTimeCards: \"All Employee Time Cards\",\n\t\tviewManageRecords: \"View and manage all employee time records\",\n\t\tfilterByEmployee: \"Filter by Employee\",\n\t\tallEmployees: \"All Employees\",\n\t\tfilterByDate: \"Filter by Date\",\n\t\tclearFilters: \"Clear Filters\",\n\t\tnoTimeCardsFound: \"No time cards found\",\n\t\temployeeName: \"Employee\",\n\t\tactions: \"Actions\",\n\t\tedit: \"Edit\",\n\t\teditTimeCard: \"Edit Time Card\",\n\t\tcancel: \"Cancel\",\n\t\tsaveChanges: \"Save Changes\",\n\t\tlocation: \"Location\",\n\t\twhereWorked: \"Where did you work?\",\n\t\tworkDescription: \"Work Description\",\n\t\twhatDid: \"What did you do today?\",\n\t\tlocationPlaceholder: \"e.g., Office, Remote, Client Site\",\n\t\tdescriptionPlaceholder: \"Describe your work activities...\",\n\t\tstartLunch: \"Start Lunch Break\",\n\t\tendLunch: \"End Lunch Break\",\n\t\tonLunchBreak: \"On Lunch Break\",\n\t\tlunchBreak: \"Lunch Break\",\n\t\tlunchDuration: \"Lunch\",\n\t\tlunchStartTime: \"Lunch Start\",\n\t\tlunchEndTime: \"Lunch End\",\n\t\ttimeCards: \"Time Cards\",\n\t\treports: \"Reports\",\n\t\temployees: \"Employees\",\n\t\taddEmployee: \"Add Employee\",\n\t\teditEmployee: \"Edit Employee\",\n\t\tdeleteEmployee: \"Delete Employee\",\n\t\tname: \"Name\",\n\t\temail: \"Email\",\n\t\tphone: \"Phone\",\n\t\trole: \"Role\",\n\t\tdelete: \"Delete\",\n\t\tweeklyReport: \"Weekly Report\",\n\t\tselectWeek: \"Select Week\",\n\t\tregularHours: \"Regular\",\n\t\tovertimeHours: \"Overtime\",\n\t\ttotalHours: \"Total\",\n\t\tnoReportData: \"No data for selected week\",\n\t\taddTimeCard: \"Add Time Card\",\n\t\tmanualEntry: \"Manual Entry\",\n\t\taddManualEntry: \"Add Manual Time Card\",\n\t\tconfirmDelete: \"Are you sure you want to delete this employee?\",\n\t\tovertimeAlert: \"Overtime Alert\",\n\t\tprintReport: \"Print Report\",\n\t\texportCSV: \"Export to CSV\",\n\t\tdetailedReport: \"Detailed Time Card Report\",\n\t\tdate: \"Date\",\n\t\tday: \"Day\",\n\t\tdeleteTimeCard: \"Delete Time Card\",\n\t\tconfirmDeleteTimeCard: \"Are you sure you want to delete this time card? This action cannot be undone.\",\n\t},\n\tes: {\n\t\tappTitle: \"Registro de Tiempo de Empleados\",\n\t\tselectAccount: \"Selecciona tu cuenta para continuar\",\n\t\tselectUser: \"Seleccionar Usuario\",\n\t\tchooseAccount: \"Elige tu cuenta\",\n\t\tmanager: \"Gerente\",\n\t\temployee: \"Empleado\",\n\t\tswitchUser: \"Cambiar Usuario\",\n\t\ttimeTrackingSystem: \"Sistema de Registro de Tiempo\",\n\t\twelcome: \"Bienvenido\",\n\t\tclockInOut: \"Entrada/Salida\",\n\t\tcurrentlyClocked: \"Actualmente Registrado\",\n\t\tsince: \"Desde\",\n\t\telapsedTime: \"Tiempo Transcurrido\",\n\t\tclockOut: \"Registrar Salida\",\n\t\tnotClocked: \"No est√° registrado actualmente\",\n\t\tclockIn: \"Registrar Entrada\",\n\t\ttimeCardHistory: \"Historial de Tarjetas de Tiempo\",\n\t\trecentRecords: \"Tus registros recientes de entrada/salida\",\n\t\tnoTimeCards: \"No hay tarjetas de tiempo todav√≠a\",\n\t\tclockInTime: \"Entrada\",\n\t\tclockOutTime: \"Salida\",\n\t\thours: \"Horas\",\n\t\tstatus: \"Estado\",\n\t\tcompleted: \"Completado\",\n\t\tactive: \"Activo\",\n\t\ttotalEmployees: \"Total de Empleados\",\n\t\thoursToday: \"Horas Hoy\",\n\t\thoursThisWeek: \"Horas Esta Semana\",\n\t\tallEmployeeTimeCards: \"Todas las Tarjetas de Tiempo\",\n\t\tviewManageRecords: \"Ver y gestionar todos los registros de empleados\",\n\t\tfilterByEmployee: \"Filtrar por Empleado\",\n\t\tallEmployees: \"Todos los Empleados\",\n\t\tfilterByDate: \"Filtrar por Fecha\",\n\t\tclearFilters: \"Limpiar Filtros\",\n\t\tnoTimeCardsFound: \"No se encontraron tarjetas de tiempo\",\n\t\temployeeName: \"Empleado\",\n\t\tactions: \"Acciones\",\n\t\tedit: \"Editar\",\n\t\teditTimeCard: \"Editar Tarjeta de Tiempo\",\n\t\tcancel: \"Cancelar\",\n\t\tsaveChanges: \"Guardar Cambios\",\n\t\tlocation: \"Ubicaci√≥n\",\n\t\twhereWorked: \"¬øD√≥nde trabajaste?\",\n\t\tworkDescription: \"Descripci√≥n del Trabajo\",\n\t\twhatDid: \"¬øQu√© hiciste hoy?\",\n\t\tlocationPlaceholder: \"ej., Oficina, Remoto, Sitio del Cliente\",\n\t\tdescriptionPlaceholder: \"Describe tus actividades laborales...\",\n\t\tstartLunch: \"Iniciar Almuerzo\",\n\t\tendLunch: \"Terminar Almuerzo\",\n\t\tonLunchBreak: \"En Almuerzo\",\n\t\tlunchBreak: \"Almuerzo\",\n\t\tlunchDuration: \"Almuerzo\",\n\t\tlunchStartTime: \"Inicio Almuerzo\",\n\t\tlunchEndTime: \"Fin Almuerzo\",\n\t\ttimeCards: \"Tarjetas de Tiempo\",\n\t\treports: \"Informes\",\n\t\temployees: \"Empleados\",\n\t\taddEmployee: \"Agregar Empleado\",\n\t\teditEmployee: \"Editar Empleado\",\n\t\tdeleteEmployee: \"Eliminar Empleado\",\n\t\tname: \"Nombre\",\n\t\temail: \"Correo\",\n\t\tphone: \"Tel√©fono\",\n\t\trole: \"Rol\",\n\t\tdelete: \"Eliminar\",\n\t\tweeklyReport: \"Informe Semanal\",\n\t\tselectWeek: \"Seleccionar Semana\",\n\t\tregularHours: \"Regular\",\n\t\tovertimeHours: \"Tiempo Extra\",\n\t\ttotalHours: \"Total\",\n\t\tnoReportData: \"No hay datos para la semana seleccionada\",\n\t\taddTimeCard: \"Agregar Tarjeta\",\n\t\tmanualEntry: \"Entrada Manual\",\n\t\taddManualEntry: \"Agregar Tarjeta Manual\",\n\t\tconfirmDelete: \"¬øEst√° seguro de eliminar este empleado?\",\n\t\tovertimeAlert: \"Alerta de Tiempo Extra\",\n\t\tprintReport: \"Imprimir Informe\",\n\t\texportCSV: \"Exportar a CSV\",\n\t\tdetailedReport: \"Informe Detallado de Tarjetas de Tiempo\",\n\t\tdate: \"Fecha\",\n\t\tday: \"D√≠a\",\n\t\tdeleteTimeCard: \"Eliminar Tarjeta de Tiempo\",\n\t\tconfirmDeleteTimeCard: \"¬øEst√° seguro de eliminar esta tarjeta de tiempo? Esta acci√≥n no se puede deshacer.\",\n\t}\n};\n\nfunction App() {\n\tconst [currentUser, setCurrentUser] = useState<UserModel | null>(null);\n\tconst [users, setUsers] = useState<UserModel[]>([]);\n\tconst [showUserSelect, setShowUserSelect] = useState(true);\n\tconst [language, setLanguage] = useState<Language>('en');\n\n\tconst t = translations[language];\n\n\tuseEffect(() => {\n\t\tloadUsers();\n\t}, []);\n\n\tconst loadUsers = async () => {\n\t\tconst userORM = UserORM.getInstance();\n\t\tconst allUsers = await userORM.getAllUser();\n\n\t\t// If no users exist, create demo users\n\t\tif (allUsers.length === 0) {\n\t\t\tconst demoUsers = await userORM.insertUser([\n\t\t\t\t{\n\t\t\t\t\tname: \"John Smith\",\n\t\t\t\t\temail: \"john@example.com\",\n\t\t\t\t\trole: UserRole.Employee,\n\t\t\t\t} as UserModel,\n\t\t\t\t{\n\t\t\t\t\tname: \"Sarah Johnson\",\n\t\t\t\t\temail: \"sarah@example.com\",\n\t\t\t\t\trole: UserRole.Employee,\n\t\t\t\t} as UserModel,\n\t\t\t\t{\n\t\t\t\t\tname: \"Mike Manager\",\n\t\t\t\t\temail: \"mike@example.com\",\n\t\t\t\t\trole: UserRole.Manager,\n\t\t\t\t} as UserModel,\n\t\t\t]);\n\t\t\tsetUsers(demoUsers);\n\t\t} else {\n\t\t\tsetUsers(allUsers);\n\t\t}\n\t};\n\n\tconst handleUserSelect = (userId: string) => {\n\t\tconst user = users.find(u => u.id === userId);\n\t\tif (user) {\n\t\t\tsetCurrentUser(user);\n\t\t\tsetShowUserSelect(false);\n\t\t}\n\t};\n\n\tconst handleLogout = () => {\n\t\tsetCurrentUser(null);\n\t\tsetShowUserSelect(true);\n\t};\n\n\tconst toggleLanguage = () => {\n\t\tsetLanguage(prev => prev === 'en' ? 'es' : 'en');\n\t};\n\n\tif (showUserSelect || !currentUser) {\n\t\treturn (\n\t\t\t<div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800 flex items-center justify-center p-4\">\n\t\t\t\t<div className=\"absolute top-4 right-4\">\n\t\t\t\t\t<Button onClick={toggleLanguage} variant=\"outline\" size=\"sm\">\n\t\t\t\t\t\t<Languages className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t\t{language === 'en' ? 'Espa√±ol' : 'English'}\n\t\t\t\t\t</Button>\n\t\t\t\t</div>\n\t\t\t\t<Card className=\"w-full max-w-md\">\n\t\t\t\t\t<CardHeader>\n\t\t\t\t\t\t<CardTitle className=\"text-2xl\">{t.appTitle}</CardTitle>\n\t\t\t\t\t\t<CardDescription>{t.selectAccount}</CardDescription>\n\t\t\t\t\t</CardHeader>\n\t\t\t\t\t<CardContent className=\"space-y-4\">\n\t\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t\t<Label>{t.selectUser}</Label>\n\t\t\t\t\t\t\t<Select onValueChange={handleUserSelect}>\n\t\t\t\t\t\t\t\t<SelectTrigger className=\"w-full\">\n\t\t\t\t\t\t\t\t\t<SelectValue placeholder={t.chooseAccount} />\n\t\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t\t{users.map((user) => (\n\t\t\t\t\t\t\t\t\t\t<SelectItem key={user.id} value={user.id}>\n\t\t\t\t\t\t\t\t\t\t\t{user.name} - {user.role === UserRole.Manager ? t.manager : t.employee}\n\t\t\t\t\t\t\t\t\t\t</SelectItem>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t\t</Select>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</CardContent>\n\t\t\t\t</Card>\n\t\t\t</div>\n\t\t);\n\t}\n\n\treturn (\n\t\t<div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800\">\n\t\t\t<div className=\"container mx-auto p-6 space-y-6\">\n\t\t\t\t<div className=\"flex justify-between items-center\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<h1 className=\"text-3xl font-bold\">{t.timeTrackingSystem}</h1>\n\t\t\t\t\t\t<p className=\"text-muted-foreground\">\n\t\t\t\t\t\t\t{t.welcome}, {currentUser.name} ({currentUser.role === UserRole.Manager ? t.manager : t.employee})\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"flex gap-2\">\n\t\t\t\t\t\t<Button onClick={toggleLanguage} variant=\"outline\" size=\"sm\">\n\t\t\t\t\t\t\t<Languages className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t\t\t{language === 'en' ? 'Espa√±ol' : 'English'}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button onClick={handleLogout} variant=\"outline\">\n\t\t\t\t\t\t\t{t.switchUser}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t{currentUser.role === UserRole.Employee ? (\n\t\t\t\t\t<EmployeeView user={currentUser} language={language} />\n\t\t\t\t) : (\n\t\t\t\t\t<ManagerView user={currentUser} users={users} language={language} onUsersChange={loadUsers} />\n\t\t\t\t)}\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n\nfunction EmployeeView({ user, language }: { user: UserModel; language: Language }) {\n\tconst [timeCards, setTimeCards] = useState<TimeCardEntryModel[]>([]);\n\tconst [currentShift, setCurrentShift] = useState<TimeCardEntryModel | null>(null);\n\tconst [elapsedSeconds, setElapsedSeconds] = useState(0);\n\tconst [locationInput, setLocationInput] = useState(\"\");\n\tconst [descriptionInput, setDescriptionInput] = useState(\"\");\n\tconst [isProcessing, setIsProcessing] = useState(false);\n\n\tconst t = translations[language];\n\n\t// Load time cards on mount and find active shift\n\tuseEffect(() => {\n\t\tloadAllTimeCards();\n\t}, [user.id]);\n\n\tuseEffect(() => {\n\t\tlet interval: NodeJS.Timeout;\n\t\tif (activeShift && !isOnLunch) {\n\t\t\tinterval = setInterval(() => {\n\t\t\t\tconst clockInTime = parseInt(activeShift.clock_in_timestamp) * 1000;\n\t\t\t\tconst elapsed = Date.now() - clockInTime;\n\t\t\t\tsetElapsedTime(elapsed);\n\t\t\t}, 1000);\n\t\t}\n\t\treturn () => clearInterval(interval);\n\t}, [activeShift, isOnLunch]);\n\n\tconst loadTimeCards = async () => {\n\t\tconsole.log(\"Loading time cards for user:\", user.id);\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tconst userTimeCards = await timeCardORM.getTimeCardEntryByUserId(user.id);\n\n\t\tconsole.log(\"Found\", userTimeCards.length, \"time cards\");\n\n\t\t// Sort by clock in time (newest first)\n\t\tconst sorted = userTimeCards.sort((a, b) =>\n\t\t\tparseInt(b.clock_in_timestamp) - parseInt(a.clock_in_timestamp)\n\t\t);\n\n\t\tsetTimeCards(sorted);\n\n\t\t// Find active shift (no clock out time)\n\t\tconst active = sorted.find(tc => !tc.clock_out_timestamp);\n\t\tconsole.log(\"Active shift found:\", active ? `Yes (ID: ${active.id})` : \"No\");\n\n\t\tsetActiveShift(active || null);\n\t\tif (active) {\n\t\t\tsetLocation(active.location || \"\");\n\t\t\tsetWorkDescription(active.work_description || \"\");\n\t\t\t// Check if on lunch break\n\t\t\tconst onLunch = !!(active.lunch_start_timestamp && !active.lunch_end_timestamp);\n\t\t\tsetIsOnLunch(onLunch);\n\t\t\tconsole.log(\"On lunch:\", onLunch);\n\t\t} else {\n\t\t\tsetIsOnLunch(false);\n\t\t}\n\t};\n\n\tconst handleClockIn = async () => {\n\t\tconsole.log(\"=== CLOCK IN STARTED ===\");\n\t\tconsole.log(\"User ID:\", user.id);\n\t\tconsole.log(\"Location:\", location);\n\t\tconsole.log(\"Work Description:\", workDescription);\n\n\t\tsetIsLoading(true);\n\t\ttry {\n\t\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\t\tconst now = Math.floor(Date.now() / 1000).toString();\n\t\t\tconsole.log(\"Current timestamp:\", now);\n\n\t\t\tconst newEntry = {\n\t\t\t\tuser_id: user.id,\n\t\t\t\tclock_in_timestamp: now,\n\t\t\t\tlocation: location || null,\n\t\t\t\twork_description: workDescription || null,\n\t\t\t} as TimeCardEntryModel;\n\n\t\t\tconsole.log(\"Inserting time card entry:\", newEntry);\n\n\t\t\tconst result = await timeCardORM.insertTimeCardEntry([newEntry]);\n\t\t\tconsole.log(\"Insert result:\", result);\n\n\t\t\tconsole.log(\"Time card entry created successfully!\");\n\n\t\t\t// Clear form\n\t\t\tsetLocation(\"\");\n\t\t\tsetWorkDescription(\"\");\n\n\t\t\t// Reload time cards\n\t\t\tconsole.log(\"Reloading time cards...\");\n\t\t\tawait loadTimeCards();\n\n\t\t\tconsole.log(\"=== CLOCK IN COMPLETED ===\");\n\n\t\t\t// Show success feedback\n\t\t\tif (activeShift) {\n\t\t\t\talert(\"‚úÖ Successfully clocked in! You can now see the CLOCK OUT button.\");\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.error(\"=== CLOCK IN FAILED ===\");\n\t\t\tconsole.error(\"Error details:\", error);\n\t\t\talert(`Error clocking in: ${error instanceof Error ? error.message : 'Unknown error'}. Check console for details.`);\n\t\t} finally {\n\t\t\tsetIsLoading(false);\n\t\t}\n\t};\n\n\tconst handleClockOut = async () => {\n\t\tconsole.log(\"Clock Out clicked - activeShift:\", activeShift);\n\n\t\tif (!activeShift) {\n\t\t\tconsole.error(\"No active shift to clock out!\");\n\t\t\talert(\"Error: No active shift found. Please try clocking in first.\");\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\t\tconst now = Math.floor(Date.now() / 1000).toString();\n\n\t\t\tconst clockInTime = parseInt(activeShift.clock_in_timestamp);\n\t\t\tconst clockOutTime = parseInt(now);\n\t\t\tlet totalHours = (clockOutTime - clockInTime) / 3600;\n\n\t\t\t// Deduct lunch time if lunch was taken\n\t\t\tif (activeShift.lunch_duration_minutes) {\n\t\t\t\ttotalHours -= activeShift.lunch_duration_minutes / 60;\n\t\t\t}\n\n\t\t\tconsole.log(\"Clocking out - Total hours:\", totalHours);\n\n\t\t\tawait timeCardORM.setTimeCardEntryById(activeShift.id, {\n\t\t\t\t...activeShift,\n\t\t\t\tclock_out_timestamp: now,\n\t\t\t\ttotal_hours: totalHours,\n\t\t\t\tlocation: location || activeShift.location,\n\t\t\t\twork_description: workDescription || activeShift.work_description,\n\t\t\t});\n\n\t\t\tconsole.log(\"Clock out successful!\");\n\t\t\tsetLocation(\"\");\n\t\t\tsetWorkDescription(\"\");\n\t\t\tawait loadTimeCards();\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Error clocking out:\", error);\n\t\t\talert(\"Error clocking out. Please try again.\");\n\t\t}\n\t};\n\n\tconst handleStartLunch = async () => {\n\t\tif (!activeShift) return;\n\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tconst now = Math.floor(Date.now() / 1000).toString();\n\n\t\tawait timeCardORM.setTimeCardEntryById(activeShift.id, {\n\t\t\t...activeShift,\n\t\t\tlunch_start_timestamp: now,\n\t\t\tlocation: location || activeShift.location,\n\t\t\twork_description: workDescription || activeShift.work_description,\n\t\t});\n\n\t\tawait loadTimeCards();\n\t};\n\n\tconst handleEndLunch = async () => {\n\t\tif (!activeShift || !activeShift.lunch_start_timestamp) return;\n\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tconst now = Math.floor(Date.now() / 1000).toString();\n\n\t\tconst lunchStartTime = parseInt(activeShift.lunch_start_timestamp);\n\t\tconst lunchEndTime = parseInt(now);\n\t\tconst lunchDurationMinutes = (lunchEndTime - lunchStartTime) / 60;\n\n\t\t// Add to existing lunch duration if there was already one\n\t\tconst totalLunchMinutes = (activeShift.lunch_duration_minutes || 0) + lunchDurationMinutes;\n\n\t\tawait timeCardORM.setTimeCardEntryById(activeShift.id, {\n\t\t\t...activeShift,\n\t\t\tlunch_end_timestamp: now,\n\t\t\tlunch_duration_minutes: totalLunchMinutes,\n\t\t});\n\n\t\tawait loadTimeCards();\n\t};\n\n\tconst formatTime = (ms: number) => {\n\t\tconst seconds = Math.floor(ms / 1000);\n\t\tconst hours = Math.floor(seconds / 3600);\n\t\tconst minutes = Math.floor((seconds % 3600) / 60);\n\t\tconst secs = seconds % 60;\n\t\treturn `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\n\t};\n\n\tconst formatDate = (timestamp: string) => {\n\t\tconst date = new Date(parseInt(timestamp) * 1000);\n\t\treturn date.toLocaleString(language === 'es' ? 'es-ES' : 'en-US');\n\t};\n\n\tconst formatHours = (hours: number | null | undefined) => {\n\t\tif (hours === null || hours === undefined) return \"‚Äî\";\n\t\treturn `${hours.toFixed(2)} ${language === 'es' ? 'hrs' : 'hrs'}`;\n\t};\n\n\tconst formatMinutes = (minutes: number | null | undefined) => {\n\t\tif (minutes === null || minutes === undefined) return \"‚Äî\";\n\t\treturn `${Math.round(minutes)} min`;\n\t};\n\n\treturn (\n\t\t<div className=\"space-y-6\">\n\t\t\t<Card>\n\t\t\t\t<CardHeader>\n\t\t\t\t\t<CardTitle className=\"flex items-center gap-2\">\n\t\t\t\t\t\t<Clock className=\"w-5 h-5\" />\n\t\t\t\t\t\t{t.clockInOut}\n\t\t\t\t\t</CardTitle>\n\t\t\t\t\t<CardDescription>\n\t\t\t\t\t\t{activeShift ? \"‚úÖ You are currently clocked in - Clock out button is below\" : \"‚ùå Not clocked in - Click CLOCK IN button to start\"}\n\t\t\t\t\t</CardDescription>\n\t\t\t\t</CardHeader>\n\t\t\t\t<CardContent className=\"space-y-6\">\n\t\t\t\t\t{/* Show current status */}\n\t\t\t\t\t<div className={`p-6 rounded-lg border-2 ${activeShift ? 'bg-green-50 border-green-300 dark:bg-green-900/20 dark:border-green-700' : 'bg-blue-50 border-blue-300 dark:bg-blue-900/20 dark:border-blue-700'}`}>\n\t\t\t\t\t\t<div className=\"flex items-center justify-between mb-4\">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<p className={`text-2xl font-bold ${activeShift ? 'text-green-700' : 'text-blue-700'}`}>\n\t\t\t\t\t\t\t\t\t{activeShift ? 'üü¢ CLOCKED IN' : '‚ö™ NOT CLOCKED IN'}\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t{!activeShift && (\n\t\t\t\t\t\t\t\t\t<p className=\"text-sm text-blue-600 dark:text-blue-400 mt-2 font-semibold\">\n\t\t\t\t\t\t\t\t\t\tüëá Fill out the form below and click \"CLOCK IN\"\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t{activeShift && (\n\t\t\t\t\t\t\t\t\t<p className=\"text-sm text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\tStarted: {formatDate(activeShift.clock_in_timestamp)}\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t{isOnLunch && (\n\t\t\t\t\t\t\t\t\t<p className=\"text-sm text-orange-600 font-semibold mt-1\">\n\t\t\t\t\t\t\t\t\t\t‚òï On Lunch Break\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{activeShift && !isOnLunch && (\n\t\t\t\t\t\t\t\t<div className=\"text-right\">\n\t\t\t\t\t\t\t\t\t<p className=\"text-3xl font-mono font-bold tabular-nums\">\n\t\t\t\t\t\t\t\t\t\t{formatTime(elapsedTime)}\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t<p className=\"text-xs text-muted-foreground\">Time Elapsed</p>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Main Action Buttons */}\n\t\t\t\t\t{activeShift ? (\n\t\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t\t{/* Clock Out Button - ALWAYS VISIBLE when clocked in */}\n\t\t\t\t\t\t\t<div className=\"bg-red-50 dark:bg-red-950 p-4 rounded-lg border-2 border-red-300 dark:border-red-700\">\n\t\t\t\t\t\t\t\t<p className=\"text-center text-sm font-bold text-red-700 dark:text-red-300 mb-3\">\n\t\t\t\t\t\t\t\t\t‚¨áÔ∏è CLICK HERE TO END YOUR SHIFT ‚¨áÔ∏è\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tonClick={handleClockOut}\n\t\t\t\t\t\t\t\t\tvariant=\"destructive\"\n\t\t\t\t\t\t\t\t\tsize=\"lg\"\n\t\t\t\t\t\t\t\t\tclassName=\"w-full h-20 text-2xl font-black shadow-lg hover:shadow-xl transition-all\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<Clock className=\"w-8 h-8 mr-3\" />\n\t\t\t\t\t\t\t\t\tCLOCK OUT\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t{/* Lunch Buttons */}\n\t\t\t\t\t\t\t<div className=\"border-t pt-4\">\n\t\t\t\t\t\t\t\t<p className=\"text-sm text-muted-foreground mb-3\">Lunch Break (Optional)</p>\n\t\t\t\t\t\t\t\t{isOnLunch ? (\n\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\tonClick={handleEndLunch}\n\t\t\t\t\t\t\t\t\t\tclassName=\"w-full h-12\"\n\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<Coffee className=\"w-5 h-5 mr-2\" />\n\t\t\t\t\t\t\t\t\t\tEnd Lunch Break\n\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\tonClick={handleStartLunch}\n\t\t\t\t\t\t\t\t\t\tclassName=\"w-full h-12\"\n\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<Coffee className=\"w-5 h-5 mr-2\" />\n\t\t\t\t\t\t\t\t\t\tStart Lunch Break\n\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t{/* Location and Description */}\n\t\t\t\t\t\t\t<div className=\"border-t pt-4 space-y-4\">\n\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t<Label>{t.location}</Label>\n\t\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\t\tvalue={location}\n\t\t\t\t\t\t\t\t\t\tonChange={(e) => setLocation(e.target.value)}\n\t\t\t\t\t\t\t\t\t\tplaceholder={t.locationPlaceholder}\n\t\t\t\t\t\t\t\t\t\tclassName=\"mt-2\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t<Label>{t.workDescription}</Label>\n\t\t\t\t\t\t\t\t\t<Textarea\n\t\t\t\t\t\t\t\t\t\tvalue={workDescription}\n\t\t\t\t\t\t\t\t\t\tonChange={(e) => setWorkDescription(e.target.value)}\n\t\t\t\t\t\t\t\t\t\tplaceholder={t.descriptionPlaceholder}\n\t\t\t\t\t\t\t\t\t\trows={3}\n\t\t\t\t\t\t\t\t\t\tclassName=\"mt-2\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t\t{/* Clock In Form */}\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<Label>{t.location}</Label>\n\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\tvalue={location}\n\t\t\t\t\t\t\t\t\tonChange={(e) => setLocation(e.target.value)}\n\t\t\t\t\t\t\t\t\tplaceholder={t.locationPlaceholder}\n\t\t\t\t\t\t\t\t\tclassName=\"mt-2\"\n\t\t\t\t\t\t\t\t\tdisabled={isLoading}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<Label>{t.workDescription}</Label>\n\t\t\t\t\t\t\t\t<Textarea\n\t\t\t\t\t\t\t\t\tvalue={workDescription}\n\t\t\t\t\t\t\t\t\tonChange={(e) => setWorkDescription(e.target.value)}\n\t\t\t\t\t\t\t\t\tplaceholder={t.descriptionPlaceholder}\n\t\t\t\t\t\t\t\t\trows={3}\n\t\t\t\t\t\t\t\t\tclassName=\"mt-2\"\n\t\t\t\t\t\t\t\t\tdisabled={isLoading}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tonClick={handleClockIn}\n\t\t\t\t\t\t\t\tsize=\"lg\"\n\t\t\t\t\t\t\t\tdisabled={isLoading}\n\t\t\t\t\t\t\t\tclassName=\"w-full h-16 text-xl font-bold bg-green-600 hover:bg-green-700 disabled:opacity-50\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Clock className=\"w-6 h-6 mr-2\" />\n\t\t\t\t\t\t\t\t{isLoading ? \"CLOCKING IN...\" : \"CLOCK IN\"}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t{isLoading && (\n\t\t\t\t\t\t\t\t<p className=\"text-center text-sm text-muted-foreground animate-pulse\">\n\t\t\t\t\t\t\t\t\tPlease wait, processing...\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</CardContent>\n\t\t\t</Card>\n\n\t\t\t<Card>\n\t\t\t\t<CardHeader>\n\t\t\t\t\t<CardTitle className=\"flex items-center gap-2\">\n\t\t\t\t\t\t<CalendarDays className=\"w-5 h-5\" />\n\t\t\t\t\t\t{t.timeCardHistory}\n\t\t\t\t\t</CardTitle>\n\t\t\t\t\t<CardDescription>{t.recentRecords}</CardDescription>\n\t\t\t\t</CardHeader>\n\t\t\t\t<CardContent>\n\t\t\t\t\t{timeCards.length === 0 ? (\n\t\t\t\t\t\t<p className=\"text-center text-muted-foreground py-8\">{t.noTimeCards}</p>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<div className=\"overflow-x-auto\">\n\t\t\t\t\t\t\t<Table>\n\t\t\t\t\t\t\t\t<TableHeader>\n\t\t\t\t\t\t\t\t\t<TableRow>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.clockInTime}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.clockOutTime}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.location}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.workDescription}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.lunchDuration}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.hours}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.status}</TableHead>\n\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t</TableHeader>\n\t\t\t\t\t\t\t\t<TableBody>\n\t\t\t\t\t\t\t\t\t{timeCards.map((tc) => (\n\t\t\t\t\t\t\t\t\t\t<TableRow key={tc.id}>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatDate(tc.clock_in_timestamp)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t{tc.clock_out_timestamp ? formatDate(tc.clock_out_timestamp) : \"‚Äî\"}\n\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell>{tc.location || \"‚Äî\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"max-w-xs truncate\">{tc.work_description || \"‚Äî\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatMinutes(tc.lunch_duration_minutes)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatHours(tc.total_hours)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t{tc.clock_out_timestamp ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge variant=\"secondary\">{t.completed}</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t) : tc.lunch_start_timestamp && !tc.lunch_end_timestamp ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge className=\"bg-orange-500\">{t.onLunchBreak}</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge className=\"bg-green-500\">{t.active}</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</TableBody>\n\t\t\t\t\t\t\t</Table>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</CardContent>\n\t\t\t</Card>\n\t\t</div>\n\t);\n}\n\nfunction ManagerView({ user, users, language, onUsersChange }: { user: UserModel; users: UserModel[]; language: Language; onUsersChange: () => void }) {\n\tconst [activeTab, setActiveTab] = useState(\"timecards\");\n\n\tconst t = translations[language];\n\n\treturn (\n\t\t<Tabs value={activeTab} onValueChange={setActiveTab}>\n\t\t\t<TabsList className=\"grid w-full grid-cols-3\">\n\t\t\t\t<TabsTrigger value=\"timecards\">\n\t\t\t\t\t<Clock className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t{t.timeCards}\n\t\t\t\t</TabsTrigger>\n\t\t\t\t<TabsTrigger value=\"reports\">\n\t\t\t\t\t<FileText className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t{t.reports}\n\t\t\t\t</TabsTrigger>\n\t\t\t\t<TabsTrigger value=\"employees\">\n\t\t\t\t\t<Users className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t{t.employees}\n\t\t\t\t</TabsTrigger>\n\t\t\t</TabsList>\n\n\t\t\t<TabsContent value=\"timecards\" className=\"space-y-4\">\n\t\t\t\t<TimeCardsTab users={users} language={language} />\n\t\t\t</TabsContent>\n\n\t\t\t<TabsContent value=\"reports\" className=\"space-y-4\">\n\t\t\t\t<ReportsTab users={users} language={language} />\n\t\t\t</TabsContent>\n\n\t\t\t<TabsContent value=\"employees\" className=\"space-y-4\">\n\t\t\t\t<EmployeesTab users={users} language={language} onUsersChange={onUsersChange} />\n\t\t\t</TabsContent>\n\t\t</Tabs>\n\t);\n}\n\nfunction TimeCardsTab({ users, language }: { users: UserModel[]; language: Language }) {\n\tconst [allTimeCards, setAllTimeCards] = useState<TimeCardEntryModel[]>([]);\n\tconst [filteredCards, setFilteredCards] = useState<TimeCardEntryModel[]>([]);\n\tconst [selectedEmployee, setSelectedEmployee] = useState<string>(\"all\");\n\tconst [dateFilter, setDateFilter] = useState<string>(\"\");\n\tconst [editingCard, setEditingCard] = useState<TimeCardEntryModel | null>(null);\n\tconst [editClockIn, setEditClockIn] = useState(\"\");\n\tconst [editClockOut, setEditClockOut] = useState(\"\");\n\tconst [editLocation, setEditLocation] = useState(\"\");\n\tconst [editWorkDescription, setEditWorkDescription] = useState(\"\");\n\tconst [editLunchStart, setEditLunchStart] = useState(\"\");\n\tconst [editLunchEnd, setEditLunchEnd] = useState(\"\");\n\tconst [showManualEntry, setShowManualEntry] = useState(false);\n\tconst [manualEntryUserId, setManualEntryUserId] = useState<string>(\"\");\n\n\tconst t = translations[language];\n\n\tuseEffect(() => {\n\t\tloadAllTimeCards();\n\t}, []);\n\n\tuseEffect(() => {\n\t\tapplyFilters();\n\t}, [allTimeCards, selectedEmployee, dateFilter]);\n\n\tconst loadAllTimeCards = async () => {\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tconst allCards = await timeCardORM.getAllTimeCardEntry();\n\n\t\t// Sort by clock in time (newest first)\n\t\tconst sorted = allCards.sort((a, b) =>\n\t\t\tparseInt(b.clock_in_timestamp) - parseInt(a.clock_in_timestamp)\n\t\t);\n\n\t\tsetAllTimeCards(sorted);\n\t};\n\n\tconst applyFilters = () => {\n\t\tlet filtered = [...allTimeCards];\n\n\t\t// Filter by employee\n\t\tif (selectedEmployee !== \"all\") {\n\t\t\tfiltered = filtered.filter(tc => tc.user_id === selectedEmployee);\n\t\t}\n\n\t\t// Filter by date\n\t\tif (dateFilter) {\n\t\t\tconst filterDate = new Date(dateFilter);\n\t\t\tconst filterTimestamp = Math.floor(filterDate.getTime() / 1000);\n\t\t\tconst nextDayTimestamp = filterTimestamp + 86400; // +24 hours\n\n\t\t\tfiltered = filtered.filter(tc => {\n\t\t\t\tconst clockIn = parseInt(tc.clock_in_timestamp);\n\t\t\t\treturn clockIn >= filterTimestamp && clockIn < nextDayTimestamp;\n\t\t\t});\n\t\t}\n\n\t\tsetFilteredCards(filtered);\n\t};\n\n\tconst getUserName = (userId: string) => {\n\t\tconst user = users.find(u => u.id === userId);\n\t\treturn user?.name || \"Unknown\";\n\t};\n\n\tconst formatDate = (timestamp: string) => {\n\t\tconst date = new Date(parseInt(timestamp) * 1000);\n\t\treturn date.toLocaleString(language === 'es' ? 'es-ES' : 'en-US');\n\t};\n\n\tconst formatHours = (hours: number | null | undefined) => {\n\t\tif (hours === null || hours === undefined) return \"‚Äî\";\n\t\treturn `${hours.toFixed(2)} ${language === 'es' ? 'hrs' : 'hrs'}`;\n\t};\n\n\tconst formatMinutes = (minutes: number | null | undefined) => {\n\t\tif (minutes === null || minutes === undefined) return \"‚Äî\";\n\t\treturn `${Math.round(minutes)} min`;\n\t};\n\n\tconst calculateTotalHours = (period: 'day' | 'week') => {\n\t\tconst now = Date.now() / 1000;\n\t\tconst periodSeconds = period === 'day' ? 86400 : 604800; // 1 day or 7 days\n\t\tconst startTime = now - periodSeconds;\n\n\t\tconst relevantCards = allTimeCards.filter(tc => {\n\t\t\tconst clockIn = parseInt(tc.clock_in_timestamp);\n\t\t\treturn clockIn >= startTime && tc.total_hours;\n\t\t});\n\n\t\treturn relevantCards.reduce((sum, tc) => sum + (tc.total_hours || 0), 0);\n\t};\n\n\tconst handleEditCard = (card: TimeCardEntryModel) => {\n\t\tsetEditingCard(card);\n\n\t\t// Helper function to safely convert timestamp to ISO string\n\t\tconst safeTimestampToISO = (timestamp: string | null | undefined): string => {\n\t\t\tif (!timestamp) return \"\";\n\t\t\tconst parsed = parseInt(timestamp);\n\t\t\tif (isNaN(parsed) || parsed <= 0) return \"\";\n\t\t\tconst date = new Date(parsed * 1000);\n\t\t\tif (isNaN(date.getTime())) return \"\";\n\t\t\treturn date.toISOString().slice(0, 16);\n\t\t};\n\n\t\tsetEditClockIn(safeTimestampToISO(card.clock_in_timestamp) || new Date().toISOString().slice(0, 16));\n\t\tsetEditClockOut(safeTimestampToISO(card.clock_out_timestamp));\n\t\tsetEditLocation(card.location || \"\");\n\t\tsetEditWorkDescription(card.work_description || \"\");\n\t\tsetEditLunchStart(safeTimestampToISO(card.lunch_start_timestamp));\n\t\tsetEditLunchEnd(safeTimestampToISO(card.lunch_end_timestamp));\n\t};\n\n\tconst handleSaveEdit = async () => {\n\t\tif (!editingCard) return;\n\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tconst clockInTimestamp = Math.floor(new Date(editClockIn).getTime() / 1000).toString();\n\t\tconst clockOutTimestamp = editClockOut\n\t\t\t? Math.floor(new Date(editClockOut).getTime() / 1000).toString()\n\t\t\t: null;\n\t\tconst lunchStartTimestamp = editLunchStart\n\t\t\t? Math.floor(new Date(editLunchStart).getTime() / 1000).toString()\n\t\t\t: null;\n\t\tconst lunchEndTimestamp = editLunchEnd\n\t\t\t? Math.floor(new Date(editLunchEnd).getTime() / 1000).toString()\n\t\t\t: null;\n\n\t\tlet totalHours = null;\n\t\tlet lunchDurationMinutes = null;\n\n\t\t// Calculate lunch duration\n\t\tif (lunchStartTimestamp && lunchEndTimestamp) {\n\t\t\tconst lunchStart = parseInt(lunchStartTimestamp);\n\t\t\tconst lunchEnd = parseInt(lunchEndTimestamp);\n\t\t\tlunchDurationMinutes = (lunchEnd - lunchStart) / 60;\n\t\t}\n\n\t\t// Calculate total hours\n\t\tif (clockOutTimestamp) {\n\t\t\tconst clockInTime = parseInt(clockInTimestamp);\n\t\t\tconst clockOutTime = parseInt(clockOutTimestamp);\n\t\t\ttotalHours = (clockOutTime - clockInTime) / 3600;\n\n\t\t\t// Deduct lunch time\n\t\t\tif (lunchDurationMinutes) {\n\t\t\t\ttotalHours -= lunchDurationMinutes / 60;\n\t\t\t}\n\t\t}\n\n\t\tawait timeCardORM.setTimeCardEntryById(editingCard.id, {\n\t\t\t...editingCard,\n\t\t\tclock_in_timestamp: clockInTimestamp,\n\t\t\tclock_out_timestamp: clockOutTimestamp,\n\t\t\ttotal_hours: totalHours,\n\t\t\tlocation: editLocation || null,\n\t\t\twork_description: editWorkDescription || null,\n\t\t\tlunch_start_timestamp: lunchStartTimestamp,\n\t\t\tlunch_end_timestamp: lunchEndTimestamp,\n\t\t\tlunch_duration_minutes: lunchDurationMinutes,\n\t\t});\n\n\t\tsetEditingCard(null);\n\t\tawait loadAllTimeCards();\n\t};\n\n\tconst handleDeleteTimeCard = async (card: TimeCardEntryModel) => {\n\t\tif (!window.confirm(t.confirmDeleteTimeCard)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tawait timeCardORM.deleteTimeCardEntryById(card.id);\n\t\tawait loadAllTimeCards();\n\t};\n\n\tconst handleAddManualEntry = (userId: string) => {\n\t\tsetManualEntryUserId(userId);\n\t\tsetShowManualEntry(true);\n\t};\n\n\treturn (\n\t\t<>\n\t\t\t<div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n\t\t\t\t<Card>\n\t\t\t\t\t<CardHeader className=\"pb-3\">\n\t\t\t\t\t\t<CardTitle className=\"text-sm font-medium flex items-center gap-2\">\n\t\t\t\t\t\t\t<Users className=\"w-4 h-4\" />\n\t\t\t\t\t\t\t{t.totalEmployees}\n\t\t\t\t\t\t</CardTitle>\n\t\t\t\t\t</CardHeader>\n\t\t\t\t\t<CardContent>\n\t\t\t\t\t\t<div className=\"text-2xl font-bold\">{users.filter(u => u.role === UserRole.Employee).length}</div>\n\t\t\t\t\t</CardContent>\n\t\t\t\t</Card>\n\n\t\t\t\t<Card>\n\t\t\t\t\t<CardHeader className=\"pb-3\">\n\t\t\t\t\t\t<CardTitle className=\"text-sm font-medium flex items-center gap-2\">\n\t\t\t\t\t\t\t<Timer className=\"w-4 h-4\" />\n\t\t\t\t\t\t\t{t.hoursToday}\n\t\t\t\t\t\t</CardTitle>\n\t\t\t\t\t</CardHeader>\n\t\t\t\t\t<CardContent>\n\t\t\t\t\t\t<div className=\"text-2xl font-bold\">{calculateTotalHours('day').toFixed(2)}</div>\n\t\t\t\t\t</CardContent>\n\t\t\t\t</Card>\n\n\t\t\t\t<Card>\n\t\t\t\t\t<CardHeader className=\"pb-3\">\n\t\t\t\t\t\t<CardTitle className=\"text-sm font-medium flex items-center gap-2\">\n\t\t\t\t\t\t\t<CalendarDays className=\"w-4 h-4\" />\n\t\t\t\t\t\t\t{t.hoursThisWeek}\n\t\t\t\t\t\t</CardTitle>\n\t\t\t\t\t</CardHeader>\n\t\t\t\t\t<CardContent>\n\t\t\t\t\t\t<div className=\"text-2xl font-bold\">{calculateTotalHours('week').toFixed(2)}</div>\n\t\t\t\t\t</CardContent>\n\t\t\t\t</Card>\n\t\t\t</div>\n\n\t\t\t<Card>\n\t\t\t\t<CardHeader>\n\t\t\t\t\t<div className=\"flex justify-between items-center\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<CardTitle>{t.allEmployeeTimeCards}</CardTitle>\n\t\t\t\t\t\t\t<CardDescription>{t.viewManageRecords}</CardDescription>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<Button onClick={() => handleAddManualEntry(\"\")} variant=\"outline\" size=\"sm\">\n\t\t\t\t\t\t\t<Plus className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t\t\t{t.addTimeCard}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t</CardHeader>\n\t\t\t\t<CardContent className=\"space-y-4\">\n\t\t\t\t\t<div className=\"flex gap-4 flex-wrap\">\n\t\t\t\t\t\t<div className=\"flex-1 min-w-[200px]\">\n\t\t\t\t\t\t\t<Label>{t.filterByEmployee}</Label>\n\t\t\t\t\t\t\t<Select value={selectedEmployee} onValueChange={setSelectedEmployee}>\n\t\t\t\t\t\t\t\t<SelectTrigger>\n\t\t\t\t\t\t\t\t\t<SelectValue />\n\t\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t\t<SelectItem value=\"all\">{t.allEmployees}</SelectItem>\n\t\t\t\t\t\t\t\t\t{users.filter(u => u.role === UserRole.Employee).map((u) => (\n\t\t\t\t\t\t\t\t\t\t<SelectItem key={u.id} value={u.id}>\n\t\t\t\t\t\t\t\t\t\t\t{u.name}\n\t\t\t\t\t\t\t\t\t\t</SelectItem>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t\t</Select>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div className=\"flex-1 min-w-[200px]\">\n\t\t\t\t\t\t\t<Label>{t.filterByDate}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"date\"\n\t\t\t\t\t\t\t\tvalue={dateFilter}\n\t\t\t\t\t\t\t\tonChange={(e) => setDateFilter(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t{(selectedEmployee !== \"all\" || dateFilter) && (\n\t\t\t\t\t\t\t<div className=\"flex items-end\">\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\t\t\tsetSelectedEmployee(\"all\");\n\t\t\t\t\t\t\t\t\t\tsetDateFilter(\"\");\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{t.clearFilters}\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{filteredCards.length === 0 ? (\n\t\t\t\t\t\t<p className=\"text-center text-muted-foreground py-8\">{t.noTimeCardsFound}</p>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<div className=\"overflow-x-auto\">\n\t\t\t\t\t\t\t<Table>\n\t\t\t\t\t\t\t\t<TableHeader>\n\t\t\t\t\t\t\t\t\t<TableRow>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.employeeName}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.clockInTime}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.clockOutTime}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.location}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.workDescription}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.lunchDuration}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.hours}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.status}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.actions}</TableHead>\n\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t</TableHeader>\n\t\t\t\t\t\t\t\t<TableBody>\n\t\t\t\t\t\t\t\t\t{filteredCards.map((tc) => (\n\t\t\t\t\t\t\t\t\t\t<TableRow key={tc.id}>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"font-medium whitespace-nowrap\">{getUserName(tc.user_id)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatDate(tc.clock_in_timestamp)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t{tc.clock_out_timestamp ? formatDate(tc.clock_out_timestamp) : \"‚Äî\"}\n\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell>{tc.location || \"‚Äî\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"max-w-xs truncate\">{tc.work_description || \"‚Äî\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatMinutes(tc.lunch_duration_minutes)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatHours(tc.total_hours)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t{tc.clock_out_timestamp ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge variant=\"secondary\">{t.completed}</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t) : tc.lunch_start_timestamp && !tc.lunch_end_timestamp ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge className=\"bg-orange-500\">{t.onLunchBreak}</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge className=\"bg-green-500\">{t.active}</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => handleEditCard(tc)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{t.edit}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => handleDeleteTimeCard(tc)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"text-red-600 hover:text-red-700 hover:bg-red-50\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Trash2 className=\"w-4 h-4\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</TableBody>\n\t\t\t\t\t\t\t</Table>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</CardContent>\n\t\t\t</Card>\n\n\t\t\t<Dialog open={!!editingCard} onOpenChange={(open) => !open && setEditingCard(null)}>\n\t\t\t\t<DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n\t\t\t\t\t<DialogHeader>\n\t\t\t\t\t\t<DialogTitle>{t.editTimeCard}</DialogTitle>\n\t\t\t\t\t</DialogHeader>\n\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.employeeName}</Label>\n\t\t\t\t\t\t\t<Input value={editingCard ? getUserName(editingCard.user_id) : \"\"} disabled />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"grid grid-cols-2 gap-4\">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<Label>{t.clockInTime}</Label>\n\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\t\tvalue={editClockIn}\n\t\t\t\t\t\t\t\t\tonChange={(e) => setEditClockIn(e.target.value)}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<Label>{t.clockOutTime}</Label>\n\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\t\tvalue={editClockOut}\n\t\t\t\t\t\t\t\t\tonChange={(e) => setEditClockOut(e.target.value)}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.location}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\tvalue={editLocation}\n\t\t\t\t\t\t\t\tonChange={(e) => setEditLocation(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder={t.locationPlaceholder}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.workDescription}</Label>\n\t\t\t\t\t\t\t<Textarea\n\t\t\t\t\t\t\t\tvalue={editWorkDescription}\n\t\t\t\t\t\t\t\tonChange={(e) => setEditWorkDescription(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder={t.descriptionPlaceholder}\n\t\t\t\t\t\t\t\trows={4}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"grid grid-cols-2 gap-4\">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<Label>{t.lunchStartTime}</Label>\n\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\t\tvalue={editLunchStart}\n\t\t\t\t\t\t\t\t\tonChange={(e) => setEditLunchStart(e.target.value)}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<Label>{t.lunchEndTime}</Label>\n\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\t\tvalue={editLunchEnd}\n\t\t\t\t\t\t\t\t\tonChange={(e) => setEditLunchEnd(e.target.value)}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<DialogFooter>\n\t\t\t\t\t\t<Button variant=\"outline\" onClick={() => setEditingCard(null)}>\n\t\t\t\t\t\t\t{t.cancel}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button onClick={handleSaveEdit}>\n\t\t\t\t\t\t\t{t.saveChanges}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</DialogFooter>\n\t\t\t\t</DialogContent>\n\t\t\t</Dialog>\n\n\t\t\t<ManualEntryDialog\n\t\t\t\topen={showManualEntry}\n\t\t\t\tonClose={() => setShowManualEntry(false)}\n\t\t\t\tuserId={manualEntryUserId}\n\t\t\t\tonSave={loadAllTimeCards}\n\t\t\t\tlanguage={language}\n\t\t\t\tusers={users}\n\t\t\t/>\n\t\t</>\n\t);\n}\n\nfunction ReportsTab({ users, language }: { users: UserModel[]; language: Language }) {\n\tconst [weekStart, setWeekStart] = useState(\"\");\n\tconst [reportData, setReportData] = useState<{ user: UserModel; regularHours: number; overtimeHours: number; totalHours: number }[]>([]);\n\tconst [detailedTimeCards, setDetailedTimeCards] = useState<TimeCardEntryModel[]>([]);\n\n\tconst t = translations[language];\n\n\tuseEffect(() => {\n\t\t// Set default to current week\n\t\tconst today = new Date();\n\t\tconst monday = new Date(today);\n\t\tmonday.setDate(today.getDate() - today.getDay() + 1);\n\t\tsetWeekStart(monday.toISOString().slice(0, 10));\n\t}, []);\n\n\tuseEffect(() => {\n\t\tif (weekStart) {\n\t\t\tloadWeeklyReport();\n\t\t}\n\t}, [weekStart, users]);\n\n\tconst loadWeeklyReport = async () => {\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tconst allCards = await timeCardORM.getAllTimeCardEntry();\n\n\t\tconst weekStartDate = new Date(weekStart);\n\t\tconst weekStartTimestamp = Math.floor(weekStartDate.getTime() / 1000);\n\t\tconst weekEndTimestamp = weekStartTimestamp + 604800; // 7 days\n\n\t\tconst weekCards = allCards.filter(tc => {\n\t\t\tconst clockIn = parseInt(tc.clock_in_timestamp);\n\t\t\treturn clockIn >= weekStartTimestamp && clockIn < weekEndTimestamp && tc.total_hours;\n\t\t});\n\n\t\t// Store detailed time cards\n\t\tsetDetailedTimeCards(weekCards.sort((a, b) => parseInt(a.clock_in_timestamp) - parseInt(b.clock_in_timestamp)));\n\n\t\tconst employeeHours = users\n\t\t\t.filter(u => u.role === UserRole.Employee)\n\t\t\t.map(user => {\n\t\t\t\tconst userCards = weekCards.filter(tc => tc.user_id === user.id);\n\t\t\t\tconst totalHours = userCards.reduce((sum, tc) => sum + (tc.total_hours || 0), 0);\n\t\t\t\tconst regularHours = Math.min(totalHours, 40);\n\t\t\t\tconst overtimeHours = Math.max(totalHours - 40, 0);\n\n\t\t\t\treturn {\n\t\t\t\t\tuser,\n\t\t\t\t\tregularHours,\n\t\t\t\t\tovertimeHours,\n\t\t\t\t\ttotalHours,\n\t\t\t\t};\n\t\t\t});\n\n\t\tsetReportData(employeeHours);\n\t};\n\n\tconst formatHours = (hours: number) => {\n\t\treturn `${hours.toFixed(2)} hrs`;\n\t};\n\n\tconst formatDate = (timestamp: string) => {\n\t\tconst date = new Date(parseInt(timestamp) * 1000);\n\t\treturn date.toLocaleString(language === 'es' ? 'es-ES' : 'en-US');\n\t};\n\n\tconst formatDateOnly = (timestamp: string) => {\n\t\tconst date = new Date(parseInt(timestamp) * 1000);\n\t\treturn date.toLocaleDateString(language === 'es' ? 'es-ES' : 'en-US');\n\t};\n\n\tconst getDayOfWeek = (timestamp: string) => {\n\t\tconst date = new Date(parseInt(timestamp) * 1000);\n\t\treturn date.toLocaleDateString(language === 'es' ? 'es-ES' : 'en-US', { weekday: 'long' });\n\t};\n\n\tconst getUserName = (userId: string) => {\n\t\tconst user = users.find(u => u.id === userId);\n\t\treturn user?.name || \"Unknown\";\n\t};\n\n\tconst handlePrint = () => {\n\t\twindow.print();\n\t};\n\n\tconst handleExportCSV = () => {\n\t\tif (detailedTimeCards.length === 0) return;\n\n\t\t// Create CSV header\n\t\tconst headers = [\n\t\t\tt.employeeName,\n\t\t\tt.date,\n\t\t\tt.day,\n\t\t\tt.clockInTime,\n\t\t\tt.clockOutTime,\n\t\t\tt.location,\n\t\t\tt.workDescription,\n\t\t\tt.lunchDuration,\n\t\t\tt.hours\n\t\t];\n\n\t\t// Create CSV rows\n\t\tconst rows = detailedTimeCards.map(tc => {\n\t\t\tconst userName = getUserName(tc.user_id);\n\t\t\tconst date = formatDateOnly(tc.clock_in_timestamp);\n\t\t\tconst day = getDayOfWeek(tc.clock_in_timestamp);\n\t\t\tconst clockIn = formatDate(tc.clock_in_timestamp);\n\t\t\tconst clockOut = tc.clock_out_timestamp ? formatDate(tc.clock_out_timestamp) : \"‚Äî\";\n\t\t\tconst location = tc.location || \"‚Äî\";\n\t\t\tconst workDescription = (tc.work_description || \"‚Äî\").replace(/\"/g, '\"\"'); // Escape quotes\n\t\t\tconst lunchDuration = tc.lunch_duration_minutes ? `${Math.round(tc.lunch_duration_minutes)} min` : \"‚Äî\";\n\t\t\tconst hours = tc.total_hours ? `${tc.total_hours.toFixed(2)} hrs` : \"‚Äî\";\n\n\t\t\treturn [\n\t\t\t\t`\"${userName}\"`,\n\t\t\t\t`\"${date}\"`,\n\t\t\t\t`\"${day}\"`,\n\t\t\t\t`\"${clockIn}\"`,\n\t\t\t\t`\"${clockOut}\"`,\n\t\t\t\t`\"${location}\"`,\n\t\t\t\t`\"${workDescription}\"`,\n\t\t\t\t`\"${lunchDuration}\"`,\n\t\t\t\t`\"${hours}\"`\n\t\t\t].join(',');\n\t\t});\n\n\t\t// Combine header and rows\n\t\tconst csv = [headers.join(','), ...rows].join('\\n');\n\n\t\t// Create blob and download\n\t\tconst blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });\n\t\tconst link = document.createElement('a');\n\t\tconst url = URL.createObjectURL(blob);\n\t\tlink.setAttribute('href', url);\n\t\tlink.setAttribute('download', `weekly-report-${weekStart}.csv`);\n\t\tlink.style.visibility = 'hidden';\n\t\tdocument.body.appendChild(link);\n\t\tlink.click();\n\t\tdocument.body.removeChild(link);\n\t};\n\n\treturn (\n\t\t<div className=\"space-y-4\">\n\t\t\t<Card>\n\t\t\t\t<CardHeader>\n\t\t\t\t\t<div className=\"flex justify-between items-center\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<CardTitle>{t.weeklyReport}</CardTitle>\n\t\t\t\t\t\t\t<CardDescription>Overtime calculated for hours worked beyond 40 hours/week</CardDescription>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"flex gap-2 print:hidden\">\n\t\t\t\t\t\t\t<Button onClick={handleExportCSV} variant=\"outline\" disabled={detailedTimeCards.length === 0}>\n\t\t\t\t\t\t\t\t<FileText className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t\t\t\t{t.exportCSV}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t<Button onClick={handlePrint} variant=\"outline\" disabled={detailedTimeCards.length === 0}>\n\t\t\t\t\t\t\t\t<FileText className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t\t\t\t{t.printReport}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</CardHeader>\n\t\t\t\t<CardContent className=\"space-y-4\">\n\t\t\t\t\t<div className=\"max-w-xs print:hidden\">\n\t\t\t\t\t\t<Label>{t.selectWeek}</Label>\n\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\ttype=\"date\"\n\t\t\t\t\t\t\tvalue={weekStart}\n\t\t\t\t\t\t\tonChange={(e) => setWeekStart(e.target.value)}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{reportData.length === 0 ? (\n\t\t\t\t\t\t<p className=\"text-center text-muted-foreground py-8\">{t.noReportData}</p>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t{/* Summary Table */}\n\t\t\t\t\t\t\t<div className=\"overflow-x-auto\">\n\t\t\t\t\t\t\t\t<Table>\n\t\t\t\t\t\t\t\t\t<TableHeader>\n\t\t\t\t\t\t\t\t\t\t<TableRow>\n\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.employeeName}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.regularHours}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.overtimeHours}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.totalHours}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.status}</TableHead>\n\t\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t\t</TableHeader>\n\t\t\t\t\t\t\t\t\t<TableBody>\n\t\t\t\t\t\t\t\t\t\t{reportData.map(({ user, regularHours, overtimeHours, totalHours }) => (\n\t\t\t\t\t\t\t\t\t\t\t<TableRow key={user.id}>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"font-medium\">{user.name}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableCell>{formatHours(regularHours)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{overtimeHours > 0 ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-orange-600 font-semibold\">{formatHours(overtimeHours)}</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tformatHours(0)\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"font-semibold\">{formatHours(totalHours)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{overtimeHours > 0 && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge className=\"bg-orange-500\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<AlertCircle className=\"w-3 h-3 mr-1\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{t.overtimeAlert}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t\t</TableBody>\n\t\t\t\t\t\t\t\t</Table>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t{/* Detailed Time Cards Table */}\n\t\t\t\t\t\t\t<div className=\"mt-8\">\n\t\t\t\t\t\t\t\t<h3 className=\"text-lg font-semibold mb-4\">{t.detailedReport}</h3>\n\t\t\t\t\t\t\t\t<div className=\"overflow-x-auto\">\n\t\t\t\t\t\t\t\t\t<Table>\n\t\t\t\t\t\t\t\t\t\t<TableHeader>\n\t\t\t\t\t\t\t\t\t\t\t<TableRow>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.employeeName}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.date}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.day}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.clockInTime}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.clockOutTime}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.location}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.workDescription}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.lunchDuration}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.hours}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t\t\t</TableHeader>\n\t\t\t\t\t\t\t\t\t\t<TableBody>\n\t\t\t\t\t\t\t\t\t\t\t{detailedTimeCards.map((tc) => (\n\t\t\t\t\t\t\t\t\t\t\t\t<TableRow key={tc.id}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"font-medium whitespace-nowrap\">{getUserName(tc.user_id)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatDateOnly(tc.clock_in_timestamp)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{getDayOfWeek(tc.clock_in_timestamp)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatDate(tc.clock_in_timestamp)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{tc.clock_out_timestamp ? formatDate(tc.clock_out_timestamp) : \"‚Äî\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell>{tc.location || \"‚Äî\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"max-w-xs\">{tc.work_description || \"‚Äî\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{tc.lunch_duration_minutes ? `${Math.round(tc.lunch_duration_minutes)} min` : \"‚Äî\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{tc.total_hours ? `${tc.total_hours.toFixed(2)} hrs` : \"‚Äî\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t\t\t</TableBody>\n\t\t\t\t\t\t\t\t\t</Table>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</>\n\t\t\t\t\t)}\n\t\t\t\t</CardContent>\n\t\t\t</Card>\n\t\t</div>\n\t);\n}\n\nfunction EmployeesTab({ users, language, onUsersChange }: { users: UserModel[]; language: Language; onUsersChange: () => void }) {\n\tconst [showAddEmployee, setShowAddEmployee] = useState(false);\n\tconst [editingEmployee, setEditingEmployee] = useState<UserModel | null>(null);\n\tconst [employeeName, setEmployeeName] = useState(\"\");\n\tconst [employeeEmail, setEmployeeEmail] = useState(\"\");\n\tconst [employeePhone, setEmployeePhone] = useState(\"\");\n\tconst [employeeRole, setEmployeeRole] = useState<UserRole>(UserRole.Employee);\n\tconst [deleteConfirm, setDeleteConfirm] = useState<UserModel | null>(null);\n\n\tconst t = translations[language];\n\n\tconst handleAddEmployee = async () => {\n\t\tconst userORM = UserORM.getInstance();\n\t\tawait userORM.insertUser([{\n\t\t\tname: employeeName,\n\t\t\temail: employeeEmail,\n\t\t\tphone: employeePhone || null,\n\t\t\trole: employeeRole,\n\t\t} as UserModel]);\n\n\t\tsetShowAddEmployee(false);\n\t\tsetEmployeeName(\"\");\n\t\tsetEmployeeEmail(\"\");\n\t\tsetEmployeePhone(\"\");\n\t\tsetEmployeeRole(UserRole.Employee);\n\t\tonUsersChange();\n\t};\n\n\tconst handleEditEmployee = async () => {\n\t\tif (!editingEmployee) return;\n\n\t\tconst userORM = UserORM.getInstance();\n\t\tawait userORM.setUserById(editingEmployee.id, {\n\t\t\t...editingEmployee,\n\t\t\tname: employeeName,\n\t\t\temail: employeeEmail,\n\t\t\tphone: employeePhone || null,\n\t\t\trole: employeeRole,\n\t\t});\n\n\t\tsetEditingEmployee(null);\n\t\tsetEmployeeName(\"\");\n\t\tsetEmployeeEmail(\"\");\n\t\tsetEmployeePhone(\"\");\n\t\tsetEmployeeRole(UserRole.Employee);\n\t\tonUsersChange();\n\t};\n\n\tconst handleDeleteEmployee = async (user: UserModel) => {\n\t\tconst userORM = UserORM.getInstance();\n\t\tawait userORM.deleteUserById(user.id);\n\t\tsetDeleteConfirm(null);\n\t\tonUsersChange();\n\t};\n\n\tconst openEditDialog = (user: UserModel) => {\n\t\tsetEditingEmployee(user);\n\t\tsetEmployeeName(user.name);\n\t\tsetEmployeeEmail(user.email);\n\t\tsetEmployeePhone(user.phone || \"\");\n\t\tsetEmployeeRole(user.role);\n\t};\n\n\treturn (\n\t\t<div className=\"space-y-4\">\n\t\t\t<Card>\n\t\t\t\t<CardHeader>\n\t\t\t\t\t<div className=\"flex justify-between items-center\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<CardTitle>{t.employees}</CardTitle>\n\t\t\t\t\t\t\t<CardDescription>Manage employee accounts</CardDescription>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<Button onClick={() => setShowAddEmployee(true)}>\n\t\t\t\t\t\t\t<UserPlus className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t\t\t{t.addEmployee}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t</CardHeader>\n\t\t\t\t<CardContent>\n\t\t\t\t\t<div className=\"overflow-x-auto\">\n\t\t\t\t\t\t<Table>\n\t\t\t\t\t\t\t<TableHeader>\n\t\t\t\t\t\t\t\t<TableRow>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.name}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.email}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.phone}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.role}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.actions}</TableHead>\n\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t</TableHeader>\n\t\t\t\t\t\t\t<TableBody>\n\t\t\t\t\t\t\t\t{users.map((user) => (\n\t\t\t\t\t\t\t\t\t<TableRow key={user.id}>\n\t\t\t\t\t\t\t\t\t\t<TableCell className=\"font-medium\">{user.name}</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell>{user.email}</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell>{user.phone || \"‚Äî\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<Badge variant={user.role === UserRole.Manager ? \"default\" : \"secondary\"}>\n\t\t\t\t\t\t\t\t\t\t\t\t{user.role === UserRole.Manager ? t.manager : t.employee}\n\t\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => openEditDialog(user)}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{t.edit}\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"destructive\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => setDeleteConfirm(user)}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{t.delete}\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</TableBody>\n\t\t\t\t\t\t</Table>\n\t\t\t\t\t</div>\n\t\t\t\t</CardContent>\n\t\t\t</Card>\n\n\t\t\t<Dialog open={showAddEmployee} onOpenChange={setShowAddEmployee}>\n\t\t\t\t<DialogContent>\n\t\t\t\t\t<DialogHeader>\n\t\t\t\t\t\t<DialogTitle>{t.addEmployee}</DialogTitle>\n\t\t\t\t\t</DialogHeader>\n\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.name}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\tvalue={employeeName}\n\t\t\t\t\t\t\t\tonChange={(e) => setEmployeeName(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder=\"John Doe\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.email}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"email\"\n\t\t\t\t\t\t\t\tvalue={employeeEmail}\n\t\t\t\t\t\t\t\tonChange={(e) => setEmployeeEmail(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder=\"john@example.com\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.phone}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"tel\"\n\t\t\t\t\t\t\t\tvalue={employeePhone}\n\t\t\t\t\t\t\t\tonChange={(e) => setEmployeePhone(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder=\"+1 (555) 123-4567\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.role}</Label>\n\t\t\t\t\t\t\t<Select value={employeeRole.toString()} onValueChange={(v) => setEmployeeRole(parseInt(v))}>\n\t\t\t\t\t\t\t\t<SelectTrigger>\n\t\t\t\t\t\t\t\t\t<SelectValue />\n\t\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t\t<SelectItem value={UserRole.Employee.toString()}>{t.employee}</SelectItem>\n\t\t\t\t\t\t\t\t\t<SelectItem value={UserRole.Manager.toString()}>{t.manager}</SelectItem>\n\t\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t\t</Select>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<DialogFooter>\n\t\t\t\t\t\t<Button variant=\"outline\" onClick={() => setShowAddEmployee(false)}>\n\t\t\t\t\t\t\t{t.cancel}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button onClick={handleAddEmployee} disabled={!employeeName || !employeeEmail}>\n\t\t\t\t\t\t\t{t.saveChanges}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</DialogFooter>\n\t\t\t\t</DialogContent>\n\t\t\t</Dialog>\n\n\t\t\t<Dialog open={!!editingEmployee} onOpenChange={(open) => !open && setEditingEmployee(null)}>\n\t\t\t\t<DialogContent>\n\t\t\t\t\t<DialogHeader>\n\t\t\t\t\t\t<DialogTitle>{t.editEmployee}</DialogTitle>\n\t\t\t\t\t</DialogHeader>\n\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.name}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\tvalue={employeeName}\n\t\t\t\t\t\t\t\tonChange={(e) => setEmployeeName(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.email}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"email\"\n\t\t\t\t\t\t\t\tvalue={employeeEmail}\n\t\t\t\t\t\t\t\tonChange={(e) => setEmployeeEmail(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.phone}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"tel\"\n\t\t\t\t\t\t\t\tvalue={employeePhone}\n\t\t\t\t\t\t\t\tonChange={(e) => setEmployeePhone(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder=\"+1 (555) 123-4567\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.role}</Label>\n\t\t\t\t\t\t\t<Select value={employeeRole.toString()} onValueChange={(v) => setEmployeeRole(parseInt(v))}>\n\t\t\t\t\t\t\t\t<SelectTrigger>\n\t\t\t\t\t\t\t\t\t<SelectValue />\n\t\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t\t<SelectItem value={UserRole.Employee.toString()}>{t.employee}</SelectItem>\n\t\t\t\t\t\t\t\t\t<SelectItem value={UserRole.Manager.toString()}>{t.manager}</SelectItem>\n\t\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t\t</Select>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<DialogFooter>\n\t\t\t\t\t\t<Button variant=\"outline\" onClick={() => setEditingEmployee(null)}>\n\t\t\t\t\t\t\t{t.cancel}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button onClick={handleEditEmployee}>\n\t\t\t\t\t\t\t{t.saveChanges}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</DialogFooter>\n\t\t\t\t</DialogContent>\n\t\t\t</Dialog>\n\n\t\t\t<Dialog open={!!deleteConfirm} onOpenChange={(open) => !open && setDeleteConfirm(null)}>\n\t\t\t\t<DialogContent>\n\t\t\t\t\t<DialogHeader>\n\t\t\t\t\t\t<DialogTitle>{t.deleteEmployee}</DialogTitle>\n\t\t\t\t\t</DialogHeader>\n\t\t\t\t\t<p>{t.confirmDelete}</p>\n\t\t\t\t\t<p className=\"font-semibold\">{deleteConfirm?.name}</p>\n\t\t\t\t\t<DialogFooter>\n\t\t\t\t\t\t<Button variant=\"outline\" onClick={() => setDeleteConfirm(null)}>\n\t\t\t\t\t\t\t{t.cancel}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button variant=\"destructive\" onClick={() => deleteConfirm && handleDeleteEmployee(deleteConfirm)}>\n\t\t\t\t\t\t\t{t.delete}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</DialogFooter>\n\t\t\t\t</DialogContent>\n\t\t\t</Dialog>\n\t\t</div>\n\t);\n}\n\nfunction ManualEntryDialog({\n\topen,\n\tonClose,\n\tuserId,\n\tonSave,\n\tlanguage,\n\tusers\n}: {\n\topen: boolean;\n\tonClose: () => void;\n\tuserId: string;\n\tonSave: () => void;\n\tlanguage: Language;\n\tusers?: UserModel[];\n}) {\n\tconst [selectedUser, setSelectedUser] = useState(userId);\n\tconst [clockIn, setClockIn] = useState(\"\");\n\tconst [clockOut, setClockOut] = useState(\"\");\n\tconst [location, setLocation] = useState(\"\");\n\tconst [workDescription, setWorkDescription] = useState(\"\");\n\tconst [lunchStart, setLunchStart] = useState(\"\");\n\tconst [lunchEnd, setLunchEnd] = useState(\"\");\n\n\tconst t = translations[language];\n\n\tuseEffect(() => {\n\t\tif (open) {\n\t\t\tsetSelectedUser(userId);\n\t\t\t// Set default to today\n\t\t\tconst now = new Date();\n\t\t\tconst today = now.toISOString().slice(0, 10);\n\t\t\tsetClockIn(`${today}T09:00`);\n\t\t\tsetClockOut(`${today}T17:00`);\n\t\t\tsetLocation(\"\");\n\t\t\tsetWorkDescription(\"\");\n\t\t\tsetLunchStart(`${today}T12:00`);\n\t\t\tsetLunchEnd(`${today}T13:00`);\n\t\t}\n\t}, [open, userId]);\n\n\tconst handleSave = async () => {\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\n\t\tconst clockInTimestamp = Math.floor(new Date(clockIn).getTime() / 1000).toString();\n\t\tconst clockOutTimestamp = clockOut ? Math.floor(new Date(clockOut).getTime() / 1000).toString() : null;\n\t\tconst lunchStartTimestamp = lunchStart ? Math.floor(new Date(lunchStart).getTime() / 1000).toString() : null;\n\t\tconst lunchEndTimestamp = lunchEnd ? Math.floor(new Date(lunchEnd).getTime() / 1000).toString() : null;\n\n\t\tlet totalHours = null;\n\t\tlet lunchDurationMinutes = null;\n\n\t\t// Calculate lunch duration\n\t\tif (lunchStartTimestamp && lunchEndTimestamp) {\n\t\t\tconst lunchStartTime = parseInt(lunchStartTimestamp);\n\t\t\tconst lunchEndTime = parseInt(lunchEndTimestamp);\n\t\t\tlunchDurationMinutes = (lunchEndTime - lunchStartTime) / 60;\n\t\t}\n\n\t\t// Calculate total hours\n\t\tif (clockOutTimestamp) {\n\t\t\tconst clockInTime = parseInt(clockInTimestamp);\n\t\t\tconst clockOutTime = parseInt(clockOutTimestamp);\n\t\t\ttotalHours = (clockOutTime - clockInTime) / 3600;\n\n\t\t\t// Deduct lunch time\n\t\t\tif (lunchDurationMinutes) {\n\t\t\t\ttotalHours -= lunchDurationMinutes / 60;\n\t\t\t}\n\t\t}\n\n\t\tawait timeCardORM.insertTimeCardEntry([{\n\t\t\tuser_id: selectedUser,\n\t\t\tclock_in_timestamp: clockInTimestamp,\n\t\t\tclock_out_timestamp: clockOutTimestamp,\n\t\t\ttotal_hours: totalHours,\n\t\t\tlocation: location || null,\n\t\t\twork_description: workDescription || null,\n\t\t\tlunch_start_timestamp: lunchStartTimestamp,\n\t\t\tlunch_end_timestamp: lunchEndTimestamp,\n\t\t\tlunch_duration_minutes: lunchDurationMinutes,\n\t\t} as TimeCardEntryModel]);\n\n\t\tonSave();\n\t\tonClose();\n\t};\n\n\treturn (\n\t\t<Dialog open={open} onOpenChange={onClose}>\n\t\t\t<DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n\t\t\t\t<DialogHeader>\n\t\t\t\t\t<DialogTitle>{t.addManualEntry}</DialogTitle>\n\t\t\t\t</DialogHeader>\n\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t{users && (\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.employeeName}</Label>\n\t\t\t\t\t\t\t<Select value={selectedUser} onValueChange={setSelectedUser}>\n\t\t\t\t\t\t\t\t<SelectTrigger>\n\t\t\t\t\t\t\t\t\t<SelectValue />\n\t\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t\t{users.filter(u => u.role === UserRole.Employee).map((u) => (\n\t\t\t\t\t\t\t\t\t\t<SelectItem key={u.id} value={u.id}>\n\t\t\t\t\t\t\t\t\t\t\t{u.name}\n\t\t\t\t\t\t\t\t\t\t</SelectItem>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t\t</Select>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t\t<div className=\"grid grid-cols-2 gap-4\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.clockInTime}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\tvalue={clockIn}\n\t\t\t\t\t\t\t\tonChange={(e) => setClockIn(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.clockOutTime}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\tvalue={clockOut}\n\t\t\t\t\t\t\t\tonChange={(e) => setClockOut(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<Label>{t.location}</Label>\n\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\tvalue={location}\n\t\t\t\t\t\t\tonChange={(e) => setLocation(e.target.value)}\n\t\t\t\t\t\t\tplaceholder={t.locationPlaceholder}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<Label>{t.workDescription}</Label>\n\t\t\t\t\t\t<Textarea\n\t\t\t\t\t\t\tvalue={workDescription}\n\t\t\t\t\t\t\tonChange={(e) => setWorkDescription(e.target.value)}\n\t\t\t\t\t\t\tplaceholder={t.descriptionPlaceholder}\n\t\t\t\t\t\t\trows={4}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"grid grid-cols-2 gap-4\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.lunchStartTime} ({language === 'en' ? 'Optional' : 'Opcional'})</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\tvalue={lunchStart}\n\t\t\t\t\t\t\t\tonChange={(e) => setLunchStart(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.lunchEndTime} ({language === 'en' ? 'Optional' : 'Opcional'})</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\tvalue={lunchEnd}\n\t\t\t\t\t\t\t\tonChange={(e) => setLunchEnd(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<DialogFooter>\n\t\t\t\t\t<Button variant=\"outline\" onClick={onClose}>\n\t\t\t\t\t\t{t.cancel}\n\t\t\t\t\t</Button>\n\t\t\t\t\t<Button onClick={handleSave} disabled={!selectedUser || !clockIn}>\n\t\t\t\t\t\t{t.saveChanges}\n\t\t\t\t\t</Button>\n\t\t\t\t</DialogFooter>\n\t\t\t</DialogContent>\n\t\t</Dialog>\n\t);\n}\n","structuredPatch":[{"oldStart":320,"oldLines":17,"newStart":320,"newLines":17,"lines":[" "," function EmployeeView({ user, language }: { user: UserModel; language: Language }) {","   const [timeCards, setTimeCards] = useState<TimeCardEntryModel[]>([]);","-  const [currentShift, setCurrentShift] = useState<TimeCardEntryModel | null>(null);","-  const [elapsedSeconds, setElapsedSeconds] = useState(0);","-  const [locationInput, setLocationInput] = useState(\"\");","-  const [descriptionInput, setDescriptionInput] = useState(\"\");","-  const [isProcessing, setIsProcessing] = useState(false);","+  const [activeShift, setActiveShift] = useState<TimeCardEntryModel | null>(null);","+  const [elapsedTime, setElapsedTime] = useState(0);","+  const [location, setLocation] = useState(\"\");","+  const [workDescription, setWorkDescription] = useState(\"\");","+  const [isOnLunch, setIsOnLunch] = useState(false);","+  const [isLoading, setIsLoading] = useState(false);"," ","   const t = translations[language];"," ","-  // Load time cards on mount and find active shift","   useEffect(() => {","-    loadAllTimeCards();","+    loadTimeCards();","   }, [user.id]);"," ","   useEffect(() => {"]}],"userModified":false,"replaceAll":false}}
{"type":"assistant","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_vrtx_01FuGncVuSRy5QtmZNMn8TyC","type":"message","role":"assistant","content":[{"type":"text","text":"Good! Now let me validate to see if there are any remaining errors:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":2363,"cache_read_input_tokens":135981,"cache_creation":{"ephemeral_5m_input_tokens":2363,"ephemeral_1h_input_tokens":0},"output_tokens":1},"context_management":null},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"a4a82016-de45-4c3a-ba41-a48d01350b83"}
{"type":"assistant","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_vrtx_01FuGncVuSRy5QtmZNMn8TyC","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_vrtx_01U1RG3VXyEp3uaV3N6XYDnD","name":"Bash","input":{"command":"npm run check:safe","description":"Validate TypeScript after fixing variable names"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":2363,"cache_read_input_tokens":135981,"cache_creation":{"ephemeral_5m_input_tokens":2363,"ephemeral_1h_input_tokens":0},"output_tokens":96},"context_management":null},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"e062f9cd-54f3-4bc6-8cdc-26d46b1a53f8"}
{"type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_vrtx_01U1RG3VXyEp3uaV3N6XYDnD","type":"tool_result","content":"> check:safe\n> timeout 20 npm run check || (echo 'Check timed out after 20 seconds' && exit 1)\n\n\n> check\n> tsgo --noEmit && npm run lint:radix -- --fix && npm run format\n\n\n> lint:radix\n> grep -l -r '<SelectItem' src | xargs eslint --config config/eslint/eslint.radix.config.js --fix\n\n\n> format\n> biome check --write --unsafe\n\nChecked 6 files in 60ms. No fixes applied.","is_error":false}]},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"a8dfa540-5b2c-4be0-9232-f0bd32efa61a","tool_use_result":{"stdout":"> check:safe\n> timeout 20 npm run check || (echo 'Check timed out after 20 seconds' && exit 1)\n\n\n> check\n> tsgo --noEmit && npm run lint:radix -- --fix && npm run format\n\n\n> lint:radix\n> grep -l -r '<SelectItem' src | xargs eslint --config config/eslint/eslint.radix.config.js --fix\n\n\n> format\n> biome check --write --unsafe\n\nChecked 6 files in 60ms. No fixes applied.","stderr":"","interrupted":false,"isImage":false}}
{"type":"assistant","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_vrtx_01MSqiK8oe5bhLoXtZtAExCr","type":"message","role":"assistant","content":[{"type":"text","text":"Perfect! All validation passed. The code is now fixed. The clock in/out functionality should be working now with all the debugging in place. The interface shows:\n\n- **When NOT clocked in**: Blue status box ‚Üí Location field ‚Üí Work Description field ‚Üí Green \"CLOCK IN\" button\n- **When clocked in**: Green status box with timer ‚Üí RED \"CLOCK OUT\" button (in a red box) ‚Üí Lunch buttons ‚Üí Location/Description fields\n\nThe extensive console logging will help identify any issues. When you click \"CLOCK IN\", check the browser console (F12) to see detailed logs about what's happening. If it's still not working, the console logs will show exactly where the problem is occurring."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":2,"cache_creation_input_tokens":338,"cache_read_input_tokens":138344,"cache_creation":{"ephemeral_5m_input_tokens":338,"ephemeral_1h_input_tokens":0},"output_tokens":154},"context_management":null},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"ca1660b1-75d8-4546-ae72-5b19014cd597"}
{"type":"result","subtype":"success","is_error":false,"duration_ms":69852,"duration_api_ms":64100,"num_turns":5,"result":"Perfect! All validation passed. The code is now fixed. The clock in/out functionality should be working now with all the debugging in place. The interface shows:\n\n- **When NOT clocked in**: Blue status box ‚Üí Location field ‚Üí Work Description field ‚Üí Green \"CLOCK IN\" button\n- **When clocked in**: Green status box with timer ‚Üí RED \"CLOCK OUT\" button (in a red box) ‚Üí Lunch buttons ‚Üí Location/Description fields\n\nThe extensive console logging will help identify any issues. When you click \"CLOCK IN\", check the browser console (F12) to see detailed logs about what's happening. If it's still not working, the console logs will show exactly where the problem is occurring.","session_id":"752928d6-a510-485a-bbfe-46da4a277f96","total_cost_usd":0.6689327,"usage":{"input_tokens":10,"cache_creation_input_tokens":122372,"cache_read_input_tokens":547823,"output_tokens":2349,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":0,"ephemeral_5m_input_tokens":122372}},"modelUsage":{"claude-haiku-4-5-20251001":{"inputTokens":3369,"outputTokens":277,"cacheReadInputTokens":0,"cacheCreationInputTokens":0,"webSearchRequests":0,"costUSD":0.0047539999999999995,"contextWindow":200000},"claude-sonnet-4-5-20250929":{"inputTokens":2,"outputTokens":333,"cacheReadInputTokens":2236,"cacheCreationInputTokens":0,"webSearchRequests":0,"costUSD":0.0056718,"contextWindow":200000},"claude-sonnet-4-5":{"inputTokens":10,"outputTokens":2349,"cacheReadInputTokens":547823,"cacheCreationInputTokens":122372,"webSearchRequests":0,"costUSD":0.6585069,"contextWindow":200000}},"permission_denials":[],"uuid":"56f95d38-d13f-4664-8a66-afa15c759046"}
