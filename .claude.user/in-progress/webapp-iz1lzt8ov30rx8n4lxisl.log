{"type":"system","subtype":"hook_response","session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"606ac682-c6b2-40b8-817b-134a613701d6","hook_name":"SessionStart:resume","hook_event":"SessionStart","stdout":"","stderr":"","exit_code":0}
{"type":"system","subtype":"hook_response","session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"e83c1d6f-39f9-4412-9305-b785324d126d","hook_name":"SessionStart:resume","hook_event":"SessionStart","stdout":"=== RESUMING SESSION - MODIFICATION GUIDANCE ===\n\n## DATA LAYER\n\n- IF you have any data layer related requirements, use the 'database-administrator' subagent\n- Send the user's actual requirements as-is to the subagent.\n\n=== END OF MODIFICATION GUIDANCE ===\n","stderr":"","exit_code":0}
{"type":"system","subtype":"init","cwd":"/home/user/vite-template","session_id":"752928d6-a510-485a-bbfe-46da4a277f96","tools":["Task","Bash","Glob","Grep","ExitPlanMode","Read","Edit","Write","NotebookEdit","WebFetch","TodoWrite","WebSearch","BashOutput","KillShell","Skill","SlashCommand","EnterPlanMode"],"mcp_servers":[],"model":"claude-sonnet-4-5","permissionMode":"bypassPermissions","slash_commands":["compact","context","cost","init","pr-comments","release-notes","todos","review","security-review"],"apiKeySource":"none","claude_code_version":"2.0.53","output_style":"default","agents":["general-purpose","statusline-setup","Explore","Plan","integration-administrator","database-administrator"],"skills":[],"plugins":[],"uuid":"e37a3ad9-c9ba-49b2-b2ad-60a8f55db37a"}
{"type":"assistant","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_vrtx_01R8WAYsdHJkLrHrVe8J2SqJ","type":"message","role":"assistant","content":[{"type":"text","text":"I'll create a shareable employee view that shows only their own information for clocking in/out and viewing their time and sick pay. Let me first review the current code structure:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":23634,"cache_read_input_tokens":16310,"cache_creation":{"ephemeral_5m_input_tokens":23634,"ephemeral_1h_input_tokens":0},"output_tokens":1},"context_management":null},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"731fd1bf-258d-466b-8d83-6a9b91494b57"}
{"type":"assistant","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_vrtx_01R8WAYsdHJkLrHrVe8J2SqJ","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_vrtx_01UsVkHnvh1WA5859FF79e21","name":"Read","input":{"file_path":"/home/user/vite-template/src/routes/index.tsx","offset":1,"limit":100}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":23634,"cache_read_input_tokens":16310,"cache_creation":{"ephemeral_5m_input_tokens":23634,"ephemeral_1h_input_tokens":0},"output_tokens":141},"context_management":null},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"d8c7101c-96f2-437e-94cd-66628f94e978"}
{"type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_vrtx_01UsVkHnvh1WA5859FF79e21","type":"tool_result","content":"     1→import { createFileRoute } from \"@tanstack/react-router\";\n     2→import { useState, useEffect } from \"react\";\n     3→import { Button } from \"@/components/ui/button\";\n     4→import { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\n     5→import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\n     6→import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\n     7→import { Input } from \"@/components/ui/input\";\n     8→import { Label } from \"@/components/ui/label\";\n     9→import { Textarea } from \"@/components/ui/textarea\";\n    10→import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from \"@/components/ui/dialog\";\n    11→import { Badge } from \"@/components/ui/badge\";\n    12→import { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\n    13→import { Clock, Users, CalendarDays, Timer, Languages, Coffee, UserPlus, FileText, AlertCircle, Plus, Trash2, Heart } from \"lucide-react\";\n    14→import { UserORM, type UserModel, UserRole } from \"@/sdk/database/orm/orm_user\";\n    15→import { TimeCardEntryORM, type TimeCardEntryModel } from \"@/sdk/database/orm/orm_time_card_entry\";\n    16→import { SickDayORM, type SickDayModel } from \"@/sdk/database/orm/orm_sick_day\";\n    17→import { normalizeTimeCardEntryForSave, normalizeTimeCardEntriesFromORM, isActiveShift, isOnLunchBreak } from \"@/lib/orm-data-helpers\";\n    18→\n    19→export const Route = createFileRoute(\"/\")({\n    20→\tcomponent: App,\n    21→});\n    22→\n    23→type Language = 'en' | 'es';\n    24→\n    25→const translations = {\n    26→\ten: {\n    27→\t\tappTitle: \"Employee Time Tracking\",\n    28→\t\tselectAccount: \"Select your account to continue\",\n    29→\t\tselectUser: \"Select User\",\n    30→\t\tchooseAccount: \"Choose your account\",\n    31→\t\tmanager: \"Manager\",\n    32→\t\temployee: \"Employee\",\n    33→\t\tswitchUser: \"Switch User\",\n    34→\t\ttimeTrackingSystem: \"Time Tracking System\",\n    35→\t\twelcome: \"Welcome\",\n    36→\t\tclockInOut: \"Clock In/Out\",\n    37→\t\tcurrentlyClocked: \"Currently Clocked In\",\n    38→\t\tsince: \"Since\",\n    39→\t\telapsedTime: \"Elapsed Time\",\n    40→\t\tclockOut: \"Clock Out\",\n    41→\t\tnotClocked: \"Not currently clocked in\",\n    42→\t\tclockIn: \"Clock In\",\n    43→\t\ttimeCardHistory: \"Time Card History\",\n    44→\t\trecentRecords: \"Your recent clock in/out records\",\n    45→\t\tnoTimeCards: \"No time cards yet\",\n    46→\t\tclockInTime: \"Clock In\",\n    47→\t\tclockOutTime: \"Clock Out\",\n    48→\t\thours: \"Hours\",\n    49→\t\tstatus: \"Status\",\n    50→\t\tcompleted: \"Completed\",\n    51→\t\tactive: \"Active\",\n    52→\t\ttotalEmployees: \"Total Employees\",\n    53→\t\thoursToday: \"Hours Today\",\n    54→\t\thoursThisWeek: \"Hours This Week\",\n    55→\t\tallEmployeeTimeCards: \"All Employee Time Cards\",\n    56→\t\tviewManageRecords: \"View and manage all employee time records\",\n    57→\t\tfilterByEmployee: \"Filter by Employee\",\n    58→\t\tallEmployees: \"All Employees\",\n    59→\t\tfilterByDate: \"Filter by Date\",\n    60→\t\tclearFilters: \"Clear Filters\",\n    61→\t\tnoTimeCardsFound: \"No time cards found\",\n    62→\t\temployeeName: \"Employee\",\n    63→\t\tactions: \"Actions\",\n    64→\t\tedit: \"Edit\",\n    65→\t\teditTimeCard: \"Edit Time Card\",\n    66→\t\tcancel: \"Cancel\",\n    67→\t\tsaveChanges: \"Save Changes\",\n    68→\t\tlocation: \"Location\",\n    69→\t\twhereWorked: \"Where did you work?\",\n    70→\t\tworkDescription: \"Work Description\",\n    71→\t\twhatDid: \"What did you do today?\",\n    72→\t\tlocationPlaceholder: \"e.g., Office, Remote, Client Site\",\n    73→\t\tdescriptionPlaceholder: \"Describe your work activities...\",\n    74→\t\tstartLunch: \"Start Lunch Break\",\n    75→\t\tendLunch: \"End Lunch Break\",\n    76→\t\tonLunchBreak: \"On Lunch Break\",\n    77→\t\tlunchBreak: \"Lunch Break\",\n    78→\t\tlunchDuration: \"Lunch\",\n    79→\t\tlunchStartTime: \"Lunch Start\",\n    80→\t\tlunchEndTime: \"Lunch End\",\n    81→\t\ttimeCards: \"Time Cards\",\n    82→\t\treports: \"Reports\",\n    83→\t\temployees: \"Employees\",\n    84→\t\taddEmployee: \"Add Employee\",\n    85→\t\teditEmployee: \"Edit Employee\",\n    86→\t\tdeleteEmployee: \"Delete Employee\",\n    87→\t\tname: \"Name\",\n    88→\t\temail: \"Email\",\n    89→\t\tphone: \"Phone\",\n    90→\t\trole: \"Role\",\n    91→\t\tdelete: \"Delete\",\n    92→\t\tweeklyReport: \"Weekly Report\",\n    93→\t\tselectWeek: \"Select Week\",\n    94→\t\tregularHours: \"Regular\",\n    95→\t\tovertimeHours: \"Overtime\",\n    96→\t\ttotalHours: \"Total\",\n    97→\t\tnoReportData: \"No data for selected week\",\n    98→\t\taddTimeCard: \"Add Time Card\",\n    99→\t\tmanualEntry: \"Manual Entry\",\n   100→\t\taddManualEntry: \"Add Manual Time Card\",\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"10e53df7-ef74-419d-b047-0e525f1c4191","tool_use_result":{"type":"text","file":{"filePath":"/home/user/vite-template/src/routes/index.tsx","content":"import { createFileRoute } from \"@tanstack/react-router\";\nimport { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from \"@/components/ui/dialog\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Clock, Users, CalendarDays, Timer, Languages, Coffee, UserPlus, FileText, AlertCircle, Plus, Trash2, Heart } from \"lucide-react\";\nimport { UserORM, type UserModel, UserRole } from \"@/sdk/database/orm/orm_user\";\nimport { TimeCardEntryORM, type TimeCardEntryModel } from \"@/sdk/database/orm/orm_time_card_entry\";\nimport { SickDayORM, type SickDayModel } from \"@/sdk/database/orm/orm_sick_day\";\nimport { normalizeTimeCardEntryForSave, normalizeTimeCardEntriesFromORM, isActiveShift, isOnLunchBreak } from \"@/lib/orm-data-helpers\";\n\nexport const Route = createFileRoute(\"/\")({\n\tcomponent: App,\n});\n\ntype Language = 'en' | 'es';\n\nconst translations = {\n\ten: {\n\t\tappTitle: \"Employee Time Tracking\",\n\t\tselectAccount: \"Select your account to continue\",\n\t\tselectUser: \"Select User\",\n\t\tchooseAccount: \"Choose your account\",\n\t\tmanager: \"Manager\",\n\t\temployee: \"Employee\",\n\t\tswitchUser: \"Switch User\",\n\t\ttimeTrackingSystem: \"Time Tracking System\",\n\t\twelcome: \"Welcome\",\n\t\tclockInOut: \"Clock In/Out\",\n\t\tcurrentlyClocked: \"Currently Clocked In\",\n\t\tsince: \"Since\",\n\t\telapsedTime: \"Elapsed Time\",\n\t\tclockOut: \"Clock Out\",\n\t\tnotClocked: \"Not currently clocked in\",\n\t\tclockIn: \"Clock In\",\n\t\ttimeCardHistory: \"Time Card History\",\n\t\trecentRecords: \"Your recent clock in/out records\",\n\t\tnoTimeCards: \"No time cards yet\",\n\t\tclockInTime: \"Clock In\",\n\t\tclockOutTime: \"Clock Out\",\n\t\thours: \"Hours\",\n\t\tstatus: \"Status\",\n\t\tcompleted: \"Completed\",\n\t\tactive: \"Active\",\n\t\ttotalEmployees: \"Total Employees\",\n\t\thoursToday: \"Hours Today\",\n\t\thoursThisWeek: \"Hours This Week\",\n\t\tallEmployeeTimeCards: \"All Employee Time Cards\",\n\t\tviewManageRecords: \"View and manage all employee time records\",\n\t\tfilterByEmployee: \"Filter by Employee\",\n\t\tallEmployees: \"All Employees\",\n\t\tfilterByDate: \"Filter by Date\",\n\t\tclearFilters: \"Clear Filters\",\n\t\tnoTimeCardsFound: \"No time cards found\",\n\t\temployeeName: \"Employee\",\n\t\tactions: \"Actions\",\n\t\tedit: \"Edit\",\n\t\teditTimeCard: \"Edit Time Card\",\n\t\tcancel: \"Cancel\",\n\t\tsaveChanges: \"Save Changes\",\n\t\tlocation: \"Location\",\n\t\twhereWorked: \"Where did you work?\",\n\t\tworkDescription: \"Work Description\",\n\t\twhatDid: \"What did you do today?\",\n\t\tlocationPlaceholder: \"e.g., Office, Remote, Client Site\",\n\t\tdescriptionPlaceholder: \"Describe your work activities...\",\n\t\tstartLunch: \"Start Lunch Break\",\n\t\tendLunch: \"End Lunch Break\",\n\t\tonLunchBreak: \"On Lunch Break\",\n\t\tlunchBreak: \"Lunch Break\",\n\t\tlunchDuration: \"Lunch\",\n\t\tlunchStartTime: \"Lunch Start\",\n\t\tlunchEndTime: \"Lunch End\",\n\t\ttimeCards: \"Time Cards\",\n\t\treports: \"Reports\",\n\t\temployees: \"Employees\",\n\t\taddEmployee: \"Add Employee\",\n\t\teditEmployee: \"Edit Employee\",\n\t\tdeleteEmployee: \"Delete Employee\",\n\t\tname: \"Name\",\n\t\temail: \"Email\",\n\t\tphone: \"Phone\",\n\t\trole: \"Role\",\n\t\tdelete: \"Delete\",\n\t\tweeklyReport: \"Weekly Report\",\n\t\tselectWeek: \"Select Week\",\n\t\tregularHours: \"Regular\",\n\t\tovertimeHours: \"Overtime\",\n\t\ttotalHours: \"Total\",\n\t\tnoReportData: \"No data for selected week\",\n\t\taddTimeCard: \"Add Time Card\",\n\t\tmanualEntry: \"Manual Entry\",\n\t\taddManualEntry: \"Add Manual Time Card\",","numLines":100,"startLine":1,"totalLines":2439}}}
{"type":"assistant","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_vrtx_01Gxr2o1oVewymXMJhDDhYTi","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_vrtx_01PqMu4ZWGgE6hZXemVMTvqL","name":"TodoWrite","input":{"todos":[{"content":"Create shareable employee view with limited access","status":"in_progress","activeForm":"Creating employee view"},{"content":"Add employee link generation for managers","status":"pending","activeForm":"Adding link generation"},{"content":"Update translations for employee view","status":"pending","activeForm":"Updating translations"},{"content":"Test and validate changes","status":"pending","activeForm":"Testing changes"}]}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":4,"cache_creation_input_tokens":1767,"cache_read_input_tokens":39944,"cache_creation":{"ephemeral_5m_input_tokens":1767,"ephemeral_1h_input_tokens":0},"output_tokens":160},"context_management":null},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"d7f4c403-692e-4e67-9931-65cf67db1939"}
{"type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_vrtx_01PqMu4ZWGgE6hZXemVMTvqL","type":"tool_result","content":"Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable"}]},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"5c73834d-dca4-4aca-83ad-c00a23684680","tool_use_result":{"oldTodos":[],"newTodos":[{"content":"Create shareable employee view with limited access","status":"in_progress","activeForm":"Creating employee view"},{"content":"Add employee link generation for managers","status":"pending","activeForm":"Adding link generation"},{"content":"Update translations for employee view","status":"pending","activeForm":"Updating translations"},{"content":"Test and validate changes","status":"pending","activeForm":"Testing changes"}]}}
{"type":"assistant","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_vrtx_01GpjtrmYTbMEWfWv2FVC7MH","type":"message","role":"assistant","content":[{"type":"text","text":"Let me read more of the current implementation to understand how user selection works:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":4,"cache_creation_input_tokens":202,"cache_read_input_tokens":41711,"cache_creation":{"ephemeral_5m_input_tokens":202,"ephemeral_1h_input_tokens":0},"output_tokens":1},"context_management":null},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"bf0cbbd0-495c-4475-9d4c-1a0ca7d4d1cc"}
{"type":"assistant","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_vrtx_01GpjtrmYTbMEWfWv2FVC7MH","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_vrtx_0169p2jYLFzManQbqrDHvTj3","name":"Read","input":{"file_path":"/home/user/vite-template/src/routes/index.tsx","offset":200,"limit":100}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":4,"cache_creation_input_tokens":202,"cache_read_input_tokens":41711,"cache_creation":{"ephemeral_5m_input_tokens":202,"ephemeral_1h_input_tokens":0},"output_tokens":119},"context_management":null},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"6ada4596-b156-40cc-b41f-45c1f0166bc9"}
{"type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_vrtx_0169p2jYLFzManQbqrDHvTj3","type":"tool_result","content":"   200→\t\taddTimeCard: \"Agregar Tarjeta\",\n   201→\t\tmanualEntry: \"Entrada Manual\",\n   202→\t\taddManualEntry: \"Agregar Tarjeta Manual\",\n   203→\t\tconfirmDelete: \"¿Está seguro de eliminar este empleado?\",\n   204→\t\tovertimeAlert: \"Alerta de Tiempo Extra\",\n   205→\t\tprintReport: \"Imprimir Informe\",\n   206→\t\texportCSV: \"Exportar a CSV\",\n   207→\t\tdetailedReport: \"Informe Detallado de Tarjetas de Tiempo\",\n   208→\t\tdate: \"Fecha\",\n   209→\t\tday: \"Día\",\n   210→\t\tdeleteTimeCard: \"Eliminar Tarjeta de Tiempo\",\n   211→\t\tconfirmDeleteTimeCard: \"¿Está seguro de eliminar esta tarjeta de tiempo? Esta acción no se puede deshacer.\",\n   212→\t\tsickDays: \"Días de Enfermedad\",\n   213→\t\taddSickDay: \"Agregar Día de Enfermedad\",\n   214→\t\tsickDayDate: \"Fecha de Enfermedad\",\n   215→\t\tsickDayHours: \"Horas\",\n   216→\t\tsickDayNotes: \"Notas/Razón\",\n   217→\t\tsickDayNotesPlaceholder: \"ej., Cita médica, gripe, etc.\",\n   218→\t\tmySickDays: \"Mis Días de Enfermedad\",\n   219→\t\tnoSickDays: \"No hay días de enfermedad registrados\",\n   220→\t\ttotalSickDays: \"Total Días de Enfermedad\",\n   221→\t\tdeleteSickDay: \"Eliminar Día de Enfermedad\",\n   222→\t\tconfirmDeleteSickDay: \"¿Está seguro de eliminar este día de enfermedad? Esta acción no se puede deshacer.\",\n   223→\t\tsickDayHistory: \"Historial de Días de Enfermedad\",\n   224→\t\thourlyRate: \"Tarifa por Hora\",\n   225→\t\tpay: \"Pago\",\n   226→\t\ttotalPay: \"Pago Total\",\n   227→\t\tregularPay: \"Pago Regular\",\n   228→\t\tovertimePay: \"Pago Tiempo Extra\",\n   229→\t}\n   230→};\n   231→\n   232→function App() {\n   233→\tconst [currentUser, setCurrentUser] = useState<UserModel | null>(null);\n   234→\tconst [users, setUsers] = useState<UserModel[]>([]);\n   235→\tconst [showUserSelect, setShowUserSelect] = useState(true);\n   236→\tconst [language, setLanguage] = useState<Language>('en');\n   237→\n   238→\tconst t = translations[language];\n   239→\n   240→\tuseEffect(() => {\n   241→\t\tloadUsers();\n   242→\t}, []);\n   243→\n   244→\tconst loadUsers = async () => {\n   245→\t\tconst userORM = UserORM.getInstance();\n   246→\t\tconst allUsers = await userORM.getAllUser();\n   247→\n   248→\t\t// If no users exist, create demo users\n   249→\t\tif (allUsers.length === 0) {\n   250→\t\t\tconst demoUsers = await userORM.insertUser([\n   251→\t\t\t\t{\n   252→\t\t\t\t\tname: \"John Smith\",\n   253→\t\t\t\t\temail: \"john@example.com\",\n   254→\t\t\t\t\trole: UserRole.Employee,\n   255→\t\t\t\t} as UserModel,\n   256→\t\t\t\t{\n   257→\t\t\t\t\tname: \"Sarah Johnson\",\n   258→\t\t\t\t\temail: \"sarah@example.com\",\n   259→\t\t\t\t\trole: UserRole.Employee,\n   260→\t\t\t\t} as UserModel,\n   261→\t\t\t\t{\n   262→\t\t\t\t\tname: \"Mike Manager\",\n   263→\t\t\t\t\temail: \"mike@example.com\",\n   264→\t\t\t\t\trole: UserRole.Manager,\n   265→\t\t\t\t} as UserModel,\n   266→\t\t\t]);\n   267→\t\t\tsetUsers(demoUsers);\n   268→\t\t} else {\n   269→\t\t\tsetUsers(allUsers);\n   270→\t\t}\n   271→\t};\n   272→\n   273→\tconst handleUserSelect = (userId: string) => {\n   274→\t\tconst user = users.find(u => u.id === userId);\n   275→\t\tif (user) {\n   276→\t\t\tsetCurrentUser(user);\n   277→\t\t\tsetShowUserSelect(false);\n   278→\t\t}\n   279→\t};\n   280→\n   281→\tconst handleLogout = () => {\n   282→\t\tsetCurrentUser(null);\n   283→\t\tsetShowUserSelect(true);\n   284→\t};\n   285→\n   286→\tconst toggleLanguage = () => {\n   287→\t\tsetLanguage(prev => prev === 'en' ? 'es' : 'en');\n   288→\t};\n   289→\n   290→\tif (showUserSelect || !currentUser) {\n   291→\t\treturn (\n   292→\t\t\t<div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800 flex items-center justify-center p-4\">\n   293→\t\t\t\t<div className=\"absolute top-4 right-4\">\n   294→\t\t\t\t\t<Button onClick={toggleLanguage} variant=\"outline\" size=\"sm\">\n   295→\t\t\t\t\t\t<Languages className=\"w-4 h-4 mr-2\" />\n   296→\t\t\t\t\t\t{language === 'en' ? 'Español' : 'English'}\n   297→\t\t\t\t\t</Button>\n   298→\t\t\t\t</div>\n   299→\t\t\t\t<Card className=\"w-full max-w-md\">\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"90f3f74e-8754-4e81-93dd-380f6b85e3d7","tool_use_result":{"type":"text","file":{"filePath":"/home/user/vite-template/src/routes/index.tsx","content":"\t\taddTimeCard: \"Agregar Tarjeta\",\n\t\tmanualEntry: \"Entrada Manual\",\n\t\taddManualEntry: \"Agregar Tarjeta Manual\",\n\t\tconfirmDelete: \"¿Está seguro de eliminar este empleado?\",\n\t\tovertimeAlert: \"Alerta de Tiempo Extra\",\n\t\tprintReport: \"Imprimir Informe\",\n\t\texportCSV: \"Exportar a CSV\",\n\t\tdetailedReport: \"Informe Detallado de Tarjetas de Tiempo\",\n\t\tdate: \"Fecha\",\n\t\tday: \"Día\",\n\t\tdeleteTimeCard: \"Eliminar Tarjeta de Tiempo\",\n\t\tconfirmDeleteTimeCard: \"¿Está seguro de eliminar esta tarjeta de tiempo? Esta acción no se puede deshacer.\",\n\t\tsickDays: \"Días de Enfermedad\",\n\t\taddSickDay: \"Agregar Día de Enfermedad\",\n\t\tsickDayDate: \"Fecha de Enfermedad\",\n\t\tsickDayHours: \"Horas\",\n\t\tsickDayNotes: \"Notas/Razón\",\n\t\tsickDayNotesPlaceholder: \"ej., Cita médica, gripe, etc.\",\n\t\tmySickDays: \"Mis Días de Enfermedad\",\n\t\tnoSickDays: \"No hay días de enfermedad registrados\",\n\t\ttotalSickDays: \"Total Días de Enfermedad\",\n\t\tdeleteSickDay: \"Eliminar Día de Enfermedad\",\n\t\tconfirmDeleteSickDay: \"¿Está seguro de eliminar este día de enfermedad? Esta acción no se puede deshacer.\",\n\t\tsickDayHistory: \"Historial de Días de Enfermedad\",\n\t\thourlyRate: \"Tarifa por Hora\",\n\t\tpay: \"Pago\",\n\t\ttotalPay: \"Pago Total\",\n\t\tregularPay: \"Pago Regular\",\n\t\tovertimePay: \"Pago Tiempo Extra\",\n\t}\n};\n\nfunction App() {\n\tconst [currentUser, setCurrentUser] = useState<UserModel | null>(null);\n\tconst [users, setUsers] = useState<UserModel[]>([]);\n\tconst [showUserSelect, setShowUserSelect] = useState(true);\n\tconst [language, setLanguage] = useState<Language>('en');\n\n\tconst t = translations[language];\n\n\tuseEffect(() => {\n\t\tloadUsers();\n\t}, []);\n\n\tconst loadUsers = async () => {\n\t\tconst userORM = UserORM.getInstance();\n\t\tconst allUsers = await userORM.getAllUser();\n\n\t\t// If no users exist, create demo users\n\t\tif (allUsers.length === 0) {\n\t\t\tconst demoUsers = await userORM.insertUser([\n\t\t\t\t{\n\t\t\t\t\tname: \"John Smith\",\n\t\t\t\t\temail: \"john@example.com\",\n\t\t\t\t\trole: UserRole.Employee,\n\t\t\t\t} as UserModel,\n\t\t\t\t{\n\t\t\t\t\tname: \"Sarah Johnson\",\n\t\t\t\t\temail: \"sarah@example.com\",\n\t\t\t\t\trole: UserRole.Employee,\n\t\t\t\t} as UserModel,\n\t\t\t\t{\n\t\t\t\t\tname: \"Mike Manager\",\n\t\t\t\t\temail: \"mike@example.com\",\n\t\t\t\t\trole: UserRole.Manager,\n\t\t\t\t} as UserModel,\n\t\t\t]);\n\t\t\tsetUsers(demoUsers);\n\t\t} else {\n\t\t\tsetUsers(allUsers);\n\t\t}\n\t};\n\n\tconst handleUserSelect = (userId: string) => {\n\t\tconst user = users.find(u => u.id === userId);\n\t\tif (user) {\n\t\t\tsetCurrentUser(user);\n\t\t\tsetShowUserSelect(false);\n\t\t}\n\t};\n\n\tconst handleLogout = () => {\n\t\tsetCurrentUser(null);\n\t\tsetShowUserSelect(true);\n\t};\n\n\tconst toggleLanguage = () => {\n\t\tsetLanguage(prev => prev === 'en' ? 'es' : 'en');\n\t};\n\n\tif (showUserSelect || !currentUser) {\n\t\treturn (\n\t\t\t<div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800 flex items-center justify-center p-4\">\n\t\t\t\t<div className=\"absolute top-4 right-4\">\n\t\t\t\t\t<Button onClick={toggleLanguage} variant=\"outline\" size=\"sm\">\n\t\t\t\t\t\t<Languages className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t\t{language === 'en' ? 'Español' : 'English'}\n\t\t\t\t\t</Button>\n\t\t\t\t</div>\n\t\t\t\t<Card className=\"w-full max-w-md\">","numLines":100,"startLine":200,"totalLines":2439}}}
{"type":"assistant","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_vrtx_01WytSe9kPr4JkG2DrtGSBMP","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me check how the app handles URL parameters and see if I can use that for employee links:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":4,"cache_creation_input_tokens":1652,"cache_read_input_tokens":41913,"cache_creation":{"ephemeral_5m_input_tokens":1652,"ephemeral_1h_input_tokens":0},"output_tokens":1},"context_management":null},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"104133a1-5175-408a-93a0-14a9366bf5ef"}
{"type":"assistant","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_vrtx_01WytSe9kPr4JkG2DrtGSBMP","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_vrtx_013i7iCwyWMtvWm2zURwRqBA","name":"Read","input":{"file_path":"/home/user/vite-template/src/main.tsx"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":4,"cache_creation_input_tokens":1652,"cache_read_input_tokens":41913,"cache_creation":{"ephemeral_5m_input_tokens":1652,"ephemeral_1h_input_tokens":0},"output_tokens":89},"context_management":null},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"c1e0a2aa-efd2-4ce2-83f7-eb8745fcbe6d"}
{"type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_vrtx_013i7iCwyWMtvWm2zURwRqBA","type":"tool_result","content":"     1→import { QueryClient, QueryClientProvider } from \"@tanstack/react-query\";\n     2→import { createRouter, RouterProvider } from \"@tanstack/react-router\";\n     3→import { StrictMode } from \"react\";\n     4→import ReactDOM from \"react-dom/client\";\n     5→\n     6→// Import the generated route tree\n     7→import { routeTree } from \"./routeTree.gen\";\n     8→\n     9→import reportWebVitals from \"./sdk/core/internal/reportWebVitals.ts\";\n    10→import \"./styles.css\";\n    11→\n    12→// Initialize Creao platform SDK\n    13→import { APP_CONFIG } from \"./sdk/core/global.ts\";\n    14→export { APP_CONFIG }; // for backward compatibility\n    15→\n    16→// Create a QueryClient instance\n    17→const queryClient = new QueryClient({\n    18→\tdefaultOptions: {\n    19→\t\tqueries: {\n    20→\t\t\tstaleTime: 5 * 60 * 1000, // 5 minutes\n    21→\t\t\tgcTime: 10 * 60 * 1000, // 10 minutes (previously cacheTime)\n    22→\t\t\tretry: 1,\n    23→\t\t\trefetchOnWindowFocus: false,\n    24→\t\t},\n    25→\t},\n    26→});\n    27→\n    28→// Create a new router instance\n    29→const router = createRouter({\n    30→\trouteTree,\n    31→\tcontext: {},\n    32→\tdefaultPreload: \"intent\",\n    33→\tscrollRestoration: true,\n    34→\tdefaultStructuralSharing: true,\n    35→\tdefaultPreloadStaleTime: 0,\n    36→\tbasepath: import.meta.env.TENANT_ID ? `/${import.meta.env.TENANT_ID}` : \"/\",\n    37→});\n    38→\n    39→// Register the router instance for type safety\n    40→declare module \"@tanstack/react-router\" {\n    41→\tinterface Register {\n    42→\t\trouter: typeof router;\n    43→\t}\n    44→}\n    45→\n    46→// Render the app\n    47→const rootElement = document.getElementById(\"app\");\n    48→if (rootElement && !rootElement.innerHTML) {\n    49→\tconst root = ReactDOM.createRoot(rootElement);\n    50→\troot.render(\n    51→\t\t<StrictMode>\n    52→\t\t\t<QueryClientProvider client={queryClient}>\n    53→\t\t\t\t<RouterProvider router={router} />\n    54→\t\t\t</QueryClientProvider>\n    55→\t\t</StrictMode>,\n    56→\t);\n    57→}\n    58→\n    59→// If you want to start measuring performance in your app, pass a function\n    60→// to log results (for example: reportWebVitals(console.log))\n    61→// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\n    62→reportWebVitals();\n    63→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"4dc86b32-b9db-4c0c-8ac1-3f6acda7f967","tool_use_result":{"type":"text","file":{"filePath":"/home/user/vite-template/src/main.tsx","content":"import { QueryClient, QueryClientProvider } from \"@tanstack/react-query\";\nimport { createRouter, RouterProvider } from \"@tanstack/react-router\";\nimport { StrictMode } from \"react\";\nimport ReactDOM from \"react-dom/client\";\n\n// Import the generated route tree\nimport { routeTree } from \"./routeTree.gen\";\n\nimport reportWebVitals from \"./sdk/core/internal/reportWebVitals.ts\";\nimport \"./styles.css\";\n\n// Initialize Creao platform SDK\nimport { APP_CONFIG } from \"./sdk/core/global.ts\";\nexport { APP_CONFIG }; // for backward compatibility\n\n// Create a QueryClient instance\nconst queryClient = new QueryClient({\n\tdefaultOptions: {\n\t\tqueries: {\n\t\t\tstaleTime: 5 * 60 * 1000, // 5 minutes\n\t\t\tgcTime: 10 * 60 * 1000, // 10 minutes (previously cacheTime)\n\t\t\tretry: 1,\n\t\t\trefetchOnWindowFocus: false,\n\t\t},\n\t},\n});\n\n// Create a new router instance\nconst router = createRouter({\n\trouteTree,\n\tcontext: {},\n\tdefaultPreload: \"intent\",\n\tscrollRestoration: true,\n\tdefaultStructuralSharing: true,\n\tdefaultPreloadStaleTime: 0,\n\tbasepath: import.meta.env.TENANT_ID ? `/${import.meta.env.TENANT_ID}` : \"/\",\n});\n\n// Register the router instance for type safety\ndeclare module \"@tanstack/react-router\" {\n\tinterface Register {\n\t\trouter: typeof router;\n\t}\n}\n\n// Render the app\nconst rootElement = document.getElementById(\"app\");\nif (rootElement && !rootElement.innerHTML) {\n\tconst root = ReactDOM.createRoot(rootElement);\n\troot.render(\n\t\t<StrictMode>\n\t\t\t<QueryClientProvider client={queryClient}>\n\t\t\t\t<RouterProvider router={router} />\n\t\t\t</QueryClientProvider>\n\t\t</StrictMode>,\n\t);\n}\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n","numLines":63,"startLine":1,"totalLines":63}}}
{"type":"assistant","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_vrtx_018aTdkCTavFd6UaAxJhcKUm","type":"message","role":"assistant","content":[{"type":"text","text":"Perfect! I'll implement a solution that uses URL parameters to automatically log in employees and show them only their own information. Here's my plan:\n\n1. Add URL parameter support to auto-select an employee (e.g., `?employee=user_id`)\n2. Create an employee-only view that shows only their time cards, sick days, and clock in/out\n3. Add a \"Copy Employee Link\" button in the manager's employee list\n4. Update translations\n\nLet me start implementing:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":4,"cache_creation_input_tokens":931,"cache_read_input_tokens":43565,"cache_creation":{"ephemeral_5m_input_tokens":931,"ephemeral_1h_input_tokens":0},"output_tokens":1},"context_management":null},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"2bd56672-d3d6-4e97-97bb-e47103f5c6fa"}
{"type":"assistant","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_vrtx_018aTdkCTavFd6UaAxJhcKUm","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_vrtx_01VvSxNeLBy13grt9nnhLFtK","name":"Read","input":{"file_path":"/home/user/vite-template/src/routes/index.tsx","offset":232,"limit":100}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":4,"cache_creation_input_tokens":931,"cache_read_input_tokens":43565,"cache_creation":{"ephemeral_5m_input_tokens":931,"ephemeral_1h_input_tokens":0},"output_tokens":211},"context_management":null},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"3ef8418d-3146-46b5-9f96-292b1b82f555"}
{"type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_vrtx_01VvSxNeLBy13grt9nnhLFtK","type":"tool_result","content":"   232→function App() {\n   233→\tconst [currentUser, setCurrentUser] = useState<UserModel | null>(null);\n   234→\tconst [users, setUsers] = useState<UserModel[]>([]);\n   235→\tconst [showUserSelect, setShowUserSelect] = useState(true);\n   236→\tconst [language, setLanguage] = useState<Language>('en');\n   237→\n   238→\tconst t = translations[language];\n   239→\n   240→\tuseEffect(() => {\n   241→\t\tloadUsers();\n   242→\t}, []);\n   243→\n   244→\tconst loadUsers = async () => {\n   245→\t\tconst userORM = UserORM.getInstance();\n   246→\t\tconst allUsers = await userORM.getAllUser();\n   247→\n   248→\t\t// If no users exist, create demo users\n   249→\t\tif (allUsers.length === 0) {\n   250→\t\t\tconst demoUsers = await userORM.insertUser([\n   251→\t\t\t\t{\n   252→\t\t\t\t\tname: \"John Smith\",\n   253→\t\t\t\t\temail: \"john@example.com\",\n   254→\t\t\t\t\trole: UserRole.Employee,\n   255→\t\t\t\t} as UserModel,\n   256→\t\t\t\t{\n   257→\t\t\t\t\tname: \"Sarah Johnson\",\n   258→\t\t\t\t\temail: \"sarah@example.com\",\n   259→\t\t\t\t\trole: UserRole.Employee,\n   260→\t\t\t\t} as UserModel,\n   261→\t\t\t\t{\n   262→\t\t\t\t\tname: \"Mike Manager\",\n   263→\t\t\t\t\temail: \"mike@example.com\",\n   264→\t\t\t\t\trole: UserRole.Manager,\n   265→\t\t\t\t} as UserModel,\n   266→\t\t\t]);\n   267→\t\t\tsetUsers(demoUsers);\n   268→\t\t} else {\n   269→\t\t\tsetUsers(allUsers);\n   270→\t\t}\n   271→\t};\n   272→\n   273→\tconst handleUserSelect = (userId: string) => {\n   274→\t\tconst user = users.find(u => u.id === userId);\n   275→\t\tif (user) {\n   276→\t\t\tsetCurrentUser(user);\n   277→\t\t\tsetShowUserSelect(false);\n   278→\t\t}\n   279→\t};\n   280→\n   281→\tconst handleLogout = () => {\n   282→\t\tsetCurrentUser(null);\n   283→\t\tsetShowUserSelect(true);\n   284→\t};\n   285→\n   286→\tconst toggleLanguage = () => {\n   287→\t\tsetLanguage(prev => prev === 'en' ? 'es' : 'en');\n   288→\t};\n   289→\n   290→\tif (showUserSelect || !currentUser) {\n   291→\t\treturn (\n   292→\t\t\t<div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800 flex items-center justify-center p-4\">\n   293→\t\t\t\t<div className=\"absolute top-4 right-4\">\n   294→\t\t\t\t\t<Button onClick={toggleLanguage} variant=\"outline\" size=\"sm\">\n   295→\t\t\t\t\t\t<Languages className=\"w-4 h-4 mr-2\" />\n   296→\t\t\t\t\t\t{language === 'en' ? 'Español' : 'English'}\n   297→\t\t\t\t\t</Button>\n   298→\t\t\t\t</div>\n   299→\t\t\t\t<Card className=\"w-full max-w-md\">\n   300→\t\t\t\t\t<CardHeader>\n   301→\t\t\t\t\t\t<CardTitle className=\"text-2xl\">{t.appTitle}</CardTitle>\n   302→\t\t\t\t\t\t<CardDescription>{t.selectAccount}</CardDescription>\n   303→\t\t\t\t\t</CardHeader>\n   304→\t\t\t\t\t<CardContent className=\"space-y-4\">\n   305→\t\t\t\t\t\t<div className=\"space-y-2\">\n   306→\t\t\t\t\t\t\t<Label>{t.selectUser}</Label>\n   307→\t\t\t\t\t\t\t<Select onValueChange={handleUserSelect}>\n   308→\t\t\t\t\t\t\t\t<SelectTrigger className=\"w-full\">\n   309→\t\t\t\t\t\t\t\t\t<SelectValue placeholder={t.chooseAccount} />\n   310→\t\t\t\t\t\t\t\t</SelectTrigger>\n   311→\t\t\t\t\t\t\t\t<SelectContent>\n   312→\t\t\t\t\t\t\t\t\t{users.map((user) => (\n   313→\t\t\t\t\t\t\t\t\t\t<SelectItem key={user.id} value={user.id}>\n   314→\t\t\t\t\t\t\t\t\t\t\t{user.name} - {user.role === UserRole.Manager ? t.manager : t.employee}\n   315→\t\t\t\t\t\t\t\t\t\t</SelectItem>\n   316→\t\t\t\t\t\t\t\t\t))}\n   317→\t\t\t\t\t\t\t\t</SelectContent>\n   318→\t\t\t\t\t\t\t</Select>\n   319→\t\t\t\t\t\t</div>\n   320→\t\t\t\t\t</CardContent>\n   321→\t\t\t\t</Card>\n   322→\t\t\t</div>\n   323→\t\t);\n   324→\t}\n   325→\n   326→\treturn (\n   327→\t\t<div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800\">\n   328→\t\t\t<div className=\"container mx-auto p-6 space-y-6\">\n   329→\t\t\t\t<div className=\"flex justify-between items-center\">\n   330→\t\t\t\t\t<div>\n   331→\t\t\t\t\t\t<h1 className=\"text-3xl font-bold\">{t.timeTrackingSystem}</h1>\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"41dccc9a-de6c-4d3b-bbdf-d2263531224a","tool_use_result":{"type":"text","file":{"filePath":"/home/user/vite-template/src/routes/index.tsx","content":"function App() {\n\tconst [currentUser, setCurrentUser] = useState<UserModel | null>(null);\n\tconst [users, setUsers] = useState<UserModel[]>([]);\n\tconst [showUserSelect, setShowUserSelect] = useState(true);\n\tconst [language, setLanguage] = useState<Language>('en');\n\n\tconst t = translations[language];\n\n\tuseEffect(() => {\n\t\tloadUsers();\n\t}, []);\n\n\tconst loadUsers = async () => {\n\t\tconst userORM = UserORM.getInstance();\n\t\tconst allUsers = await userORM.getAllUser();\n\n\t\t// If no users exist, create demo users\n\t\tif (allUsers.length === 0) {\n\t\t\tconst demoUsers = await userORM.insertUser([\n\t\t\t\t{\n\t\t\t\t\tname: \"John Smith\",\n\t\t\t\t\temail: \"john@example.com\",\n\t\t\t\t\trole: UserRole.Employee,\n\t\t\t\t} as UserModel,\n\t\t\t\t{\n\t\t\t\t\tname: \"Sarah Johnson\",\n\t\t\t\t\temail: \"sarah@example.com\",\n\t\t\t\t\trole: UserRole.Employee,\n\t\t\t\t} as UserModel,\n\t\t\t\t{\n\t\t\t\t\tname: \"Mike Manager\",\n\t\t\t\t\temail: \"mike@example.com\",\n\t\t\t\t\trole: UserRole.Manager,\n\t\t\t\t} as UserModel,\n\t\t\t]);\n\t\t\tsetUsers(demoUsers);\n\t\t} else {\n\t\t\tsetUsers(allUsers);\n\t\t}\n\t};\n\n\tconst handleUserSelect = (userId: string) => {\n\t\tconst user = users.find(u => u.id === userId);\n\t\tif (user) {\n\t\t\tsetCurrentUser(user);\n\t\t\tsetShowUserSelect(false);\n\t\t}\n\t};\n\n\tconst handleLogout = () => {\n\t\tsetCurrentUser(null);\n\t\tsetShowUserSelect(true);\n\t};\n\n\tconst toggleLanguage = () => {\n\t\tsetLanguage(prev => prev === 'en' ? 'es' : 'en');\n\t};\n\n\tif (showUserSelect || !currentUser) {\n\t\treturn (\n\t\t\t<div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800 flex items-center justify-center p-4\">\n\t\t\t\t<div className=\"absolute top-4 right-4\">\n\t\t\t\t\t<Button onClick={toggleLanguage} variant=\"outline\" size=\"sm\">\n\t\t\t\t\t\t<Languages className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t\t{language === 'en' ? 'Español' : 'English'}\n\t\t\t\t\t</Button>\n\t\t\t\t</div>\n\t\t\t\t<Card className=\"w-full max-w-md\">\n\t\t\t\t\t<CardHeader>\n\t\t\t\t\t\t<CardTitle className=\"text-2xl\">{t.appTitle}</CardTitle>\n\t\t\t\t\t\t<CardDescription>{t.selectAccount}</CardDescription>\n\t\t\t\t\t</CardHeader>\n\t\t\t\t\t<CardContent className=\"space-y-4\">\n\t\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t\t<Label>{t.selectUser}</Label>\n\t\t\t\t\t\t\t<Select onValueChange={handleUserSelect}>\n\t\t\t\t\t\t\t\t<SelectTrigger className=\"w-full\">\n\t\t\t\t\t\t\t\t\t<SelectValue placeholder={t.chooseAccount} />\n\t\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t\t{users.map((user) => (\n\t\t\t\t\t\t\t\t\t\t<SelectItem key={user.id} value={user.id}>\n\t\t\t\t\t\t\t\t\t\t\t{user.name} - {user.role === UserRole.Manager ? t.manager : t.employee}\n\t\t\t\t\t\t\t\t\t\t</SelectItem>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t\t</Select>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</CardContent>\n\t\t\t\t</Card>\n\t\t\t</div>\n\t\t);\n\t}\n\n\treturn (\n\t\t<div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800\">\n\t\t\t<div className=\"container mx-auto p-6 space-y-6\">\n\t\t\t\t<div className=\"flex justify-between items-center\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<h1 className=\"text-3xl font-bold\">{t.timeTrackingSystem}</h1>","numLines":100,"startLine":232,"totalLines":2439}}}
{"type":"assistant","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_vrtx_01XSa8SN6HyXxCwk3han2t5h","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me update the App component to support URL parameters and auto-login for employees:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":1759,"cache_read_input_tokens":44496,"cache_creation":{"ephemeral_5m_input_tokens":1759,"ephemeral_1h_input_tokens":0},"output_tokens":1},"context_management":null},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"40f4e2c7-0be6-4557-a2ad-b921937ea2bf"}
{"type":"assistant","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_vrtx_01XSa8SN6HyXxCwk3han2t5h","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_vrtx_018YEJfqYKXxroJC8KEESftx","name":"Edit","input":{"file_path":"/home/user/vite-template/src/routes/index.tsx","old_string":"function App() {\n\tconst [currentUser, setCurrentUser] = useState<UserModel | null>(null);\n\tconst [users, setUsers] = useState<UserModel[]>([]);\n\tconst [showUserSelect, setShowUserSelect] = useState(true);\n\tconst [language, setLanguage] = useState<Language>('en');\n\n\tconst t = translations[language];\n\n\tuseEffect(() => {\n\t\tloadUsers();\n\t}, []);","new_string":"function App() {\n\tconst [currentUser, setCurrentUser] = useState<UserModel | null>(null);\n\tconst [users, setUsers] = useState<UserModel[]>([]);\n\tconst [showUserSelect, setShowUserSelect] = useState(true);\n\tconst [language, setLanguage] = useState<Language>('en');\n\tconst [employeeOnlyMode, setEmployeeOnlyMode] = useState(false);\n\n\tconst t = translations[language];\n\n\tuseEffect(() => {\n\t\tloadUsers();\n\t}, []);\n\n\t// Check for employee URL parameter and auto-login\n\tuseEffect(() => {\n\t\tif (users.length > 0 && !currentUser) {\n\t\t\tconst urlParams = new URLSearchParams(window.location.search);\n\t\t\tconst employeeId = urlParams.get('employee');\n\n\t\t\tif (employeeId) {\n\t\t\t\tconst user = users.find(u => u.id === employeeId && u.role === UserRole.Employee);\n\t\t\t\tif (user) {\n\t\t\t\t\tsetCurrentUser(user);\n\t\t\t\t\tsetShowUserSelect(false);\n\t\t\t\t\tsetEmployeeOnlyMode(true);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}, [users, currentUser]);"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":1759,"cache_read_input_tokens":44496,"cache_creation":{"ephemeral_5m_input_tokens":1759,"ephemeral_1h_input_tokens":0},"output_tokens":515},"context_management":null},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"4a4ec204-c2df-4f11-8e55-3c8580e8f77e"}
{"type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_vrtx_018YEJfqYKXxroJC8KEESftx","type":"tool_result","content":"The file /home/user/vite-template/src/routes/index.tsx has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n   228→\t\tovertimePay: \"Pago Tiempo Extra\",\n   229→\t}\n   230→};\n   231→\n   232→function App() {\n   233→\tconst [currentUser, setCurrentUser] = useState<UserModel | null>(null);\n   234→\tconst [users, setUsers] = useState<UserModel[]>([]);\n   235→\tconst [showUserSelect, setShowUserSelect] = useState(true);\n   236→\tconst [language, setLanguage] = useState<Language>('en');\n   237→\tconst [employeeOnlyMode, setEmployeeOnlyMode] = useState(false);\n   238→\n   239→\tconst t = translations[language];\n   240→\n   241→\tuseEffect(() => {\n   242→\t\tloadUsers();\n   243→\t}, []);\n   244→\n   245→\t// Check for employee URL parameter and auto-login\n   246→\tuseEffect(() => {\n   247→\t\tif (users.length > 0 && !currentUser) {\n   248→\t\t\tconst urlParams = new URLSearchParams(window.location.search);\n   249→\t\t\tconst employeeId = urlParams.get('employee');\n   250→\n   251→\t\t\tif (employeeId) {\n   252→\t\t\t\tconst user = users.find(u => u.id === employeeId && u.role === UserRole.Employee);\n   253→\t\t\t\tif (user) {\n   254→\t\t\t\t\tsetCurrentUser(user);\n   255→\t\t\t\t\tsetShowUserSelect(false);\n   256→\t\t\t\t\tsetEmployeeOnlyMode(true);\n   257→\t\t\t\t}\n   258→\t\t\t}\n   259→\t\t}\n   260→\t}, [users, currentUser]);\n   261→\n   262→\tconst loadUsers = async () => {\n   263→\t\tconst userORM = UserORM.getInstance();\n   264→\t\tconst allUsers = await userORM.getAllUser();"}]},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"b2323c60-286a-4161-8271-193d7d08a8e5","tool_use_result":{"filePath":"/home/user/vite-template/src/routes/index.tsx","oldString":"function App() {\n\tconst [currentUser, setCurrentUser] = useState<UserModel | null>(null);\n\tconst [users, setUsers] = useState<UserModel[]>([]);\n\tconst [showUserSelect, setShowUserSelect] = useState(true);\n\tconst [language, setLanguage] = useState<Language>('en');\n\n\tconst t = translations[language];\n\n\tuseEffect(() => {\n\t\tloadUsers();\n\t}, []);","newString":"function App() {\n\tconst [currentUser, setCurrentUser] = useState<UserModel | null>(null);\n\tconst [users, setUsers] = useState<UserModel[]>([]);\n\tconst [showUserSelect, setShowUserSelect] = useState(true);\n\tconst [language, setLanguage] = useState<Language>('en');\n\tconst [employeeOnlyMode, setEmployeeOnlyMode] = useState(false);\n\n\tconst t = translations[language];\n\n\tuseEffect(() => {\n\t\tloadUsers();\n\t}, []);\n\n\t// Check for employee URL parameter and auto-login\n\tuseEffect(() => {\n\t\tif (users.length > 0 && !currentUser) {\n\t\t\tconst urlParams = new URLSearchParams(window.location.search);\n\t\t\tconst employeeId = urlParams.get('employee');\n\n\t\t\tif (employeeId) {\n\t\t\t\tconst user = users.find(u => u.id === employeeId && u.role === UserRole.Employee);\n\t\t\t\tif (user) {\n\t\t\t\t\tsetCurrentUser(user);\n\t\t\t\t\tsetShowUserSelect(false);\n\t\t\t\t\tsetEmployeeOnlyMode(true);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}, [users, currentUser]);","originalFile":"import { createFileRoute } from \"@tanstack/react-router\";\nimport { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from \"@/components/ui/dialog\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Clock, Users, CalendarDays, Timer, Languages, Coffee, UserPlus, FileText, AlertCircle, Plus, Trash2, Heart } from \"lucide-react\";\nimport { UserORM, type UserModel, UserRole } from \"@/sdk/database/orm/orm_user\";\nimport { TimeCardEntryORM, type TimeCardEntryModel } from \"@/sdk/database/orm/orm_time_card_entry\";\nimport { SickDayORM, type SickDayModel } from \"@/sdk/database/orm/orm_sick_day\";\nimport { normalizeTimeCardEntryForSave, normalizeTimeCardEntriesFromORM, isActiveShift, isOnLunchBreak } from \"@/lib/orm-data-helpers\";\n\nexport const Route = createFileRoute(\"/\")({\n\tcomponent: App,\n});\n\ntype Language = 'en' | 'es';\n\nconst translations = {\n\ten: {\n\t\tappTitle: \"Employee Time Tracking\",\n\t\tselectAccount: \"Select your account to continue\",\n\t\tselectUser: \"Select User\",\n\t\tchooseAccount: \"Choose your account\",\n\t\tmanager: \"Manager\",\n\t\temployee: \"Employee\",\n\t\tswitchUser: \"Switch User\",\n\t\ttimeTrackingSystem: \"Time Tracking System\",\n\t\twelcome: \"Welcome\",\n\t\tclockInOut: \"Clock In/Out\",\n\t\tcurrentlyClocked: \"Currently Clocked In\",\n\t\tsince: \"Since\",\n\t\telapsedTime: \"Elapsed Time\",\n\t\tclockOut: \"Clock Out\",\n\t\tnotClocked: \"Not currently clocked in\",\n\t\tclockIn: \"Clock In\",\n\t\ttimeCardHistory: \"Time Card History\",\n\t\trecentRecords: \"Your recent clock in/out records\",\n\t\tnoTimeCards: \"No time cards yet\",\n\t\tclockInTime: \"Clock In\",\n\t\tclockOutTime: \"Clock Out\",\n\t\thours: \"Hours\",\n\t\tstatus: \"Status\",\n\t\tcompleted: \"Completed\",\n\t\tactive: \"Active\",\n\t\ttotalEmployees: \"Total Employees\",\n\t\thoursToday: \"Hours Today\",\n\t\thoursThisWeek: \"Hours This Week\",\n\t\tallEmployeeTimeCards: \"All Employee Time Cards\",\n\t\tviewManageRecords: \"View and manage all employee time records\",\n\t\tfilterByEmployee: \"Filter by Employee\",\n\t\tallEmployees: \"All Employees\",\n\t\tfilterByDate: \"Filter by Date\",\n\t\tclearFilters: \"Clear Filters\",\n\t\tnoTimeCardsFound: \"No time cards found\",\n\t\temployeeName: \"Employee\",\n\t\tactions: \"Actions\",\n\t\tedit: \"Edit\",\n\t\teditTimeCard: \"Edit Time Card\",\n\t\tcancel: \"Cancel\",\n\t\tsaveChanges: \"Save Changes\",\n\t\tlocation: \"Location\",\n\t\twhereWorked: \"Where did you work?\",\n\t\tworkDescription: \"Work Description\",\n\t\twhatDid: \"What did you do today?\",\n\t\tlocationPlaceholder: \"e.g., Office, Remote, Client Site\",\n\t\tdescriptionPlaceholder: \"Describe your work activities...\",\n\t\tstartLunch: \"Start Lunch Break\",\n\t\tendLunch: \"End Lunch Break\",\n\t\tonLunchBreak: \"On Lunch Break\",\n\t\tlunchBreak: \"Lunch Break\",\n\t\tlunchDuration: \"Lunch\",\n\t\tlunchStartTime: \"Lunch Start\",\n\t\tlunchEndTime: \"Lunch End\",\n\t\ttimeCards: \"Time Cards\",\n\t\treports: \"Reports\",\n\t\temployees: \"Employees\",\n\t\taddEmployee: \"Add Employee\",\n\t\teditEmployee: \"Edit Employee\",\n\t\tdeleteEmployee: \"Delete Employee\",\n\t\tname: \"Name\",\n\t\temail: \"Email\",\n\t\tphone: \"Phone\",\n\t\trole: \"Role\",\n\t\tdelete: \"Delete\",\n\t\tweeklyReport: \"Weekly Report\",\n\t\tselectWeek: \"Select Week\",\n\t\tregularHours: \"Regular\",\n\t\tovertimeHours: \"Overtime\",\n\t\ttotalHours: \"Total\",\n\t\tnoReportData: \"No data for selected week\",\n\t\taddTimeCard: \"Add Time Card\",\n\t\tmanualEntry: \"Manual Entry\",\n\t\taddManualEntry: \"Add Manual Time Card\",\n\t\tconfirmDelete: \"Are you sure you want to delete this employee?\",\n\t\tovertimeAlert: \"Overtime Alert\",\n\t\tprintReport: \"Print Report\",\n\t\texportCSV: \"Export to CSV\",\n\t\tdetailedReport: \"Detailed Time Card Report\",\n\t\tdate: \"Date\",\n\t\tday: \"Day\",\n\t\tdeleteTimeCard: \"Delete Time Card\",\n\t\tconfirmDeleteTimeCard: \"Are you sure you want to delete this time card? This action cannot be undone.\",\n\t\tsickDays: \"Sick Days\",\n\t\taddSickDay: \"Add Sick Day\",\n\t\tsickDayDate: \"Sick Day Date\",\n\t\tsickDayHours: \"Hours\",\n\t\tsickDayNotes: \"Notes/Reason\",\n\t\tsickDayNotesPlaceholder: \"e.g., Doctor's appointment, flu, etc.\",\n\t\tmySickDays: \"My Sick Days\",\n\t\tnoSickDays: \"No sick days recorded\",\n\t\ttotalSickDays: \"Total Sick Days\",\n\t\tdeleteSickDay: \"Delete Sick Day\",\n\t\tconfirmDeleteSickDay: \"Are you sure you want to delete this sick day? This action cannot be undone.\",\n\t\tsickDayHistory: \"Sick Day History\",\n\t\thourlyRate: \"Hourly Rate\",\n\t\tpay: \"Pay\",\n\t\ttotalPay: \"Total Pay\",\n\t\tregularPay: \"Regular Pay\",\n\t\tovertimePay: \"Overtime Pay\",\n\t},\n\tes: {\n\t\tappTitle: \"Registro de Tiempo de Empleados\",\n\t\tselectAccount: \"Selecciona tu cuenta para continuar\",\n\t\tselectUser: \"Seleccionar Usuario\",\n\t\tchooseAccount: \"Elige tu cuenta\",\n\t\tmanager: \"Gerente\",\n\t\temployee: \"Empleado\",\n\t\tswitchUser: \"Cambiar Usuario\",\n\t\ttimeTrackingSystem: \"Sistema de Registro de Tiempo\",\n\t\twelcome: \"Bienvenido\",\n\t\tclockInOut: \"Entrada/Salida\",\n\t\tcurrentlyClocked: \"Actualmente Registrado\",\n\t\tsince: \"Desde\",\n\t\telapsedTime: \"Tiempo Transcurrido\",\n\t\tclockOut: \"Registrar Salida\",\n\t\tnotClocked: \"No está registrado actualmente\",\n\t\tclockIn: \"Registrar Entrada\",\n\t\ttimeCardHistory: \"Historial de Tarjetas de Tiempo\",\n\t\trecentRecords: \"Tus registros recientes de entrada/salida\",\n\t\tnoTimeCards: \"No hay tarjetas de tiempo todavía\",\n\t\tclockInTime: \"Entrada\",\n\t\tclockOutTime: \"Salida\",\n\t\thours: \"Horas\",\n\t\tstatus: \"Estado\",\n\t\tcompleted: \"Completado\",\n\t\tactive: \"Activo\",\n\t\ttotalEmployees: \"Total de Empleados\",\n\t\thoursToday: \"Horas Hoy\",\n\t\thoursThisWeek: \"Horas Esta Semana\",\n\t\tallEmployeeTimeCards: \"Todas las Tarjetas de Tiempo\",\n\t\tviewManageRecords: \"Ver y gestionar todos los registros de empleados\",\n\t\tfilterByEmployee: \"Filtrar por Empleado\",\n\t\tallEmployees: \"Todos los Empleados\",\n\t\tfilterByDate: \"Filtrar por Fecha\",\n\t\tclearFilters: \"Limpiar Filtros\",\n\t\tnoTimeCardsFound: \"No se encontraron tarjetas de tiempo\",\n\t\temployeeName: \"Empleado\",\n\t\tactions: \"Acciones\",\n\t\tedit: \"Editar\",\n\t\teditTimeCard: \"Editar Tarjeta de Tiempo\",\n\t\tcancel: \"Cancelar\",\n\t\tsaveChanges: \"Guardar Cambios\",\n\t\tlocation: \"Ubicación\",\n\t\twhereWorked: \"¿Dónde trabajaste?\",\n\t\tworkDescription: \"Descripción del Trabajo\",\n\t\twhatDid: \"¿Qué hiciste hoy?\",\n\t\tlocationPlaceholder: \"ej., Oficina, Remoto, Sitio del Cliente\",\n\t\tdescriptionPlaceholder: \"Describe tus actividades laborales...\",\n\t\tstartLunch: \"Iniciar Almuerzo\",\n\t\tendLunch: \"Terminar Almuerzo\",\n\t\tonLunchBreak: \"En Almuerzo\",\n\t\tlunchBreak: \"Almuerzo\",\n\t\tlunchDuration: \"Almuerzo\",\n\t\tlunchStartTime: \"Inicio Almuerzo\",\n\t\tlunchEndTime: \"Fin Almuerzo\",\n\t\ttimeCards: \"Tarjetas de Tiempo\",\n\t\treports: \"Informes\",\n\t\temployees: \"Empleados\",\n\t\taddEmployee: \"Agregar Empleado\",\n\t\teditEmployee: \"Editar Empleado\",\n\t\tdeleteEmployee: \"Eliminar Empleado\",\n\t\tname: \"Nombre\",\n\t\temail: \"Correo\",\n\t\tphone: \"Teléfono\",\n\t\trole: \"Rol\",\n\t\tdelete: \"Eliminar\",\n\t\tweeklyReport: \"Informe Semanal\",\n\t\tselectWeek: \"Seleccionar Semana\",\n\t\tregularHours: \"Regular\",\n\t\tovertimeHours: \"Tiempo Extra\",\n\t\ttotalHours: \"Total\",\n\t\tnoReportData: \"No hay datos para la semana seleccionada\",\n\t\taddTimeCard: \"Agregar Tarjeta\",\n\t\tmanualEntry: \"Entrada Manual\",\n\t\taddManualEntry: \"Agregar Tarjeta Manual\",\n\t\tconfirmDelete: \"¿Está seguro de eliminar este empleado?\",\n\t\tovertimeAlert: \"Alerta de Tiempo Extra\",\n\t\tprintReport: \"Imprimir Informe\",\n\t\texportCSV: \"Exportar a CSV\",\n\t\tdetailedReport: \"Informe Detallado de Tarjetas de Tiempo\",\n\t\tdate: \"Fecha\",\n\t\tday: \"Día\",\n\t\tdeleteTimeCard: \"Eliminar Tarjeta de Tiempo\",\n\t\tconfirmDeleteTimeCard: \"¿Está seguro de eliminar esta tarjeta de tiempo? Esta acción no se puede deshacer.\",\n\t\tsickDays: \"Días de Enfermedad\",\n\t\taddSickDay: \"Agregar Día de Enfermedad\",\n\t\tsickDayDate: \"Fecha de Enfermedad\",\n\t\tsickDayHours: \"Horas\",\n\t\tsickDayNotes: \"Notas/Razón\",\n\t\tsickDayNotesPlaceholder: \"ej., Cita médica, gripe, etc.\",\n\t\tmySickDays: \"Mis Días de Enfermedad\",\n\t\tnoSickDays: \"No hay días de enfermedad registrados\",\n\t\ttotalSickDays: \"Total Días de Enfermedad\",\n\t\tdeleteSickDay: \"Eliminar Día de Enfermedad\",\n\t\tconfirmDeleteSickDay: \"¿Está seguro de eliminar este día de enfermedad? Esta acción no se puede deshacer.\",\n\t\tsickDayHistory: \"Historial de Días de Enfermedad\",\n\t\thourlyRate: \"Tarifa por Hora\",\n\t\tpay: \"Pago\",\n\t\ttotalPay: \"Pago Total\",\n\t\tregularPay: \"Pago Regular\",\n\t\tovertimePay: \"Pago Tiempo Extra\",\n\t}\n};\n\nfunction App() {\n\tconst [currentUser, setCurrentUser] = useState<UserModel | null>(null);\n\tconst [users, setUsers] = useState<UserModel[]>([]);\n\tconst [showUserSelect, setShowUserSelect] = useState(true);\n\tconst [language, setLanguage] = useState<Language>('en');\n\n\tconst t = translations[language];\n\n\tuseEffect(() => {\n\t\tloadUsers();\n\t}, []);\n\n\tconst loadUsers = async () => {\n\t\tconst userORM = UserORM.getInstance();\n\t\tconst allUsers = await userORM.getAllUser();\n\n\t\t// If no users exist, create demo users\n\t\tif (allUsers.length === 0) {\n\t\t\tconst demoUsers = await userORM.insertUser([\n\t\t\t\t{\n\t\t\t\t\tname: \"John Smith\",\n\t\t\t\t\temail: \"john@example.com\",\n\t\t\t\t\trole: UserRole.Employee,\n\t\t\t\t} as UserModel,\n\t\t\t\t{\n\t\t\t\t\tname: \"Sarah Johnson\",\n\t\t\t\t\temail: \"sarah@example.com\",\n\t\t\t\t\trole: UserRole.Employee,\n\t\t\t\t} as UserModel,\n\t\t\t\t{\n\t\t\t\t\tname: \"Mike Manager\",\n\t\t\t\t\temail: \"mike@example.com\",\n\t\t\t\t\trole: UserRole.Manager,\n\t\t\t\t} as UserModel,\n\t\t\t]);\n\t\t\tsetUsers(demoUsers);\n\t\t} else {\n\t\t\tsetUsers(allUsers);\n\t\t}\n\t};\n\n\tconst handleUserSelect = (userId: string) => {\n\t\tconst user = users.find(u => u.id === userId);\n\t\tif (user) {\n\t\t\tsetCurrentUser(user);\n\t\t\tsetShowUserSelect(false);\n\t\t}\n\t};\n\n\tconst handleLogout = () => {\n\t\tsetCurrentUser(null);\n\t\tsetShowUserSelect(true);\n\t};\n\n\tconst toggleLanguage = () => {\n\t\tsetLanguage(prev => prev === 'en' ? 'es' : 'en');\n\t};\n\n\tif (showUserSelect || !currentUser) {\n\t\treturn (\n\t\t\t<div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800 flex items-center justify-center p-4\">\n\t\t\t\t<div className=\"absolute top-4 right-4\">\n\t\t\t\t\t<Button onClick={toggleLanguage} variant=\"outline\" size=\"sm\">\n\t\t\t\t\t\t<Languages className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t\t{language === 'en' ? 'Español' : 'English'}\n\t\t\t\t\t</Button>\n\t\t\t\t</div>\n\t\t\t\t<Card className=\"w-full max-w-md\">\n\t\t\t\t\t<CardHeader>\n\t\t\t\t\t\t<CardTitle className=\"text-2xl\">{t.appTitle}</CardTitle>\n\t\t\t\t\t\t<CardDescription>{t.selectAccount}</CardDescription>\n\t\t\t\t\t</CardHeader>\n\t\t\t\t\t<CardContent className=\"space-y-4\">\n\t\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t\t<Label>{t.selectUser}</Label>\n\t\t\t\t\t\t\t<Select onValueChange={handleUserSelect}>\n\t\t\t\t\t\t\t\t<SelectTrigger className=\"w-full\">\n\t\t\t\t\t\t\t\t\t<SelectValue placeholder={t.chooseAccount} />\n\t\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t\t{users.map((user) => (\n\t\t\t\t\t\t\t\t\t\t<SelectItem key={user.id} value={user.id}>\n\t\t\t\t\t\t\t\t\t\t\t{user.name} - {user.role === UserRole.Manager ? t.manager : t.employee}\n\t\t\t\t\t\t\t\t\t\t</SelectItem>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t\t</Select>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</CardContent>\n\t\t\t\t</Card>\n\t\t\t</div>\n\t\t);\n\t}\n\n\treturn (\n\t\t<div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800\">\n\t\t\t<div className=\"container mx-auto p-6 space-y-6\">\n\t\t\t\t<div className=\"flex justify-between items-center\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<h1 className=\"text-3xl font-bold\">{t.timeTrackingSystem}</h1>\n\t\t\t\t\t\t<p className=\"text-muted-foreground\">\n\t\t\t\t\t\t\t{t.welcome}, {currentUser.name} ({currentUser.role === UserRole.Manager ? t.manager : t.employee})\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"flex gap-2\">\n\t\t\t\t\t\t<Button onClick={toggleLanguage} variant=\"outline\" size=\"sm\">\n\t\t\t\t\t\t\t<Languages className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t\t\t{language === 'en' ? 'Español' : 'English'}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button onClick={handleLogout} variant=\"outline\">\n\t\t\t\t\t\t\t{t.switchUser}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t{currentUser.role === UserRole.Employee ? (\n\t\t\t\t\t<EmployeeView user={currentUser} language={language} />\n\t\t\t\t) : (\n\t\t\t\t\t<ManagerView user={currentUser} users={users} language={language} onUsersChange={loadUsers} />\n\t\t\t\t)}\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n\nfunction SickDayCard({ user, language }: { user: UserModel; language: Language }) {\n\tconst [sickDays, setSickDays] = useState<SickDayModel[]>([]);\n\tconst [showAddDialog, setShowAddDialog] = useState(false);\n\tconst [sickDate, setSickDate] = useState(\"\");\n\tconst [sickHours, setSickHours] = useState(\"8\");\n\tconst [sickNotes, setSickNotes] = useState(\"\");\n\n\tconst t = translations[language];\n\n\tuseEffect(() => {\n\t\tloadSickDays();\n\t}, [user.id]);\n\n\tconst loadSickDays = async () => {\n\t\tconst sickDayORM = SickDayORM.getInstance();\n\t\tconst userSickDays = await sickDayORM.getSickDayByUserId(user.id);\n\n\t\t// Sort by date (newest first)\n\t\tconst sorted = userSickDays.sort((a, b) =>\n\t\t\tnew Date(b.sick_date).getTime() - new Date(a.sick_date).getTime()\n\t\t);\n\n\t\tsetSickDays(sorted);\n\t};\n\n\tconst handleAddSickDay = async () => {\n\t\tif (!sickDate || !sickHours) {\n\t\t\talert(\"Please fill in date and hours\");\n\t\t\treturn;\n\t\t}\n\n\t\tconst sickDayORM = SickDayORM.getInstance();\n\t\tawait sickDayORM.insertSickDay([{\n\t\t\tuser_id: user.id,\n\t\t\tsick_date: sickDate,\n\t\t\thours: parseFloat(sickHours),\n\t\t\tnotes: sickNotes || null,\n\t\t} as SickDayModel]);\n\n\t\t// Reset form\n\t\tsetSickDate(\"\");\n\t\tsetSickHours(\"8\");\n\t\tsetSickNotes(\"\");\n\t\tsetShowAddDialog(false);\n\n\t\tawait loadSickDays();\n\t};\n\n\tconst handleDeleteSickDay = async (sickDay: SickDayModel) => {\n\t\tif (!window.confirm(t.confirmDeleteSickDay)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst sickDayORM = SickDayORM.getInstance();\n\t\tawait sickDayORM.deleteSickDayById(sickDay.id);\n\t\tawait loadSickDays();\n\t};\n\n\tconst formatDate = (dateStr: string) => {\n\t\tconst date = new Date(dateStr);\n\t\treturn date.toLocaleDateString(language === 'es' ? 'es-ES' : 'en-US', {\n\t\t\tyear: 'numeric',\n\t\t\tmonth: 'long',\n\t\t\tday: 'numeric'\n\t\t});\n\t};\n\n\tconst totalSickHours = sickDays.reduce((sum, sd) => sum + sd.hours, 0);\n\n\treturn (\n\t\t<>\n\t\t\t<Card>\n\t\t\t\t<CardHeader>\n\t\t\t\t\t<div className=\"flex justify-between items-center\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<CardTitle className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t<Heart className=\"w-5 h-5 text-red-500\" />\n\t\t\t\t\t\t\t\t{t.mySickDays}\n\t\t\t\t\t\t\t</CardTitle>\n\t\t\t\t\t\t\t<CardDescription>\n\t\t\t\t\t\t\t\t{t.totalSickDays}: {totalSickHours.toFixed(1)} {language === 'es' ? 'hrs' : 'hrs'}\n\t\t\t\t\t\t\t</CardDescription>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<Button onClick={() => setShowAddDialog(true)} size=\"sm\">\n\t\t\t\t\t\t\t<Plus className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t\t\t{t.addSickDay}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t</CardHeader>\n\t\t\t\t<CardContent>\n\t\t\t\t\t{sickDays.length === 0 ? (\n\t\t\t\t\t\t<p className=\"text-center text-muted-foreground py-8\">{t.noSickDays}</p>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<div className=\"overflow-x-auto\">\n\t\t\t\t\t\t\t<Table>\n\t\t\t\t\t\t\t\t<TableHeader>\n\t\t\t\t\t\t\t\t\t<TableRow>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.sickDayDate}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.sickDayHours}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.sickDayNotes}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.actions}</TableHead>\n\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t</TableHeader>\n\t\t\t\t\t\t\t\t<TableBody>\n\t\t\t\t\t\t\t\t\t{sickDays.map((sd) => (\n\t\t\t\t\t\t\t\t\t\t<TableRow key={sd.id}>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"font-medium whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t{formatDate(sd.sick_date)}\n\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell>{sd.hours} hrs</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"max-w-xs truncate\">{sd.notes || \"—\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => handleDeleteSickDay(sd)}\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"text-red-600 hover:text-red-700 hover:bg-red-50\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Trash2 className=\"w-4 h-4\" />\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</TableBody>\n\t\t\t\t\t\t\t</Table>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</CardContent>\n\t\t\t</Card>\n\n\t\t\t<Dialog open={showAddDialog} onOpenChange={setShowAddDialog}>\n\t\t\t\t<DialogContent>\n\t\t\t\t\t<DialogHeader>\n\t\t\t\t\t\t<DialogTitle>{t.addSickDay}</DialogTitle>\n\t\t\t\t\t</DialogHeader>\n\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.sickDayDate}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"date\"\n\t\t\t\t\t\t\t\tvalue={sickDate}\n\t\t\t\t\t\t\t\tonChange={(e) => setSickDate(e.target.value)}\n\t\t\t\t\t\t\t\tmax={new Date().toISOString().split('T')[0]}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.sickDayHours}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\tmin=\"0.5\"\n\t\t\t\t\t\t\t\tmax=\"24\"\n\t\t\t\t\t\t\t\tstep=\"0.5\"\n\t\t\t\t\t\t\t\tvalue={sickHours}\n\t\t\t\t\t\t\t\tonChange={(e) => setSickHours(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.sickDayNotes}</Label>\n\t\t\t\t\t\t\t<Textarea\n\t\t\t\t\t\t\t\tvalue={sickNotes}\n\t\t\t\t\t\t\t\tonChange={(e) => setSickNotes(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder={t.sickDayNotesPlaceholder}\n\t\t\t\t\t\t\t\trows={3}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<DialogFooter>\n\t\t\t\t\t\t<Button variant=\"outline\" onClick={() => setShowAddDialog(false)}>\n\t\t\t\t\t\t\t{t.cancel}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button onClick={handleAddSickDay} disabled={!sickDate || !sickHours}>\n\t\t\t\t\t\t\t{t.saveChanges}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</DialogFooter>\n\t\t\t\t</DialogContent>\n\t\t\t</Dialog>\n\t\t</>\n\t);\n}\n\nfunction EmployeeView({ user, language }: { user: UserModel; language: Language }) {\n\tconst [timeCards, setTimeCards] = useState<TimeCardEntryModel[]>([]);\n\tconst [activeShift, setActiveShift] = useState<TimeCardEntryModel | null>(null);\n\tconst [elapsedTime, setElapsedTime] = useState(0);\n\tconst [location, setLocation] = useState(\"\");\n\tconst [workDescription, setWorkDescription] = useState(\"\");\n\tconst [isOnLunch, setIsOnLunch] = useState(false);\n\tconst [isLoading, setIsLoading] = useState(false);\n\n\tconst t = translations[language];\n\n\tuseEffect(() => {\n\t\tloadTimeCards();\n\t}, [user.id]);\n\n\tuseEffect(() => {\n\t\tlet interval: NodeJS.Timeout;\n\t\tif (activeShift && !isOnLunch) {\n\t\t\tinterval = setInterval(() => {\n\t\t\t\tconst clockInTime = parseInt(activeShift.clock_in_timestamp) * 1000;\n\t\t\t\tconst elapsed = Date.now() - clockInTime;\n\t\t\t\tsetElapsedTime(elapsed);\n\t\t\t}, 1000);\n\t\t}\n\t\treturn () => clearInterval(interval);\n\t}, [activeShift, isOnLunch]);\n\n\tconst loadTimeCards = async () => {\n\t\tconsole.log(\"Loading time cards for user:\", user.id);\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tconst userTimeCards = await timeCardORM.getTimeCardEntryByUserId(user.id);\n\n\t\tconsole.log(\"Found\", userTimeCards.length, \"time cards\");\n\n\t\t// Normalize data retrieved from ORM to fix null-handling bugs\n\t\tconst normalized = normalizeTimeCardEntriesFromORM(userTimeCards);\n\n\t\t// Sort by clock in time (newest first)\n\t\tconst sorted = normalized.sort((a, b) =>\n\t\t\tparseInt(b.clock_in_timestamp) - parseInt(a.clock_in_timestamp)\n\t\t);\n\n\t\tsetTimeCards(sorted);\n\n\t\t// Find active shift using helper function\n\t\tconst active = sorted.find(tc => isActiveShift(tc));\n\t\tconsole.log(\"Active shift found:\", active ? `Yes (ID: ${active.id})` : \"No\");\n\n\t\tsetActiveShift(active || null);\n\t\tif (active) {\n\t\t\tsetLocation(active.location || \"\");\n\t\t\tsetWorkDescription(active.work_description || \"\");\n\t\t\t// Check if on lunch break using helper function\n\t\t\tconst onLunch = isOnLunchBreak(active);\n\t\t\tsetIsOnLunch(onLunch);\n\t\t\tconsole.log(\"On lunch:\", onLunch);\n\t\t} else {\n\t\t\tsetIsOnLunch(false);\n\t\t}\n\t};\n\n\tconst handleClockIn = async () => {\n\t\tconsole.log(\"=== CLOCK IN STARTED ===\");\n\t\tconsole.log(\"User ID:\", user.id);\n\t\tconsole.log(\"Location:\", location);\n\t\tconsole.log(\"Work Description:\", workDescription);\n\n\t\tsetIsLoading(true);\n\t\ttry {\n\t\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\t\tconst now = Math.floor(Date.now() / 1000).toString();\n\t\t\tconsole.log(\"Current timestamp:\", now);\n\n\t\t\tconst newEntry = {\n\t\t\t\tuser_id: user.id,\n\t\t\t\tclock_in_timestamp: now,\n\t\t\t\tlocation: location || undefined,\n\t\t\t\twork_description: workDescription || undefined,\n\t\t\t} as TimeCardEntryModel;\n\n\t\t\t// Normalize the entry to work around ORM null-handling bugs\n\t\t\tconst normalizedEntry = normalizeTimeCardEntryForSave(newEntry);\n\n\t\t\tconsole.log(\"Inserting time card entry:\", normalizedEntry);\n\n\t\t\tconst result = await timeCardORM.insertTimeCardEntry([normalizedEntry as TimeCardEntryModel]);\n\t\t\tconsole.log(\"Insert result:\", result);\n\n\t\t\t// Normalize the returned data\n\t\t\tconst normalizedResult = normalizeTimeCardEntriesFromORM(result);\n\t\t\tconsole.log(\"Normalized result:\", normalizedResult);\n\n\t\t\tconsole.log(\"Time card entry created successfully!\");\n\n\t\t\t// Clear form\n\t\t\tsetLocation(\"\");\n\t\t\tsetWorkDescription(\"\");\n\n\t\t\t// Reload time cards\n\t\t\tconsole.log(\"Reloading time cards...\");\n\t\t\tawait loadTimeCards();\n\n\t\t\tconsole.log(\"=== CLOCK IN COMPLETED ===\");\n\n\t\t\t// Show success feedback\n\t\t\tconst reloadedShifts = normalizeTimeCardEntriesFromORM(\n\t\t\t\tawait timeCardORM.getTimeCardEntryByUserId(user.id)\n\t\t\t);\n\t\t\tif (reloadedShifts.some(tc => isActiveShift(tc))) {\n\t\t\t\talert(\"✅ Successfully clocked in! You can now see the CLOCK OUT button.\");\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.error(\"=== CLOCK IN FAILED ===\");\n\t\t\tconsole.error(\"Error details:\", error);\n\t\t\talert(`Error clocking in: ${error instanceof Error ? error.message : 'Unknown error'}. Check console for details.`);\n\t\t} finally {\n\t\t\tsetIsLoading(false);\n\t\t}\n\t};\n\n\tconst handleClockOut = async () => {\n\t\tconsole.log(\"Clock Out clicked - activeShift:\", activeShift);\n\n\t\tif (!activeShift) {\n\t\t\tconsole.error(\"No active shift to clock out!\");\n\t\t\talert(\"Error: No active shift found. Please try clocking in first.\");\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\t\tconst now = Math.floor(Date.now() / 1000).toString();\n\n\t\t\tconst clockInTime = parseInt(activeShift.clock_in_timestamp);\n\t\t\tconst clockOutTime = parseInt(now);\n\t\t\tlet totalHours = (clockOutTime - clockInTime) / 3600;\n\n\t\t\t// Deduct lunch time if lunch was taken\n\t\t\tif (activeShift.lunch_duration_minutes && activeShift.lunch_duration_minutes > 0) {\n\t\t\t\ttotalHours -= activeShift.lunch_duration_minutes / 60;\n\t\t\t}\n\n\t\t\tconsole.log(\"Clocking out - Total hours:\", totalHours);\n\n\t\t\tconst updateData = {\n\t\t\t\t...activeShift,\n\t\t\t\tclock_out_timestamp: now,\n\t\t\t\ttotal_hours: totalHours,\n\t\t\t\tlocation: location || activeShift.location || undefined,\n\t\t\t\twork_description: workDescription || activeShift.work_description || undefined,\n\t\t\t};\n\n\t\t\t// Normalize before saving\n\t\t\tconst normalizedUpdate = normalizeTimeCardEntryForSave(updateData as TimeCardEntryModel);\n\n\t\t\tawait timeCardORM.setTimeCardEntryById(activeShift.id, normalizedUpdate as TimeCardEntryModel);\n\n\t\t\tconsole.log(\"Clock out successful!\");\n\t\t\tsetLocation(\"\");\n\t\t\tsetWorkDescription(\"\");\n\t\t\tawait loadTimeCards();\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Error clocking out:\", error);\n\t\t\talert(\"Error clocking out. Please try again.\");\n\t\t}\n\t};\n\n\tconst handleStartLunch = async () => {\n\t\tif (!activeShift) return;\n\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tconst now = Math.floor(Date.now() / 1000).toString();\n\n\t\tconst updateData = {\n\t\t\t...activeShift,\n\t\t\tlunch_start_timestamp: now,\n\t\t\tlocation: location || activeShift.location || undefined,\n\t\t\twork_description: workDescription || activeShift.work_description || undefined,\n\t\t};\n\n\t\tconst normalizedUpdate = normalizeTimeCardEntryForSave(updateData as TimeCardEntryModel);\n\t\tawait timeCardORM.setTimeCardEntryById(activeShift.id, normalizedUpdate as TimeCardEntryModel);\n\n\t\tawait loadTimeCards();\n\t};\n\n\tconst handleEndLunch = async () => {\n\t\tif (!activeShift || !activeShift.lunch_start_timestamp) return;\n\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tconst now = Math.floor(Date.now() / 1000).toString();\n\n\t\t// Handle case where lunch_start_timestamp might be the string \"null\"\n\t\tlet lunchStartTime: number;\n\t\tif (typeof activeShift.lunch_start_timestamp === 'string' && activeShift.lunch_start_timestamp !== 'null') {\n\t\t\tlunchStartTime = parseInt(activeShift.lunch_start_timestamp);\n\t\t} else {\n\t\t\treturn;\n\t\t}\n\n\t\tconst lunchEndTime = parseInt(now);\n\t\tconst lunchDurationMinutes = (lunchEndTime - lunchStartTime) / 60;\n\n\t\t// Add to existing lunch duration if there was already one\n\t\tconst totalLunchMinutes = (activeShift.lunch_duration_minutes && activeShift.lunch_duration_minutes > 0 ? activeShift.lunch_duration_minutes : 0) + lunchDurationMinutes;\n\n\t\tconst updateData = {\n\t\t\t...activeShift,\n\t\t\tlunch_end_timestamp: now,\n\t\t\tlunch_duration_minutes: totalLunchMinutes,\n\t\t};\n\n\t\tconst normalizedUpdate = normalizeTimeCardEntryForSave(updateData as TimeCardEntryModel);\n\t\tawait timeCardORM.setTimeCardEntryById(activeShift.id, normalizedUpdate as TimeCardEntryModel);\n\n\t\tawait loadTimeCards();\n\t};\n\n\tconst formatTime = (ms: number) => {\n\t\tconst seconds = Math.floor(ms / 1000);\n\t\tconst hours = Math.floor(seconds / 3600);\n\t\tconst minutes = Math.floor((seconds % 3600) / 60);\n\t\tconst secs = seconds % 60;\n\t\treturn `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\n\t};\n\n\tconst formatDate = (timestamp: string) => {\n\t\tconst date = new Date(parseInt(timestamp) * 1000);\n\t\treturn date.toLocaleString(language === 'es' ? 'es-ES' : 'en-US');\n\t};\n\n\tconst formatHours = (hours: number | null | undefined) => {\n\t\tif (hours === null || hours === undefined) return \"—\";\n\t\treturn `${hours.toFixed(2)} ${language === 'es' ? 'hrs' : 'hrs'}`;\n\t};\n\n\tconst formatMinutes = (minutes: number | null | undefined) => {\n\t\tif (minutes === null || minutes === undefined) return \"—\";\n\t\treturn `${Math.round(minutes)} min`;\n\t};\n\n\treturn (\n\t\t<div className=\"space-y-6\">\n\t\t\t<SickDayCard user={user} language={language} />\n\t\t\t<Card>\n\t\t\t\t<CardHeader>\n\t\t\t\t\t<CardTitle className=\"flex items-center gap-2\">\n\t\t\t\t\t\t<Clock className=\"w-5 h-5\" />\n\t\t\t\t\t\t{t.clockInOut}\n\t\t\t\t\t</CardTitle>\n\t\t\t\t\t<CardDescription>\n\t\t\t\t\t\t{activeShift ? \"✅ You are currently clocked in - Clock out button is below\" : \"❌ Not clocked in - Click CLOCK IN button to start\"}\n\t\t\t\t\t</CardDescription>\n\t\t\t\t</CardHeader>\n\t\t\t\t<CardContent className=\"space-y-6\">\n\t\t\t\t\t{/* Show current status */}\n\t\t\t\t\t<div className={`p-6 rounded-lg border-2 ${activeShift ? 'bg-green-50 border-green-300 dark:bg-green-900/20 dark:border-green-700' : 'bg-blue-50 border-blue-300 dark:bg-blue-900/20 dark:border-blue-700'}`}>\n\t\t\t\t\t\t<div className=\"flex items-center justify-between mb-4\">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<p className={`text-2xl font-bold ${activeShift ? 'text-green-700' : 'text-blue-700'}`}>\n\t\t\t\t\t\t\t\t\t{activeShift ? '🟢 CLOCKED IN' : '⚪ NOT CLOCKED IN'}\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t{!activeShift && (\n\t\t\t\t\t\t\t\t\t<p className=\"text-sm text-blue-600 dark:text-blue-400 mt-2 font-semibold\">\n\t\t\t\t\t\t\t\t\t\t👇 Fill out the form below and click \"CLOCK IN\"\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t{activeShift && (\n\t\t\t\t\t\t\t\t\t<p className=\"text-sm text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\tStarted: {formatDate(activeShift.clock_in_timestamp)}\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t{isOnLunch && (\n\t\t\t\t\t\t\t\t\t<p className=\"text-sm text-orange-600 font-semibold mt-1\">\n\t\t\t\t\t\t\t\t\t\t☕ On Lunch Break\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{activeShift && !isOnLunch && (\n\t\t\t\t\t\t\t\t<div className=\"text-right\">\n\t\t\t\t\t\t\t\t\t<p className=\"text-3xl font-mono font-bold tabular-nums\">\n\t\t\t\t\t\t\t\t\t\t{formatTime(elapsedTime)}\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t<p className=\"text-xs text-muted-foreground\">Time Elapsed</p>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Main Action Buttons */}\n\t\t\t\t\t{activeShift ? (\n\t\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t\t{/* Clock Out Button - ALWAYS VISIBLE when clocked in */}\n\t\t\t\t\t\t\t<div className=\"bg-red-50 dark:bg-red-950 p-4 rounded-lg border-2 border-red-300 dark:border-red-700\">\n\t\t\t\t\t\t\t\t<p className=\"text-center text-sm font-bold text-red-700 dark:text-red-300 mb-3\">\n\t\t\t\t\t\t\t\t\t⬇️ CLICK HERE TO END YOUR SHIFT ⬇️\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tonClick={handleClockOut}\n\t\t\t\t\t\t\t\t\tvariant=\"destructive\"\n\t\t\t\t\t\t\t\t\tsize=\"lg\"\n\t\t\t\t\t\t\t\t\tclassName=\"w-full h-20 text-2xl font-black shadow-lg hover:shadow-xl transition-all\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<Clock className=\"w-8 h-8 mr-3\" />\n\t\t\t\t\t\t\t\t\tCLOCK OUT\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t{/* Lunch Buttons */}\n\t\t\t\t\t\t\t<div className=\"border-t pt-4\">\n\t\t\t\t\t\t\t\t<p className=\"text-sm text-muted-foreground mb-3\">Lunch Break (Optional)</p>\n\t\t\t\t\t\t\t\t{isOnLunch ? (\n\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\tonClick={handleEndLunch}\n\t\t\t\t\t\t\t\t\t\tclassName=\"w-full h-12\"\n\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<Coffee className=\"w-5 h-5 mr-2\" />\n\t\t\t\t\t\t\t\t\t\tEnd Lunch Break\n\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\tonClick={handleStartLunch}\n\t\t\t\t\t\t\t\t\t\tclassName=\"w-full h-12\"\n\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<Coffee className=\"w-5 h-5 mr-2\" />\n\t\t\t\t\t\t\t\t\t\tStart Lunch Break\n\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t{/* Location and Description */}\n\t\t\t\t\t\t\t<div className=\"border-t pt-4 space-y-4\">\n\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t<Label>{t.location}</Label>\n\t\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\t\tvalue={location}\n\t\t\t\t\t\t\t\t\t\tonChange={(e) => setLocation(e.target.value)}\n\t\t\t\t\t\t\t\t\t\tplaceholder={t.locationPlaceholder}\n\t\t\t\t\t\t\t\t\t\tclassName=\"mt-2\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t<Label>{t.workDescription}</Label>\n\t\t\t\t\t\t\t\t\t<Textarea\n\t\t\t\t\t\t\t\t\t\tvalue={workDescription}\n\t\t\t\t\t\t\t\t\t\tonChange={(e) => setWorkDescription(e.target.value)}\n\t\t\t\t\t\t\t\t\t\tplaceholder={t.descriptionPlaceholder}\n\t\t\t\t\t\t\t\t\t\trows={3}\n\t\t\t\t\t\t\t\t\t\tclassName=\"mt-2\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t\t{/* Clock In Form */}\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<Label>{t.location}</Label>\n\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\tvalue={location}\n\t\t\t\t\t\t\t\t\tonChange={(e) => setLocation(e.target.value)}\n\t\t\t\t\t\t\t\t\tplaceholder={t.locationPlaceholder}\n\t\t\t\t\t\t\t\t\tclassName=\"mt-2\"\n\t\t\t\t\t\t\t\t\tdisabled={isLoading}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<Label>{t.workDescription}</Label>\n\t\t\t\t\t\t\t\t<Textarea\n\t\t\t\t\t\t\t\t\tvalue={workDescription}\n\t\t\t\t\t\t\t\t\tonChange={(e) => setWorkDescription(e.target.value)}\n\t\t\t\t\t\t\t\t\tplaceholder={t.descriptionPlaceholder}\n\t\t\t\t\t\t\t\t\trows={3}\n\t\t\t\t\t\t\t\t\tclassName=\"mt-2\"\n\t\t\t\t\t\t\t\t\tdisabled={isLoading}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tonClick={handleClockIn}\n\t\t\t\t\t\t\t\tsize=\"lg\"\n\t\t\t\t\t\t\t\tdisabled={isLoading}\n\t\t\t\t\t\t\t\tclassName=\"w-full h-16 text-xl font-bold bg-green-600 hover:bg-green-700 disabled:opacity-50\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Clock className=\"w-6 h-6 mr-2\" />\n\t\t\t\t\t\t\t\t{isLoading ? \"CLOCKING IN...\" : \"CLOCK IN\"}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t{isLoading && (\n\t\t\t\t\t\t\t\t<p className=\"text-center text-sm text-muted-foreground animate-pulse\">\n\t\t\t\t\t\t\t\t\tPlease wait, processing...\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</CardContent>\n\t\t\t</Card>\n\n\t\t\t<Card>\n\t\t\t\t<CardHeader>\n\t\t\t\t\t<CardTitle className=\"flex items-center gap-2\">\n\t\t\t\t\t\t<CalendarDays className=\"w-5 h-5\" />\n\t\t\t\t\t\t{t.timeCardHistory}\n\t\t\t\t\t</CardTitle>\n\t\t\t\t\t<CardDescription>{t.recentRecords}</CardDescription>\n\t\t\t\t</CardHeader>\n\t\t\t\t<CardContent>\n\t\t\t\t\t{timeCards.length === 0 ? (\n\t\t\t\t\t\t<p className=\"text-center text-muted-foreground py-8\">{t.noTimeCards}</p>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<div className=\"overflow-x-auto\">\n\t\t\t\t\t\t\t<Table>\n\t\t\t\t\t\t\t\t<TableHeader>\n\t\t\t\t\t\t\t\t\t<TableRow>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.clockInTime}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.clockOutTime}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.location}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.workDescription}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.lunchDuration}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.hours}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.status}</TableHead>\n\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t</TableHeader>\n\t\t\t\t\t\t\t\t<TableBody>\n\t\t\t\t\t\t\t\t\t{timeCards.map((tc) => (\n\t\t\t\t\t\t\t\t\t\t<TableRow key={tc.id}>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatDate(tc.clock_in_timestamp)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t{tc.clock_out_timestamp ? formatDate(tc.clock_out_timestamp) : \"—\"}\n\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell>{tc.location || \"—\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"max-w-xs truncate\">{tc.work_description || \"—\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatMinutes(tc.lunch_duration_minutes)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatHours(tc.total_hours)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t{tc.clock_out_timestamp ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge variant=\"secondary\">{t.completed}</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t) : tc.lunch_start_timestamp && !tc.lunch_end_timestamp ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge className=\"bg-orange-500\">{t.onLunchBreak}</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge className=\"bg-green-500\">{t.active}</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</TableBody>\n\t\t\t\t\t\t\t</Table>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</CardContent>\n\t\t\t</Card>\n\t\t</div>\n\t);\n}\n\nfunction ManagerView({ user, users, language, onUsersChange }: { user: UserModel; users: UserModel[]; language: Language; onUsersChange: () => void }) {\n\tconst [activeTab, setActiveTab] = useState(\"timecards\");\n\n\tconst t = translations[language];\n\n\treturn (\n\t\t<Tabs value={activeTab} onValueChange={setActiveTab}>\n\t\t\t<TabsList className=\"grid w-full grid-cols-4\">\n\t\t\t\t<TabsTrigger value=\"timecards\">\n\t\t\t\t\t<Clock className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t{t.timeCards}\n\t\t\t\t</TabsTrigger>\n\t\t\t\t<TabsTrigger value=\"sickdays\">\n\t\t\t\t\t<Heart className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t{t.sickDays}\n\t\t\t\t</TabsTrigger>\n\t\t\t\t<TabsTrigger value=\"reports\">\n\t\t\t\t\t<FileText className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t{t.reports}\n\t\t\t\t</TabsTrigger>\n\t\t\t\t<TabsTrigger value=\"employees\">\n\t\t\t\t\t<Users className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t{t.employees}\n\t\t\t\t</TabsTrigger>\n\t\t\t</TabsList>\n\n\t\t\t<TabsContent value=\"timecards\" className=\"space-y-4\">\n\t\t\t\t<TimeCardsTab users={users} language={language} />\n\t\t\t</TabsContent>\n\n\t\t\t<TabsContent value=\"sickdays\" className=\"space-y-4\">\n\t\t\t\t<SickDaysTab users={users} language={language} />\n\t\t\t</TabsContent>\n\n\t\t\t<TabsContent value=\"reports\" className=\"space-y-4\">\n\t\t\t\t<ReportsTab users={users} language={language} />\n\t\t\t</TabsContent>\n\n\t\t\t<TabsContent value=\"employees\" className=\"space-y-4\">\n\t\t\t\t<EmployeesTab users={users} language={language} onUsersChange={onUsersChange} />\n\t\t\t</TabsContent>\n\t\t</Tabs>\n\t);\n}\n\nfunction TimeCardsTab({ users, language }: { users: UserModel[]; language: Language }) {\n\tconst [allTimeCards, setAllTimeCards] = useState<TimeCardEntryModel[]>([]);\n\tconst [filteredCards, setFilteredCards] = useState<TimeCardEntryModel[]>([]);\n\tconst [selectedEmployee, setSelectedEmployee] = useState<string>(\"all\");\n\tconst [dateFilter, setDateFilter] = useState<string>(\"\");\n\tconst [editingCard, setEditingCard] = useState<TimeCardEntryModel | null>(null);\n\tconst [editClockIn, setEditClockIn] = useState(\"\");\n\tconst [editClockOut, setEditClockOut] = useState(\"\");\n\tconst [editLocation, setEditLocation] = useState(\"\");\n\tconst [editWorkDescription, setEditWorkDescription] = useState(\"\");\n\tconst [editLunchStart, setEditLunchStart] = useState(\"\");\n\tconst [editLunchEnd, setEditLunchEnd] = useState(\"\");\n\tconst [showManualEntry, setShowManualEntry] = useState(false);\n\tconst [manualEntryUserId, setManualEntryUserId] = useState<string>(\"\");\n\n\tconst t = translations[language];\n\n\tuseEffect(() => {\n\t\tloadAllTimeCards();\n\t}, []);\n\n\tuseEffect(() => {\n\t\tapplyFilters();\n\t}, [allTimeCards, selectedEmployee, dateFilter]);\n\n\tconst loadAllTimeCards = async () => {\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tconst allCards = await timeCardORM.getAllTimeCardEntry();\n\n\t\t// Normalize data from ORM\n\t\tconst normalized = normalizeTimeCardEntriesFromORM(allCards);\n\n\t\t// Sort by clock in time (newest first)\n\t\tconst sorted = normalized.sort((a, b) =>\n\t\t\tparseInt(b.clock_in_timestamp) - parseInt(a.clock_in_timestamp)\n\t\t);\n\n\t\tsetAllTimeCards(sorted);\n\t};\n\n\tconst applyFilters = () => {\n\t\tlet filtered = [...allTimeCards];\n\n\t\t// Filter by employee\n\t\tif (selectedEmployee !== \"all\") {\n\t\t\tfiltered = filtered.filter(tc => tc.user_id === selectedEmployee);\n\t\t}\n\n\t\t// Filter by date\n\t\tif (dateFilter) {\n\t\t\tconst filterDate = new Date(dateFilter);\n\t\t\tconst filterTimestamp = Math.floor(filterDate.getTime() / 1000);\n\t\t\tconst nextDayTimestamp = filterTimestamp + 86400; // +24 hours\n\n\t\t\tfiltered = filtered.filter(tc => {\n\t\t\t\tconst clockIn = parseInt(tc.clock_in_timestamp);\n\t\t\t\treturn clockIn >= filterTimestamp && clockIn < nextDayTimestamp;\n\t\t\t});\n\t\t}\n\n\t\tsetFilteredCards(filtered);\n\t};\n\n\tconst getUserName = (userId: string) => {\n\t\tconst user = users.find(u => u.id === userId);\n\t\treturn user?.name || \"Unknown\";\n\t};\n\n\tconst formatDate = (timestamp: string) => {\n\t\tconst date = new Date(parseInt(timestamp) * 1000);\n\t\treturn date.toLocaleString(language === 'es' ? 'es-ES' : 'en-US');\n\t};\n\n\tconst formatHours = (hours: number | null | undefined) => {\n\t\tif (hours === null || hours === undefined) return \"—\";\n\t\treturn `${hours.toFixed(2)} ${language === 'es' ? 'hrs' : 'hrs'}`;\n\t};\n\n\tconst formatMinutes = (minutes: number | null | undefined) => {\n\t\tif (minutes === null || minutes === undefined) return \"—\";\n\t\treturn `${Math.round(minutes)} min`;\n\t};\n\n\tconst calculateTotalHours = (period: 'day' | 'week') => {\n\t\tconst now = Date.now() / 1000;\n\t\tconst periodSeconds = period === 'day' ? 86400 : 604800; // 1 day or 7 days\n\t\tconst startTime = now - periodSeconds;\n\n\t\tconst relevantCards = allTimeCards.filter(tc => {\n\t\t\tconst clockIn = parseInt(tc.clock_in_timestamp);\n\t\t\treturn clockIn >= startTime && tc.total_hours;\n\t\t});\n\n\t\treturn relevantCards.reduce((sum, tc) => sum + (tc.total_hours || 0), 0);\n\t};\n\n\tconst handleEditCard = (card: TimeCardEntryModel) => {\n\t\tsetEditingCard(card);\n\n\t\t// Helper function to safely convert timestamp to ISO string\n\t\tconst safeTimestampToISO = (timestamp: string | null | undefined): string => {\n\t\t\tif (!timestamp) return \"\";\n\t\t\tconst parsed = parseInt(timestamp);\n\t\t\tif (isNaN(parsed) || parsed <= 0) return \"\";\n\t\t\tconst date = new Date(parsed * 1000);\n\t\t\tif (isNaN(date.getTime())) return \"\";\n\t\t\treturn date.toISOString().slice(0, 16);\n\t\t};\n\n\t\tsetEditClockIn(safeTimestampToISO(card.clock_in_timestamp) || new Date().toISOString().slice(0, 16));\n\t\tsetEditClockOut(safeTimestampToISO(card.clock_out_timestamp));\n\t\tsetEditLocation(card.location || \"\");\n\t\tsetEditWorkDescription(card.work_description || \"\");\n\t\tsetEditLunchStart(safeTimestampToISO(card.lunch_start_timestamp));\n\t\tsetEditLunchEnd(safeTimestampToISO(card.lunch_end_timestamp));\n\t};\n\n\tconst handleSaveEdit = async () => {\n\t\tif (!editingCard) return;\n\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tconst clockInTimestamp = Math.floor(new Date(editClockIn).getTime() / 1000).toString();\n\t\tconst clockOutTimestamp = editClockOut\n\t\t\t? Math.floor(new Date(editClockOut).getTime() / 1000).toString()\n\t\t\t: undefined;\n\t\tconst lunchStartTimestamp = editLunchStart\n\t\t\t? Math.floor(new Date(editLunchStart).getTime() / 1000).toString()\n\t\t\t: undefined;\n\t\tconst lunchEndTimestamp = editLunchEnd\n\t\t\t? Math.floor(new Date(editLunchEnd).getTime() / 1000).toString()\n\t\t\t: undefined;\n\n\t\tlet totalHours: number | undefined = undefined;\n\t\tlet lunchDurationMinutes: number | undefined = undefined;\n\n\t\t// Calculate lunch duration\n\t\tif (lunchStartTimestamp && lunchEndTimestamp) {\n\t\t\tconst lunchStart = parseInt(lunchStartTimestamp);\n\t\t\tconst lunchEnd = parseInt(lunchEndTimestamp);\n\t\t\tlunchDurationMinutes = (lunchEnd - lunchStart) / 60;\n\t\t}\n\n\t\t// Calculate total hours\n\t\tif (clockOutTimestamp) {\n\t\t\tconst clockInTime = parseInt(clockInTimestamp);\n\t\t\tconst clockOutTime = parseInt(clockOutTimestamp);\n\t\t\ttotalHours = (clockOutTime - clockInTime) / 3600;\n\n\t\t\t// Deduct lunch time\n\t\t\tif (lunchDurationMinutes) {\n\t\t\t\ttotalHours -= lunchDurationMinutes / 60;\n\t\t\t}\n\t\t}\n\n\t\tconst updateData = {\n\t\t\t...editingCard,\n\t\t\tclock_in_timestamp: clockInTimestamp,\n\t\t\tclock_out_timestamp: clockOutTimestamp,\n\t\t\ttotal_hours: totalHours,\n\t\t\tlocation: editLocation || undefined,\n\t\t\twork_description: editWorkDescription || undefined,\n\t\t\tlunch_start_timestamp: lunchStartTimestamp,\n\t\t\tlunch_end_timestamp: lunchEndTimestamp,\n\t\t\tlunch_duration_minutes: lunchDurationMinutes,\n\t\t};\n\n\t\tconst normalizedUpdate = normalizeTimeCardEntryForSave(updateData as TimeCardEntryModel);\n\t\tawait timeCardORM.setTimeCardEntryById(editingCard.id, normalizedUpdate as TimeCardEntryModel);\n\n\t\tsetEditingCard(null);\n\t\tawait loadAllTimeCards();\n\t};\n\n\tconst handleDeleteTimeCard = async (card: TimeCardEntryModel) => {\n\t\tif (!window.confirm(t.confirmDeleteTimeCard)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tawait timeCardORM.deleteTimeCardEntryById(card.id);\n\t\tawait loadAllTimeCards();\n\t};\n\n\tconst handleAddManualEntry = (userId: string) => {\n\t\tsetManualEntryUserId(userId);\n\t\tsetShowManualEntry(true);\n\t};\n\n\treturn (\n\t\t<>\n\t\t\t<div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n\t\t\t\t<Card>\n\t\t\t\t\t<CardHeader className=\"pb-3\">\n\t\t\t\t\t\t<CardTitle className=\"text-sm font-medium flex items-center gap-2\">\n\t\t\t\t\t\t\t<Users className=\"w-4 h-4\" />\n\t\t\t\t\t\t\t{t.totalEmployees}\n\t\t\t\t\t\t</CardTitle>\n\t\t\t\t\t</CardHeader>\n\t\t\t\t\t<CardContent>\n\t\t\t\t\t\t<div className=\"text-2xl font-bold\">{users.filter(u => u.role === UserRole.Employee).length}</div>\n\t\t\t\t\t</CardContent>\n\t\t\t\t</Card>\n\n\t\t\t\t<Card>\n\t\t\t\t\t<CardHeader className=\"pb-3\">\n\t\t\t\t\t\t<CardTitle className=\"text-sm font-medium flex items-center gap-2\">\n\t\t\t\t\t\t\t<Timer className=\"w-4 h-4\" />\n\t\t\t\t\t\t\t{t.hoursToday}\n\t\t\t\t\t\t</CardTitle>\n\t\t\t\t\t</CardHeader>\n\t\t\t\t\t<CardContent>\n\t\t\t\t\t\t<div className=\"text-2xl font-bold\">{calculateTotalHours('day').toFixed(2)}</div>\n\t\t\t\t\t</CardContent>\n\t\t\t\t</Card>\n\n\t\t\t\t<Card>\n\t\t\t\t\t<CardHeader className=\"pb-3\">\n\t\t\t\t\t\t<CardTitle className=\"text-sm font-medium flex items-center gap-2\">\n\t\t\t\t\t\t\t<CalendarDays className=\"w-4 h-4\" />\n\t\t\t\t\t\t\t{t.hoursThisWeek}\n\t\t\t\t\t\t</CardTitle>\n\t\t\t\t\t</CardHeader>\n\t\t\t\t\t<CardContent>\n\t\t\t\t\t\t<div className=\"text-2xl font-bold\">{calculateTotalHours('week').toFixed(2)}</div>\n\t\t\t\t\t</CardContent>\n\t\t\t\t</Card>\n\t\t\t</div>\n\n\t\t\t<Card>\n\t\t\t\t<CardHeader>\n\t\t\t\t\t<div className=\"flex justify-between items-center\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<CardTitle>{t.allEmployeeTimeCards}</CardTitle>\n\t\t\t\t\t\t\t<CardDescription>{t.viewManageRecords}</CardDescription>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<Button onClick={() => handleAddManualEntry(\"\")} variant=\"outline\" size=\"sm\">\n\t\t\t\t\t\t\t<Plus className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t\t\t{t.addTimeCard}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t</CardHeader>\n\t\t\t\t<CardContent className=\"space-y-4\">\n\t\t\t\t\t<div className=\"flex gap-4 flex-wrap\">\n\t\t\t\t\t\t<div className=\"flex-1 min-w-[200px]\">\n\t\t\t\t\t\t\t<Label>{t.filterByEmployee}</Label>\n\t\t\t\t\t\t\t<Select value={selectedEmployee} onValueChange={setSelectedEmployee}>\n\t\t\t\t\t\t\t\t<SelectTrigger>\n\t\t\t\t\t\t\t\t\t<SelectValue />\n\t\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t\t<SelectItem value=\"all\">{t.allEmployees}</SelectItem>\n\t\t\t\t\t\t\t\t\t{users.filter(u => u.role === UserRole.Employee).map((u) => (\n\t\t\t\t\t\t\t\t\t\t<SelectItem key={u.id} value={u.id}>\n\t\t\t\t\t\t\t\t\t\t\t{u.name}\n\t\t\t\t\t\t\t\t\t\t</SelectItem>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t\t</Select>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div className=\"flex-1 min-w-[200px]\">\n\t\t\t\t\t\t\t<Label>{t.filterByDate}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"date\"\n\t\t\t\t\t\t\t\tvalue={dateFilter}\n\t\t\t\t\t\t\t\tonChange={(e) => setDateFilter(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t{(selectedEmployee !== \"all\" || dateFilter) && (\n\t\t\t\t\t\t\t<div className=\"flex items-end\">\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\t\t\tsetSelectedEmployee(\"all\");\n\t\t\t\t\t\t\t\t\t\tsetDateFilter(\"\");\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{t.clearFilters}\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{filteredCards.length === 0 ? (\n\t\t\t\t\t\t<p className=\"text-center text-muted-foreground py-8\">{t.noTimeCardsFound}</p>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<div className=\"overflow-x-auto\">\n\t\t\t\t\t\t\t<Table>\n\t\t\t\t\t\t\t\t<TableHeader>\n\t\t\t\t\t\t\t\t\t<TableRow>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.employeeName}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.clockInTime}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.clockOutTime}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.location}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.workDescription}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.lunchDuration}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.hours}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.status}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.actions}</TableHead>\n\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t</TableHeader>\n\t\t\t\t\t\t\t\t<TableBody>\n\t\t\t\t\t\t\t\t\t{filteredCards.map((tc) => (\n\t\t\t\t\t\t\t\t\t\t<TableRow key={tc.id}>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"font-medium whitespace-nowrap\">{getUserName(tc.user_id)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatDate(tc.clock_in_timestamp)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t{tc.clock_out_timestamp ? formatDate(tc.clock_out_timestamp) : \"—\"}\n\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell>{tc.location || \"—\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"max-w-xs truncate\">{tc.work_description || \"—\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatMinutes(tc.lunch_duration_minutes)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatHours(tc.total_hours)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t{tc.clock_out_timestamp ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge variant=\"secondary\">{t.completed}</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t) : tc.lunch_start_timestamp && !tc.lunch_end_timestamp ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge className=\"bg-orange-500\">{t.onLunchBreak}</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge className=\"bg-green-500\">{t.active}</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => handleEditCard(tc)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{t.edit}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => handleDeleteTimeCard(tc)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"text-red-600 hover:text-red-700 hover:bg-red-50\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Trash2 className=\"w-4 h-4\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</TableBody>\n\t\t\t\t\t\t\t</Table>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</CardContent>\n\t\t\t</Card>\n\n\t\t\t<Dialog open={!!editingCard} onOpenChange={(open) => !open && setEditingCard(null)}>\n\t\t\t\t<DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n\t\t\t\t\t<DialogHeader>\n\t\t\t\t\t\t<DialogTitle>{t.editTimeCard}</DialogTitle>\n\t\t\t\t\t</DialogHeader>\n\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.employeeName}</Label>\n\t\t\t\t\t\t\t<Input value={editingCard ? getUserName(editingCard.user_id) : \"\"} disabled />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"grid grid-cols-2 gap-4\">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<Label>{t.clockInTime}</Label>\n\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\t\tvalue={editClockIn}\n\t\t\t\t\t\t\t\t\tonChange={(e) => setEditClockIn(e.target.value)}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<Label>{t.clockOutTime}</Label>\n\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\t\tvalue={editClockOut}\n\t\t\t\t\t\t\t\t\tonChange={(e) => setEditClockOut(e.target.value)}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.location}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\tvalue={editLocation}\n\t\t\t\t\t\t\t\tonChange={(e) => setEditLocation(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder={t.locationPlaceholder}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.workDescription}</Label>\n\t\t\t\t\t\t\t<Textarea\n\t\t\t\t\t\t\t\tvalue={editWorkDescription}\n\t\t\t\t\t\t\t\tonChange={(e) => setEditWorkDescription(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder={t.descriptionPlaceholder}\n\t\t\t\t\t\t\t\trows={4}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"grid grid-cols-2 gap-4\">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<Label>{t.lunchStartTime}</Label>\n\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\t\tvalue={editLunchStart}\n\t\t\t\t\t\t\t\t\tonChange={(e) => setEditLunchStart(e.target.value)}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<Label>{t.lunchEndTime}</Label>\n\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\t\tvalue={editLunchEnd}\n\t\t\t\t\t\t\t\t\tonChange={(e) => setEditLunchEnd(e.target.value)}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<DialogFooter>\n\t\t\t\t\t\t<Button variant=\"outline\" onClick={() => setEditingCard(null)}>\n\t\t\t\t\t\t\t{t.cancel}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button onClick={handleSaveEdit}>\n\t\t\t\t\t\t\t{t.saveChanges}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</DialogFooter>\n\t\t\t\t</DialogContent>\n\t\t\t</Dialog>\n\n\t\t\t<ManualEntryDialog\n\t\t\t\topen={showManualEntry}\n\t\t\t\tonClose={() => setShowManualEntry(false)}\n\t\t\t\tuserId={manualEntryUserId}\n\t\t\t\tonSave={loadAllTimeCards}\n\t\t\t\tlanguage={language}\n\t\t\t\tusers={users}\n\t\t\t/>\n\t\t</>\n\t);\n}\n\nfunction SickDaysTab({ users, language }: { users: UserModel[]; language: Language }) {\n\tconst [allSickDays, setAllSickDays] = useState<SickDayModel[]>([]);\n\tconst [filteredSickDays, setFilteredSickDays] = useState<SickDayModel[]>([]);\n\tconst [selectedEmployee, setSelectedEmployee] = useState<string>(\"all\");\n\tconst [dateFilter, setDateFilter] = useState<string>(\"\");\n\n\tconst t = translations[language];\n\n\tuseEffect(() => {\n\t\tloadAllSickDays();\n\t}, []);\n\n\tuseEffect(() => {\n\t\tapplyFilters();\n\t}, [allSickDays, selectedEmployee, dateFilter]);\n\n\tconst loadAllSickDays = async () => {\n\t\tconst sickDayORM = SickDayORM.getInstance();\n\t\tconst allDays = await sickDayORM.getAllSickDay();\n\n\t\t// Sort by date (newest first)\n\t\tconst sorted = allDays.sort((a, b) =>\n\t\t\tnew Date(b.sick_date).getTime() - new Date(a.sick_date).getTime()\n\t\t);\n\n\t\tsetAllSickDays(sorted);\n\t};\n\n\tconst applyFilters = () => {\n\t\tlet filtered = [...allSickDays];\n\n\t\t// Filter by employee\n\t\tif (selectedEmployee !== \"all\") {\n\t\t\tfiltered = filtered.filter(sd => sd.user_id === selectedEmployee);\n\t\t}\n\n\t\t// Filter by date\n\t\tif (dateFilter) {\n\t\t\tfiltered = filtered.filter(sd => sd.sick_date === dateFilter);\n\t\t}\n\n\t\tsetFilteredSickDays(filtered);\n\t};\n\n\tconst getUserName = (userId: string) => {\n\t\tconst user = users.find(u => u.id === userId);\n\t\treturn user?.name || \"Unknown\";\n\t};\n\n\tconst formatDate = (dateStr: string) => {\n\t\tconst date = new Date(dateStr);\n\t\treturn date.toLocaleDateString(language === 'es' ? 'es-ES' : 'en-US', {\n\t\t\tyear: 'numeric',\n\t\t\tmonth: 'long',\n\t\t\tday: 'numeric'\n\t\t});\n\t};\n\n\tconst handleDeleteSickDay = async (sickDay: SickDayModel) => {\n\t\tif (!window.confirm(t.confirmDeleteSickDay)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst sickDayORM = SickDayORM.getInstance();\n\t\tawait sickDayORM.deleteSickDayById(sickDay.id);\n\t\tawait loadAllSickDays();\n\t};\n\n\tconst calculateTotalSickHours = () => {\n\t\treturn filteredSickDays.reduce((sum, sd) => sum + sd.hours, 0);\n\t};\n\n\treturn (\n\t\t<Card>\n\t\t\t<CardHeader>\n\t\t\t\t<div className=\"flex justify-between items-center\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<CardTitle className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t<Heart className=\"w-5 h-5 text-red-500\" />\n\t\t\t\t\t\t\t{t.sickDayHistory}\n\t\t\t\t\t\t</CardTitle>\n\t\t\t\t\t\t<CardDescription>\n\t\t\t\t\t\t\t{t.totalSickDays}: {calculateTotalSickHours().toFixed(1)} {language === 'es' ? 'hrs' : 'hrs'}\n\t\t\t\t\t\t</CardDescription>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</CardHeader>\n\t\t\t<CardContent className=\"space-y-4\">\n\t\t\t\t<div className=\"flex gap-4 flex-wrap\">\n\t\t\t\t\t<div className=\"flex-1 min-w-[200px]\">\n\t\t\t\t\t\t<Label>{t.filterByEmployee}</Label>\n\t\t\t\t\t\t<Select value={selectedEmployee} onValueChange={setSelectedEmployee}>\n\t\t\t\t\t\t\t<SelectTrigger>\n\t\t\t\t\t\t\t\t<SelectValue />\n\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t<SelectItem value=\"all\">{t.allEmployees}</SelectItem>\n\t\t\t\t\t\t\t\t{users.filter(u => u.role === UserRole.Employee).map((u) => (\n\t\t\t\t\t\t\t\t\t<SelectItem key={u.id} value={u.id}>\n\t\t\t\t\t\t\t\t\t\t{u.name}\n\t\t\t\t\t\t\t\t\t</SelectItem>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t</Select>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div className=\"flex-1 min-w-[200px]\">\n\t\t\t\t\t\t<Label>{t.filterByDate}</Label>\n\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\ttype=\"date\"\n\t\t\t\t\t\t\tvalue={dateFilter}\n\t\t\t\t\t\t\tonChange={(e) => setDateFilter(e.target.value)}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{(selectedEmployee !== \"all\" || dateFilter) && (\n\t\t\t\t\t\t<div className=\"flex items-end\">\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\t\tsetSelectedEmployee(\"all\");\n\t\t\t\t\t\t\t\t\tsetDateFilter(\"\");\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{t.clearFilters}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\n\t\t\t\t{filteredSickDays.length === 0 ? (\n\t\t\t\t\t<p className=\"text-center text-muted-foreground py-8\">{t.noSickDays}</p>\n\t\t\t\t) : (\n\t\t\t\t\t<div className=\"overflow-x-auto\">\n\t\t\t\t\t\t<Table>\n\t\t\t\t\t\t\t<TableHeader>\n\t\t\t\t\t\t\t\t<TableRow>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.employeeName}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.sickDayDate}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.sickDayHours}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.sickDayNotes}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.actions}</TableHead>\n\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t</TableHeader>\n\t\t\t\t\t\t\t<TableBody>\n\t\t\t\t\t\t\t\t{filteredSickDays.map((sd) => (\n\t\t\t\t\t\t\t\t\t<TableRow key={sd.id}>\n\t\t\t\t\t\t\t\t\t\t<TableCell className=\"font-medium whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t{getUserName(sd.user_id)}\n\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t{formatDate(sd.sick_date)}\n\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell>{sd.hours} hrs</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell className=\"max-w-xs truncate\">{sd.notes || \"—\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => handleDeleteSickDay(sd)}\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"text-red-600 hover:text-red-700 hover:bg-red-50\"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<Trash2 className=\"w-4 h-4\" />\n\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</TableBody>\n\t\t\t\t\t\t</Table>\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\t\t\t</CardContent>\n\t\t</Card>\n\t);\n}\n\nfunction ReportsTab({ users, language }: { users: UserModel[]; language: Language }) {\n\tconst [weekStart, setWeekStart] = useState(\"\");\n\tconst [reportData, setReportData] = useState<{ user: UserModel; regularHours: number; overtimeHours: number; totalHours: number; regularPay: number; overtimePay: number; totalPay: number }[]>([]);\n\tconst [detailedTimeCards, setDetailedTimeCards] = useState<TimeCardEntryModel[]>([]);\n\n\tconst t = translations[language];\n\n\tuseEffect(() => {\n\t\t// Set default to current week\n\t\tconst today = new Date();\n\t\tconst monday = new Date(today);\n\t\tmonday.setDate(today.getDate() - today.getDay() + 1);\n\t\tsetWeekStart(monday.toISOString().slice(0, 10));\n\t}, []);\n\n\tuseEffect(() => {\n\t\tif (weekStart) {\n\t\t\tloadWeeklyReport();\n\t\t}\n\t}, [weekStart, users]);\n\n\tconst loadWeeklyReport = async () => {\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tconst allCards = await timeCardORM.getAllTimeCardEntry();\n\n\t\t// Normalize data from ORM\n\t\tconst normalized = normalizeTimeCardEntriesFromORM(allCards);\n\n\t\tconst weekStartDate = new Date(weekStart);\n\t\tconst weekStartTimestamp = Math.floor(weekStartDate.getTime() / 1000);\n\t\tconst weekEndTimestamp = weekStartTimestamp + 604800; // 7 days\n\n\t\tconst weekCards = normalized.filter(tc => {\n\t\t\tconst clockIn = parseInt(tc.clock_in_timestamp);\n\t\t\treturn clockIn >= weekStartTimestamp && clockIn < weekEndTimestamp && tc.total_hours;\n\t\t});\n\n\t\t// Store detailed time cards\n\t\tsetDetailedTimeCards(weekCards.sort((a, b) => parseInt(a.clock_in_timestamp) - parseInt(b.clock_in_timestamp)));\n\n\t\tconst employeeHours = users\n\t\t\t.filter(u => u.role === UserRole.Employee)\n\t\t\t.map(user => {\n\t\t\t\tconst userCards = weekCards.filter(tc => tc.user_id === user.id);\n\t\t\t\tconst totalHours = userCards.reduce((sum, tc) => sum + (tc.total_hours || 0), 0);\n\t\t\t\tconst regularHours = Math.min(totalHours, 40);\n\t\t\t\tconst overtimeHours = Math.max(totalHours - 40, 0);\n\n\t\t\t\t// Calculate pay\n\t\t\t\tconst hourlyRate = user.hourly_rate || 0;\n\t\t\t\tconst regularPay = regularHours * hourlyRate;\n\t\t\t\tconst overtimePay = overtimeHours * hourlyRate * 1.5;\n\t\t\t\tconst totalPay = regularPay + overtimePay;\n\n\t\t\t\treturn {\n\t\t\t\t\tuser,\n\t\t\t\t\tregularHours,\n\t\t\t\t\tovertimeHours,\n\t\t\t\t\ttotalHours,\n\t\t\t\t\tregularPay,\n\t\t\t\t\tovertimePay,\n\t\t\t\t\ttotalPay,\n\t\t\t\t};\n\t\t\t});\n\n\t\tsetReportData(employeeHours);\n\t};\n\n\tconst formatHours = (hours: number) => {\n\t\treturn `${hours.toFixed(2)} hrs`;\n\t};\n\n\tconst formatPay = (amount: number) => {\n\t\treturn `$${amount.toFixed(2)}`;\n\t};\n\n\tconst formatDate = (timestamp: string) => {\n\t\tconst date = new Date(parseInt(timestamp) * 1000);\n\t\treturn date.toLocaleString(language === 'es' ? 'es-ES' : 'en-US');\n\t};\n\n\tconst formatDateOnly = (timestamp: string) => {\n\t\tconst date = new Date(parseInt(timestamp) * 1000);\n\t\treturn date.toLocaleDateString(language === 'es' ? 'es-ES' : 'en-US');\n\t};\n\n\tconst getDayOfWeek = (timestamp: string) => {\n\t\tconst date = new Date(parseInt(timestamp) * 1000);\n\t\treturn date.toLocaleDateString(language === 'es' ? 'es-ES' : 'en-US', { weekday: 'long' });\n\t};\n\n\tconst getUserName = (userId: string) => {\n\t\tconst user = users.find(u => u.id === userId);\n\t\treturn user?.name || \"Unknown\";\n\t};\n\n\tconst handlePrint = () => {\n\t\twindow.print();\n\t};\n\n\tconst handleExportCSV = () => {\n\t\tif (detailedTimeCards.length === 0) return;\n\n\t\t// Create CSV header\n\t\tconst headers = [\n\t\t\tt.employeeName,\n\t\t\tt.date,\n\t\t\tt.day,\n\t\t\tt.clockInTime,\n\t\t\tt.clockOutTime,\n\t\t\tt.location,\n\t\t\tt.workDescription,\n\t\t\tt.lunchDuration,\n\t\t\tt.hours,\n\t\t\tt.hourlyRate,\n\t\t\tt.pay\n\t\t];\n\n\t\t// Create CSV rows\n\t\tconst rows = detailedTimeCards.map(tc => {\n\t\t\tconst user = users.find(u => u.id === tc.user_id);\n\t\t\tconst userName = user?.name || \"Unknown\";\n\t\t\tconst hourlyRate = user?.hourly_rate || 0;\n\t\t\tconst date = formatDateOnly(tc.clock_in_timestamp);\n\t\t\tconst day = getDayOfWeek(tc.clock_in_timestamp);\n\t\t\tconst clockIn = formatDate(tc.clock_in_timestamp);\n\t\t\tconst clockOut = tc.clock_out_timestamp ? formatDate(tc.clock_out_timestamp) : \"—\";\n\t\t\tconst location = tc.location || \"—\";\n\t\t\tconst workDescription = (tc.work_description || \"—\").replace(/\"/g, '\"\"'); // Escape quotes\n\t\t\tconst lunchDuration = tc.lunch_duration_minutes ? `${Math.round(tc.lunch_duration_minutes)} min` : \"—\";\n\t\t\tconst hours = tc.total_hours ? `${tc.total_hours.toFixed(2)} hrs` : \"—\";\n\t\t\tconst pay = tc.total_hours ? formatPay(tc.total_hours * hourlyRate) : \"—\";\n\n\t\t\treturn [\n\t\t\t\t`\"${userName}\"`,\n\t\t\t\t`\"${date}\"`,\n\t\t\t\t`\"${day}\"`,\n\t\t\t\t`\"${clockIn}\"`,\n\t\t\t\t`\"${clockOut}\"`,\n\t\t\t\t`\"${location}\"`,\n\t\t\t\t`\"${workDescription}\"`,\n\t\t\t\t`\"${lunchDuration}\"`,\n\t\t\t\t`\"${hours}\"`,\n\t\t\t\t`\"${formatPay(hourlyRate)}\"`,\n\t\t\t\t`\"${pay}\"`\n\t\t\t].join(',');\n\t\t});\n\n\t\t// Combine header and rows\n\t\tconst csv = [headers.join(','), ...rows].join('\\n');\n\n\t\t// Create blob and download\n\t\tconst blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });\n\t\tconst link = document.createElement('a');\n\t\tconst url = URL.createObjectURL(blob);\n\t\tlink.setAttribute('href', url);\n\t\tlink.setAttribute('download', `weekly-report-${weekStart}.csv`);\n\t\tlink.style.visibility = 'hidden';\n\t\tdocument.body.appendChild(link);\n\t\tlink.click();\n\t\tdocument.body.removeChild(link);\n\t};\n\n\treturn (\n\t\t<div className=\"space-y-4\">\n\t\t\t<Card>\n\t\t\t\t<CardHeader>\n\t\t\t\t\t<div className=\"flex justify-between items-center\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<CardTitle>{t.weeklyReport}</CardTitle>\n\t\t\t\t\t\t\t<CardDescription>\n\t\t\t\t\t\t\t\tOvertime calculated for hours worked beyond 40 hours/week\n\t\t\t\t\t\t\t\t<br />\n\t\t\t\t\t\t\t\t<span className=\"text-xs text-muted-foreground\">\n\t\t\t\t\t\t\t\t\tNote: Sick days are tracked separately in the \"Sick Days\" tab and are NOT included in this time card report.\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</CardDescription>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"flex gap-2 print:hidden\">\n\t\t\t\t\t\t\t<Button onClick={handleExportCSV} variant=\"outline\" disabled={detailedTimeCards.length === 0}>\n\t\t\t\t\t\t\t\t<FileText className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t\t\t\t{t.exportCSV}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t<Button onClick={handlePrint} variant=\"outline\" disabled={detailedTimeCards.length === 0}>\n\t\t\t\t\t\t\t\t<FileText className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t\t\t\t{t.printReport}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</CardHeader>\n\t\t\t\t<CardContent className=\"space-y-4\">\n\t\t\t\t\t<div className=\"max-w-xs print:hidden\">\n\t\t\t\t\t\t<Label>{t.selectWeek}</Label>\n\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\ttype=\"date\"\n\t\t\t\t\t\t\tvalue={weekStart}\n\t\t\t\t\t\t\tonChange={(e) => setWeekStart(e.target.value)}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{reportData.length === 0 ? (\n\t\t\t\t\t\t<p className=\"text-center text-muted-foreground py-8\">{t.noReportData}</p>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t{/* Summary Table */}\n\t\t\t\t\t\t\t<div className=\"overflow-x-auto\">\n\t\t\t\t\t\t\t\t<Table>\n\t\t\t\t\t\t\t\t\t<TableHeader>\n\t\t\t\t\t\t\t\t\t\t<TableRow>\n\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.employeeName}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.regularHours}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.overtimeHours}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.totalHours}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.regularPay}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.overtimePay}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.totalPay}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t<TableHead className=\"print:hidden\">{t.status}</TableHead>\n\t\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t\t</TableHeader>\n\t\t\t\t\t\t\t\t\t<TableBody>\n\t\t\t\t\t\t\t\t\t\t{reportData.map(({ user, regularHours, overtimeHours, totalHours, regularPay, overtimePay, totalPay }) => (\n\t\t\t\t\t\t\t\t\t\t\t<TableRow key={user.id}>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"font-medium\">{user.name}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableCell>{formatHours(regularHours)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{overtimeHours > 0 ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-orange-600 font-semibold\">{formatHours(overtimeHours)}</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tformatHours(0)\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"font-semibold\">{formatHours(totalHours)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableCell>{formatPay(regularPay)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{overtimePay > 0 ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-orange-600 font-semibold\">{formatPay(overtimePay)}</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tformatPay(0)\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"font-semibold\">{formatPay(totalPay)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"print:hidden\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{overtimeHours > 0 && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge className=\"bg-orange-500\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<AlertCircle className=\"w-3 h-3 mr-1\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{t.overtimeAlert}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t\t</TableBody>\n\t\t\t\t\t\t\t\t</Table>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t{/* Detailed Time Cards Table */}\n\t\t\t\t\t\t\t<div className=\"mt-8\">\n\t\t\t\t\t\t\t\t<h3 className=\"text-lg font-semibold mb-4\">{t.detailedReport}</h3>\n\t\t\t\t\t\t\t\t<div className=\"overflow-x-auto\">\n\t\t\t\t\t\t\t\t\t<Table className=\"print-table-responsive\">\n\t\t\t\t\t\t\t\t\t\t<TableHeader>\n\t\t\t\t\t\t\t\t\t\t\t<TableRow>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.employeeName}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.date}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.day}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.clockInTime}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.clockOutTime}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.location}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.workDescription}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.lunchDuration}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.hours}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.hourlyRate}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.pay}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t\t\t</TableHeader>\n\t\t\t\t\t\t\t\t\t\t<TableBody className=\"print-table-responsive\">\n\t\t\t\t\t\t\t\t\t\t\t{detailedTimeCards.map((tc) => {\n\t\t\t\t\t\t\t\t\t\t\t\tconst user = users.find(u => u.id === tc.user_id);\n\t\t\t\t\t\t\t\t\t\t\t\tconst hourlyRate = user?.hourly_rate || 0;\n\t\t\t\t\t\t\t\t\t\t\t\tconst pay = tc.total_hours ? tc.total_hours * hourlyRate : 0;\n\n\t\t\t\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<TableRow key={tc.id}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"font-medium whitespace-nowrap\">{user?.name || \"Unknown\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatDateOnly(tc.clock_in_timestamp)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{getDayOfWeek(tc.clock_in_timestamp)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatDate(tc.clock_in_timestamp)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{tc.clock_out_timestamp ? formatDate(tc.clock_out_timestamp) : \"—\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell>{tc.location || \"—\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"allow-wrap max-w-xs\">{tc.work_description || \"—\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{tc.lunch_duration_minutes ? `${Math.round(tc.lunch_duration_minutes)} min` : \"—\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{tc.total_hours ? `${tc.total_hours.toFixed(2)} hrs` : \"—\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{formatPay(hourlyRate)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{formatPay(pay)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t\t\t\t</TableBody>\n\t\t\t\t\t\t\t\t\t</Table>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</>\n\t\t\t\t\t)}\n\t\t\t\t</CardContent>\n\t\t\t</Card>\n\t\t</div>\n\t);\n}\n\nfunction EmployeesTab({ users, language, onUsersChange }: { users: UserModel[]; language: Language; onUsersChange: () => void }) {\n\tconst [showAddEmployee, setShowAddEmployee] = useState(false);\n\tconst [editingEmployee, setEditingEmployee] = useState<UserModel | null>(null);\n\tconst [employeeName, setEmployeeName] = useState(\"\");\n\tconst [employeeEmail, setEmployeeEmail] = useState(\"\");\n\tconst [employeePhone, setEmployeePhone] = useState(\"\");\n\tconst [employeeRole, setEmployeeRole] = useState<UserRole>(UserRole.Employee);\n\tconst [employeeHourlyRate, setEmployeeHourlyRate] = useState(\"\");\n\tconst [deleteConfirm, setDeleteConfirm] = useState<UserModel | null>(null);\n\n\tconst t = translations[language];\n\n\tconst handleAddEmployee = async () => {\n\t\tconst userORM = UserORM.getInstance();\n\t\tawait userORM.insertUser([{\n\t\t\tname: employeeName,\n\t\t\temail: employeeEmail,\n\t\t\tphone: employeePhone || null,\n\t\t\trole: employeeRole,\n\t\t\thourly_rate: employeeHourlyRate ? parseFloat(employeeHourlyRate) : null,\n\t\t} as UserModel]);\n\n\t\tsetShowAddEmployee(false);\n\t\tsetEmployeeName(\"\");\n\t\tsetEmployeeEmail(\"\");\n\t\tsetEmployeePhone(\"\");\n\t\tsetEmployeeRole(UserRole.Employee);\n\t\tsetEmployeeHourlyRate(\"\");\n\t\tonUsersChange();\n\t};\n\n\tconst handleEditEmployee = async () => {\n\t\tif (!editingEmployee) return;\n\n\t\tconst userORM = UserORM.getInstance();\n\t\tawait userORM.setUserById(editingEmployee.id, {\n\t\t\t...editingEmployee,\n\t\t\tname: employeeName,\n\t\t\temail: employeeEmail,\n\t\t\tphone: employeePhone || null,\n\t\t\trole: employeeRole,\n\t\t\thourly_rate: employeeHourlyRate ? parseFloat(employeeHourlyRate) : null,\n\t\t});\n\n\t\tsetEditingEmployee(null);\n\t\tsetEmployeeName(\"\");\n\t\tsetEmployeeEmail(\"\");\n\t\tsetEmployeePhone(\"\");\n\t\tsetEmployeeRole(UserRole.Employee);\n\t\tsetEmployeeHourlyRate(\"\");\n\t\tonUsersChange();\n\t};\n\n\tconst handleDeleteEmployee = async (user: UserModel) => {\n\t\tconst userORM = UserORM.getInstance();\n\t\tawait userORM.deleteUserById(user.id);\n\t\tsetDeleteConfirm(null);\n\t\tonUsersChange();\n\t};\n\n\tconst openEditDialog = (user: UserModel) => {\n\t\tsetEditingEmployee(user);\n\t\tsetEmployeeName(user.name);\n\t\tsetEmployeeEmail(user.email);\n\t\tsetEmployeePhone(user.phone || \"\");\n\t\tsetEmployeeRole(user.role);\n\t\tsetEmployeeHourlyRate(user.hourly_rate ? user.hourly_rate.toString() : \"\");\n\t};\n\n\treturn (\n\t\t<div className=\"space-y-4\">\n\t\t\t<Card>\n\t\t\t\t<CardHeader>\n\t\t\t\t\t<div className=\"flex justify-between items-center\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<CardTitle>{t.employees}</CardTitle>\n\t\t\t\t\t\t\t<CardDescription>Manage employee accounts</CardDescription>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<Button onClick={() => setShowAddEmployee(true)}>\n\t\t\t\t\t\t\t<UserPlus className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t\t\t{t.addEmployee}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t</CardHeader>\n\t\t\t\t<CardContent>\n\t\t\t\t\t<div className=\"overflow-x-auto\">\n\t\t\t\t\t\t<Table>\n\t\t\t\t\t\t\t<TableHeader>\n\t\t\t\t\t\t\t\t<TableRow>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.name}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.email}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.phone}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.role}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.hourlyRate}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.actions}</TableHead>\n\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t</TableHeader>\n\t\t\t\t\t\t\t<TableBody>\n\t\t\t\t\t\t\t\t{users.map((user) => (\n\t\t\t\t\t\t\t\t\t<TableRow key={user.id}>\n\t\t\t\t\t\t\t\t\t\t<TableCell className=\"font-medium\">{user.name}</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell>{user.email}</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell>{user.phone || \"—\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<Badge variant={user.role === UserRole.Manager ? \"default\" : \"secondary\"}>\n\t\t\t\t\t\t\t\t\t\t\t\t{user.role === UserRole.Manager ? t.manager : t.employee}\n\t\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t{user.hourly_rate ? `$${user.hourly_rate.toFixed(2)}/hr` : \"—\"}\n\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => openEditDialog(user)}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{t.edit}\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"destructive\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => setDeleteConfirm(user)}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{t.delete}\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</TableBody>\n\t\t\t\t\t\t</Table>\n\t\t\t\t\t</div>\n\t\t\t\t</CardContent>\n\t\t\t</Card>\n\n\t\t\t<Dialog open={showAddEmployee} onOpenChange={setShowAddEmployee}>\n\t\t\t\t<DialogContent>\n\t\t\t\t\t<DialogHeader>\n\t\t\t\t\t\t<DialogTitle>{t.addEmployee}</DialogTitle>\n\t\t\t\t\t</DialogHeader>\n\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.name}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\tvalue={employeeName}\n\t\t\t\t\t\t\t\tonChange={(e) => setEmployeeName(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder=\"John Doe\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.email}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"email\"\n\t\t\t\t\t\t\t\tvalue={employeeEmail}\n\t\t\t\t\t\t\t\tonChange={(e) => setEmployeeEmail(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder=\"john@example.com\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.phone}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"tel\"\n\t\t\t\t\t\t\t\tvalue={employeePhone}\n\t\t\t\t\t\t\t\tonChange={(e) => setEmployeePhone(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder=\"+1 (555) 123-4567\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.role}</Label>\n\t\t\t\t\t\t\t<Select value={employeeRole.toString()} onValueChange={(v) => setEmployeeRole(parseInt(v))}>\n\t\t\t\t\t\t\t\t<SelectTrigger>\n\t\t\t\t\t\t\t\t\t<SelectValue />\n\t\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t\t<SelectItem value={UserRole.Employee.toString()}>{t.employee}</SelectItem>\n\t\t\t\t\t\t\t\t\t<SelectItem value={UserRole.Manager.toString()}>{t.manager}</SelectItem>\n\t\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t\t</Select>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.hourlyRate}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\tmin=\"0\"\n\t\t\t\t\t\t\t\tstep=\"0.01\"\n\t\t\t\t\t\t\t\tvalue={employeeHourlyRate}\n\t\t\t\t\t\t\t\tonChange={(e) => setEmployeeHourlyRate(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder=\"15.00\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<DialogFooter>\n\t\t\t\t\t\t<Button variant=\"outline\" onClick={() => setShowAddEmployee(false)}>\n\t\t\t\t\t\t\t{t.cancel}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button onClick={handleAddEmployee} disabled={!employeeName || !employeeEmail}>\n\t\t\t\t\t\t\t{t.saveChanges}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</DialogFooter>\n\t\t\t\t</DialogContent>\n\t\t\t</Dialog>\n\n\t\t\t<Dialog open={!!editingEmployee} onOpenChange={(open) => !open && setEditingEmployee(null)}>\n\t\t\t\t<DialogContent>\n\t\t\t\t\t<DialogHeader>\n\t\t\t\t\t\t<DialogTitle>{t.editEmployee}</DialogTitle>\n\t\t\t\t\t</DialogHeader>\n\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.name}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\tvalue={employeeName}\n\t\t\t\t\t\t\t\tonChange={(e) => setEmployeeName(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.email}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"email\"\n\t\t\t\t\t\t\t\tvalue={employeeEmail}\n\t\t\t\t\t\t\t\tonChange={(e) => setEmployeeEmail(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.phone}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"tel\"\n\t\t\t\t\t\t\t\tvalue={employeePhone}\n\t\t\t\t\t\t\t\tonChange={(e) => setEmployeePhone(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder=\"+1 (555) 123-4567\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.role}</Label>\n\t\t\t\t\t\t\t<Select value={employeeRole.toString()} onValueChange={(v) => setEmployeeRole(parseInt(v))}>\n\t\t\t\t\t\t\t\t<SelectTrigger>\n\t\t\t\t\t\t\t\t\t<SelectValue />\n\t\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t\t<SelectItem value={UserRole.Employee.toString()}>{t.employee}</SelectItem>\n\t\t\t\t\t\t\t\t\t<SelectItem value={UserRole.Manager.toString()}>{t.manager}</SelectItem>\n\t\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t\t</Select>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.hourlyRate}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\tmin=\"0\"\n\t\t\t\t\t\t\t\tstep=\"0.01\"\n\t\t\t\t\t\t\t\tvalue={employeeHourlyRate}\n\t\t\t\t\t\t\t\tonChange={(e) => setEmployeeHourlyRate(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder=\"15.00\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<DialogFooter>\n\t\t\t\t\t\t<Button variant=\"outline\" onClick={() => setEditingEmployee(null)}>\n\t\t\t\t\t\t\t{t.cancel}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button onClick={handleEditEmployee}>\n\t\t\t\t\t\t\t{t.saveChanges}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</DialogFooter>\n\t\t\t\t</DialogContent>\n\t\t\t</Dialog>\n\n\t\t\t<Dialog open={!!deleteConfirm} onOpenChange={(open) => !open && setDeleteConfirm(null)}>\n\t\t\t\t<DialogContent>\n\t\t\t\t\t<DialogHeader>\n\t\t\t\t\t\t<DialogTitle>{t.deleteEmployee}</DialogTitle>\n\t\t\t\t\t</DialogHeader>\n\t\t\t\t\t<p>{t.confirmDelete}</p>\n\t\t\t\t\t<p className=\"font-semibold\">{deleteConfirm?.name}</p>\n\t\t\t\t\t<DialogFooter>\n\t\t\t\t\t\t<Button variant=\"outline\" onClick={() => setDeleteConfirm(null)}>\n\t\t\t\t\t\t\t{t.cancel}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button variant=\"destructive\" onClick={() => deleteConfirm && handleDeleteEmployee(deleteConfirm)}>\n\t\t\t\t\t\t\t{t.delete}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</DialogFooter>\n\t\t\t\t</DialogContent>\n\t\t\t</Dialog>\n\t\t</div>\n\t);\n}\n\nfunction ManualEntryDialog({\n\topen,\n\tonClose,\n\tuserId,\n\tonSave,\n\tlanguage,\n\tusers\n}: {\n\topen: boolean;\n\tonClose: () => void;\n\tuserId: string;\n\tonSave: () => void;\n\tlanguage: Language;\n\tusers?: UserModel[];\n}) {\n\tconst [selectedUser, setSelectedUser] = useState(userId);\n\tconst [clockIn, setClockIn] = useState(\"\");\n\tconst [clockOut, setClockOut] = useState(\"\");\n\tconst [location, setLocation] = useState(\"\");\n\tconst [workDescription, setWorkDescription] = useState(\"\");\n\tconst [lunchStart, setLunchStart] = useState(\"\");\n\tconst [lunchEnd, setLunchEnd] = useState(\"\");\n\n\tconst t = translations[language];\n\n\tuseEffect(() => {\n\t\tif (open) {\n\t\t\tsetSelectedUser(userId);\n\t\t\t// Set default to today\n\t\t\tconst now = new Date();\n\t\t\tconst today = now.toISOString().slice(0, 10);\n\t\t\tsetClockIn(`${today}T09:00`);\n\t\t\tsetClockOut(`${today}T17:00`);\n\t\t\tsetLocation(\"\");\n\t\t\tsetWorkDescription(\"\");\n\t\t\tsetLunchStart(`${today}T12:00`);\n\t\t\tsetLunchEnd(`${today}T13:00`);\n\t\t}\n\t}, [open, userId]);\n\n\tconst handleSave = async () => {\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\n\t\tconst clockInTimestamp = Math.floor(new Date(clockIn).getTime() / 1000).toString();\n\t\tconst clockOutTimestamp = clockOut ? Math.floor(new Date(clockOut).getTime() / 1000).toString() : undefined;\n\t\tconst lunchStartTimestamp = lunchStart ? Math.floor(new Date(lunchStart).getTime() / 1000).toString() : undefined;\n\t\tconst lunchEndTimestamp = lunchEnd ? Math.floor(new Date(lunchEnd).getTime() / 1000).toString() : undefined;\n\n\t\tlet totalHours: number | undefined = undefined;\n\t\tlet lunchDurationMinutes: number | undefined = undefined;\n\n\t\t// Calculate lunch duration\n\t\tif (lunchStartTimestamp && lunchEndTimestamp) {\n\t\t\tconst lunchStartTime = parseInt(lunchStartTimestamp);\n\t\t\tconst lunchEndTime = parseInt(lunchEndTimestamp);\n\t\t\tlunchDurationMinutes = (lunchEndTime - lunchStartTime) / 60;\n\t\t}\n\n\t\t// Calculate total hours\n\t\tif (clockOutTimestamp) {\n\t\t\tconst clockInTime = parseInt(clockInTimestamp);\n\t\t\tconst clockOutTime = parseInt(clockOutTimestamp);\n\t\t\ttotalHours = (clockOutTime - clockInTime) / 3600;\n\n\t\t\t// Deduct lunch time\n\t\t\tif (lunchDurationMinutes) {\n\t\t\t\ttotalHours -= lunchDurationMinutes / 60;\n\t\t\t}\n\t\t}\n\n\t\tconst entryData = {\n\t\t\tuser_id: selectedUser,\n\t\t\tclock_in_timestamp: clockInTimestamp,\n\t\t\tclock_out_timestamp: clockOutTimestamp,\n\t\t\ttotal_hours: totalHours,\n\t\t\tlocation: location || undefined,\n\t\t\twork_description: workDescription || undefined,\n\t\t\tlunch_start_timestamp: lunchStartTimestamp,\n\t\t\tlunch_end_timestamp: lunchEndTimestamp,\n\t\t\tlunch_duration_minutes: lunchDurationMinutes,\n\t\t} as TimeCardEntryModel;\n\n\t\tconst normalizedEntry = normalizeTimeCardEntryForSave(entryData);\n\t\tawait timeCardORM.insertTimeCardEntry([normalizedEntry as TimeCardEntryModel]);\n\n\t\tonSave();\n\t\tonClose();\n\t};\n\n\treturn (\n\t\t<Dialog open={open} onOpenChange={onClose}>\n\t\t\t<DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n\t\t\t\t<DialogHeader>\n\t\t\t\t\t<DialogTitle>{t.addManualEntry}</DialogTitle>\n\t\t\t\t</DialogHeader>\n\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t{users && (\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.employeeName}</Label>\n\t\t\t\t\t\t\t<Select value={selectedUser} onValueChange={setSelectedUser}>\n\t\t\t\t\t\t\t\t<SelectTrigger>\n\t\t\t\t\t\t\t\t\t<SelectValue />\n\t\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t\t{users.filter(u => u.role === UserRole.Employee).map((u) => (\n\t\t\t\t\t\t\t\t\t\t<SelectItem key={u.id} value={u.id}>\n\t\t\t\t\t\t\t\t\t\t\t{u.name}\n\t\t\t\t\t\t\t\t\t\t</SelectItem>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t\t</Select>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t\t<div className=\"grid grid-cols-2 gap-4\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.clockInTime}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\tvalue={clockIn}\n\t\t\t\t\t\t\t\tonChange={(e) => setClockIn(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.clockOutTime}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\tvalue={clockOut}\n\t\t\t\t\t\t\t\tonChange={(e) => setClockOut(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<Label>{t.location}</Label>\n\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\tvalue={location}\n\t\t\t\t\t\t\tonChange={(e) => setLocation(e.target.value)}\n\t\t\t\t\t\t\tplaceholder={t.locationPlaceholder}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<Label>{t.workDescription}</Label>\n\t\t\t\t\t\t<Textarea\n\t\t\t\t\t\t\tvalue={workDescription}\n\t\t\t\t\t\t\tonChange={(e) => setWorkDescription(e.target.value)}\n\t\t\t\t\t\t\tplaceholder={t.descriptionPlaceholder}\n\t\t\t\t\t\t\trows={4}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"grid grid-cols-2 gap-4\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.lunchStartTime} ({language === 'en' ? 'Optional' : 'Opcional'})</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\tvalue={lunchStart}\n\t\t\t\t\t\t\t\tonChange={(e) => setLunchStart(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.lunchEndTime} ({language === 'en' ? 'Optional' : 'Opcional'})</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\tvalue={lunchEnd}\n\t\t\t\t\t\t\t\tonChange={(e) => setLunchEnd(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<DialogFooter>\n\t\t\t\t\t<Button variant=\"outline\" onClick={onClose}>\n\t\t\t\t\t\t{t.cancel}\n\t\t\t\t\t</Button>\n\t\t\t\t\t<Button onClick={handleSave} disabled={!selectedUser || !clockIn}>\n\t\t\t\t\t\t{t.saveChanges}\n\t\t\t\t\t</Button>\n\t\t\t\t</DialogFooter>\n\t\t\t</DialogContent>\n\t\t</Dialog>\n\t);\n}\n","structuredPatch":[{"oldStart":234,"oldLines":6,"newStart":234,"newLines":7,"lines":["   const [users, setUsers] = useState<UserModel[]>([]);","   const [showUserSelect, setShowUserSelect] = useState(true);","   const [language, setLanguage] = useState<Language>('en');","+  const [employeeOnlyMode, setEmployeeOnlyMode] = useState(false);"," ","   const t = translations[language];"," "]},{"oldStart":241,"oldLines":6,"newStart":242,"newLines":23,"lines":["     loadUsers();","   }, []);"," ","+  // Check for employee URL parameter and auto-login","+  useEffect(() => {","+    if (users.length > 0 && !currentUser) {","+      const urlParams = new URLSearchParams(window.location.search);","+      const employeeId = urlParams.get('employee');","+","+      if (employeeId) {","+        const user = users.find(u => u.id === employeeId && u.role === UserRole.Employee);","+        if (user) {","+          setCurrentUser(user);","+          setShowUserSelect(false);","+          setEmployeeOnlyMode(true);","+        }","+      }","+    }","+  }, [users, currentUser]);","+","   const loadUsers = async () => {","     const userORM = UserORM.getInstance();","     const allUsers = await userORM.getAllUser();"]}],"userModified":false,"replaceAll":false}}
{"type":"assistant","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_vrtx_01RN5xvhCYkVyvKWm1vQcyPZ","type":"message","role":"assistant","content":[{"type":"text","text":"Now I need to add translations for the employee view features:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":1026,"cache_read_input_tokens":46255,"cache_creation":{"ephemeral_5m_input_tokens":1026,"ephemeral_1h_input_tokens":0},"output_tokens":1},"context_management":null},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"3f590818-ad6a-4701-bb81-a4f260e6b830"}
{"type":"assistant","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_vrtx_01RN5xvhCYkVyvKWm1vQcyPZ","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_vrtx_01BJ6AfE7mhdqF969UwKYu7q","name":"Edit","input":{"file_path":"/home/user/vite-template/src/routes/index.tsx","old_string":"\t\ttotalPay: \"Total Pay\",\n\t\tregularPay: \"Regular Pay\",\n\t\tovertimePay: \"Overtime Pay\",\n\t},","new_string":"\t\ttotalPay: \"Total Pay\",\n\t\tregularPay: \"Regular Pay\",\n\t\tovertimePay: \"Overtime Pay\",\n\t\tcopyEmployeeLink: \"Copy Employee Link\",\n\t\temployeeLinkCopied: \"Employee link copied!\",\n\t\tmyTimeTracking: \"My Time Tracking\",\n\t\tmyHours: \"My Hours\",\n\t},"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":1026,"cache_read_input_tokens":46255,"cache_creation":{"ephemeral_5m_input_tokens":1026,"ephemeral_1h_input_tokens":0},"output_tokens":237},"context_management":null},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"60736adf-34b3-4250-b26d-eaefb78262a4"}
{"type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_vrtx_01BJ6AfE7mhdqF969UwKYu7q","type":"tool_result","content":"The file /home/user/vite-template/src/routes/index.tsx has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n   120→\t\tconfirmDeleteSickDay: \"Are you sure you want to delete this sick day? This action cannot be undone.\",\n   121→\t\tsickDayHistory: \"Sick Day History\",\n   122→\t\thourlyRate: \"Hourly Rate\",\n   123→\t\tpay: \"Pay\",\n   124→\t\ttotalPay: \"Total Pay\",\n   125→\t\tregularPay: \"Regular Pay\",\n   126→\t\tovertimePay: \"Overtime Pay\",\n   127→\t\tcopyEmployeeLink: \"Copy Employee Link\",\n   128→\t\temployeeLinkCopied: \"Employee link copied!\",\n   129→\t\tmyTimeTracking: \"My Time Tracking\",\n   130→\t\tmyHours: \"My Hours\",\n   131→\t},\n   132→\tes: {\n   133→\t\tappTitle: \"Registro de Tiempo de Empleados\",\n   134→\t\tselectAccount: \"Selecciona tu cuenta para continuar\",\n   135→\t\tselectUser: \"Seleccionar Usuario\","}]},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"3d63367b-0151-49e8-a0d9-316ea531288a","tool_use_result":{"filePath":"/home/user/vite-template/src/routes/index.tsx","oldString":"\t\ttotalPay: \"Total Pay\",\n\t\tregularPay: \"Regular Pay\",\n\t\tovertimePay: \"Overtime Pay\",\n\t},","newString":"\t\ttotalPay: \"Total Pay\",\n\t\tregularPay: \"Regular Pay\",\n\t\tovertimePay: \"Overtime Pay\",\n\t\tcopyEmployeeLink: \"Copy Employee Link\",\n\t\temployeeLinkCopied: \"Employee link copied!\",\n\t\tmyTimeTracking: \"My Time Tracking\",\n\t\tmyHours: \"My Hours\",\n\t},","originalFile":"import { createFileRoute } from \"@tanstack/react-router\";\nimport { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from \"@/components/ui/dialog\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Clock, Users, CalendarDays, Timer, Languages, Coffee, UserPlus, FileText, AlertCircle, Plus, Trash2, Heart } from \"lucide-react\";\nimport { UserORM, type UserModel, UserRole } from \"@/sdk/database/orm/orm_user\";\nimport { TimeCardEntryORM, type TimeCardEntryModel } from \"@/sdk/database/orm/orm_time_card_entry\";\nimport { SickDayORM, type SickDayModel } from \"@/sdk/database/orm/orm_sick_day\";\nimport { normalizeTimeCardEntryForSave, normalizeTimeCardEntriesFromORM, isActiveShift, isOnLunchBreak } from \"@/lib/orm-data-helpers\";\n\nexport const Route = createFileRoute(\"/\")({\n\tcomponent: App,\n});\n\ntype Language = 'en' | 'es';\n\nconst translations = {\n\ten: {\n\t\tappTitle: \"Employee Time Tracking\",\n\t\tselectAccount: \"Select your account to continue\",\n\t\tselectUser: \"Select User\",\n\t\tchooseAccount: \"Choose your account\",\n\t\tmanager: \"Manager\",\n\t\temployee: \"Employee\",\n\t\tswitchUser: \"Switch User\",\n\t\ttimeTrackingSystem: \"Time Tracking System\",\n\t\twelcome: \"Welcome\",\n\t\tclockInOut: \"Clock In/Out\",\n\t\tcurrentlyClocked: \"Currently Clocked In\",\n\t\tsince: \"Since\",\n\t\telapsedTime: \"Elapsed Time\",\n\t\tclockOut: \"Clock Out\",\n\t\tnotClocked: \"Not currently clocked in\",\n\t\tclockIn: \"Clock In\",\n\t\ttimeCardHistory: \"Time Card History\",\n\t\trecentRecords: \"Your recent clock in/out records\",\n\t\tnoTimeCards: \"No time cards yet\",\n\t\tclockInTime: \"Clock In\",\n\t\tclockOutTime: \"Clock Out\",\n\t\thours: \"Hours\",\n\t\tstatus: \"Status\",\n\t\tcompleted: \"Completed\",\n\t\tactive: \"Active\",\n\t\ttotalEmployees: \"Total Employees\",\n\t\thoursToday: \"Hours Today\",\n\t\thoursThisWeek: \"Hours This Week\",\n\t\tallEmployeeTimeCards: \"All Employee Time Cards\",\n\t\tviewManageRecords: \"View and manage all employee time records\",\n\t\tfilterByEmployee: \"Filter by Employee\",\n\t\tallEmployees: \"All Employees\",\n\t\tfilterByDate: \"Filter by Date\",\n\t\tclearFilters: \"Clear Filters\",\n\t\tnoTimeCardsFound: \"No time cards found\",\n\t\temployeeName: \"Employee\",\n\t\tactions: \"Actions\",\n\t\tedit: \"Edit\",\n\t\teditTimeCard: \"Edit Time Card\",\n\t\tcancel: \"Cancel\",\n\t\tsaveChanges: \"Save Changes\",\n\t\tlocation: \"Location\",\n\t\twhereWorked: \"Where did you work?\",\n\t\tworkDescription: \"Work Description\",\n\t\twhatDid: \"What did you do today?\",\n\t\tlocationPlaceholder: \"e.g., Office, Remote, Client Site\",\n\t\tdescriptionPlaceholder: \"Describe your work activities...\",\n\t\tstartLunch: \"Start Lunch Break\",\n\t\tendLunch: \"End Lunch Break\",\n\t\tonLunchBreak: \"On Lunch Break\",\n\t\tlunchBreak: \"Lunch Break\",\n\t\tlunchDuration: \"Lunch\",\n\t\tlunchStartTime: \"Lunch Start\",\n\t\tlunchEndTime: \"Lunch End\",\n\t\ttimeCards: \"Time Cards\",\n\t\treports: \"Reports\",\n\t\temployees: \"Employees\",\n\t\taddEmployee: \"Add Employee\",\n\t\teditEmployee: \"Edit Employee\",\n\t\tdeleteEmployee: \"Delete Employee\",\n\t\tname: \"Name\",\n\t\temail: \"Email\",\n\t\tphone: \"Phone\",\n\t\trole: \"Role\",\n\t\tdelete: \"Delete\",\n\t\tweeklyReport: \"Weekly Report\",\n\t\tselectWeek: \"Select Week\",\n\t\tregularHours: \"Regular\",\n\t\tovertimeHours: \"Overtime\",\n\t\ttotalHours: \"Total\",\n\t\tnoReportData: \"No data for selected week\",\n\t\taddTimeCard: \"Add Time Card\",\n\t\tmanualEntry: \"Manual Entry\",\n\t\taddManualEntry: \"Add Manual Time Card\",\n\t\tconfirmDelete: \"Are you sure you want to delete this employee?\",\n\t\tovertimeAlert: \"Overtime Alert\",\n\t\tprintReport: \"Print Report\",\n\t\texportCSV: \"Export to CSV\",\n\t\tdetailedReport: \"Detailed Time Card Report\",\n\t\tdate: \"Date\",\n\t\tday: \"Day\",\n\t\tdeleteTimeCard: \"Delete Time Card\",\n\t\tconfirmDeleteTimeCard: \"Are you sure you want to delete this time card? This action cannot be undone.\",\n\t\tsickDays: \"Sick Days\",\n\t\taddSickDay: \"Add Sick Day\",\n\t\tsickDayDate: \"Sick Day Date\",\n\t\tsickDayHours: \"Hours\",\n\t\tsickDayNotes: \"Notes/Reason\",\n\t\tsickDayNotesPlaceholder: \"e.g., Doctor's appointment, flu, etc.\",\n\t\tmySickDays: \"My Sick Days\",\n\t\tnoSickDays: \"No sick days recorded\",\n\t\ttotalSickDays: \"Total Sick Days\",\n\t\tdeleteSickDay: \"Delete Sick Day\",\n\t\tconfirmDeleteSickDay: \"Are you sure you want to delete this sick day? This action cannot be undone.\",\n\t\tsickDayHistory: \"Sick Day History\",\n\t\thourlyRate: \"Hourly Rate\",\n\t\tpay: \"Pay\",\n\t\ttotalPay: \"Total Pay\",\n\t\tregularPay: \"Regular Pay\",\n\t\tovertimePay: \"Overtime Pay\",\n\t},\n\tes: {\n\t\tappTitle: \"Registro de Tiempo de Empleados\",\n\t\tselectAccount: \"Selecciona tu cuenta para continuar\",\n\t\tselectUser: \"Seleccionar Usuario\",\n\t\tchooseAccount: \"Elige tu cuenta\",\n\t\tmanager: \"Gerente\",\n\t\temployee: \"Empleado\",\n\t\tswitchUser: \"Cambiar Usuario\",\n\t\ttimeTrackingSystem: \"Sistema de Registro de Tiempo\",\n\t\twelcome: \"Bienvenido\",\n\t\tclockInOut: \"Entrada/Salida\",\n\t\tcurrentlyClocked: \"Actualmente Registrado\",\n\t\tsince: \"Desde\",\n\t\telapsedTime: \"Tiempo Transcurrido\",\n\t\tclockOut: \"Registrar Salida\",\n\t\tnotClocked: \"No está registrado actualmente\",\n\t\tclockIn: \"Registrar Entrada\",\n\t\ttimeCardHistory: \"Historial de Tarjetas de Tiempo\",\n\t\trecentRecords: \"Tus registros recientes de entrada/salida\",\n\t\tnoTimeCards: \"No hay tarjetas de tiempo todavía\",\n\t\tclockInTime: \"Entrada\",\n\t\tclockOutTime: \"Salida\",\n\t\thours: \"Horas\",\n\t\tstatus: \"Estado\",\n\t\tcompleted: \"Completado\",\n\t\tactive: \"Activo\",\n\t\ttotalEmployees: \"Total de Empleados\",\n\t\thoursToday: \"Horas Hoy\",\n\t\thoursThisWeek: \"Horas Esta Semana\",\n\t\tallEmployeeTimeCards: \"Todas las Tarjetas de Tiempo\",\n\t\tviewManageRecords: \"Ver y gestionar todos los registros de empleados\",\n\t\tfilterByEmployee: \"Filtrar por Empleado\",\n\t\tallEmployees: \"Todos los Empleados\",\n\t\tfilterByDate: \"Filtrar por Fecha\",\n\t\tclearFilters: \"Limpiar Filtros\",\n\t\tnoTimeCardsFound: \"No se encontraron tarjetas de tiempo\",\n\t\temployeeName: \"Empleado\",\n\t\tactions: \"Acciones\",\n\t\tedit: \"Editar\",\n\t\teditTimeCard: \"Editar Tarjeta de Tiempo\",\n\t\tcancel: \"Cancelar\",\n\t\tsaveChanges: \"Guardar Cambios\",\n\t\tlocation: \"Ubicación\",\n\t\twhereWorked: \"¿Dónde trabajaste?\",\n\t\tworkDescription: \"Descripción del Trabajo\",\n\t\twhatDid: \"¿Qué hiciste hoy?\",\n\t\tlocationPlaceholder: \"ej., Oficina, Remoto, Sitio del Cliente\",\n\t\tdescriptionPlaceholder: \"Describe tus actividades laborales...\",\n\t\tstartLunch: \"Iniciar Almuerzo\",\n\t\tendLunch: \"Terminar Almuerzo\",\n\t\tonLunchBreak: \"En Almuerzo\",\n\t\tlunchBreak: \"Almuerzo\",\n\t\tlunchDuration: \"Almuerzo\",\n\t\tlunchStartTime: \"Inicio Almuerzo\",\n\t\tlunchEndTime: \"Fin Almuerzo\",\n\t\ttimeCards: \"Tarjetas de Tiempo\",\n\t\treports: \"Informes\",\n\t\temployees: \"Empleados\",\n\t\taddEmployee: \"Agregar Empleado\",\n\t\teditEmployee: \"Editar Empleado\",\n\t\tdeleteEmployee: \"Eliminar Empleado\",\n\t\tname: \"Nombre\",\n\t\temail: \"Correo\",\n\t\tphone: \"Teléfono\",\n\t\trole: \"Rol\",\n\t\tdelete: \"Eliminar\",\n\t\tweeklyReport: \"Informe Semanal\",\n\t\tselectWeek: \"Seleccionar Semana\",\n\t\tregularHours: \"Regular\",\n\t\tovertimeHours: \"Tiempo Extra\",\n\t\ttotalHours: \"Total\",\n\t\tnoReportData: \"No hay datos para la semana seleccionada\",\n\t\taddTimeCard: \"Agregar Tarjeta\",\n\t\tmanualEntry: \"Entrada Manual\",\n\t\taddManualEntry: \"Agregar Tarjeta Manual\",\n\t\tconfirmDelete: \"¿Está seguro de eliminar este empleado?\",\n\t\tovertimeAlert: \"Alerta de Tiempo Extra\",\n\t\tprintReport: \"Imprimir Informe\",\n\t\texportCSV: \"Exportar a CSV\",\n\t\tdetailedReport: \"Informe Detallado de Tarjetas de Tiempo\",\n\t\tdate: \"Fecha\",\n\t\tday: \"Día\",\n\t\tdeleteTimeCard: \"Eliminar Tarjeta de Tiempo\",\n\t\tconfirmDeleteTimeCard: \"¿Está seguro de eliminar esta tarjeta de tiempo? Esta acción no se puede deshacer.\",\n\t\tsickDays: \"Días de Enfermedad\",\n\t\taddSickDay: \"Agregar Día de Enfermedad\",\n\t\tsickDayDate: \"Fecha de Enfermedad\",\n\t\tsickDayHours: \"Horas\",\n\t\tsickDayNotes: \"Notas/Razón\",\n\t\tsickDayNotesPlaceholder: \"ej., Cita médica, gripe, etc.\",\n\t\tmySickDays: \"Mis Días de Enfermedad\",\n\t\tnoSickDays: \"No hay días de enfermedad registrados\",\n\t\ttotalSickDays: \"Total Días de Enfermedad\",\n\t\tdeleteSickDay: \"Eliminar Día de Enfermedad\",\n\t\tconfirmDeleteSickDay: \"¿Está seguro de eliminar este día de enfermedad? Esta acción no se puede deshacer.\",\n\t\tsickDayHistory: \"Historial de Días de Enfermedad\",\n\t\thourlyRate: \"Tarifa por Hora\",\n\t\tpay: \"Pago\",\n\t\ttotalPay: \"Pago Total\",\n\t\tregularPay: \"Pago Regular\",\n\t\tovertimePay: \"Pago Tiempo Extra\",\n\t}\n};\n\nfunction App() {\n\tconst [currentUser, setCurrentUser] = useState<UserModel | null>(null);\n\tconst [users, setUsers] = useState<UserModel[]>([]);\n\tconst [showUserSelect, setShowUserSelect] = useState(true);\n\tconst [language, setLanguage] = useState<Language>('en');\n\tconst [employeeOnlyMode, setEmployeeOnlyMode] = useState(false);\n\n\tconst t = translations[language];\n\n\tuseEffect(() => {\n\t\tloadUsers();\n\t}, []);\n\n\t// Check for employee URL parameter and auto-login\n\tuseEffect(() => {\n\t\tif (users.length > 0 && !currentUser) {\n\t\t\tconst urlParams = new URLSearchParams(window.location.search);\n\t\t\tconst employeeId = urlParams.get('employee');\n\n\t\t\tif (employeeId) {\n\t\t\t\tconst user = users.find(u => u.id === employeeId && u.role === UserRole.Employee);\n\t\t\t\tif (user) {\n\t\t\t\t\tsetCurrentUser(user);\n\t\t\t\t\tsetShowUserSelect(false);\n\t\t\t\t\tsetEmployeeOnlyMode(true);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}, [users, currentUser]);\n\n\tconst loadUsers = async () => {\n\t\tconst userORM = UserORM.getInstance();\n\t\tconst allUsers = await userORM.getAllUser();\n\n\t\t// If no users exist, create demo users\n\t\tif (allUsers.length === 0) {\n\t\t\tconst demoUsers = await userORM.insertUser([\n\t\t\t\t{\n\t\t\t\t\tname: \"John Smith\",\n\t\t\t\t\temail: \"john@example.com\",\n\t\t\t\t\trole: UserRole.Employee,\n\t\t\t\t} as UserModel,\n\t\t\t\t{\n\t\t\t\t\tname: \"Sarah Johnson\",\n\t\t\t\t\temail: \"sarah@example.com\",\n\t\t\t\t\trole: UserRole.Employee,\n\t\t\t\t} as UserModel,\n\t\t\t\t{\n\t\t\t\t\tname: \"Mike Manager\",\n\t\t\t\t\temail: \"mike@example.com\",\n\t\t\t\t\trole: UserRole.Manager,\n\t\t\t\t} as UserModel,\n\t\t\t]);\n\t\t\tsetUsers(demoUsers);\n\t\t} else {\n\t\t\tsetUsers(allUsers);\n\t\t}\n\t};\n\n\tconst handleUserSelect = (userId: string) => {\n\t\tconst user = users.find(u => u.id === userId);\n\t\tif (user) {\n\t\t\tsetCurrentUser(user);\n\t\t\tsetShowUserSelect(false);\n\t\t}\n\t};\n\n\tconst handleLogout = () => {\n\t\tsetCurrentUser(null);\n\t\tsetShowUserSelect(true);\n\t};\n\n\tconst toggleLanguage = () => {\n\t\tsetLanguage(prev => prev === 'en' ? 'es' : 'en');\n\t};\n\n\tif (showUserSelect || !currentUser) {\n\t\treturn (\n\t\t\t<div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800 flex items-center justify-center p-4\">\n\t\t\t\t<div className=\"absolute top-4 right-4\">\n\t\t\t\t\t<Button onClick={toggleLanguage} variant=\"outline\" size=\"sm\">\n\t\t\t\t\t\t<Languages className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t\t{language === 'en' ? 'Español' : 'English'}\n\t\t\t\t\t</Button>\n\t\t\t\t</div>\n\t\t\t\t<Card className=\"w-full max-w-md\">\n\t\t\t\t\t<CardHeader>\n\t\t\t\t\t\t<CardTitle className=\"text-2xl\">{t.appTitle}</CardTitle>\n\t\t\t\t\t\t<CardDescription>{t.selectAccount}</CardDescription>\n\t\t\t\t\t</CardHeader>\n\t\t\t\t\t<CardContent className=\"space-y-4\">\n\t\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t\t<Label>{t.selectUser}</Label>\n\t\t\t\t\t\t\t<Select onValueChange={handleUserSelect}>\n\t\t\t\t\t\t\t\t<SelectTrigger className=\"w-full\">\n\t\t\t\t\t\t\t\t\t<SelectValue placeholder={t.chooseAccount} />\n\t\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t\t{users.map((user) => (\n\t\t\t\t\t\t\t\t\t\t<SelectItem key={user.id} value={user.id}>\n\t\t\t\t\t\t\t\t\t\t\t{user.name} - {user.role === UserRole.Manager ? t.manager : t.employee}\n\t\t\t\t\t\t\t\t\t\t</SelectItem>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t\t</Select>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</CardContent>\n\t\t\t\t</Card>\n\t\t\t</div>\n\t\t);\n\t}\n\n\treturn (\n\t\t<div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800\">\n\t\t\t<div className=\"container mx-auto p-6 space-y-6\">\n\t\t\t\t<div className=\"flex justify-between items-center\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<h1 className=\"text-3xl font-bold\">{t.timeTrackingSystem}</h1>\n\t\t\t\t\t\t<p className=\"text-muted-foreground\">\n\t\t\t\t\t\t\t{t.welcome}, {currentUser.name} ({currentUser.role === UserRole.Manager ? t.manager : t.employee})\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"flex gap-2\">\n\t\t\t\t\t\t<Button onClick={toggleLanguage} variant=\"outline\" size=\"sm\">\n\t\t\t\t\t\t\t<Languages className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t\t\t{language === 'en' ? 'Español' : 'English'}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button onClick={handleLogout} variant=\"outline\">\n\t\t\t\t\t\t\t{t.switchUser}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t{currentUser.role === UserRole.Employee ? (\n\t\t\t\t\t<EmployeeView user={currentUser} language={language} />\n\t\t\t\t) : (\n\t\t\t\t\t<ManagerView user={currentUser} users={users} language={language} onUsersChange={loadUsers} />\n\t\t\t\t)}\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n\nfunction SickDayCard({ user, language }: { user: UserModel; language: Language }) {\n\tconst [sickDays, setSickDays] = useState<SickDayModel[]>([]);\n\tconst [showAddDialog, setShowAddDialog] = useState(false);\n\tconst [sickDate, setSickDate] = useState(\"\");\n\tconst [sickHours, setSickHours] = useState(\"8\");\n\tconst [sickNotes, setSickNotes] = useState(\"\");\n\n\tconst t = translations[language];\n\n\tuseEffect(() => {\n\t\tloadSickDays();\n\t}, [user.id]);\n\n\tconst loadSickDays = async () => {\n\t\tconst sickDayORM = SickDayORM.getInstance();\n\t\tconst userSickDays = await sickDayORM.getSickDayByUserId(user.id);\n\n\t\t// Sort by date (newest first)\n\t\tconst sorted = userSickDays.sort((a, b) =>\n\t\t\tnew Date(b.sick_date).getTime() - new Date(a.sick_date).getTime()\n\t\t);\n\n\t\tsetSickDays(sorted);\n\t};\n\n\tconst handleAddSickDay = async () => {\n\t\tif (!sickDate || !sickHours) {\n\t\t\talert(\"Please fill in date and hours\");\n\t\t\treturn;\n\t\t}\n\n\t\tconst sickDayORM = SickDayORM.getInstance();\n\t\tawait sickDayORM.insertSickDay([{\n\t\t\tuser_id: user.id,\n\t\t\tsick_date: sickDate,\n\t\t\thours: parseFloat(sickHours),\n\t\t\tnotes: sickNotes || null,\n\t\t} as SickDayModel]);\n\n\t\t// Reset form\n\t\tsetSickDate(\"\");\n\t\tsetSickHours(\"8\");\n\t\tsetSickNotes(\"\");\n\t\tsetShowAddDialog(false);\n\n\t\tawait loadSickDays();\n\t};\n\n\tconst handleDeleteSickDay = async (sickDay: SickDayModel) => {\n\t\tif (!window.confirm(t.confirmDeleteSickDay)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst sickDayORM = SickDayORM.getInstance();\n\t\tawait sickDayORM.deleteSickDayById(sickDay.id);\n\t\tawait loadSickDays();\n\t};\n\n\tconst formatDate = (dateStr: string) => {\n\t\tconst date = new Date(dateStr);\n\t\treturn date.toLocaleDateString(language === 'es' ? 'es-ES' : 'en-US', {\n\t\t\tyear: 'numeric',\n\t\t\tmonth: 'long',\n\t\t\tday: 'numeric'\n\t\t});\n\t};\n\n\tconst totalSickHours = sickDays.reduce((sum, sd) => sum + sd.hours, 0);\n\n\treturn (\n\t\t<>\n\t\t\t<Card>\n\t\t\t\t<CardHeader>\n\t\t\t\t\t<div className=\"flex justify-between items-center\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<CardTitle className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t<Heart className=\"w-5 h-5 text-red-500\" />\n\t\t\t\t\t\t\t\t{t.mySickDays}\n\t\t\t\t\t\t\t</CardTitle>\n\t\t\t\t\t\t\t<CardDescription>\n\t\t\t\t\t\t\t\t{t.totalSickDays}: {totalSickHours.toFixed(1)} {language === 'es' ? 'hrs' : 'hrs'}\n\t\t\t\t\t\t\t</CardDescription>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<Button onClick={() => setShowAddDialog(true)} size=\"sm\">\n\t\t\t\t\t\t\t<Plus className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t\t\t{t.addSickDay}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t</CardHeader>\n\t\t\t\t<CardContent>\n\t\t\t\t\t{sickDays.length === 0 ? (\n\t\t\t\t\t\t<p className=\"text-center text-muted-foreground py-8\">{t.noSickDays}</p>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<div className=\"overflow-x-auto\">\n\t\t\t\t\t\t\t<Table>\n\t\t\t\t\t\t\t\t<TableHeader>\n\t\t\t\t\t\t\t\t\t<TableRow>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.sickDayDate}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.sickDayHours}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.sickDayNotes}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.actions}</TableHead>\n\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t</TableHeader>\n\t\t\t\t\t\t\t\t<TableBody>\n\t\t\t\t\t\t\t\t\t{sickDays.map((sd) => (\n\t\t\t\t\t\t\t\t\t\t<TableRow key={sd.id}>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"font-medium whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t{formatDate(sd.sick_date)}\n\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell>{sd.hours} hrs</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"max-w-xs truncate\">{sd.notes || \"—\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => handleDeleteSickDay(sd)}\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"text-red-600 hover:text-red-700 hover:bg-red-50\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Trash2 className=\"w-4 h-4\" />\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</TableBody>\n\t\t\t\t\t\t\t</Table>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</CardContent>\n\t\t\t</Card>\n\n\t\t\t<Dialog open={showAddDialog} onOpenChange={setShowAddDialog}>\n\t\t\t\t<DialogContent>\n\t\t\t\t\t<DialogHeader>\n\t\t\t\t\t\t<DialogTitle>{t.addSickDay}</DialogTitle>\n\t\t\t\t\t</DialogHeader>\n\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.sickDayDate}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"date\"\n\t\t\t\t\t\t\t\tvalue={sickDate}\n\t\t\t\t\t\t\t\tonChange={(e) => setSickDate(e.target.value)}\n\t\t\t\t\t\t\t\tmax={new Date().toISOString().split('T')[0]}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.sickDayHours}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\tmin=\"0.5\"\n\t\t\t\t\t\t\t\tmax=\"24\"\n\t\t\t\t\t\t\t\tstep=\"0.5\"\n\t\t\t\t\t\t\t\tvalue={sickHours}\n\t\t\t\t\t\t\t\tonChange={(e) => setSickHours(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.sickDayNotes}</Label>\n\t\t\t\t\t\t\t<Textarea\n\t\t\t\t\t\t\t\tvalue={sickNotes}\n\t\t\t\t\t\t\t\tonChange={(e) => setSickNotes(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder={t.sickDayNotesPlaceholder}\n\t\t\t\t\t\t\t\trows={3}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<DialogFooter>\n\t\t\t\t\t\t<Button variant=\"outline\" onClick={() => setShowAddDialog(false)}>\n\t\t\t\t\t\t\t{t.cancel}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button onClick={handleAddSickDay} disabled={!sickDate || !sickHours}>\n\t\t\t\t\t\t\t{t.saveChanges}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</DialogFooter>\n\t\t\t\t</DialogContent>\n\t\t\t</Dialog>\n\t\t</>\n\t);\n}\n\nfunction EmployeeView({ user, language }: { user: UserModel; language: Language }) {\n\tconst [timeCards, setTimeCards] = useState<TimeCardEntryModel[]>([]);\n\tconst [activeShift, setActiveShift] = useState<TimeCardEntryModel | null>(null);\n\tconst [elapsedTime, setElapsedTime] = useState(0);\n\tconst [location, setLocation] = useState(\"\");\n\tconst [workDescription, setWorkDescription] = useState(\"\");\n\tconst [isOnLunch, setIsOnLunch] = useState(false);\n\tconst [isLoading, setIsLoading] = useState(false);\n\n\tconst t = translations[language];\n\n\tuseEffect(() => {\n\t\tloadTimeCards();\n\t}, [user.id]);\n\n\tuseEffect(() => {\n\t\tlet interval: NodeJS.Timeout;\n\t\tif (activeShift && !isOnLunch) {\n\t\t\tinterval = setInterval(() => {\n\t\t\t\tconst clockInTime = parseInt(activeShift.clock_in_timestamp) * 1000;\n\t\t\t\tconst elapsed = Date.now() - clockInTime;\n\t\t\t\tsetElapsedTime(elapsed);\n\t\t\t}, 1000);\n\t\t}\n\t\treturn () => clearInterval(interval);\n\t}, [activeShift, isOnLunch]);\n\n\tconst loadTimeCards = async () => {\n\t\tconsole.log(\"Loading time cards for user:\", user.id);\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tconst userTimeCards = await timeCardORM.getTimeCardEntryByUserId(user.id);\n\n\t\tconsole.log(\"Found\", userTimeCards.length, \"time cards\");\n\n\t\t// Normalize data retrieved from ORM to fix null-handling bugs\n\t\tconst normalized = normalizeTimeCardEntriesFromORM(userTimeCards);\n\n\t\t// Sort by clock in time (newest first)\n\t\tconst sorted = normalized.sort((a, b) =>\n\t\t\tparseInt(b.clock_in_timestamp) - parseInt(a.clock_in_timestamp)\n\t\t);\n\n\t\tsetTimeCards(sorted);\n\n\t\t// Find active shift using helper function\n\t\tconst active = sorted.find(tc => isActiveShift(tc));\n\t\tconsole.log(\"Active shift found:\", active ? `Yes (ID: ${active.id})` : \"No\");\n\n\t\tsetActiveShift(active || null);\n\t\tif (active) {\n\t\t\tsetLocation(active.location || \"\");\n\t\t\tsetWorkDescription(active.work_description || \"\");\n\t\t\t// Check if on lunch break using helper function\n\t\t\tconst onLunch = isOnLunchBreak(active);\n\t\t\tsetIsOnLunch(onLunch);\n\t\t\tconsole.log(\"On lunch:\", onLunch);\n\t\t} else {\n\t\t\tsetIsOnLunch(false);\n\t\t}\n\t};\n\n\tconst handleClockIn = async () => {\n\t\tconsole.log(\"=== CLOCK IN STARTED ===\");\n\t\tconsole.log(\"User ID:\", user.id);\n\t\tconsole.log(\"Location:\", location);\n\t\tconsole.log(\"Work Description:\", workDescription);\n\n\t\tsetIsLoading(true);\n\t\ttry {\n\t\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\t\tconst now = Math.floor(Date.now() / 1000).toString();\n\t\t\tconsole.log(\"Current timestamp:\", now);\n\n\t\t\tconst newEntry = {\n\t\t\t\tuser_id: user.id,\n\t\t\t\tclock_in_timestamp: now,\n\t\t\t\tlocation: location || undefined,\n\t\t\t\twork_description: workDescription || undefined,\n\t\t\t} as TimeCardEntryModel;\n\n\t\t\t// Normalize the entry to work around ORM null-handling bugs\n\t\t\tconst normalizedEntry = normalizeTimeCardEntryForSave(newEntry);\n\n\t\t\tconsole.log(\"Inserting time card entry:\", normalizedEntry);\n\n\t\t\tconst result = await timeCardORM.insertTimeCardEntry([normalizedEntry as TimeCardEntryModel]);\n\t\t\tconsole.log(\"Insert result:\", result);\n\n\t\t\t// Normalize the returned data\n\t\t\tconst normalizedResult = normalizeTimeCardEntriesFromORM(result);\n\t\t\tconsole.log(\"Normalized result:\", normalizedResult);\n\n\t\t\tconsole.log(\"Time card entry created successfully!\");\n\n\t\t\t// Clear form\n\t\t\tsetLocation(\"\");\n\t\t\tsetWorkDescription(\"\");\n\n\t\t\t// Reload time cards\n\t\t\tconsole.log(\"Reloading time cards...\");\n\t\t\tawait loadTimeCards();\n\n\t\t\tconsole.log(\"=== CLOCK IN COMPLETED ===\");\n\n\t\t\t// Show success feedback\n\t\t\tconst reloadedShifts = normalizeTimeCardEntriesFromORM(\n\t\t\t\tawait timeCardORM.getTimeCardEntryByUserId(user.id)\n\t\t\t);\n\t\t\tif (reloadedShifts.some(tc => isActiveShift(tc))) {\n\t\t\t\talert(\"✅ Successfully clocked in! You can now see the CLOCK OUT button.\");\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.error(\"=== CLOCK IN FAILED ===\");\n\t\t\tconsole.error(\"Error details:\", error);\n\t\t\talert(`Error clocking in: ${error instanceof Error ? error.message : 'Unknown error'}. Check console for details.`);\n\t\t} finally {\n\t\t\tsetIsLoading(false);\n\t\t}\n\t};\n\n\tconst handleClockOut = async () => {\n\t\tconsole.log(\"Clock Out clicked - activeShift:\", activeShift);\n\n\t\tif (!activeShift) {\n\t\t\tconsole.error(\"No active shift to clock out!\");\n\t\t\talert(\"Error: No active shift found. Please try clocking in first.\");\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\t\tconst now = Math.floor(Date.now() / 1000).toString();\n\n\t\t\tconst clockInTime = parseInt(activeShift.clock_in_timestamp);\n\t\t\tconst clockOutTime = parseInt(now);\n\t\t\tlet totalHours = (clockOutTime - clockInTime) / 3600;\n\n\t\t\t// Deduct lunch time if lunch was taken\n\t\t\tif (activeShift.lunch_duration_minutes && activeShift.lunch_duration_minutes > 0) {\n\t\t\t\ttotalHours -= activeShift.lunch_duration_minutes / 60;\n\t\t\t}\n\n\t\t\tconsole.log(\"Clocking out - Total hours:\", totalHours);\n\n\t\t\tconst updateData = {\n\t\t\t\t...activeShift,\n\t\t\t\tclock_out_timestamp: now,\n\t\t\t\ttotal_hours: totalHours,\n\t\t\t\tlocation: location || activeShift.location || undefined,\n\t\t\t\twork_description: workDescription || activeShift.work_description || undefined,\n\t\t\t};\n\n\t\t\t// Normalize before saving\n\t\t\tconst normalizedUpdate = normalizeTimeCardEntryForSave(updateData as TimeCardEntryModel);\n\n\t\t\tawait timeCardORM.setTimeCardEntryById(activeShift.id, normalizedUpdate as TimeCardEntryModel);\n\n\t\t\tconsole.log(\"Clock out successful!\");\n\t\t\tsetLocation(\"\");\n\t\t\tsetWorkDescription(\"\");\n\t\t\tawait loadTimeCards();\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Error clocking out:\", error);\n\t\t\talert(\"Error clocking out. Please try again.\");\n\t\t}\n\t};\n\n\tconst handleStartLunch = async () => {\n\t\tif (!activeShift) return;\n\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tconst now = Math.floor(Date.now() / 1000).toString();\n\n\t\tconst updateData = {\n\t\t\t...activeShift,\n\t\t\tlunch_start_timestamp: now,\n\t\t\tlocation: location || activeShift.location || undefined,\n\t\t\twork_description: workDescription || activeShift.work_description || undefined,\n\t\t};\n\n\t\tconst normalizedUpdate = normalizeTimeCardEntryForSave(updateData as TimeCardEntryModel);\n\t\tawait timeCardORM.setTimeCardEntryById(activeShift.id, normalizedUpdate as TimeCardEntryModel);\n\n\t\tawait loadTimeCards();\n\t};\n\n\tconst handleEndLunch = async () => {\n\t\tif (!activeShift || !activeShift.lunch_start_timestamp) return;\n\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tconst now = Math.floor(Date.now() / 1000).toString();\n\n\t\t// Handle case where lunch_start_timestamp might be the string \"null\"\n\t\tlet lunchStartTime: number;\n\t\tif (typeof activeShift.lunch_start_timestamp === 'string' && activeShift.lunch_start_timestamp !== 'null') {\n\t\t\tlunchStartTime = parseInt(activeShift.lunch_start_timestamp);\n\t\t} else {\n\t\t\treturn;\n\t\t}\n\n\t\tconst lunchEndTime = parseInt(now);\n\t\tconst lunchDurationMinutes = (lunchEndTime - lunchStartTime) / 60;\n\n\t\t// Add to existing lunch duration if there was already one\n\t\tconst totalLunchMinutes = (activeShift.lunch_duration_minutes && activeShift.lunch_duration_minutes > 0 ? activeShift.lunch_duration_minutes : 0) + lunchDurationMinutes;\n\n\t\tconst updateData = {\n\t\t\t...activeShift,\n\t\t\tlunch_end_timestamp: now,\n\t\t\tlunch_duration_minutes: totalLunchMinutes,\n\t\t};\n\n\t\tconst normalizedUpdate = normalizeTimeCardEntryForSave(updateData as TimeCardEntryModel);\n\t\tawait timeCardORM.setTimeCardEntryById(activeShift.id, normalizedUpdate as TimeCardEntryModel);\n\n\t\tawait loadTimeCards();\n\t};\n\n\tconst formatTime = (ms: number) => {\n\t\tconst seconds = Math.floor(ms / 1000);\n\t\tconst hours = Math.floor(seconds / 3600);\n\t\tconst minutes = Math.floor((seconds % 3600) / 60);\n\t\tconst secs = seconds % 60;\n\t\treturn `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\n\t};\n\n\tconst formatDate = (timestamp: string) => {\n\t\tconst date = new Date(parseInt(timestamp) * 1000);\n\t\treturn date.toLocaleString(language === 'es' ? 'es-ES' : 'en-US');\n\t};\n\n\tconst formatHours = (hours: number | null | undefined) => {\n\t\tif (hours === null || hours === undefined) return \"—\";\n\t\treturn `${hours.toFixed(2)} ${language === 'es' ? 'hrs' : 'hrs'}`;\n\t};\n\n\tconst formatMinutes = (minutes: number | null | undefined) => {\n\t\tif (minutes === null || minutes === undefined) return \"—\";\n\t\treturn `${Math.round(minutes)} min`;\n\t};\n\n\treturn (\n\t\t<div className=\"space-y-6\">\n\t\t\t<SickDayCard user={user} language={language} />\n\t\t\t<Card>\n\t\t\t\t<CardHeader>\n\t\t\t\t\t<CardTitle className=\"flex items-center gap-2\">\n\t\t\t\t\t\t<Clock className=\"w-5 h-5\" />\n\t\t\t\t\t\t{t.clockInOut}\n\t\t\t\t\t</CardTitle>\n\t\t\t\t\t<CardDescription>\n\t\t\t\t\t\t{activeShift ? \"✅ You are currently clocked in - Clock out button is below\" : \"❌ Not clocked in - Click CLOCK IN button to start\"}\n\t\t\t\t\t</CardDescription>\n\t\t\t\t</CardHeader>\n\t\t\t\t<CardContent className=\"space-y-6\">\n\t\t\t\t\t{/* Show current status */}\n\t\t\t\t\t<div className={`p-6 rounded-lg border-2 ${activeShift ? 'bg-green-50 border-green-300 dark:bg-green-900/20 dark:border-green-700' : 'bg-blue-50 border-blue-300 dark:bg-blue-900/20 dark:border-blue-700'}`}>\n\t\t\t\t\t\t<div className=\"flex items-center justify-between mb-4\">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<p className={`text-2xl font-bold ${activeShift ? 'text-green-700' : 'text-blue-700'}`}>\n\t\t\t\t\t\t\t\t\t{activeShift ? '🟢 CLOCKED IN' : '⚪ NOT CLOCKED IN'}\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t{!activeShift && (\n\t\t\t\t\t\t\t\t\t<p className=\"text-sm text-blue-600 dark:text-blue-400 mt-2 font-semibold\">\n\t\t\t\t\t\t\t\t\t\t👇 Fill out the form below and click \"CLOCK IN\"\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t{activeShift && (\n\t\t\t\t\t\t\t\t\t<p className=\"text-sm text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\tStarted: {formatDate(activeShift.clock_in_timestamp)}\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t{isOnLunch && (\n\t\t\t\t\t\t\t\t\t<p className=\"text-sm text-orange-600 font-semibold mt-1\">\n\t\t\t\t\t\t\t\t\t\t☕ On Lunch Break\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{activeShift && !isOnLunch && (\n\t\t\t\t\t\t\t\t<div className=\"text-right\">\n\t\t\t\t\t\t\t\t\t<p className=\"text-3xl font-mono font-bold tabular-nums\">\n\t\t\t\t\t\t\t\t\t\t{formatTime(elapsedTime)}\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t<p className=\"text-xs text-muted-foreground\">Time Elapsed</p>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Main Action Buttons */}\n\t\t\t\t\t{activeShift ? (\n\t\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t\t{/* Clock Out Button - ALWAYS VISIBLE when clocked in */}\n\t\t\t\t\t\t\t<div className=\"bg-red-50 dark:bg-red-950 p-4 rounded-lg border-2 border-red-300 dark:border-red-700\">\n\t\t\t\t\t\t\t\t<p className=\"text-center text-sm font-bold text-red-700 dark:text-red-300 mb-3\">\n\t\t\t\t\t\t\t\t\t⬇️ CLICK HERE TO END YOUR SHIFT ⬇️\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tonClick={handleClockOut}\n\t\t\t\t\t\t\t\t\tvariant=\"destructive\"\n\t\t\t\t\t\t\t\t\tsize=\"lg\"\n\t\t\t\t\t\t\t\t\tclassName=\"w-full h-20 text-2xl font-black shadow-lg hover:shadow-xl transition-all\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<Clock className=\"w-8 h-8 mr-3\" />\n\t\t\t\t\t\t\t\t\tCLOCK OUT\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t{/* Lunch Buttons */}\n\t\t\t\t\t\t\t<div className=\"border-t pt-4\">\n\t\t\t\t\t\t\t\t<p className=\"text-sm text-muted-foreground mb-3\">Lunch Break (Optional)</p>\n\t\t\t\t\t\t\t\t{isOnLunch ? (\n\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\tonClick={handleEndLunch}\n\t\t\t\t\t\t\t\t\t\tclassName=\"w-full h-12\"\n\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<Coffee className=\"w-5 h-5 mr-2\" />\n\t\t\t\t\t\t\t\t\t\tEnd Lunch Break\n\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\tonClick={handleStartLunch}\n\t\t\t\t\t\t\t\t\t\tclassName=\"w-full h-12\"\n\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<Coffee className=\"w-5 h-5 mr-2\" />\n\t\t\t\t\t\t\t\t\t\tStart Lunch Break\n\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t{/* Location and Description */}\n\t\t\t\t\t\t\t<div className=\"border-t pt-4 space-y-4\">\n\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t<Label>{t.location}</Label>\n\t\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\t\tvalue={location}\n\t\t\t\t\t\t\t\t\t\tonChange={(e) => setLocation(e.target.value)}\n\t\t\t\t\t\t\t\t\t\tplaceholder={t.locationPlaceholder}\n\t\t\t\t\t\t\t\t\t\tclassName=\"mt-2\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t<Label>{t.workDescription}</Label>\n\t\t\t\t\t\t\t\t\t<Textarea\n\t\t\t\t\t\t\t\t\t\tvalue={workDescription}\n\t\t\t\t\t\t\t\t\t\tonChange={(e) => setWorkDescription(e.target.value)}\n\t\t\t\t\t\t\t\t\t\tplaceholder={t.descriptionPlaceholder}\n\t\t\t\t\t\t\t\t\t\trows={3}\n\t\t\t\t\t\t\t\t\t\tclassName=\"mt-2\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t\t{/* Clock In Form */}\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<Label>{t.location}</Label>\n\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\tvalue={location}\n\t\t\t\t\t\t\t\t\tonChange={(e) => setLocation(e.target.value)}\n\t\t\t\t\t\t\t\t\tplaceholder={t.locationPlaceholder}\n\t\t\t\t\t\t\t\t\tclassName=\"mt-2\"\n\t\t\t\t\t\t\t\t\tdisabled={isLoading}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<Label>{t.workDescription}</Label>\n\t\t\t\t\t\t\t\t<Textarea\n\t\t\t\t\t\t\t\t\tvalue={workDescription}\n\t\t\t\t\t\t\t\t\tonChange={(e) => setWorkDescription(e.target.value)}\n\t\t\t\t\t\t\t\t\tplaceholder={t.descriptionPlaceholder}\n\t\t\t\t\t\t\t\t\trows={3}\n\t\t\t\t\t\t\t\t\tclassName=\"mt-2\"\n\t\t\t\t\t\t\t\t\tdisabled={isLoading}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tonClick={handleClockIn}\n\t\t\t\t\t\t\t\tsize=\"lg\"\n\t\t\t\t\t\t\t\tdisabled={isLoading}\n\t\t\t\t\t\t\t\tclassName=\"w-full h-16 text-xl font-bold bg-green-600 hover:bg-green-700 disabled:opacity-50\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Clock className=\"w-6 h-6 mr-2\" />\n\t\t\t\t\t\t\t\t{isLoading ? \"CLOCKING IN...\" : \"CLOCK IN\"}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t{isLoading && (\n\t\t\t\t\t\t\t\t<p className=\"text-center text-sm text-muted-foreground animate-pulse\">\n\t\t\t\t\t\t\t\t\tPlease wait, processing...\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</CardContent>\n\t\t\t</Card>\n\n\t\t\t<Card>\n\t\t\t\t<CardHeader>\n\t\t\t\t\t<CardTitle className=\"flex items-center gap-2\">\n\t\t\t\t\t\t<CalendarDays className=\"w-5 h-5\" />\n\t\t\t\t\t\t{t.timeCardHistory}\n\t\t\t\t\t</CardTitle>\n\t\t\t\t\t<CardDescription>{t.recentRecords}</CardDescription>\n\t\t\t\t</CardHeader>\n\t\t\t\t<CardContent>\n\t\t\t\t\t{timeCards.length === 0 ? (\n\t\t\t\t\t\t<p className=\"text-center text-muted-foreground py-8\">{t.noTimeCards}</p>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<div className=\"overflow-x-auto\">\n\t\t\t\t\t\t\t<Table>\n\t\t\t\t\t\t\t\t<TableHeader>\n\t\t\t\t\t\t\t\t\t<TableRow>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.clockInTime}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.clockOutTime}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.location}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.workDescription}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.lunchDuration}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.hours}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.status}</TableHead>\n\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t</TableHeader>\n\t\t\t\t\t\t\t\t<TableBody>\n\t\t\t\t\t\t\t\t\t{timeCards.map((tc) => (\n\t\t\t\t\t\t\t\t\t\t<TableRow key={tc.id}>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatDate(tc.clock_in_timestamp)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t{tc.clock_out_timestamp ? formatDate(tc.clock_out_timestamp) : \"—\"}\n\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell>{tc.location || \"—\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"max-w-xs truncate\">{tc.work_description || \"—\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatMinutes(tc.lunch_duration_minutes)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatHours(tc.total_hours)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t{tc.clock_out_timestamp ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge variant=\"secondary\">{t.completed}</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t) : tc.lunch_start_timestamp && !tc.lunch_end_timestamp ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge className=\"bg-orange-500\">{t.onLunchBreak}</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge className=\"bg-green-500\">{t.active}</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</TableBody>\n\t\t\t\t\t\t\t</Table>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</CardContent>\n\t\t\t</Card>\n\t\t</div>\n\t);\n}\n\nfunction ManagerView({ user, users, language, onUsersChange }: { user: UserModel; users: UserModel[]; language: Language; onUsersChange: () => void }) {\n\tconst [activeTab, setActiveTab] = useState(\"timecards\");\n\n\tconst t = translations[language];\n\n\treturn (\n\t\t<Tabs value={activeTab} onValueChange={setActiveTab}>\n\t\t\t<TabsList className=\"grid w-full grid-cols-4\">\n\t\t\t\t<TabsTrigger value=\"timecards\">\n\t\t\t\t\t<Clock className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t{t.timeCards}\n\t\t\t\t</TabsTrigger>\n\t\t\t\t<TabsTrigger value=\"sickdays\">\n\t\t\t\t\t<Heart className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t{t.sickDays}\n\t\t\t\t</TabsTrigger>\n\t\t\t\t<TabsTrigger value=\"reports\">\n\t\t\t\t\t<FileText className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t{t.reports}\n\t\t\t\t</TabsTrigger>\n\t\t\t\t<TabsTrigger value=\"employees\">\n\t\t\t\t\t<Users className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t{t.employees}\n\t\t\t\t</TabsTrigger>\n\t\t\t</TabsList>\n\n\t\t\t<TabsContent value=\"timecards\" className=\"space-y-4\">\n\t\t\t\t<TimeCardsTab users={users} language={language} />\n\t\t\t</TabsContent>\n\n\t\t\t<TabsContent value=\"sickdays\" className=\"space-y-4\">\n\t\t\t\t<SickDaysTab users={users} language={language} />\n\t\t\t</TabsContent>\n\n\t\t\t<TabsContent value=\"reports\" className=\"space-y-4\">\n\t\t\t\t<ReportsTab users={users} language={language} />\n\t\t\t</TabsContent>\n\n\t\t\t<TabsContent value=\"employees\" className=\"space-y-4\">\n\t\t\t\t<EmployeesTab users={users} language={language} onUsersChange={onUsersChange} />\n\t\t\t</TabsContent>\n\t\t</Tabs>\n\t);\n}\n\nfunction TimeCardsTab({ users, language }: { users: UserModel[]; language: Language }) {\n\tconst [allTimeCards, setAllTimeCards] = useState<TimeCardEntryModel[]>([]);\n\tconst [filteredCards, setFilteredCards] = useState<TimeCardEntryModel[]>([]);\n\tconst [selectedEmployee, setSelectedEmployee] = useState<string>(\"all\");\n\tconst [dateFilter, setDateFilter] = useState<string>(\"\");\n\tconst [editingCard, setEditingCard] = useState<TimeCardEntryModel | null>(null);\n\tconst [editClockIn, setEditClockIn] = useState(\"\");\n\tconst [editClockOut, setEditClockOut] = useState(\"\");\n\tconst [editLocation, setEditLocation] = useState(\"\");\n\tconst [editWorkDescription, setEditWorkDescription] = useState(\"\");\n\tconst [editLunchStart, setEditLunchStart] = useState(\"\");\n\tconst [editLunchEnd, setEditLunchEnd] = useState(\"\");\n\tconst [showManualEntry, setShowManualEntry] = useState(false);\n\tconst [manualEntryUserId, setManualEntryUserId] = useState<string>(\"\");\n\n\tconst t = translations[language];\n\n\tuseEffect(() => {\n\t\tloadAllTimeCards();\n\t}, []);\n\n\tuseEffect(() => {\n\t\tapplyFilters();\n\t}, [allTimeCards, selectedEmployee, dateFilter]);\n\n\tconst loadAllTimeCards = async () => {\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tconst allCards = await timeCardORM.getAllTimeCardEntry();\n\n\t\t// Normalize data from ORM\n\t\tconst normalized = normalizeTimeCardEntriesFromORM(allCards);\n\n\t\t// Sort by clock in time (newest first)\n\t\tconst sorted = normalized.sort((a, b) =>\n\t\t\tparseInt(b.clock_in_timestamp) - parseInt(a.clock_in_timestamp)\n\t\t);\n\n\t\tsetAllTimeCards(sorted);\n\t};\n\n\tconst applyFilters = () => {\n\t\tlet filtered = [...allTimeCards];\n\n\t\t// Filter by employee\n\t\tif (selectedEmployee !== \"all\") {\n\t\t\tfiltered = filtered.filter(tc => tc.user_id === selectedEmployee);\n\t\t}\n\n\t\t// Filter by date\n\t\tif (dateFilter) {\n\t\t\tconst filterDate = new Date(dateFilter);\n\t\t\tconst filterTimestamp = Math.floor(filterDate.getTime() / 1000);\n\t\t\tconst nextDayTimestamp = filterTimestamp + 86400; // +24 hours\n\n\t\t\tfiltered = filtered.filter(tc => {\n\t\t\t\tconst clockIn = parseInt(tc.clock_in_timestamp);\n\t\t\t\treturn clockIn >= filterTimestamp && clockIn < nextDayTimestamp;\n\t\t\t});\n\t\t}\n\n\t\tsetFilteredCards(filtered);\n\t};\n\n\tconst getUserName = (userId: string) => {\n\t\tconst user = users.find(u => u.id === userId);\n\t\treturn user?.name || \"Unknown\";\n\t};\n\n\tconst formatDate = (timestamp: string) => {\n\t\tconst date = new Date(parseInt(timestamp) * 1000);\n\t\treturn date.toLocaleString(language === 'es' ? 'es-ES' : 'en-US');\n\t};\n\n\tconst formatHours = (hours: number | null | undefined) => {\n\t\tif (hours === null || hours === undefined) return \"—\";\n\t\treturn `${hours.toFixed(2)} ${language === 'es' ? 'hrs' : 'hrs'}`;\n\t};\n\n\tconst formatMinutes = (minutes: number | null | undefined) => {\n\t\tif (minutes === null || minutes === undefined) return \"—\";\n\t\treturn `${Math.round(minutes)} min`;\n\t};\n\n\tconst calculateTotalHours = (period: 'day' | 'week') => {\n\t\tconst now = Date.now() / 1000;\n\t\tconst periodSeconds = period === 'day' ? 86400 : 604800; // 1 day or 7 days\n\t\tconst startTime = now - periodSeconds;\n\n\t\tconst relevantCards = allTimeCards.filter(tc => {\n\t\t\tconst clockIn = parseInt(tc.clock_in_timestamp);\n\t\t\treturn clockIn >= startTime && tc.total_hours;\n\t\t});\n\n\t\treturn relevantCards.reduce((sum, tc) => sum + (tc.total_hours || 0), 0);\n\t};\n\n\tconst handleEditCard = (card: TimeCardEntryModel) => {\n\t\tsetEditingCard(card);\n\n\t\t// Helper function to safely convert timestamp to ISO string\n\t\tconst safeTimestampToISO = (timestamp: string | null | undefined): string => {\n\t\t\tif (!timestamp) return \"\";\n\t\t\tconst parsed = parseInt(timestamp);\n\t\t\tif (isNaN(parsed) || parsed <= 0) return \"\";\n\t\t\tconst date = new Date(parsed * 1000);\n\t\t\tif (isNaN(date.getTime())) return \"\";\n\t\t\treturn date.toISOString().slice(0, 16);\n\t\t};\n\n\t\tsetEditClockIn(safeTimestampToISO(card.clock_in_timestamp) || new Date().toISOString().slice(0, 16));\n\t\tsetEditClockOut(safeTimestampToISO(card.clock_out_timestamp));\n\t\tsetEditLocation(card.location || \"\");\n\t\tsetEditWorkDescription(card.work_description || \"\");\n\t\tsetEditLunchStart(safeTimestampToISO(card.lunch_start_timestamp));\n\t\tsetEditLunchEnd(safeTimestampToISO(card.lunch_end_timestamp));\n\t};\n\n\tconst handleSaveEdit = async () => {\n\t\tif (!editingCard) return;\n\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tconst clockInTimestamp = Math.floor(new Date(editClockIn).getTime() / 1000).toString();\n\t\tconst clockOutTimestamp = editClockOut\n\t\t\t? Math.floor(new Date(editClockOut).getTime() / 1000).toString()\n\t\t\t: undefined;\n\t\tconst lunchStartTimestamp = editLunchStart\n\t\t\t? Math.floor(new Date(editLunchStart).getTime() / 1000).toString()\n\t\t\t: undefined;\n\t\tconst lunchEndTimestamp = editLunchEnd\n\t\t\t? Math.floor(new Date(editLunchEnd).getTime() / 1000).toString()\n\t\t\t: undefined;\n\n\t\tlet totalHours: number | undefined = undefined;\n\t\tlet lunchDurationMinutes: number | undefined = undefined;\n\n\t\t// Calculate lunch duration\n\t\tif (lunchStartTimestamp && lunchEndTimestamp) {\n\t\t\tconst lunchStart = parseInt(lunchStartTimestamp);\n\t\t\tconst lunchEnd = parseInt(lunchEndTimestamp);\n\t\t\tlunchDurationMinutes = (lunchEnd - lunchStart) / 60;\n\t\t}\n\n\t\t// Calculate total hours\n\t\tif (clockOutTimestamp) {\n\t\t\tconst clockInTime = parseInt(clockInTimestamp);\n\t\t\tconst clockOutTime = parseInt(clockOutTimestamp);\n\t\t\ttotalHours = (clockOutTime - clockInTime) / 3600;\n\n\t\t\t// Deduct lunch time\n\t\t\tif (lunchDurationMinutes) {\n\t\t\t\ttotalHours -= lunchDurationMinutes / 60;\n\t\t\t}\n\t\t}\n\n\t\tconst updateData = {\n\t\t\t...editingCard,\n\t\t\tclock_in_timestamp: clockInTimestamp,\n\t\t\tclock_out_timestamp: clockOutTimestamp,\n\t\t\ttotal_hours: totalHours,\n\t\t\tlocation: editLocation || undefined,\n\t\t\twork_description: editWorkDescription || undefined,\n\t\t\tlunch_start_timestamp: lunchStartTimestamp,\n\t\t\tlunch_end_timestamp: lunchEndTimestamp,\n\t\t\tlunch_duration_minutes: lunchDurationMinutes,\n\t\t};\n\n\t\tconst normalizedUpdate = normalizeTimeCardEntryForSave(updateData as TimeCardEntryModel);\n\t\tawait timeCardORM.setTimeCardEntryById(editingCard.id, normalizedUpdate as TimeCardEntryModel);\n\n\t\tsetEditingCard(null);\n\t\tawait loadAllTimeCards();\n\t};\n\n\tconst handleDeleteTimeCard = async (card: TimeCardEntryModel) => {\n\t\tif (!window.confirm(t.confirmDeleteTimeCard)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tawait timeCardORM.deleteTimeCardEntryById(card.id);\n\t\tawait loadAllTimeCards();\n\t};\n\n\tconst handleAddManualEntry = (userId: string) => {\n\t\tsetManualEntryUserId(userId);\n\t\tsetShowManualEntry(true);\n\t};\n\n\treturn (\n\t\t<>\n\t\t\t<div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n\t\t\t\t<Card>\n\t\t\t\t\t<CardHeader className=\"pb-3\">\n\t\t\t\t\t\t<CardTitle className=\"text-sm font-medium flex items-center gap-2\">\n\t\t\t\t\t\t\t<Users className=\"w-4 h-4\" />\n\t\t\t\t\t\t\t{t.totalEmployees}\n\t\t\t\t\t\t</CardTitle>\n\t\t\t\t\t</CardHeader>\n\t\t\t\t\t<CardContent>\n\t\t\t\t\t\t<div className=\"text-2xl font-bold\">{users.filter(u => u.role === UserRole.Employee).length}</div>\n\t\t\t\t\t</CardContent>\n\t\t\t\t</Card>\n\n\t\t\t\t<Card>\n\t\t\t\t\t<CardHeader className=\"pb-3\">\n\t\t\t\t\t\t<CardTitle className=\"text-sm font-medium flex items-center gap-2\">\n\t\t\t\t\t\t\t<Timer className=\"w-4 h-4\" />\n\t\t\t\t\t\t\t{t.hoursToday}\n\t\t\t\t\t\t</CardTitle>\n\t\t\t\t\t</CardHeader>\n\t\t\t\t\t<CardContent>\n\t\t\t\t\t\t<div className=\"text-2xl font-bold\">{calculateTotalHours('day').toFixed(2)}</div>\n\t\t\t\t\t</CardContent>\n\t\t\t\t</Card>\n\n\t\t\t\t<Card>\n\t\t\t\t\t<CardHeader className=\"pb-3\">\n\t\t\t\t\t\t<CardTitle className=\"text-sm font-medium flex items-center gap-2\">\n\t\t\t\t\t\t\t<CalendarDays className=\"w-4 h-4\" />\n\t\t\t\t\t\t\t{t.hoursThisWeek}\n\t\t\t\t\t\t</CardTitle>\n\t\t\t\t\t</CardHeader>\n\t\t\t\t\t<CardContent>\n\t\t\t\t\t\t<div className=\"text-2xl font-bold\">{calculateTotalHours('week').toFixed(2)}</div>\n\t\t\t\t\t</CardContent>\n\t\t\t\t</Card>\n\t\t\t</div>\n\n\t\t\t<Card>\n\t\t\t\t<CardHeader>\n\t\t\t\t\t<div className=\"flex justify-between items-center\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<CardTitle>{t.allEmployeeTimeCards}</CardTitle>\n\t\t\t\t\t\t\t<CardDescription>{t.viewManageRecords}</CardDescription>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<Button onClick={() => handleAddManualEntry(\"\")} variant=\"outline\" size=\"sm\">\n\t\t\t\t\t\t\t<Plus className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t\t\t{t.addTimeCard}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t</CardHeader>\n\t\t\t\t<CardContent className=\"space-y-4\">\n\t\t\t\t\t<div className=\"flex gap-4 flex-wrap\">\n\t\t\t\t\t\t<div className=\"flex-1 min-w-[200px]\">\n\t\t\t\t\t\t\t<Label>{t.filterByEmployee}</Label>\n\t\t\t\t\t\t\t<Select value={selectedEmployee} onValueChange={setSelectedEmployee}>\n\t\t\t\t\t\t\t\t<SelectTrigger>\n\t\t\t\t\t\t\t\t\t<SelectValue />\n\t\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t\t<SelectItem value=\"all\">{t.allEmployees}</SelectItem>\n\t\t\t\t\t\t\t\t\t{users.filter(u => u.role === UserRole.Employee).map((u) => (\n\t\t\t\t\t\t\t\t\t\t<SelectItem key={u.id} value={u.id}>\n\t\t\t\t\t\t\t\t\t\t\t{u.name}\n\t\t\t\t\t\t\t\t\t\t</SelectItem>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t\t</Select>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div className=\"flex-1 min-w-[200px]\">\n\t\t\t\t\t\t\t<Label>{t.filterByDate}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"date\"\n\t\t\t\t\t\t\t\tvalue={dateFilter}\n\t\t\t\t\t\t\t\tonChange={(e) => setDateFilter(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t{(selectedEmployee !== \"all\" || dateFilter) && (\n\t\t\t\t\t\t\t<div className=\"flex items-end\">\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\t\t\tsetSelectedEmployee(\"all\");\n\t\t\t\t\t\t\t\t\t\tsetDateFilter(\"\");\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{t.clearFilters}\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{filteredCards.length === 0 ? (\n\t\t\t\t\t\t<p className=\"text-center text-muted-foreground py-8\">{t.noTimeCardsFound}</p>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<div className=\"overflow-x-auto\">\n\t\t\t\t\t\t\t<Table>\n\t\t\t\t\t\t\t\t<TableHeader>\n\t\t\t\t\t\t\t\t\t<TableRow>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.employeeName}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.clockInTime}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.clockOutTime}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.location}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.workDescription}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.lunchDuration}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.hours}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.status}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.actions}</TableHead>\n\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t</TableHeader>\n\t\t\t\t\t\t\t\t<TableBody>\n\t\t\t\t\t\t\t\t\t{filteredCards.map((tc) => (\n\t\t\t\t\t\t\t\t\t\t<TableRow key={tc.id}>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"font-medium whitespace-nowrap\">{getUserName(tc.user_id)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatDate(tc.clock_in_timestamp)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t{tc.clock_out_timestamp ? formatDate(tc.clock_out_timestamp) : \"—\"}\n\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell>{tc.location || \"—\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"max-w-xs truncate\">{tc.work_description || \"—\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatMinutes(tc.lunch_duration_minutes)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatHours(tc.total_hours)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t{tc.clock_out_timestamp ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge variant=\"secondary\">{t.completed}</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t) : tc.lunch_start_timestamp && !tc.lunch_end_timestamp ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge className=\"bg-orange-500\">{t.onLunchBreak}</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge className=\"bg-green-500\">{t.active}</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => handleEditCard(tc)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{t.edit}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => handleDeleteTimeCard(tc)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"text-red-600 hover:text-red-700 hover:bg-red-50\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Trash2 className=\"w-4 h-4\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</TableBody>\n\t\t\t\t\t\t\t</Table>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</CardContent>\n\t\t\t</Card>\n\n\t\t\t<Dialog open={!!editingCard} onOpenChange={(open) => !open && setEditingCard(null)}>\n\t\t\t\t<DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n\t\t\t\t\t<DialogHeader>\n\t\t\t\t\t\t<DialogTitle>{t.editTimeCard}</DialogTitle>\n\t\t\t\t\t</DialogHeader>\n\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.employeeName}</Label>\n\t\t\t\t\t\t\t<Input value={editingCard ? getUserName(editingCard.user_id) : \"\"} disabled />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"grid grid-cols-2 gap-4\">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<Label>{t.clockInTime}</Label>\n\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\t\tvalue={editClockIn}\n\t\t\t\t\t\t\t\t\tonChange={(e) => setEditClockIn(e.target.value)}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<Label>{t.clockOutTime}</Label>\n\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\t\tvalue={editClockOut}\n\t\t\t\t\t\t\t\t\tonChange={(e) => setEditClockOut(e.target.value)}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.location}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\tvalue={editLocation}\n\t\t\t\t\t\t\t\tonChange={(e) => setEditLocation(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder={t.locationPlaceholder}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.workDescription}</Label>\n\t\t\t\t\t\t\t<Textarea\n\t\t\t\t\t\t\t\tvalue={editWorkDescription}\n\t\t\t\t\t\t\t\tonChange={(e) => setEditWorkDescription(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder={t.descriptionPlaceholder}\n\t\t\t\t\t\t\t\trows={4}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"grid grid-cols-2 gap-4\">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<Label>{t.lunchStartTime}</Label>\n\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\t\tvalue={editLunchStart}\n\t\t\t\t\t\t\t\t\tonChange={(e) => setEditLunchStart(e.target.value)}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<Label>{t.lunchEndTime}</Label>\n\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\t\tvalue={editLunchEnd}\n\t\t\t\t\t\t\t\t\tonChange={(e) => setEditLunchEnd(e.target.value)}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<DialogFooter>\n\t\t\t\t\t\t<Button variant=\"outline\" onClick={() => setEditingCard(null)}>\n\t\t\t\t\t\t\t{t.cancel}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button onClick={handleSaveEdit}>\n\t\t\t\t\t\t\t{t.saveChanges}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</DialogFooter>\n\t\t\t\t</DialogContent>\n\t\t\t</Dialog>\n\n\t\t\t<ManualEntryDialog\n\t\t\t\topen={showManualEntry}\n\t\t\t\tonClose={() => setShowManualEntry(false)}\n\t\t\t\tuserId={manualEntryUserId}\n\t\t\t\tonSave={loadAllTimeCards}\n\t\t\t\tlanguage={language}\n\t\t\t\tusers={users}\n\t\t\t/>\n\t\t</>\n\t);\n}\n\nfunction SickDaysTab({ users, language }: { users: UserModel[]; language: Language }) {\n\tconst [allSickDays, setAllSickDays] = useState<SickDayModel[]>([]);\n\tconst [filteredSickDays, setFilteredSickDays] = useState<SickDayModel[]>([]);\n\tconst [selectedEmployee, setSelectedEmployee] = useState<string>(\"all\");\n\tconst [dateFilter, setDateFilter] = useState<string>(\"\");\n\n\tconst t = translations[language];\n\n\tuseEffect(() => {\n\t\tloadAllSickDays();\n\t}, []);\n\n\tuseEffect(() => {\n\t\tapplyFilters();\n\t}, [allSickDays, selectedEmployee, dateFilter]);\n\n\tconst loadAllSickDays = async () => {\n\t\tconst sickDayORM = SickDayORM.getInstance();\n\t\tconst allDays = await sickDayORM.getAllSickDay();\n\n\t\t// Sort by date (newest first)\n\t\tconst sorted = allDays.sort((a, b) =>\n\t\t\tnew Date(b.sick_date).getTime() - new Date(a.sick_date).getTime()\n\t\t);\n\n\t\tsetAllSickDays(sorted);\n\t};\n\n\tconst applyFilters = () => {\n\t\tlet filtered = [...allSickDays];\n\n\t\t// Filter by employee\n\t\tif (selectedEmployee !== \"all\") {\n\t\t\tfiltered = filtered.filter(sd => sd.user_id === selectedEmployee);\n\t\t}\n\n\t\t// Filter by date\n\t\tif (dateFilter) {\n\t\t\tfiltered = filtered.filter(sd => sd.sick_date === dateFilter);\n\t\t}\n\n\t\tsetFilteredSickDays(filtered);\n\t};\n\n\tconst getUserName = (userId: string) => {\n\t\tconst user = users.find(u => u.id === userId);\n\t\treturn user?.name || \"Unknown\";\n\t};\n\n\tconst formatDate = (dateStr: string) => {\n\t\tconst date = new Date(dateStr);\n\t\treturn date.toLocaleDateString(language === 'es' ? 'es-ES' : 'en-US', {\n\t\t\tyear: 'numeric',\n\t\t\tmonth: 'long',\n\t\t\tday: 'numeric'\n\t\t});\n\t};\n\n\tconst handleDeleteSickDay = async (sickDay: SickDayModel) => {\n\t\tif (!window.confirm(t.confirmDeleteSickDay)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst sickDayORM = SickDayORM.getInstance();\n\t\tawait sickDayORM.deleteSickDayById(sickDay.id);\n\t\tawait loadAllSickDays();\n\t};\n\n\tconst calculateTotalSickHours = () => {\n\t\treturn filteredSickDays.reduce((sum, sd) => sum + sd.hours, 0);\n\t};\n\n\treturn (\n\t\t<Card>\n\t\t\t<CardHeader>\n\t\t\t\t<div className=\"flex justify-between items-center\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<CardTitle className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t<Heart className=\"w-5 h-5 text-red-500\" />\n\t\t\t\t\t\t\t{t.sickDayHistory}\n\t\t\t\t\t\t</CardTitle>\n\t\t\t\t\t\t<CardDescription>\n\t\t\t\t\t\t\t{t.totalSickDays}: {calculateTotalSickHours().toFixed(1)} {language === 'es' ? 'hrs' : 'hrs'}\n\t\t\t\t\t\t</CardDescription>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</CardHeader>\n\t\t\t<CardContent className=\"space-y-4\">\n\t\t\t\t<div className=\"flex gap-4 flex-wrap\">\n\t\t\t\t\t<div className=\"flex-1 min-w-[200px]\">\n\t\t\t\t\t\t<Label>{t.filterByEmployee}</Label>\n\t\t\t\t\t\t<Select value={selectedEmployee} onValueChange={setSelectedEmployee}>\n\t\t\t\t\t\t\t<SelectTrigger>\n\t\t\t\t\t\t\t\t<SelectValue />\n\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t<SelectItem value=\"all\">{t.allEmployees}</SelectItem>\n\t\t\t\t\t\t\t\t{users.filter(u => u.role === UserRole.Employee).map((u) => (\n\t\t\t\t\t\t\t\t\t<SelectItem key={u.id} value={u.id}>\n\t\t\t\t\t\t\t\t\t\t{u.name}\n\t\t\t\t\t\t\t\t\t</SelectItem>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t</Select>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div className=\"flex-1 min-w-[200px]\">\n\t\t\t\t\t\t<Label>{t.filterByDate}</Label>\n\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\ttype=\"date\"\n\t\t\t\t\t\t\tvalue={dateFilter}\n\t\t\t\t\t\t\tonChange={(e) => setDateFilter(e.target.value)}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{(selectedEmployee !== \"all\" || dateFilter) && (\n\t\t\t\t\t\t<div className=\"flex items-end\">\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\t\tsetSelectedEmployee(\"all\");\n\t\t\t\t\t\t\t\t\tsetDateFilter(\"\");\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{t.clearFilters}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\n\t\t\t\t{filteredSickDays.length === 0 ? (\n\t\t\t\t\t<p className=\"text-center text-muted-foreground py-8\">{t.noSickDays}</p>\n\t\t\t\t) : (\n\t\t\t\t\t<div className=\"overflow-x-auto\">\n\t\t\t\t\t\t<Table>\n\t\t\t\t\t\t\t<TableHeader>\n\t\t\t\t\t\t\t\t<TableRow>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.employeeName}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.sickDayDate}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.sickDayHours}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.sickDayNotes}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.actions}</TableHead>\n\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t</TableHeader>\n\t\t\t\t\t\t\t<TableBody>\n\t\t\t\t\t\t\t\t{filteredSickDays.map((sd) => (\n\t\t\t\t\t\t\t\t\t<TableRow key={sd.id}>\n\t\t\t\t\t\t\t\t\t\t<TableCell className=\"font-medium whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t{getUserName(sd.user_id)}\n\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t{formatDate(sd.sick_date)}\n\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell>{sd.hours} hrs</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell className=\"max-w-xs truncate\">{sd.notes || \"—\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => handleDeleteSickDay(sd)}\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"text-red-600 hover:text-red-700 hover:bg-red-50\"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<Trash2 className=\"w-4 h-4\" />\n\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</TableBody>\n\t\t\t\t\t\t</Table>\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\t\t\t</CardContent>\n\t\t</Card>\n\t);\n}\n\nfunction ReportsTab({ users, language }: { users: UserModel[]; language: Language }) {\n\tconst [weekStart, setWeekStart] = useState(\"\");\n\tconst [reportData, setReportData] = useState<{ user: UserModel; regularHours: number; overtimeHours: number; totalHours: number; regularPay: number; overtimePay: number; totalPay: number }[]>([]);\n\tconst [detailedTimeCards, setDetailedTimeCards] = useState<TimeCardEntryModel[]>([]);\n\n\tconst t = translations[language];\n\n\tuseEffect(() => {\n\t\t// Set default to current week\n\t\tconst today = new Date();\n\t\tconst monday = new Date(today);\n\t\tmonday.setDate(today.getDate() - today.getDay() + 1);\n\t\tsetWeekStart(monday.toISOString().slice(0, 10));\n\t}, []);\n\n\tuseEffect(() => {\n\t\tif (weekStart) {\n\t\t\tloadWeeklyReport();\n\t\t}\n\t}, [weekStart, users]);\n\n\tconst loadWeeklyReport = async () => {\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tconst allCards = await timeCardORM.getAllTimeCardEntry();\n\n\t\t// Normalize data from ORM\n\t\tconst normalized = normalizeTimeCardEntriesFromORM(allCards);\n\n\t\tconst weekStartDate = new Date(weekStart);\n\t\tconst weekStartTimestamp = Math.floor(weekStartDate.getTime() / 1000);\n\t\tconst weekEndTimestamp = weekStartTimestamp + 604800; // 7 days\n\n\t\tconst weekCards = normalized.filter(tc => {\n\t\t\tconst clockIn = parseInt(tc.clock_in_timestamp);\n\t\t\treturn clockIn >= weekStartTimestamp && clockIn < weekEndTimestamp && tc.total_hours;\n\t\t});\n\n\t\t// Store detailed time cards\n\t\tsetDetailedTimeCards(weekCards.sort((a, b) => parseInt(a.clock_in_timestamp) - parseInt(b.clock_in_timestamp)));\n\n\t\tconst employeeHours = users\n\t\t\t.filter(u => u.role === UserRole.Employee)\n\t\t\t.map(user => {\n\t\t\t\tconst userCards = weekCards.filter(tc => tc.user_id === user.id);\n\t\t\t\tconst totalHours = userCards.reduce((sum, tc) => sum + (tc.total_hours || 0), 0);\n\t\t\t\tconst regularHours = Math.min(totalHours, 40);\n\t\t\t\tconst overtimeHours = Math.max(totalHours - 40, 0);\n\n\t\t\t\t// Calculate pay\n\t\t\t\tconst hourlyRate = user.hourly_rate || 0;\n\t\t\t\tconst regularPay = regularHours * hourlyRate;\n\t\t\t\tconst overtimePay = overtimeHours * hourlyRate * 1.5;\n\t\t\t\tconst totalPay = regularPay + overtimePay;\n\n\t\t\t\treturn {\n\t\t\t\t\tuser,\n\t\t\t\t\tregularHours,\n\t\t\t\t\tovertimeHours,\n\t\t\t\t\ttotalHours,\n\t\t\t\t\tregularPay,\n\t\t\t\t\tovertimePay,\n\t\t\t\t\ttotalPay,\n\t\t\t\t};\n\t\t\t});\n\n\t\tsetReportData(employeeHours);\n\t};\n\n\tconst formatHours = (hours: number) => {\n\t\treturn `${hours.toFixed(2)} hrs`;\n\t};\n\n\tconst formatPay = (amount: number) => {\n\t\treturn `$${amount.toFixed(2)}`;\n\t};\n\n\tconst formatDate = (timestamp: string) => {\n\t\tconst date = new Date(parseInt(timestamp) * 1000);\n\t\treturn date.toLocaleString(language === 'es' ? 'es-ES' : 'en-US');\n\t};\n\n\tconst formatDateOnly = (timestamp: string) => {\n\t\tconst date = new Date(parseInt(timestamp) * 1000);\n\t\treturn date.toLocaleDateString(language === 'es' ? 'es-ES' : 'en-US');\n\t};\n\n\tconst getDayOfWeek = (timestamp: string) => {\n\t\tconst date = new Date(parseInt(timestamp) * 1000);\n\t\treturn date.toLocaleDateString(language === 'es' ? 'es-ES' : 'en-US', { weekday: 'long' });\n\t};\n\n\tconst getUserName = (userId: string) => {\n\t\tconst user = users.find(u => u.id === userId);\n\t\treturn user?.name || \"Unknown\";\n\t};\n\n\tconst handlePrint = () => {\n\t\twindow.print();\n\t};\n\n\tconst handleExportCSV = () => {\n\t\tif (detailedTimeCards.length === 0) return;\n\n\t\t// Create CSV header\n\t\tconst headers = [\n\t\t\tt.employeeName,\n\t\t\tt.date,\n\t\t\tt.day,\n\t\t\tt.clockInTime,\n\t\t\tt.clockOutTime,\n\t\t\tt.location,\n\t\t\tt.workDescription,\n\t\t\tt.lunchDuration,\n\t\t\tt.hours,\n\t\t\tt.hourlyRate,\n\t\t\tt.pay\n\t\t];\n\n\t\t// Create CSV rows\n\t\tconst rows = detailedTimeCards.map(tc => {\n\t\t\tconst user = users.find(u => u.id === tc.user_id);\n\t\t\tconst userName = user?.name || \"Unknown\";\n\t\t\tconst hourlyRate = user?.hourly_rate || 0;\n\t\t\tconst date = formatDateOnly(tc.clock_in_timestamp);\n\t\t\tconst day = getDayOfWeek(tc.clock_in_timestamp);\n\t\t\tconst clockIn = formatDate(tc.clock_in_timestamp);\n\t\t\tconst clockOut = tc.clock_out_timestamp ? formatDate(tc.clock_out_timestamp) : \"—\";\n\t\t\tconst location = tc.location || \"—\";\n\t\t\tconst workDescription = (tc.work_description || \"—\").replace(/\"/g, '\"\"'); // Escape quotes\n\t\t\tconst lunchDuration = tc.lunch_duration_minutes ? `${Math.round(tc.lunch_duration_minutes)} min` : \"—\";\n\t\t\tconst hours = tc.total_hours ? `${tc.total_hours.toFixed(2)} hrs` : \"—\";\n\t\t\tconst pay = tc.total_hours ? formatPay(tc.total_hours * hourlyRate) : \"—\";\n\n\t\t\treturn [\n\t\t\t\t`\"${userName}\"`,\n\t\t\t\t`\"${date}\"`,\n\t\t\t\t`\"${day}\"`,\n\t\t\t\t`\"${clockIn}\"`,\n\t\t\t\t`\"${clockOut}\"`,\n\t\t\t\t`\"${location}\"`,\n\t\t\t\t`\"${workDescription}\"`,\n\t\t\t\t`\"${lunchDuration}\"`,\n\t\t\t\t`\"${hours}\"`,\n\t\t\t\t`\"${formatPay(hourlyRate)}\"`,\n\t\t\t\t`\"${pay}\"`\n\t\t\t].join(',');\n\t\t});\n\n\t\t// Combine header and rows\n\t\tconst csv = [headers.join(','), ...rows].join('\\n');\n\n\t\t// Create blob and download\n\t\tconst blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });\n\t\tconst link = document.createElement('a');\n\t\tconst url = URL.createObjectURL(blob);\n\t\tlink.setAttribute('href', url);\n\t\tlink.setAttribute('download', `weekly-report-${weekStart}.csv`);\n\t\tlink.style.visibility = 'hidden';\n\t\tdocument.body.appendChild(link);\n\t\tlink.click();\n\t\tdocument.body.removeChild(link);\n\t};\n\n\treturn (\n\t\t<div className=\"space-y-4\">\n\t\t\t<Card>\n\t\t\t\t<CardHeader>\n\t\t\t\t\t<div className=\"flex justify-between items-center\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<CardTitle>{t.weeklyReport}</CardTitle>\n\t\t\t\t\t\t\t<CardDescription>\n\t\t\t\t\t\t\t\tOvertime calculated for hours worked beyond 40 hours/week\n\t\t\t\t\t\t\t\t<br />\n\t\t\t\t\t\t\t\t<span className=\"text-xs text-muted-foreground\">\n\t\t\t\t\t\t\t\t\tNote: Sick days are tracked separately in the \"Sick Days\" tab and are NOT included in this time card report.\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</CardDescription>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"flex gap-2 print:hidden\">\n\t\t\t\t\t\t\t<Button onClick={handleExportCSV} variant=\"outline\" disabled={detailedTimeCards.length === 0}>\n\t\t\t\t\t\t\t\t<FileText className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t\t\t\t{t.exportCSV}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t<Button onClick={handlePrint} variant=\"outline\" disabled={detailedTimeCards.length === 0}>\n\t\t\t\t\t\t\t\t<FileText className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t\t\t\t{t.printReport}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</CardHeader>\n\t\t\t\t<CardContent className=\"space-y-4\">\n\t\t\t\t\t<div className=\"max-w-xs print:hidden\">\n\t\t\t\t\t\t<Label>{t.selectWeek}</Label>\n\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\ttype=\"date\"\n\t\t\t\t\t\t\tvalue={weekStart}\n\t\t\t\t\t\t\tonChange={(e) => setWeekStart(e.target.value)}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{reportData.length === 0 ? (\n\t\t\t\t\t\t<p className=\"text-center text-muted-foreground py-8\">{t.noReportData}</p>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t{/* Summary Table */}\n\t\t\t\t\t\t\t<div className=\"overflow-x-auto\">\n\t\t\t\t\t\t\t\t<Table>\n\t\t\t\t\t\t\t\t\t<TableHeader>\n\t\t\t\t\t\t\t\t\t\t<TableRow>\n\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.employeeName}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.regularHours}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.overtimeHours}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.totalHours}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.regularPay}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.overtimePay}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.totalPay}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t<TableHead className=\"print:hidden\">{t.status}</TableHead>\n\t\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t\t</TableHeader>\n\t\t\t\t\t\t\t\t\t<TableBody>\n\t\t\t\t\t\t\t\t\t\t{reportData.map(({ user, regularHours, overtimeHours, totalHours, regularPay, overtimePay, totalPay }) => (\n\t\t\t\t\t\t\t\t\t\t\t<TableRow key={user.id}>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"font-medium\">{user.name}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableCell>{formatHours(regularHours)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{overtimeHours > 0 ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-orange-600 font-semibold\">{formatHours(overtimeHours)}</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tformatHours(0)\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"font-semibold\">{formatHours(totalHours)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableCell>{formatPay(regularPay)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{overtimePay > 0 ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-orange-600 font-semibold\">{formatPay(overtimePay)}</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tformatPay(0)\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"font-semibold\">{formatPay(totalPay)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"print:hidden\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{overtimeHours > 0 && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge className=\"bg-orange-500\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<AlertCircle className=\"w-3 h-3 mr-1\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{t.overtimeAlert}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t\t</TableBody>\n\t\t\t\t\t\t\t\t</Table>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t{/* Detailed Time Cards Table */}\n\t\t\t\t\t\t\t<div className=\"mt-8\">\n\t\t\t\t\t\t\t\t<h3 className=\"text-lg font-semibold mb-4\">{t.detailedReport}</h3>\n\t\t\t\t\t\t\t\t<div className=\"overflow-x-auto\">\n\t\t\t\t\t\t\t\t\t<Table className=\"print-table-responsive\">\n\t\t\t\t\t\t\t\t\t\t<TableHeader>\n\t\t\t\t\t\t\t\t\t\t\t<TableRow>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.employeeName}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.date}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.day}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.clockInTime}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.clockOutTime}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.location}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.workDescription}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.lunchDuration}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.hours}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.hourlyRate}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.pay}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t\t\t</TableHeader>\n\t\t\t\t\t\t\t\t\t\t<TableBody className=\"print-table-responsive\">\n\t\t\t\t\t\t\t\t\t\t\t{detailedTimeCards.map((tc) => {\n\t\t\t\t\t\t\t\t\t\t\t\tconst user = users.find(u => u.id === tc.user_id);\n\t\t\t\t\t\t\t\t\t\t\t\tconst hourlyRate = user?.hourly_rate || 0;\n\t\t\t\t\t\t\t\t\t\t\t\tconst pay = tc.total_hours ? tc.total_hours * hourlyRate : 0;\n\n\t\t\t\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<TableRow key={tc.id}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"font-medium whitespace-nowrap\">{user?.name || \"Unknown\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatDateOnly(tc.clock_in_timestamp)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{getDayOfWeek(tc.clock_in_timestamp)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatDate(tc.clock_in_timestamp)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{tc.clock_out_timestamp ? formatDate(tc.clock_out_timestamp) : \"—\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell>{tc.location || \"—\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"allow-wrap max-w-xs\">{tc.work_description || \"—\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{tc.lunch_duration_minutes ? `${Math.round(tc.lunch_duration_minutes)} min` : \"—\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{tc.total_hours ? `${tc.total_hours.toFixed(2)} hrs` : \"—\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{formatPay(hourlyRate)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{formatPay(pay)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t\t\t\t</TableBody>\n\t\t\t\t\t\t\t\t\t</Table>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</>\n\t\t\t\t\t)}\n\t\t\t\t</CardContent>\n\t\t\t</Card>\n\t\t</div>\n\t);\n}\n\nfunction EmployeesTab({ users, language, onUsersChange }: { users: UserModel[]; language: Language; onUsersChange: () => void }) {\n\tconst [showAddEmployee, setShowAddEmployee] = useState(false);\n\tconst [editingEmployee, setEditingEmployee] = useState<UserModel | null>(null);\n\tconst [employeeName, setEmployeeName] = useState(\"\");\n\tconst [employeeEmail, setEmployeeEmail] = useState(\"\");\n\tconst [employeePhone, setEmployeePhone] = useState(\"\");\n\tconst [employeeRole, setEmployeeRole] = useState<UserRole>(UserRole.Employee);\n\tconst [employeeHourlyRate, setEmployeeHourlyRate] = useState(\"\");\n\tconst [deleteConfirm, setDeleteConfirm] = useState<UserModel | null>(null);\n\n\tconst t = translations[language];\n\n\tconst handleAddEmployee = async () => {\n\t\tconst userORM = UserORM.getInstance();\n\t\tawait userORM.insertUser([{\n\t\t\tname: employeeName,\n\t\t\temail: employeeEmail,\n\t\t\tphone: employeePhone || null,\n\t\t\trole: employeeRole,\n\t\t\thourly_rate: employeeHourlyRate ? parseFloat(employeeHourlyRate) : null,\n\t\t} as UserModel]);\n\n\t\tsetShowAddEmployee(false);\n\t\tsetEmployeeName(\"\");\n\t\tsetEmployeeEmail(\"\");\n\t\tsetEmployeePhone(\"\");\n\t\tsetEmployeeRole(UserRole.Employee);\n\t\tsetEmployeeHourlyRate(\"\");\n\t\tonUsersChange();\n\t};\n\n\tconst handleEditEmployee = async () => {\n\t\tif (!editingEmployee) return;\n\n\t\tconst userORM = UserORM.getInstance();\n\t\tawait userORM.setUserById(editingEmployee.id, {\n\t\t\t...editingEmployee,\n\t\t\tname: employeeName,\n\t\t\temail: employeeEmail,\n\t\t\tphone: employeePhone || null,\n\t\t\trole: employeeRole,\n\t\t\thourly_rate: employeeHourlyRate ? parseFloat(employeeHourlyRate) : null,\n\t\t});\n\n\t\tsetEditingEmployee(null);\n\t\tsetEmployeeName(\"\");\n\t\tsetEmployeeEmail(\"\");\n\t\tsetEmployeePhone(\"\");\n\t\tsetEmployeeRole(UserRole.Employee);\n\t\tsetEmployeeHourlyRate(\"\");\n\t\tonUsersChange();\n\t};\n\n\tconst handleDeleteEmployee = async (user: UserModel) => {\n\t\tconst userORM = UserORM.getInstance();\n\t\tawait userORM.deleteUserById(user.id);\n\t\tsetDeleteConfirm(null);\n\t\tonUsersChange();\n\t};\n\n\tconst openEditDialog = (user: UserModel) => {\n\t\tsetEditingEmployee(user);\n\t\tsetEmployeeName(user.name);\n\t\tsetEmployeeEmail(user.email);\n\t\tsetEmployeePhone(user.phone || \"\");\n\t\tsetEmployeeRole(user.role);\n\t\tsetEmployeeHourlyRate(user.hourly_rate ? user.hourly_rate.toString() : \"\");\n\t};\n\n\treturn (\n\t\t<div className=\"space-y-4\">\n\t\t\t<Card>\n\t\t\t\t<CardHeader>\n\t\t\t\t\t<div className=\"flex justify-between items-center\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<CardTitle>{t.employees}</CardTitle>\n\t\t\t\t\t\t\t<CardDescription>Manage employee accounts</CardDescription>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<Button onClick={() => setShowAddEmployee(true)}>\n\t\t\t\t\t\t\t<UserPlus className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t\t\t{t.addEmployee}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t</CardHeader>\n\t\t\t\t<CardContent>\n\t\t\t\t\t<div className=\"overflow-x-auto\">\n\t\t\t\t\t\t<Table>\n\t\t\t\t\t\t\t<TableHeader>\n\t\t\t\t\t\t\t\t<TableRow>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.name}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.email}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.phone}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.role}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.hourlyRate}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.actions}</TableHead>\n\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t</TableHeader>\n\t\t\t\t\t\t\t<TableBody>\n\t\t\t\t\t\t\t\t{users.map((user) => (\n\t\t\t\t\t\t\t\t\t<TableRow key={user.id}>\n\t\t\t\t\t\t\t\t\t\t<TableCell className=\"font-medium\">{user.name}</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell>{user.email}</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell>{user.phone || \"—\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<Badge variant={user.role === UserRole.Manager ? \"default\" : \"secondary\"}>\n\t\t\t\t\t\t\t\t\t\t\t\t{user.role === UserRole.Manager ? t.manager : t.employee}\n\t\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t{user.hourly_rate ? `$${user.hourly_rate.toFixed(2)}/hr` : \"—\"}\n\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => openEditDialog(user)}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{t.edit}\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"destructive\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => setDeleteConfirm(user)}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{t.delete}\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</TableBody>\n\t\t\t\t\t\t</Table>\n\t\t\t\t\t</div>\n\t\t\t\t</CardContent>\n\t\t\t</Card>\n\n\t\t\t<Dialog open={showAddEmployee} onOpenChange={setShowAddEmployee}>\n\t\t\t\t<DialogContent>\n\t\t\t\t\t<DialogHeader>\n\t\t\t\t\t\t<DialogTitle>{t.addEmployee}</DialogTitle>\n\t\t\t\t\t</DialogHeader>\n\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.name}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\tvalue={employeeName}\n\t\t\t\t\t\t\t\tonChange={(e) => setEmployeeName(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder=\"John Doe\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.email}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"email\"\n\t\t\t\t\t\t\t\tvalue={employeeEmail}\n\t\t\t\t\t\t\t\tonChange={(e) => setEmployeeEmail(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder=\"john@example.com\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.phone}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"tel\"\n\t\t\t\t\t\t\t\tvalue={employeePhone}\n\t\t\t\t\t\t\t\tonChange={(e) => setEmployeePhone(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder=\"+1 (555) 123-4567\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.role}</Label>\n\t\t\t\t\t\t\t<Select value={employeeRole.toString()} onValueChange={(v) => setEmployeeRole(parseInt(v))}>\n\t\t\t\t\t\t\t\t<SelectTrigger>\n\t\t\t\t\t\t\t\t\t<SelectValue />\n\t\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t\t<SelectItem value={UserRole.Employee.toString()}>{t.employee}</SelectItem>\n\t\t\t\t\t\t\t\t\t<SelectItem value={UserRole.Manager.toString()}>{t.manager}</SelectItem>\n\t\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t\t</Select>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.hourlyRate}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\tmin=\"0\"\n\t\t\t\t\t\t\t\tstep=\"0.01\"\n\t\t\t\t\t\t\t\tvalue={employeeHourlyRate}\n\t\t\t\t\t\t\t\tonChange={(e) => setEmployeeHourlyRate(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder=\"15.00\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<DialogFooter>\n\t\t\t\t\t\t<Button variant=\"outline\" onClick={() => setShowAddEmployee(false)}>\n\t\t\t\t\t\t\t{t.cancel}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button onClick={handleAddEmployee} disabled={!employeeName || !employeeEmail}>\n\t\t\t\t\t\t\t{t.saveChanges}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</DialogFooter>\n\t\t\t\t</DialogContent>\n\t\t\t</Dialog>\n\n\t\t\t<Dialog open={!!editingEmployee} onOpenChange={(open) => !open && setEditingEmployee(null)}>\n\t\t\t\t<DialogContent>\n\t\t\t\t\t<DialogHeader>\n\t\t\t\t\t\t<DialogTitle>{t.editEmployee}</DialogTitle>\n\t\t\t\t\t</DialogHeader>\n\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.name}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\tvalue={employeeName}\n\t\t\t\t\t\t\t\tonChange={(e) => setEmployeeName(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.email}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"email\"\n\t\t\t\t\t\t\t\tvalue={employeeEmail}\n\t\t\t\t\t\t\t\tonChange={(e) => setEmployeeEmail(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.phone}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"tel\"\n\t\t\t\t\t\t\t\tvalue={employeePhone}\n\t\t\t\t\t\t\t\tonChange={(e) => setEmployeePhone(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder=\"+1 (555) 123-4567\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.role}</Label>\n\t\t\t\t\t\t\t<Select value={employeeRole.toString()} onValueChange={(v) => setEmployeeRole(parseInt(v))}>\n\t\t\t\t\t\t\t\t<SelectTrigger>\n\t\t\t\t\t\t\t\t\t<SelectValue />\n\t\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t\t<SelectItem value={UserRole.Employee.toString()}>{t.employee}</SelectItem>\n\t\t\t\t\t\t\t\t\t<SelectItem value={UserRole.Manager.toString()}>{t.manager}</SelectItem>\n\t\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t\t</Select>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.hourlyRate}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\tmin=\"0\"\n\t\t\t\t\t\t\t\tstep=\"0.01\"\n\t\t\t\t\t\t\t\tvalue={employeeHourlyRate}\n\t\t\t\t\t\t\t\tonChange={(e) => setEmployeeHourlyRate(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder=\"15.00\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<DialogFooter>\n\t\t\t\t\t\t<Button variant=\"outline\" onClick={() => setEditingEmployee(null)}>\n\t\t\t\t\t\t\t{t.cancel}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button onClick={handleEditEmployee}>\n\t\t\t\t\t\t\t{t.saveChanges}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</DialogFooter>\n\t\t\t\t</DialogContent>\n\t\t\t</Dialog>\n\n\t\t\t<Dialog open={!!deleteConfirm} onOpenChange={(open) => !open && setDeleteConfirm(null)}>\n\t\t\t\t<DialogContent>\n\t\t\t\t\t<DialogHeader>\n\t\t\t\t\t\t<DialogTitle>{t.deleteEmployee}</DialogTitle>\n\t\t\t\t\t</DialogHeader>\n\t\t\t\t\t<p>{t.confirmDelete}</p>\n\t\t\t\t\t<p className=\"font-semibold\">{deleteConfirm?.name}</p>\n\t\t\t\t\t<DialogFooter>\n\t\t\t\t\t\t<Button variant=\"outline\" onClick={() => setDeleteConfirm(null)}>\n\t\t\t\t\t\t\t{t.cancel}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button variant=\"destructive\" onClick={() => deleteConfirm && handleDeleteEmployee(deleteConfirm)}>\n\t\t\t\t\t\t\t{t.delete}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</DialogFooter>\n\t\t\t\t</DialogContent>\n\t\t\t</Dialog>\n\t\t</div>\n\t);\n}\n\nfunction ManualEntryDialog({\n\topen,\n\tonClose,\n\tuserId,\n\tonSave,\n\tlanguage,\n\tusers\n}: {\n\topen: boolean;\n\tonClose: () => void;\n\tuserId: string;\n\tonSave: () => void;\n\tlanguage: Language;\n\tusers?: UserModel[];\n}) {\n\tconst [selectedUser, setSelectedUser] = useState(userId);\n\tconst [clockIn, setClockIn] = useState(\"\");\n\tconst [clockOut, setClockOut] = useState(\"\");\n\tconst [location, setLocation] = useState(\"\");\n\tconst [workDescription, setWorkDescription] = useState(\"\");\n\tconst [lunchStart, setLunchStart] = useState(\"\");\n\tconst [lunchEnd, setLunchEnd] = useState(\"\");\n\n\tconst t = translations[language];\n\n\tuseEffect(() => {\n\t\tif (open) {\n\t\t\tsetSelectedUser(userId);\n\t\t\t// Set default to today\n\t\t\tconst now = new Date();\n\t\t\tconst today = now.toISOString().slice(0, 10);\n\t\t\tsetClockIn(`${today}T09:00`);\n\t\t\tsetClockOut(`${today}T17:00`);\n\t\t\tsetLocation(\"\");\n\t\t\tsetWorkDescription(\"\");\n\t\t\tsetLunchStart(`${today}T12:00`);\n\t\t\tsetLunchEnd(`${today}T13:00`);\n\t\t}\n\t}, [open, userId]);\n\n\tconst handleSave = async () => {\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\n\t\tconst clockInTimestamp = Math.floor(new Date(clockIn).getTime() / 1000).toString();\n\t\tconst clockOutTimestamp = clockOut ? Math.floor(new Date(clockOut).getTime() / 1000).toString() : undefined;\n\t\tconst lunchStartTimestamp = lunchStart ? Math.floor(new Date(lunchStart).getTime() / 1000).toString() : undefined;\n\t\tconst lunchEndTimestamp = lunchEnd ? Math.floor(new Date(lunchEnd).getTime() / 1000).toString() : undefined;\n\n\t\tlet totalHours: number | undefined = undefined;\n\t\tlet lunchDurationMinutes: number | undefined = undefined;\n\n\t\t// Calculate lunch duration\n\t\tif (lunchStartTimestamp && lunchEndTimestamp) {\n\t\t\tconst lunchStartTime = parseInt(lunchStartTimestamp);\n\t\t\tconst lunchEndTime = parseInt(lunchEndTimestamp);\n\t\t\tlunchDurationMinutes = (lunchEndTime - lunchStartTime) / 60;\n\t\t}\n\n\t\t// Calculate total hours\n\t\tif (clockOutTimestamp) {\n\t\t\tconst clockInTime = parseInt(clockInTimestamp);\n\t\t\tconst clockOutTime = parseInt(clockOutTimestamp);\n\t\t\ttotalHours = (clockOutTime - clockInTime) / 3600;\n\n\t\t\t// Deduct lunch time\n\t\t\tif (lunchDurationMinutes) {\n\t\t\t\ttotalHours -= lunchDurationMinutes / 60;\n\t\t\t}\n\t\t}\n\n\t\tconst entryData = {\n\t\t\tuser_id: selectedUser,\n\t\t\tclock_in_timestamp: clockInTimestamp,\n\t\t\tclock_out_timestamp: clockOutTimestamp,\n\t\t\ttotal_hours: totalHours,\n\t\t\tlocation: location || undefined,\n\t\t\twork_description: workDescription || undefined,\n\t\t\tlunch_start_timestamp: lunchStartTimestamp,\n\t\t\tlunch_end_timestamp: lunchEndTimestamp,\n\t\t\tlunch_duration_minutes: lunchDurationMinutes,\n\t\t} as TimeCardEntryModel;\n\n\t\tconst normalizedEntry = normalizeTimeCardEntryForSave(entryData);\n\t\tawait timeCardORM.insertTimeCardEntry([normalizedEntry as TimeCardEntryModel]);\n\n\t\tonSave();\n\t\tonClose();\n\t};\n\n\treturn (\n\t\t<Dialog open={open} onOpenChange={onClose}>\n\t\t\t<DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n\t\t\t\t<DialogHeader>\n\t\t\t\t\t<DialogTitle>{t.addManualEntry}</DialogTitle>\n\t\t\t\t</DialogHeader>\n\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t{users && (\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.employeeName}</Label>\n\t\t\t\t\t\t\t<Select value={selectedUser} onValueChange={setSelectedUser}>\n\t\t\t\t\t\t\t\t<SelectTrigger>\n\t\t\t\t\t\t\t\t\t<SelectValue />\n\t\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t\t{users.filter(u => u.role === UserRole.Employee).map((u) => (\n\t\t\t\t\t\t\t\t\t\t<SelectItem key={u.id} value={u.id}>\n\t\t\t\t\t\t\t\t\t\t\t{u.name}\n\t\t\t\t\t\t\t\t\t\t</SelectItem>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t\t</Select>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t\t<div className=\"grid grid-cols-2 gap-4\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.clockInTime}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\tvalue={clockIn}\n\t\t\t\t\t\t\t\tonChange={(e) => setClockIn(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.clockOutTime}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\tvalue={clockOut}\n\t\t\t\t\t\t\t\tonChange={(e) => setClockOut(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<Label>{t.location}</Label>\n\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\tvalue={location}\n\t\t\t\t\t\t\tonChange={(e) => setLocation(e.target.value)}\n\t\t\t\t\t\t\tplaceholder={t.locationPlaceholder}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<Label>{t.workDescription}</Label>\n\t\t\t\t\t\t<Textarea\n\t\t\t\t\t\t\tvalue={workDescription}\n\t\t\t\t\t\t\tonChange={(e) => setWorkDescription(e.target.value)}\n\t\t\t\t\t\t\tplaceholder={t.descriptionPlaceholder}\n\t\t\t\t\t\t\trows={4}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"grid grid-cols-2 gap-4\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.lunchStartTime} ({language === 'en' ? 'Optional' : 'Opcional'})</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\tvalue={lunchStart}\n\t\t\t\t\t\t\t\tonChange={(e) => setLunchStart(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.lunchEndTime} ({language === 'en' ? 'Optional' : 'Opcional'})</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\tvalue={lunchEnd}\n\t\t\t\t\t\t\t\tonChange={(e) => setLunchEnd(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<DialogFooter>\n\t\t\t\t\t<Button variant=\"outline\" onClick={onClose}>\n\t\t\t\t\t\t{t.cancel}\n\t\t\t\t\t</Button>\n\t\t\t\t\t<Button onClick={handleSave} disabled={!selectedUser || !clockIn}>\n\t\t\t\t\t\t{t.saveChanges}\n\t\t\t\t\t</Button>\n\t\t\t\t</DialogFooter>\n\t\t\t</DialogContent>\n\t\t</Dialog>\n\t);\n}\n","structuredPatch":[{"oldStart":124,"oldLines":6,"newStart":124,"newLines":10,"lines":["     totalPay: \"Total Pay\",","     regularPay: \"Regular Pay\",","     overtimePay: \"Overtime Pay\",","+    copyEmployeeLink: \"Copy Employee Link\",","+    employeeLinkCopied: \"Employee link copied!\",","+    myTimeTracking: \"My Time Tracking\",","+    myHours: \"My Hours\",","   },","   es: {","     appTitle: \"Registro de Tiempo de Empleados\","]}],"userModified":false,"replaceAll":false}}
{"type":"assistant","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_vrtx_01E4yLCc5kWuX8HXnaZzQqC3","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_vrtx_01M3jTkFhJwJVPHFUBSMAxKT","name":"Edit","input":{"file_path":"/home/user/vite-template/src/routes/index.tsx","old_string":"\t\ttotalPay: \"Pago Total\",\n\t\tregularPay: \"Pago Regular\",\n\t\tovertimePay: \"Pago Tiempo Extra\",\n\t}","new_string":"\t\ttotalPay: \"Pago Total\",\n\t\tregularPay: \"Pago Regular\",\n\t\tovertimePay: \"Pago Tiempo Extra\",\n\t\tcopyEmployeeLink: \"Copiar Enlace de Empleado\",\n\t\temployeeLinkCopied: \"¡Enlace de empleado copiado!\",\n\t\tmyTimeTracking: \"Mi Registro de Tiempo\",\n\t\tmyHours: \"Mis Horas\",\n\t}"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":2,"cache_creation_input_tokens":700,"cache_read_input_tokens":47281,"cache_creation":{"ephemeral_5m_input_tokens":700,"ephemeral_1h_input_tokens":0},"output_tokens":256},"context_management":null},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"88b44003-cce7-4fdb-b9eb-7aae4bd3a743"}
{"type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_vrtx_01M3jTkFhJwJVPHFUBSMAxKT","type":"tool_result","content":"The file /home/user/vite-template/src/routes/index.tsx has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n   226→\t\tconfirmDeleteSickDay: \"¿Está seguro de eliminar este día de enfermedad? Esta acción no se puede deshacer.\",\n   227→\t\tsickDayHistory: \"Historial de Días de Enfermedad\",\n   228→\t\thourlyRate: \"Tarifa por Hora\",\n   229→\t\tpay: \"Pago\",\n   230→\t\ttotalPay: \"Pago Total\",\n   231→\t\tregularPay: \"Pago Regular\",\n   232→\t\tovertimePay: \"Pago Tiempo Extra\",\n   233→\t\tcopyEmployeeLink: \"Copiar Enlace de Empleado\",\n   234→\t\temployeeLinkCopied: \"¡Enlace de empleado copiado!\",\n   235→\t\tmyTimeTracking: \"Mi Registro de Tiempo\",\n   236→\t\tmyHours: \"Mis Horas\",\n   237→\t}\n   238→};\n   239→\n   240→function App() {\n   241→\tconst [currentUser, setCurrentUser] = useState<UserModel | null>(null);"}]},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"a6b43851-81e2-4558-94d6-88e5eb3a7061","tool_use_result":{"filePath":"/home/user/vite-template/src/routes/index.tsx","oldString":"\t\ttotalPay: \"Pago Total\",\n\t\tregularPay: \"Pago Regular\",\n\t\tovertimePay: \"Pago Tiempo Extra\",\n\t}","newString":"\t\ttotalPay: \"Pago Total\",\n\t\tregularPay: \"Pago Regular\",\n\t\tovertimePay: \"Pago Tiempo Extra\",\n\t\tcopyEmployeeLink: \"Copiar Enlace de Empleado\",\n\t\temployeeLinkCopied: \"¡Enlace de empleado copiado!\",\n\t\tmyTimeTracking: \"Mi Registro de Tiempo\",\n\t\tmyHours: \"Mis Horas\",\n\t}","originalFile":"import { createFileRoute } from \"@tanstack/react-router\";\nimport { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from \"@/components/ui/dialog\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Clock, Users, CalendarDays, Timer, Languages, Coffee, UserPlus, FileText, AlertCircle, Plus, Trash2, Heart } from \"lucide-react\";\nimport { UserORM, type UserModel, UserRole } from \"@/sdk/database/orm/orm_user\";\nimport { TimeCardEntryORM, type TimeCardEntryModel } from \"@/sdk/database/orm/orm_time_card_entry\";\nimport { SickDayORM, type SickDayModel } from \"@/sdk/database/orm/orm_sick_day\";\nimport { normalizeTimeCardEntryForSave, normalizeTimeCardEntriesFromORM, isActiveShift, isOnLunchBreak } from \"@/lib/orm-data-helpers\";\n\nexport const Route = createFileRoute(\"/\")({\n\tcomponent: App,\n});\n\ntype Language = 'en' | 'es';\n\nconst translations = {\n\ten: {\n\t\tappTitle: \"Employee Time Tracking\",\n\t\tselectAccount: \"Select your account to continue\",\n\t\tselectUser: \"Select User\",\n\t\tchooseAccount: \"Choose your account\",\n\t\tmanager: \"Manager\",\n\t\temployee: \"Employee\",\n\t\tswitchUser: \"Switch User\",\n\t\ttimeTrackingSystem: \"Time Tracking System\",\n\t\twelcome: \"Welcome\",\n\t\tclockInOut: \"Clock In/Out\",\n\t\tcurrentlyClocked: \"Currently Clocked In\",\n\t\tsince: \"Since\",\n\t\telapsedTime: \"Elapsed Time\",\n\t\tclockOut: \"Clock Out\",\n\t\tnotClocked: \"Not currently clocked in\",\n\t\tclockIn: \"Clock In\",\n\t\ttimeCardHistory: \"Time Card History\",\n\t\trecentRecords: \"Your recent clock in/out records\",\n\t\tnoTimeCards: \"No time cards yet\",\n\t\tclockInTime: \"Clock In\",\n\t\tclockOutTime: \"Clock Out\",\n\t\thours: \"Hours\",\n\t\tstatus: \"Status\",\n\t\tcompleted: \"Completed\",\n\t\tactive: \"Active\",\n\t\ttotalEmployees: \"Total Employees\",\n\t\thoursToday: \"Hours Today\",\n\t\thoursThisWeek: \"Hours This Week\",\n\t\tallEmployeeTimeCards: \"All Employee Time Cards\",\n\t\tviewManageRecords: \"View and manage all employee time records\",\n\t\tfilterByEmployee: \"Filter by Employee\",\n\t\tallEmployees: \"All Employees\",\n\t\tfilterByDate: \"Filter by Date\",\n\t\tclearFilters: \"Clear Filters\",\n\t\tnoTimeCardsFound: \"No time cards found\",\n\t\temployeeName: \"Employee\",\n\t\tactions: \"Actions\",\n\t\tedit: \"Edit\",\n\t\teditTimeCard: \"Edit Time Card\",\n\t\tcancel: \"Cancel\",\n\t\tsaveChanges: \"Save Changes\",\n\t\tlocation: \"Location\",\n\t\twhereWorked: \"Where did you work?\",\n\t\tworkDescription: \"Work Description\",\n\t\twhatDid: \"What did you do today?\",\n\t\tlocationPlaceholder: \"e.g., Office, Remote, Client Site\",\n\t\tdescriptionPlaceholder: \"Describe your work activities...\",\n\t\tstartLunch: \"Start Lunch Break\",\n\t\tendLunch: \"End Lunch Break\",\n\t\tonLunchBreak: \"On Lunch Break\",\n\t\tlunchBreak: \"Lunch Break\",\n\t\tlunchDuration: \"Lunch\",\n\t\tlunchStartTime: \"Lunch Start\",\n\t\tlunchEndTime: \"Lunch End\",\n\t\ttimeCards: \"Time Cards\",\n\t\treports: \"Reports\",\n\t\temployees: \"Employees\",\n\t\taddEmployee: \"Add Employee\",\n\t\teditEmployee: \"Edit Employee\",\n\t\tdeleteEmployee: \"Delete Employee\",\n\t\tname: \"Name\",\n\t\temail: \"Email\",\n\t\tphone: \"Phone\",\n\t\trole: \"Role\",\n\t\tdelete: \"Delete\",\n\t\tweeklyReport: \"Weekly Report\",\n\t\tselectWeek: \"Select Week\",\n\t\tregularHours: \"Regular\",\n\t\tovertimeHours: \"Overtime\",\n\t\ttotalHours: \"Total\",\n\t\tnoReportData: \"No data for selected week\",\n\t\taddTimeCard: \"Add Time Card\",\n\t\tmanualEntry: \"Manual Entry\",\n\t\taddManualEntry: \"Add Manual Time Card\",\n\t\tconfirmDelete: \"Are you sure you want to delete this employee?\",\n\t\tovertimeAlert: \"Overtime Alert\",\n\t\tprintReport: \"Print Report\",\n\t\texportCSV: \"Export to CSV\",\n\t\tdetailedReport: \"Detailed Time Card Report\",\n\t\tdate: \"Date\",\n\t\tday: \"Day\",\n\t\tdeleteTimeCard: \"Delete Time Card\",\n\t\tconfirmDeleteTimeCard: \"Are you sure you want to delete this time card? This action cannot be undone.\",\n\t\tsickDays: \"Sick Days\",\n\t\taddSickDay: \"Add Sick Day\",\n\t\tsickDayDate: \"Sick Day Date\",\n\t\tsickDayHours: \"Hours\",\n\t\tsickDayNotes: \"Notes/Reason\",\n\t\tsickDayNotesPlaceholder: \"e.g., Doctor's appointment, flu, etc.\",\n\t\tmySickDays: \"My Sick Days\",\n\t\tnoSickDays: \"No sick days recorded\",\n\t\ttotalSickDays: \"Total Sick Days\",\n\t\tdeleteSickDay: \"Delete Sick Day\",\n\t\tconfirmDeleteSickDay: \"Are you sure you want to delete this sick day? This action cannot be undone.\",\n\t\tsickDayHistory: \"Sick Day History\",\n\t\thourlyRate: \"Hourly Rate\",\n\t\tpay: \"Pay\",\n\t\ttotalPay: \"Total Pay\",\n\t\tregularPay: \"Regular Pay\",\n\t\tovertimePay: \"Overtime Pay\",\n\t\tcopyEmployeeLink: \"Copy Employee Link\",\n\t\temployeeLinkCopied: \"Employee link copied!\",\n\t\tmyTimeTracking: \"My Time Tracking\",\n\t\tmyHours: \"My Hours\",\n\t},\n\tes: {\n\t\tappTitle: \"Registro de Tiempo de Empleados\",\n\t\tselectAccount: \"Selecciona tu cuenta para continuar\",\n\t\tselectUser: \"Seleccionar Usuario\",\n\t\tchooseAccount: \"Elige tu cuenta\",\n\t\tmanager: \"Gerente\",\n\t\temployee: \"Empleado\",\n\t\tswitchUser: \"Cambiar Usuario\",\n\t\ttimeTrackingSystem: \"Sistema de Registro de Tiempo\",\n\t\twelcome: \"Bienvenido\",\n\t\tclockInOut: \"Entrada/Salida\",\n\t\tcurrentlyClocked: \"Actualmente Registrado\",\n\t\tsince: \"Desde\",\n\t\telapsedTime: \"Tiempo Transcurrido\",\n\t\tclockOut: \"Registrar Salida\",\n\t\tnotClocked: \"No está registrado actualmente\",\n\t\tclockIn: \"Registrar Entrada\",\n\t\ttimeCardHistory: \"Historial de Tarjetas de Tiempo\",\n\t\trecentRecords: \"Tus registros recientes de entrada/salida\",\n\t\tnoTimeCards: \"No hay tarjetas de tiempo todavía\",\n\t\tclockInTime: \"Entrada\",\n\t\tclockOutTime: \"Salida\",\n\t\thours: \"Horas\",\n\t\tstatus: \"Estado\",\n\t\tcompleted: \"Completado\",\n\t\tactive: \"Activo\",\n\t\ttotalEmployees: \"Total de Empleados\",\n\t\thoursToday: \"Horas Hoy\",\n\t\thoursThisWeek: \"Horas Esta Semana\",\n\t\tallEmployeeTimeCards: \"Todas las Tarjetas de Tiempo\",\n\t\tviewManageRecords: \"Ver y gestionar todos los registros de empleados\",\n\t\tfilterByEmployee: \"Filtrar por Empleado\",\n\t\tallEmployees: \"Todos los Empleados\",\n\t\tfilterByDate: \"Filtrar por Fecha\",\n\t\tclearFilters: \"Limpiar Filtros\",\n\t\tnoTimeCardsFound: \"No se encontraron tarjetas de tiempo\",\n\t\temployeeName: \"Empleado\",\n\t\tactions: \"Acciones\",\n\t\tedit: \"Editar\",\n\t\teditTimeCard: \"Editar Tarjeta de Tiempo\",\n\t\tcancel: \"Cancelar\",\n\t\tsaveChanges: \"Guardar Cambios\",\n\t\tlocation: \"Ubicación\",\n\t\twhereWorked: \"¿Dónde trabajaste?\",\n\t\tworkDescription: \"Descripción del Trabajo\",\n\t\twhatDid: \"¿Qué hiciste hoy?\",\n\t\tlocationPlaceholder: \"ej., Oficina, Remoto, Sitio del Cliente\",\n\t\tdescriptionPlaceholder: \"Describe tus actividades laborales...\",\n\t\tstartLunch: \"Iniciar Almuerzo\",\n\t\tendLunch: \"Terminar Almuerzo\",\n\t\tonLunchBreak: \"En Almuerzo\",\n\t\tlunchBreak: \"Almuerzo\",\n\t\tlunchDuration: \"Almuerzo\",\n\t\tlunchStartTime: \"Inicio Almuerzo\",\n\t\tlunchEndTime: \"Fin Almuerzo\",\n\t\ttimeCards: \"Tarjetas de Tiempo\",\n\t\treports: \"Informes\",\n\t\temployees: \"Empleados\",\n\t\taddEmployee: \"Agregar Empleado\",\n\t\teditEmployee: \"Editar Empleado\",\n\t\tdeleteEmployee: \"Eliminar Empleado\",\n\t\tname: \"Nombre\",\n\t\temail: \"Correo\",\n\t\tphone: \"Teléfono\",\n\t\trole: \"Rol\",\n\t\tdelete: \"Eliminar\",\n\t\tweeklyReport: \"Informe Semanal\",\n\t\tselectWeek: \"Seleccionar Semana\",\n\t\tregularHours: \"Regular\",\n\t\tovertimeHours: \"Tiempo Extra\",\n\t\ttotalHours: \"Total\",\n\t\tnoReportData: \"No hay datos para la semana seleccionada\",\n\t\taddTimeCard: \"Agregar Tarjeta\",\n\t\tmanualEntry: \"Entrada Manual\",\n\t\taddManualEntry: \"Agregar Tarjeta Manual\",\n\t\tconfirmDelete: \"¿Está seguro de eliminar este empleado?\",\n\t\tovertimeAlert: \"Alerta de Tiempo Extra\",\n\t\tprintReport: \"Imprimir Informe\",\n\t\texportCSV: \"Exportar a CSV\",\n\t\tdetailedReport: \"Informe Detallado de Tarjetas de Tiempo\",\n\t\tdate: \"Fecha\",\n\t\tday: \"Día\",\n\t\tdeleteTimeCard: \"Eliminar Tarjeta de Tiempo\",\n\t\tconfirmDeleteTimeCard: \"¿Está seguro de eliminar esta tarjeta de tiempo? Esta acción no se puede deshacer.\",\n\t\tsickDays: \"Días de Enfermedad\",\n\t\taddSickDay: \"Agregar Día de Enfermedad\",\n\t\tsickDayDate: \"Fecha de Enfermedad\",\n\t\tsickDayHours: \"Horas\",\n\t\tsickDayNotes: \"Notas/Razón\",\n\t\tsickDayNotesPlaceholder: \"ej., Cita médica, gripe, etc.\",\n\t\tmySickDays: \"Mis Días de Enfermedad\",\n\t\tnoSickDays: \"No hay días de enfermedad registrados\",\n\t\ttotalSickDays: \"Total Días de Enfermedad\",\n\t\tdeleteSickDay: \"Eliminar Día de Enfermedad\",\n\t\tconfirmDeleteSickDay: \"¿Está seguro de eliminar este día de enfermedad? Esta acción no se puede deshacer.\",\n\t\tsickDayHistory: \"Historial de Días de Enfermedad\",\n\t\thourlyRate: \"Tarifa por Hora\",\n\t\tpay: \"Pago\",\n\t\ttotalPay: \"Pago Total\",\n\t\tregularPay: \"Pago Regular\",\n\t\tovertimePay: \"Pago Tiempo Extra\",\n\t}\n};\n\nfunction App() {\n\tconst [currentUser, setCurrentUser] = useState<UserModel | null>(null);\n\tconst [users, setUsers] = useState<UserModel[]>([]);\n\tconst [showUserSelect, setShowUserSelect] = useState(true);\n\tconst [language, setLanguage] = useState<Language>('en');\n\tconst [employeeOnlyMode, setEmployeeOnlyMode] = useState(false);\n\n\tconst t = translations[language];\n\n\tuseEffect(() => {\n\t\tloadUsers();\n\t}, []);\n\n\t// Check for employee URL parameter and auto-login\n\tuseEffect(() => {\n\t\tif (users.length > 0 && !currentUser) {\n\t\t\tconst urlParams = new URLSearchParams(window.location.search);\n\t\t\tconst employeeId = urlParams.get('employee');\n\n\t\t\tif (employeeId) {\n\t\t\t\tconst user = users.find(u => u.id === employeeId && u.role === UserRole.Employee);\n\t\t\t\tif (user) {\n\t\t\t\t\tsetCurrentUser(user);\n\t\t\t\t\tsetShowUserSelect(false);\n\t\t\t\t\tsetEmployeeOnlyMode(true);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}, [users, currentUser]);\n\n\tconst loadUsers = async () => {\n\t\tconst userORM = UserORM.getInstance();\n\t\tconst allUsers = await userORM.getAllUser();\n\n\t\t// If no users exist, create demo users\n\t\tif (allUsers.length === 0) {\n\t\t\tconst demoUsers = await userORM.insertUser([\n\t\t\t\t{\n\t\t\t\t\tname: \"John Smith\",\n\t\t\t\t\temail: \"john@example.com\",\n\t\t\t\t\trole: UserRole.Employee,\n\t\t\t\t} as UserModel,\n\t\t\t\t{\n\t\t\t\t\tname: \"Sarah Johnson\",\n\t\t\t\t\temail: \"sarah@example.com\",\n\t\t\t\t\trole: UserRole.Employee,\n\t\t\t\t} as UserModel,\n\t\t\t\t{\n\t\t\t\t\tname: \"Mike Manager\",\n\t\t\t\t\temail: \"mike@example.com\",\n\t\t\t\t\trole: UserRole.Manager,\n\t\t\t\t} as UserModel,\n\t\t\t]);\n\t\t\tsetUsers(demoUsers);\n\t\t} else {\n\t\t\tsetUsers(allUsers);\n\t\t}\n\t};\n\n\tconst handleUserSelect = (userId: string) => {\n\t\tconst user = users.find(u => u.id === userId);\n\t\tif (user) {\n\t\t\tsetCurrentUser(user);\n\t\t\tsetShowUserSelect(false);\n\t\t}\n\t};\n\n\tconst handleLogout = () => {\n\t\tsetCurrentUser(null);\n\t\tsetShowUserSelect(true);\n\t};\n\n\tconst toggleLanguage = () => {\n\t\tsetLanguage(prev => prev === 'en' ? 'es' : 'en');\n\t};\n\n\tif (showUserSelect || !currentUser) {\n\t\treturn (\n\t\t\t<div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800 flex items-center justify-center p-4\">\n\t\t\t\t<div className=\"absolute top-4 right-4\">\n\t\t\t\t\t<Button onClick={toggleLanguage} variant=\"outline\" size=\"sm\">\n\t\t\t\t\t\t<Languages className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t\t{language === 'en' ? 'Español' : 'English'}\n\t\t\t\t\t</Button>\n\t\t\t\t</div>\n\t\t\t\t<Card className=\"w-full max-w-md\">\n\t\t\t\t\t<CardHeader>\n\t\t\t\t\t\t<CardTitle className=\"text-2xl\">{t.appTitle}</CardTitle>\n\t\t\t\t\t\t<CardDescription>{t.selectAccount}</CardDescription>\n\t\t\t\t\t</CardHeader>\n\t\t\t\t\t<CardContent className=\"space-y-4\">\n\t\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t\t<Label>{t.selectUser}</Label>\n\t\t\t\t\t\t\t<Select onValueChange={handleUserSelect}>\n\t\t\t\t\t\t\t\t<SelectTrigger className=\"w-full\">\n\t\t\t\t\t\t\t\t\t<SelectValue placeholder={t.chooseAccount} />\n\t\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t\t{users.map((user) => (\n\t\t\t\t\t\t\t\t\t\t<SelectItem key={user.id} value={user.id}>\n\t\t\t\t\t\t\t\t\t\t\t{user.name} - {user.role === UserRole.Manager ? t.manager : t.employee}\n\t\t\t\t\t\t\t\t\t\t</SelectItem>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t\t</Select>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</CardContent>\n\t\t\t\t</Card>\n\t\t\t</div>\n\t\t);\n\t}\n\n\treturn (\n\t\t<div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800\">\n\t\t\t<div className=\"container mx-auto p-6 space-y-6\">\n\t\t\t\t<div className=\"flex justify-between items-center\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<h1 className=\"text-3xl font-bold\">{t.timeTrackingSystem}</h1>\n\t\t\t\t\t\t<p className=\"text-muted-foreground\">\n\t\t\t\t\t\t\t{t.welcome}, {currentUser.name} ({currentUser.role === UserRole.Manager ? t.manager : t.employee})\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"flex gap-2\">\n\t\t\t\t\t\t<Button onClick={toggleLanguage} variant=\"outline\" size=\"sm\">\n\t\t\t\t\t\t\t<Languages className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t\t\t{language === 'en' ? 'Español' : 'English'}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button onClick={handleLogout} variant=\"outline\">\n\t\t\t\t\t\t\t{t.switchUser}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t{currentUser.role === UserRole.Employee ? (\n\t\t\t\t\t<EmployeeView user={currentUser} language={language} />\n\t\t\t\t) : (\n\t\t\t\t\t<ManagerView user={currentUser} users={users} language={language} onUsersChange={loadUsers} />\n\t\t\t\t)}\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n\nfunction SickDayCard({ user, language }: { user: UserModel; language: Language }) {\n\tconst [sickDays, setSickDays] = useState<SickDayModel[]>([]);\n\tconst [showAddDialog, setShowAddDialog] = useState(false);\n\tconst [sickDate, setSickDate] = useState(\"\");\n\tconst [sickHours, setSickHours] = useState(\"8\");\n\tconst [sickNotes, setSickNotes] = useState(\"\");\n\n\tconst t = translations[language];\n\n\tuseEffect(() => {\n\t\tloadSickDays();\n\t}, [user.id]);\n\n\tconst loadSickDays = async () => {\n\t\tconst sickDayORM = SickDayORM.getInstance();\n\t\tconst userSickDays = await sickDayORM.getSickDayByUserId(user.id);\n\n\t\t// Sort by date (newest first)\n\t\tconst sorted = userSickDays.sort((a, b) =>\n\t\t\tnew Date(b.sick_date).getTime() - new Date(a.sick_date).getTime()\n\t\t);\n\n\t\tsetSickDays(sorted);\n\t};\n\n\tconst handleAddSickDay = async () => {\n\t\tif (!sickDate || !sickHours) {\n\t\t\talert(\"Please fill in date and hours\");\n\t\t\treturn;\n\t\t}\n\n\t\tconst sickDayORM = SickDayORM.getInstance();\n\t\tawait sickDayORM.insertSickDay([{\n\t\t\tuser_id: user.id,\n\t\t\tsick_date: sickDate,\n\t\t\thours: parseFloat(sickHours),\n\t\t\tnotes: sickNotes || null,\n\t\t} as SickDayModel]);\n\n\t\t// Reset form\n\t\tsetSickDate(\"\");\n\t\tsetSickHours(\"8\");\n\t\tsetSickNotes(\"\");\n\t\tsetShowAddDialog(false);\n\n\t\tawait loadSickDays();\n\t};\n\n\tconst handleDeleteSickDay = async (sickDay: SickDayModel) => {\n\t\tif (!window.confirm(t.confirmDeleteSickDay)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst sickDayORM = SickDayORM.getInstance();\n\t\tawait sickDayORM.deleteSickDayById(sickDay.id);\n\t\tawait loadSickDays();\n\t};\n\n\tconst formatDate = (dateStr: string) => {\n\t\tconst date = new Date(dateStr);\n\t\treturn date.toLocaleDateString(language === 'es' ? 'es-ES' : 'en-US', {\n\t\t\tyear: 'numeric',\n\t\t\tmonth: 'long',\n\t\t\tday: 'numeric'\n\t\t});\n\t};\n\n\tconst totalSickHours = sickDays.reduce((sum, sd) => sum + sd.hours, 0);\n\n\treturn (\n\t\t<>\n\t\t\t<Card>\n\t\t\t\t<CardHeader>\n\t\t\t\t\t<div className=\"flex justify-between items-center\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<CardTitle className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t<Heart className=\"w-5 h-5 text-red-500\" />\n\t\t\t\t\t\t\t\t{t.mySickDays}\n\t\t\t\t\t\t\t</CardTitle>\n\t\t\t\t\t\t\t<CardDescription>\n\t\t\t\t\t\t\t\t{t.totalSickDays}: {totalSickHours.toFixed(1)} {language === 'es' ? 'hrs' : 'hrs'}\n\t\t\t\t\t\t\t</CardDescription>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<Button onClick={() => setShowAddDialog(true)} size=\"sm\">\n\t\t\t\t\t\t\t<Plus className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t\t\t{t.addSickDay}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t</CardHeader>\n\t\t\t\t<CardContent>\n\t\t\t\t\t{sickDays.length === 0 ? (\n\t\t\t\t\t\t<p className=\"text-center text-muted-foreground py-8\">{t.noSickDays}</p>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<div className=\"overflow-x-auto\">\n\t\t\t\t\t\t\t<Table>\n\t\t\t\t\t\t\t\t<TableHeader>\n\t\t\t\t\t\t\t\t\t<TableRow>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.sickDayDate}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.sickDayHours}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.sickDayNotes}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.actions}</TableHead>\n\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t</TableHeader>\n\t\t\t\t\t\t\t\t<TableBody>\n\t\t\t\t\t\t\t\t\t{sickDays.map((sd) => (\n\t\t\t\t\t\t\t\t\t\t<TableRow key={sd.id}>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"font-medium whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t{formatDate(sd.sick_date)}\n\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell>{sd.hours} hrs</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"max-w-xs truncate\">{sd.notes || \"—\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => handleDeleteSickDay(sd)}\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"text-red-600 hover:text-red-700 hover:bg-red-50\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Trash2 className=\"w-4 h-4\" />\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</TableBody>\n\t\t\t\t\t\t\t</Table>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</CardContent>\n\t\t\t</Card>\n\n\t\t\t<Dialog open={showAddDialog} onOpenChange={setShowAddDialog}>\n\t\t\t\t<DialogContent>\n\t\t\t\t\t<DialogHeader>\n\t\t\t\t\t\t<DialogTitle>{t.addSickDay}</DialogTitle>\n\t\t\t\t\t</DialogHeader>\n\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.sickDayDate}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"date\"\n\t\t\t\t\t\t\t\tvalue={sickDate}\n\t\t\t\t\t\t\t\tonChange={(e) => setSickDate(e.target.value)}\n\t\t\t\t\t\t\t\tmax={new Date().toISOString().split('T')[0]}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.sickDayHours}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\tmin=\"0.5\"\n\t\t\t\t\t\t\t\tmax=\"24\"\n\t\t\t\t\t\t\t\tstep=\"0.5\"\n\t\t\t\t\t\t\t\tvalue={sickHours}\n\t\t\t\t\t\t\t\tonChange={(e) => setSickHours(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.sickDayNotes}</Label>\n\t\t\t\t\t\t\t<Textarea\n\t\t\t\t\t\t\t\tvalue={sickNotes}\n\t\t\t\t\t\t\t\tonChange={(e) => setSickNotes(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder={t.sickDayNotesPlaceholder}\n\t\t\t\t\t\t\t\trows={3}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<DialogFooter>\n\t\t\t\t\t\t<Button variant=\"outline\" onClick={() => setShowAddDialog(false)}>\n\t\t\t\t\t\t\t{t.cancel}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button onClick={handleAddSickDay} disabled={!sickDate || !sickHours}>\n\t\t\t\t\t\t\t{t.saveChanges}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</DialogFooter>\n\t\t\t\t</DialogContent>\n\t\t\t</Dialog>\n\t\t</>\n\t);\n}\n\nfunction EmployeeView({ user, language }: { user: UserModel; language: Language }) {\n\tconst [timeCards, setTimeCards] = useState<TimeCardEntryModel[]>([]);\n\tconst [activeShift, setActiveShift] = useState<TimeCardEntryModel | null>(null);\n\tconst [elapsedTime, setElapsedTime] = useState(0);\n\tconst [location, setLocation] = useState(\"\");\n\tconst [workDescription, setWorkDescription] = useState(\"\");\n\tconst [isOnLunch, setIsOnLunch] = useState(false);\n\tconst [isLoading, setIsLoading] = useState(false);\n\n\tconst t = translations[language];\n\n\tuseEffect(() => {\n\t\tloadTimeCards();\n\t}, [user.id]);\n\n\tuseEffect(() => {\n\t\tlet interval: NodeJS.Timeout;\n\t\tif (activeShift && !isOnLunch) {\n\t\t\tinterval = setInterval(() => {\n\t\t\t\tconst clockInTime = parseInt(activeShift.clock_in_timestamp) * 1000;\n\t\t\t\tconst elapsed = Date.now() - clockInTime;\n\t\t\t\tsetElapsedTime(elapsed);\n\t\t\t}, 1000);\n\t\t}\n\t\treturn () => clearInterval(interval);\n\t}, [activeShift, isOnLunch]);\n\n\tconst loadTimeCards = async () => {\n\t\tconsole.log(\"Loading time cards for user:\", user.id);\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tconst userTimeCards = await timeCardORM.getTimeCardEntryByUserId(user.id);\n\n\t\tconsole.log(\"Found\", userTimeCards.length, \"time cards\");\n\n\t\t// Normalize data retrieved from ORM to fix null-handling bugs\n\t\tconst normalized = normalizeTimeCardEntriesFromORM(userTimeCards);\n\n\t\t// Sort by clock in time (newest first)\n\t\tconst sorted = normalized.sort((a, b) =>\n\t\t\tparseInt(b.clock_in_timestamp) - parseInt(a.clock_in_timestamp)\n\t\t);\n\n\t\tsetTimeCards(sorted);\n\n\t\t// Find active shift using helper function\n\t\tconst active = sorted.find(tc => isActiveShift(tc));\n\t\tconsole.log(\"Active shift found:\", active ? `Yes (ID: ${active.id})` : \"No\");\n\n\t\tsetActiveShift(active || null);\n\t\tif (active) {\n\t\t\tsetLocation(active.location || \"\");\n\t\t\tsetWorkDescription(active.work_description || \"\");\n\t\t\t// Check if on lunch break using helper function\n\t\t\tconst onLunch = isOnLunchBreak(active);\n\t\t\tsetIsOnLunch(onLunch);\n\t\t\tconsole.log(\"On lunch:\", onLunch);\n\t\t} else {\n\t\t\tsetIsOnLunch(false);\n\t\t}\n\t};\n\n\tconst handleClockIn = async () => {\n\t\tconsole.log(\"=== CLOCK IN STARTED ===\");\n\t\tconsole.log(\"User ID:\", user.id);\n\t\tconsole.log(\"Location:\", location);\n\t\tconsole.log(\"Work Description:\", workDescription);\n\n\t\tsetIsLoading(true);\n\t\ttry {\n\t\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\t\tconst now = Math.floor(Date.now() / 1000).toString();\n\t\t\tconsole.log(\"Current timestamp:\", now);\n\n\t\t\tconst newEntry = {\n\t\t\t\tuser_id: user.id,\n\t\t\t\tclock_in_timestamp: now,\n\t\t\t\tlocation: location || undefined,\n\t\t\t\twork_description: workDescription || undefined,\n\t\t\t} as TimeCardEntryModel;\n\n\t\t\t// Normalize the entry to work around ORM null-handling bugs\n\t\t\tconst normalizedEntry = normalizeTimeCardEntryForSave(newEntry);\n\n\t\t\tconsole.log(\"Inserting time card entry:\", normalizedEntry);\n\n\t\t\tconst result = await timeCardORM.insertTimeCardEntry([normalizedEntry as TimeCardEntryModel]);\n\t\t\tconsole.log(\"Insert result:\", result);\n\n\t\t\t// Normalize the returned data\n\t\t\tconst normalizedResult = normalizeTimeCardEntriesFromORM(result);\n\t\t\tconsole.log(\"Normalized result:\", normalizedResult);\n\n\t\t\tconsole.log(\"Time card entry created successfully!\");\n\n\t\t\t// Clear form\n\t\t\tsetLocation(\"\");\n\t\t\tsetWorkDescription(\"\");\n\n\t\t\t// Reload time cards\n\t\t\tconsole.log(\"Reloading time cards...\");\n\t\t\tawait loadTimeCards();\n\n\t\t\tconsole.log(\"=== CLOCK IN COMPLETED ===\");\n\n\t\t\t// Show success feedback\n\t\t\tconst reloadedShifts = normalizeTimeCardEntriesFromORM(\n\t\t\t\tawait timeCardORM.getTimeCardEntryByUserId(user.id)\n\t\t\t);\n\t\t\tif (reloadedShifts.some(tc => isActiveShift(tc))) {\n\t\t\t\talert(\"✅ Successfully clocked in! You can now see the CLOCK OUT button.\");\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.error(\"=== CLOCK IN FAILED ===\");\n\t\t\tconsole.error(\"Error details:\", error);\n\t\t\talert(`Error clocking in: ${error instanceof Error ? error.message : 'Unknown error'}. Check console for details.`);\n\t\t} finally {\n\t\t\tsetIsLoading(false);\n\t\t}\n\t};\n\n\tconst handleClockOut = async () => {\n\t\tconsole.log(\"Clock Out clicked - activeShift:\", activeShift);\n\n\t\tif (!activeShift) {\n\t\t\tconsole.error(\"No active shift to clock out!\");\n\t\t\talert(\"Error: No active shift found. Please try clocking in first.\");\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\t\tconst now = Math.floor(Date.now() / 1000).toString();\n\n\t\t\tconst clockInTime = parseInt(activeShift.clock_in_timestamp);\n\t\t\tconst clockOutTime = parseInt(now);\n\t\t\tlet totalHours = (clockOutTime - clockInTime) / 3600;\n\n\t\t\t// Deduct lunch time if lunch was taken\n\t\t\tif (activeShift.lunch_duration_minutes && activeShift.lunch_duration_minutes > 0) {\n\t\t\t\ttotalHours -= activeShift.lunch_duration_minutes / 60;\n\t\t\t}\n\n\t\t\tconsole.log(\"Clocking out - Total hours:\", totalHours);\n\n\t\t\tconst updateData = {\n\t\t\t\t...activeShift,\n\t\t\t\tclock_out_timestamp: now,\n\t\t\t\ttotal_hours: totalHours,\n\t\t\t\tlocation: location || activeShift.location || undefined,\n\t\t\t\twork_description: workDescription || activeShift.work_description || undefined,\n\t\t\t};\n\n\t\t\t// Normalize before saving\n\t\t\tconst normalizedUpdate = normalizeTimeCardEntryForSave(updateData as TimeCardEntryModel);\n\n\t\t\tawait timeCardORM.setTimeCardEntryById(activeShift.id, normalizedUpdate as TimeCardEntryModel);\n\n\t\t\tconsole.log(\"Clock out successful!\");\n\t\t\tsetLocation(\"\");\n\t\t\tsetWorkDescription(\"\");\n\t\t\tawait loadTimeCards();\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Error clocking out:\", error);\n\t\t\talert(\"Error clocking out. Please try again.\");\n\t\t}\n\t};\n\n\tconst handleStartLunch = async () => {\n\t\tif (!activeShift) return;\n\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tconst now = Math.floor(Date.now() / 1000).toString();\n\n\t\tconst updateData = {\n\t\t\t...activeShift,\n\t\t\tlunch_start_timestamp: now,\n\t\t\tlocation: location || activeShift.location || undefined,\n\t\t\twork_description: workDescription || activeShift.work_description || undefined,\n\t\t};\n\n\t\tconst normalizedUpdate = normalizeTimeCardEntryForSave(updateData as TimeCardEntryModel);\n\t\tawait timeCardORM.setTimeCardEntryById(activeShift.id, normalizedUpdate as TimeCardEntryModel);\n\n\t\tawait loadTimeCards();\n\t};\n\n\tconst handleEndLunch = async () => {\n\t\tif (!activeShift || !activeShift.lunch_start_timestamp) return;\n\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tconst now = Math.floor(Date.now() / 1000).toString();\n\n\t\t// Handle case where lunch_start_timestamp might be the string \"null\"\n\t\tlet lunchStartTime: number;\n\t\tif (typeof activeShift.lunch_start_timestamp === 'string' && activeShift.lunch_start_timestamp !== 'null') {\n\t\t\tlunchStartTime = parseInt(activeShift.lunch_start_timestamp);\n\t\t} else {\n\t\t\treturn;\n\t\t}\n\n\t\tconst lunchEndTime = parseInt(now);\n\t\tconst lunchDurationMinutes = (lunchEndTime - lunchStartTime) / 60;\n\n\t\t// Add to existing lunch duration if there was already one\n\t\tconst totalLunchMinutes = (activeShift.lunch_duration_minutes && activeShift.lunch_duration_minutes > 0 ? activeShift.lunch_duration_minutes : 0) + lunchDurationMinutes;\n\n\t\tconst updateData = {\n\t\t\t...activeShift,\n\t\t\tlunch_end_timestamp: now,\n\t\t\tlunch_duration_minutes: totalLunchMinutes,\n\t\t};\n\n\t\tconst normalizedUpdate = normalizeTimeCardEntryForSave(updateData as TimeCardEntryModel);\n\t\tawait timeCardORM.setTimeCardEntryById(activeShift.id, normalizedUpdate as TimeCardEntryModel);\n\n\t\tawait loadTimeCards();\n\t};\n\n\tconst formatTime = (ms: number) => {\n\t\tconst seconds = Math.floor(ms / 1000);\n\t\tconst hours = Math.floor(seconds / 3600);\n\t\tconst minutes = Math.floor((seconds % 3600) / 60);\n\t\tconst secs = seconds % 60;\n\t\treturn `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\n\t};\n\n\tconst formatDate = (timestamp: string) => {\n\t\tconst date = new Date(parseInt(timestamp) * 1000);\n\t\treturn date.toLocaleString(language === 'es' ? 'es-ES' : 'en-US');\n\t};\n\n\tconst formatHours = (hours: number | null | undefined) => {\n\t\tif (hours === null || hours === undefined) return \"—\";\n\t\treturn `${hours.toFixed(2)} ${language === 'es' ? 'hrs' : 'hrs'}`;\n\t};\n\n\tconst formatMinutes = (minutes: number | null | undefined) => {\n\t\tif (minutes === null || minutes === undefined) return \"—\";\n\t\treturn `${Math.round(minutes)} min`;\n\t};\n\n\treturn (\n\t\t<div className=\"space-y-6\">\n\t\t\t<SickDayCard user={user} language={language} />\n\t\t\t<Card>\n\t\t\t\t<CardHeader>\n\t\t\t\t\t<CardTitle className=\"flex items-center gap-2\">\n\t\t\t\t\t\t<Clock className=\"w-5 h-5\" />\n\t\t\t\t\t\t{t.clockInOut}\n\t\t\t\t\t</CardTitle>\n\t\t\t\t\t<CardDescription>\n\t\t\t\t\t\t{activeShift ? \"✅ You are currently clocked in - Clock out button is below\" : \"❌ Not clocked in - Click CLOCK IN button to start\"}\n\t\t\t\t\t</CardDescription>\n\t\t\t\t</CardHeader>\n\t\t\t\t<CardContent className=\"space-y-6\">\n\t\t\t\t\t{/* Show current status */}\n\t\t\t\t\t<div className={`p-6 rounded-lg border-2 ${activeShift ? 'bg-green-50 border-green-300 dark:bg-green-900/20 dark:border-green-700' : 'bg-blue-50 border-blue-300 dark:bg-blue-900/20 dark:border-blue-700'}`}>\n\t\t\t\t\t\t<div className=\"flex items-center justify-between mb-4\">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<p className={`text-2xl font-bold ${activeShift ? 'text-green-700' : 'text-blue-700'}`}>\n\t\t\t\t\t\t\t\t\t{activeShift ? '🟢 CLOCKED IN' : '⚪ NOT CLOCKED IN'}\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t{!activeShift && (\n\t\t\t\t\t\t\t\t\t<p className=\"text-sm text-blue-600 dark:text-blue-400 mt-2 font-semibold\">\n\t\t\t\t\t\t\t\t\t\t👇 Fill out the form below and click \"CLOCK IN\"\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t{activeShift && (\n\t\t\t\t\t\t\t\t\t<p className=\"text-sm text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\tStarted: {formatDate(activeShift.clock_in_timestamp)}\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t{isOnLunch && (\n\t\t\t\t\t\t\t\t\t<p className=\"text-sm text-orange-600 font-semibold mt-1\">\n\t\t\t\t\t\t\t\t\t\t☕ On Lunch Break\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{activeShift && !isOnLunch && (\n\t\t\t\t\t\t\t\t<div className=\"text-right\">\n\t\t\t\t\t\t\t\t\t<p className=\"text-3xl font-mono font-bold tabular-nums\">\n\t\t\t\t\t\t\t\t\t\t{formatTime(elapsedTime)}\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t<p className=\"text-xs text-muted-foreground\">Time Elapsed</p>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Main Action Buttons */}\n\t\t\t\t\t{activeShift ? (\n\t\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t\t{/* Clock Out Button - ALWAYS VISIBLE when clocked in */}\n\t\t\t\t\t\t\t<div className=\"bg-red-50 dark:bg-red-950 p-4 rounded-lg border-2 border-red-300 dark:border-red-700\">\n\t\t\t\t\t\t\t\t<p className=\"text-center text-sm font-bold text-red-700 dark:text-red-300 mb-3\">\n\t\t\t\t\t\t\t\t\t⬇️ CLICK HERE TO END YOUR SHIFT ⬇️\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tonClick={handleClockOut}\n\t\t\t\t\t\t\t\t\tvariant=\"destructive\"\n\t\t\t\t\t\t\t\t\tsize=\"lg\"\n\t\t\t\t\t\t\t\t\tclassName=\"w-full h-20 text-2xl font-black shadow-lg hover:shadow-xl transition-all\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<Clock className=\"w-8 h-8 mr-3\" />\n\t\t\t\t\t\t\t\t\tCLOCK OUT\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t{/* Lunch Buttons */}\n\t\t\t\t\t\t\t<div className=\"border-t pt-4\">\n\t\t\t\t\t\t\t\t<p className=\"text-sm text-muted-foreground mb-3\">Lunch Break (Optional)</p>\n\t\t\t\t\t\t\t\t{isOnLunch ? (\n\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\tonClick={handleEndLunch}\n\t\t\t\t\t\t\t\t\t\tclassName=\"w-full h-12\"\n\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<Coffee className=\"w-5 h-5 mr-2\" />\n\t\t\t\t\t\t\t\t\t\tEnd Lunch Break\n\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\tonClick={handleStartLunch}\n\t\t\t\t\t\t\t\t\t\tclassName=\"w-full h-12\"\n\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<Coffee className=\"w-5 h-5 mr-2\" />\n\t\t\t\t\t\t\t\t\t\tStart Lunch Break\n\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t{/* Location and Description */}\n\t\t\t\t\t\t\t<div className=\"border-t pt-4 space-y-4\">\n\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t<Label>{t.location}</Label>\n\t\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\t\tvalue={location}\n\t\t\t\t\t\t\t\t\t\tonChange={(e) => setLocation(e.target.value)}\n\t\t\t\t\t\t\t\t\t\tplaceholder={t.locationPlaceholder}\n\t\t\t\t\t\t\t\t\t\tclassName=\"mt-2\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t<Label>{t.workDescription}</Label>\n\t\t\t\t\t\t\t\t\t<Textarea\n\t\t\t\t\t\t\t\t\t\tvalue={workDescription}\n\t\t\t\t\t\t\t\t\t\tonChange={(e) => setWorkDescription(e.target.value)}\n\t\t\t\t\t\t\t\t\t\tplaceholder={t.descriptionPlaceholder}\n\t\t\t\t\t\t\t\t\t\trows={3}\n\t\t\t\t\t\t\t\t\t\tclassName=\"mt-2\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t\t{/* Clock In Form */}\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<Label>{t.location}</Label>\n\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\tvalue={location}\n\t\t\t\t\t\t\t\t\tonChange={(e) => setLocation(e.target.value)}\n\t\t\t\t\t\t\t\t\tplaceholder={t.locationPlaceholder}\n\t\t\t\t\t\t\t\t\tclassName=\"mt-2\"\n\t\t\t\t\t\t\t\t\tdisabled={isLoading}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<Label>{t.workDescription}</Label>\n\t\t\t\t\t\t\t\t<Textarea\n\t\t\t\t\t\t\t\t\tvalue={workDescription}\n\t\t\t\t\t\t\t\t\tonChange={(e) => setWorkDescription(e.target.value)}\n\t\t\t\t\t\t\t\t\tplaceholder={t.descriptionPlaceholder}\n\t\t\t\t\t\t\t\t\trows={3}\n\t\t\t\t\t\t\t\t\tclassName=\"mt-2\"\n\t\t\t\t\t\t\t\t\tdisabled={isLoading}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tonClick={handleClockIn}\n\t\t\t\t\t\t\t\tsize=\"lg\"\n\t\t\t\t\t\t\t\tdisabled={isLoading}\n\t\t\t\t\t\t\t\tclassName=\"w-full h-16 text-xl font-bold bg-green-600 hover:bg-green-700 disabled:opacity-50\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Clock className=\"w-6 h-6 mr-2\" />\n\t\t\t\t\t\t\t\t{isLoading ? \"CLOCKING IN...\" : \"CLOCK IN\"}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t{isLoading && (\n\t\t\t\t\t\t\t\t<p className=\"text-center text-sm text-muted-foreground animate-pulse\">\n\t\t\t\t\t\t\t\t\tPlease wait, processing...\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</CardContent>\n\t\t\t</Card>\n\n\t\t\t<Card>\n\t\t\t\t<CardHeader>\n\t\t\t\t\t<CardTitle className=\"flex items-center gap-2\">\n\t\t\t\t\t\t<CalendarDays className=\"w-5 h-5\" />\n\t\t\t\t\t\t{t.timeCardHistory}\n\t\t\t\t\t</CardTitle>\n\t\t\t\t\t<CardDescription>{t.recentRecords}</CardDescription>\n\t\t\t\t</CardHeader>\n\t\t\t\t<CardContent>\n\t\t\t\t\t{timeCards.length === 0 ? (\n\t\t\t\t\t\t<p className=\"text-center text-muted-foreground py-8\">{t.noTimeCards}</p>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<div className=\"overflow-x-auto\">\n\t\t\t\t\t\t\t<Table>\n\t\t\t\t\t\t\t\t<TableHeader>\n\t\t\t\t\t\t\t\t\t<TableRow>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.clockInTime}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.clockOutTime}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.location}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.workDescription}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.lunchDuration}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.hours}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.status}</TableHead>\n\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t</TableHeader>\n\t\t\t\t\t\t\t\t<TableBody>\n\t\t\t\t\t\t\t\t\t{timeCards.map((tc) => (\n\t\t\t\t\t\t\t\t\t\t<TableRow key={tc.id}>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatDate(tc.clock_in_timestamp)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t{tc.clock_out_timestamp ? formatDate(tc.clock_out_timestamp) : \"—\"}\n\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell>{tc.location || \"—\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"max-w-xs truncate\">{tc.work_description || \"—\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatMinutes(tc.lunch_duration_minutes)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatHours(tc.total_hours)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t{tc.clock_out_timestamp ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge variant=\"secondary\">{t.completed}</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t) : tc.lunch_start_timestamp && !tc.lunch_end_timestamp ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge className=\"bg-orange-500\">{t.onLunchBreak}</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge className=\"bg-green-500\">{t.active}</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</TableBody>\n\t\t\t\t\t\t\t</Table>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</CardContent>\n\t\t\t</Card>\n\t\t</div>\n\t);\n}\n\nfunction ManagerView({ user, users, language, onUsersChange }: { user: UserModel; users: UserModel[]; language: Language; onUsersChange: () => void }) {\n\tconst [activeTab, setActiveTab] = useState(\"timecards\");\n\n\tconst t = translations[language];\n\n\treturn (\n\t\t<Tabs value={activeTab} onValueChange={setActiveTab}>\n\t\t\t<TabsList className=\"grid w-full grid-cols-4\">\n\t\t\t\t<TabsTrigger value=\"timecards\">\n\t\t\t\t\t<Clock className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t{t.timeCards}\n\t\t\t\t</TabsTrigger>\n\t\t\t\t<TabsTrigger value=\"sickdays\">\n\t\t\t\t\t<Heart className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t{t.sickDays}\n\t\t\t\t</TabsTrigger>\n\t\t\t\t<TabsTrigger value=\"reports\">\n\t\t\t\t\t<FileText className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t{t.reports}\n\t\t\t\t</TabsTrigger>\n\t\t\t\t<TabsTrigger value=\"employees\">\n\t\t\t\t\t<Users className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t{t.employees}\n\t\t\t\t</TabsTrigger>\n\t\t\t</TabsList>\n\n\t\t\t<TabsContent value=\"timecards\" className=\"space-y-4\">\n\t\t\t\t<TimeCardsTab users={users} language={language} />\n\t\t\t</TabsContent>\n\n\t\t\t<TabsContent value=\"sickdays\" className=\"space-y-4\">\n\t\t\t\t<SickDaysTab users={users} language={language} />\n\t\t\t</TabsContent>\n\n\t\t\t<TabsContent value=\"reports\" className=\"space-y-4\">\n\t\t\t\t<ReportsTab users={users} language={language} />\n\t\t\t</TabsContent>\n\n\t\t\t<TabsContent value=\"employees\" className=\"space-y-4\">\n\t\t\t\t<EmployeesTab users={users} language={language} onUsersChange={onUsersChange} />\n\t\t\t</TabsContent>\n\t\t</Tabs>\n\t);\n}\n\nfunction TimeCardsTab({ users, language }: { users: UserModel[]; language: Language }) {\n\tconst [allTimeCards, setAllTimeCards] = useState<TimeCardEntryModel[]>([]);\n\tconst [filteredCards, setFilteredCards] = useState<TimeCardEntryModel[]>([]);\n\tconst [selectedEmployee, setSelectedEmployee] = useState<string>(\"all\");\n\tconst [dateFilter, setDateFilter] = useState<string>(\"\");\n\tconst [editingCard, setEditingCard] = useState<TimeCardEntryModel | null>(null);\n\tconst [editClockIn, setEditClockIn] = useState(\"\");\n\tconst [editClockOut, setEditClockOut] = useState(\"\");\n\tconst [editLocation, setEditLocation] = useState(\"\");\n\tconst [editWorkDescription, setEditWorkDescription] = useState(\"\");\n\tconst [editLunchStart, setEditLunchStart] = useState(\"\");\n\tconst [editLunchEnd, setEditLunchEnd] = useState(\"\");\n\tconst [showManualEntry, setShowManualEntry] = useState(false);\n\tconst [manualEntryUserId, setManualEntryUserId] = useState<string>(\"\");\n\n\tconst t = translations[language];\n\n\tuseEffect(() => {\n\t\tloadAllTimeCards();\n\t}, []);\n\n\tuseEffect(() => {\n\t\tapplyFilters();\n\t}, [allTimeCards, selectedEmployee, dateFilter]);\n\n\tconst loadAllTimeCards = async () => {\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tconst allCards = await timeCardORM.getAllTimeCardEntry();\n\n\t\t// Normalize data from ORM\n\t\tconst normalized = normalizeTimeCardEntriesFromORM(allCards);\n\n\t\t// Sort by clock in time (newest first)\n\t\tconst sorted = normalized.sort((a, b) =>\n\t\t\tparseInt(b.clock_in_timestamp) - parseInt(a.clock_in_timestamp)\n\t\t);\n\n\t\tsetAllTimeCards(sorted);\n\t};\n\n\tconst applyFilters = () => {\n\t\tlet filtered = [...allTimeCards];\n\n\t\t// Filter by employee\n\t\tif (selectedEmployee !== \"all\") {\n\t\t\tfiltered = filtered.filter(tc => tc.user_id === selectedEmployee);\n\t\t}\n\n\t\t// Filter by date\n\t\tif (dateFilter) {\n\t\t\tconst filterDate = new Date(dateFilter);\n\t\t\tconst filterTimestamp = Math.floor(filterDate.getTime() / 1000);\n\t\t\tconst nextDayTimestamp = filterTimestamp + 86400; // +24 hours\n\n\t\t\tfiltered = filtered.filter(tc => {\n\t\t\t\tconst clockIn = parseInt(tc.clock_in_timestamp);\n\t\t\t\treturn clockIn >= filterTimestamp && clockIn < nextDayTimestamp;\n\t\t\t});\n\t\t}\n\n\t\tsetFilteredCards(filtered);\n\t};\n\n\tconst getUserName = (userId: string) => {\n\t\tconst user = users.find(u => u.id === userId);\n\t\treturn user?.name || \"Unknown\";\n\t};\n\n\tconst formatDate = (timestamp: string) => {\n\t\tconst date = new Date(parseInt(timestamp) * 1000);\n\t\treturn date.toLocaleString(language === 'es' ? 'es-ES' : 'en-US');\n\t};\n\n\tconst formatHours = (hours: number | null | undefined) => {\n\t\tif (hours === null || hours === undefined) return \"—\";\n\t\treturn `${hours.toFixed(2)} ${language === 'es' ? 'hrs' : 'hrs'}`;\n\t};\n\n\tconst formatMinutes = (minutes: number | null | undefined) => {\n\t\tif (minutes === null || minutes === undefined) return \"—\";\n\t\treturn `${Math.round(minutes)} min`;\n\t};\n\n\tconst calculateTotalHours = (period: 'day' | 'week') => {\n\t\tconst now = Date.now() / 1000;\n\t\tconst periodSeconds = period === 'day' ? 86400 : 604800; // 1 day or 7 days\n\t\tconst startTime = now - periodSeconds;\n\n\t\tconst relevantCards = allTimeCards.filter(tc => {\n\t\t\tconst clockIn = parseInt(tc.clock_in_timestamp);\n\t\t\treturn clockIn >= startTime && tc.total_hours;\n\t\t});\n\n\t\treturn relevantCards.reduce((sum, tc) => sum + (tc.total_hours || 0), 0);\n\t};\n\n\tconst handleEditCard = (card: TimeCardEntryModel) => {\n\t\tsetEditingCard(card);\n\n\t\t// Helper function to safely convert timestamp to ISO string\n\t\tconst safeTimestampToISO = (timestamp: string | null | undefined): string => {\n\t\t\tif (!timestamp) return \"\";\n\t\t\tconst parsed = parseInt(timestamp);\n\t\t\tif (isNaN(parsed) || parsed <= 0) return \"\";\n\t\t\tconst date = new Date(parsed * 1000);\n\t\t\tif (isNaN(date.getTime())) return \"\";\n\t\t\treturn date.toISOString().slice(0, 16);\n\t\t};\n\n\t\tsetEditClockIn(safeTimestampToISO(card.clock_in_timestamp) || new Date().toISOString().slice(0, 16));\n\t\tsetEditClockOut(safeTimestampToISO(card.clock_out_timestamp));\n\t\tsetEditLocation(card.location || \"\");\n\t\tsetEditWorkDescription(card.work_description || \"\");\n\t\tsetEditLunchStart(safeTimestampToISO(card.lunch_start_timestamp));\n\t\tsetEditLunchEnd(safeTimestampToISO(card.lunch_end_timestamp));\n\t};\n\n\tconst handleSaveEdit = async () => {\n\t\tif (!editingCard) return;\n\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tconst clockInTimestamp = Math.floor(new Date(editClockIn).getTime() / 1000).toString();\n\t\tconst clockOutTimestamp = editClockOut\n\t\t\t? Math.floor(new Date(editClockOut).getTime() / 1000).toString()\n\t\t\t: undefined;\n\t\tconst lunchStartTimestamp = editLunchStart\n\t\t\t? Math.floor(new Date(editLunchStart).getTime() / 1000).toString()\n\t\t\t: undefined;\n\t\tconst lunchEndTimestamp = editLunchEnd\n\t\t\t? Math.floor(new Date(editLunchEnd).getTime() / 1000).toString()\n\t\t\t: undefined;\n\n\t\tlet totalHours: number | undefined = undefined;\n\t\tlet lunchDurationMinutes: number | undefined = undefined;\n\n\t\t// Calculate lunch duration\n\t\tif (lunchStartTimestamp && lunchEndTimestamp) {\n\t\t\tconst lunchStart = parseInt(lunchStartTimestamp);\n\t\t\tconst lunchEnd = parseInt(lunchEndTimestamp);\n\t\t\tlunchDurationMinutes = (lunchEnd - lunchStart) / 60;\n\t\t}\n\n\t\t// Calculate total hours\n\t\tif (clockOutTimestamp) {\n\t\t\tconst clockInTime = parseInt(clockInTimestamp);\n\t\t\tconst clockOutTime = parseInt(clockOutTimestamp);\n\t\t\ttotalHours = (clockOutTime - clockInTime) / 3600;\n\n\t\t\t// Deduct lunch time\n\t\t\tif (lunchDurationMinutes) {\n\t\t\t\ttotalHours -= lunchDurationMinutes / 60;\n\t\t\t}\n\t\t}\n\n\t\tconst updateData = {\n\t\t\t...editingCard,\n\t\t\tclock_in_timestamp: clockInTimestamp,\n\t\t\tclock_out_timestamp: clockOutTimestamp,\n\t\t\ttotal_hours: totalHours,\n\t\t\tlocation: editLocation || undefined,\n\t\t\twork_description: editWorkDescription || undefined,\n\t\t\tlunch_start_timestamp: lunchStartTimestamp,\n\t\t\tlunch_end_timestamp: lunchEndTimestamp,\n\t\t\tlunch_duration_minutes: lunchDurationMinutes,\n\t\t};\n\n\t\tconst normalizedUpdate = normalizeTimeCardEntryForSave(updateData as TimeCardEntryModel);\n\t\tawait timeCardORM.setTimeCardEntryById(editingCard.id, normalizedUpdate as TimeCardEntryModel);\n\n\t\tsetEditingCard(null);\n\t\tawait loadAllTimeCards();\n\t};\n\n\tconst handleDeleteTimeCard = async (card: TimeCardEntryModel) => {\n\t\tif (!window.confirm(t.confirmDeleteTimeCard)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tawait timeCardORM.deleteTimeCardEntryById(card.id);\n\t\tawait loadAllTimeCards();\n\t};\n\n\tconst handleAddManualEntry = (userId: string) => {\n\t\tsetManualEntryUserId(userId);\n\t\tsetShowManualEntry(true);\n\t};\n\n\treturn (\n\t\t<>\n\t\t\t<div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n\t\t\t\t<Card>\n\t\t\t\t\t<CardHeader className=\"pb-3\">\n\t\t\t\t\t\t<CardTitle className=\"text-sm font-medium flex items-center gap-2\">\n\t\t\t\t\t\t\t<Users className=\"w-4 h-4\" />\n\t\t\t\t\t\t\t{t.totalEmployees}\n\t\t\t\t\t\t</CardTitle>\n\t\t\t\t\t</CardHeader>\n\t\t\t\t\t<CardContent>\n\t\t\t\t\t\t<div className=\"text-2xl font-bold\">{users.filter(u => u.role === UserRole.Employee).length}</div>\n\t\t\t\t\t</CardContent>\n\t\t\t\t</Card>\n\n\t\t\t\t<Card>\n\t\t\t\t\t<CardHeader className=\"pb-3\">\n\t\t\t\t\t\t<CardTitle className=\"text-sm font-medium flex items-center gap-2\">\n\t\t\t\t\t\t\t<Timer className=\"w-4 h-4\" />\n\t\t\t\t\t\t\t{t.hoursToday}\n\t\t\t\t\t\t</CardTitle>\n\t\t\t\t\t</CardHeader>\n\t\t\t\t\t<CardContent>\n\t\t\t\t\t\t<div className=\"text-2xl font-bold\">{calculateTotalHours('day').toFixed(2)}</div>\n\t\t\t\t\t</CardContent>\n\t\t\t\t</Card>\n\n\t\t\t\t<Card>\n\t\t\t\t\t<CardHeader className=\"pb-3\">\n\t\t\t\t\t\t<CardTitle className=\"text-sm font-medium flex items-center gap-2\">\n\t\t\t\t\t\t\t<CalendarDays className=\"w-4 h-4\" />\n\t\t\t\t\t\t\t{t.hoursThisWeek}\n\t\t\t\t\t\t</CardTitle>\n\t\t\t\t\t</CardHeader>\n\t\t\t\t\t<CardContent>\n\t\t\t\t\t\t<div className=\"text-2xl font-bold\">{calculateTotalHours('week').toFixed(2)}</div>\n\t\t\t\t\t</CardContent>\n\t\t\t\t</Card>\n\t\t\t</div>\n\n\t\t\t<Card>\n\t\t\t\t<CardHeader>\n\t\t\t\t\t<div className=\"flex justify-between items-center\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<CardTitle>{t.allEmployeeTimeCards}</CardTitle>\n\t\t\t\t\t\t\t<CardDescription>{t.viewManageRecords}</CardDescription>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<Button onClick={() => handleAddManualEntry(\"\")} variant=\"outline\" size=\"sm\">\n\t\t\t\t\t\t\t<Plus className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t\t\t{t.addTimeCard}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t</CardHeader>\n\t\t\t\t<CardContent className=\"space-y-4\">\n\t\t\t\t\t<div className=\"flex gap-4 flex-wrap\">\n\t\t\t\t\t\t<div className=\"flex-1 min-w-[200px]\">\n\t\t\t\t\t\t\t<Label>{t.filterByEmployee}</Label>\n\t\t\t\t\t\t\t<Select value={selectedEmployee} onValueChange={setSelectedEmployee}>\n\t\t\t\t\t\t\t\t<SelectTrigger>\n\t\t\t\t\t\t\t\t\t<SelectValue />\n\t\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t\t<SelectItem value=\"all\">{t.allEmployees}</SelectItem>\n\t\t\t\t\t\t\t\t\t{users.filter(u => u.role === UserRole.Employee).map((u) => (\n\t\t\t\t\t\t\t\t\t\t<SelectItem key={u.id} value={u.id}>\n\t\t\t\t\t\t\t\t\t\t\t{u.name}\n\t\t\t\t\t\t\t\t\t\t</SelectItem>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t\t</Select>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div className=\"flex-1 min-w-[200px]\">\n\t\t\t\t\t\t\t<Label>{t.filterByDate}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"date\"\n\t\t\t\t\t\t\t\tvalue={dateFilter}\n\t\t\t\t\t\t\t\tonChange={(e) => setDateFilter(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t{(selectedEmployee !== \"all\" || dateFilter) && (\n\t\t\t\t\t\t\t<div className=\"flex items-end\">\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\t\t\tsetSelectedEmployee(\"all\");\n\t\t\t\t\t\t\t\t\t\tsetDateFilter(\"\");\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{t.clearFilters}\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{filteredCards.length === 0 ? (\n\t\t\t\t\t\t<p className=\"text-center text-muted-foreground py-8\">{t.noTimeCardsFound}</p>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<div className=\"overflow-x-auto\">\n\t\t\t\t\t\t\t<Table>\n\t\t\t\t\t\t\t\t<TableHeader>\n\t\t\t\t\t\t\t\t\t<TableRow>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.employeeName}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.clockInTime}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.clockOutTime}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.location}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.workDescription}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.lunchDuration}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.hours}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.status}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.actions}</TableHead>\n\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t</TableHeader>\n\t\t\t\t\t\t\t\t<TableBody>\n\t\t\t\t\t\t\t\t\t{filteredCards.map((tc) => (\n\t\t\t\t\t\t\t\t\t\t<TableRow key={tc.id}>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"font-medium whitespace-nowrap\">{getUserName(tc.user_id)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatDate(tc.clock_in_timestamp)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t{tc.clock_out_timestamp ? formatDate(tc.clock_out_timestamp) : \"—\"}\n\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell>{tc.location || \"—\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"max-w-xs truncate\">{tc.work_description || \"—\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatMinutes(tc.lunch_duration_minutes)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatHours(tc.total_hours)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t{tc.clock_out_timestamp ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge variant=\"secondary\">{t.completed}</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t) : tc.lunch_start_timestamp && !tc.lunch_end_timestamp ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge className=\"bg-orange-500\">{t.onLunchBreak}</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge className=\"bg-green-500\">{t.active}</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => handleEditCard(tc)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{t.edit}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => handleDeleteTimeCard(tc)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"text-red-600 hover:text-red-700 hover:bg-red-50\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Trash2 className=\"w-4 h-4\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</TableBody>\n\t\t\t\t\t\t\t</Table>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</CardContent>\n\t\t\t</Card>\n\n\t\t\t<Dialog open={!!editingCard} onOpenChange={(open) => !open && setEditingCard(null)}>\n\t\t\t\t<DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n\t\t\t\t\t<DialogHeader>\n\t\t\t\t\t\t<DialogTitle>{t.editTimeCard}</DialogTitle>\n\t\t\t\t\t</DialogHeader>\n\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.employeeName}</Label>\n\t\t\t\t\t\t\t<Input value={editingCard ? getUserName(editingCard.user_id) : \"\"} disabled />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"grid grid-cols-2 gap-4\">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<Label>{t.clockInTime}</Label>\n\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\t\tvalue={editClockIn}\n\t\t\t\t\t\t\t\t\tonChange={(e) => setEditClockIn(e.target.value)}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<Label>{t.clockOutTime}</Label>\n\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\t\tvalue={editClockOut}\n\t\t\t\t\t\t\t\t\tonChange={(e) => setEditClockOut(e.target.value)}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.location}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\tvalue={editLocation}\n\t\t\t\t\t\t\t\tonChange={(e) => setEditLocation(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder={t.locationPlaceholder}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.workDescription}</Label>\n\t\t\t\t\t\t\t<Textarea\n\t\t\t\t\t\t\t\tvalue={editWorkDescription}\n\t\t\t\t\t\t\t\tonChange={(e) => setEditWorkDescription(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder={t.descriptionPlaceholder}\n\t\t\t\t\t\t\t\trows={4}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"grid grid-cols-2 gap-4\">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<Label>{t.lunchStartTime}</Label>\n\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\t\tvalue={editLunchStart}\n\t\t\t\t\t\t\t\t\tonChange={(e) => setEditLunchStart(e.target.value)}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<Label>{t.lunchEndTime}</Label>\n\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\t\tvalue={editLunchEnd}\n\t\t\t\t\t\t\t\t\tonChange={(e) => setEditLunchEnd(e.target.value)}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<DialogFooter>\n\t\t\t\t\t\t<Button variant=\"outline\" onClick={() => setEditingCard(null)}>\n\t\t\t\t\t\t\t{t.cancel}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button onClick={handleSaveEdit}>\n\t\t\t\t\t\t\t{t.saveChanges}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</DialogFooter>\n\t\t\t\t</DialogContent>\n\t\t\t</Dialog>\n\n\t\t\t<ManualEntryDialog\n\t\t\t\topen={showManualEntry}\n\t\t\t\tonClose={() => setShowManualEntry(false)}\n\t\t\t\tuserId={manualEntryUserId}\n\t\t\t\tonSave={loadAllTimeCards}\n\t\t\t\tlanguage={language}\n\t\t\t\tusers={users}\n\t\t\t/>\n\t\t</>\n\t);\n}\n\nfunction SickDaysTab({ users, language }: { users: UserModel[]; language: Language }) {\n\tconst [allSickDays, setAllSickDays] = useState<SickDayModel[]>([]);\n\tconst [filteredSickDays, setFilteredSickDays] = useState<SickDayModel[]>([]);\n\tconst [selectedEmployee, setSelectedEmployee] = useState<string>(\"all\");\n\tconst [dateFilter, setDateFilter] = useState<string>(\"\");\n\n\tconst t = translations[language];\n\n\tuseEffect(() => {\n\t\tloadAllSickDays();\n\t}, []);\n\n\tuseEffect(() => {\n\t\tapplyFilters();\n\t}, [allSickDays, selectedEmployee, dateFilter]);\n\n\tconst loadAllSickDays = async () => {\n\t\tconst sickDayORM = SickDayORM.getInstance();\n\t\tconst allDays = await sickDayORM.getAllSickDay();\n\n\t\t// Sort by date (newest first)\n\t\tconst sorted = allDays.sort((a, b) =>\n\t\t\tnew Date(b.sick_date).getTime() - new Date(a.sick_date).getTime()\n\t\t);\n\n\t\tsetAllSickDays(sorted);\n\t};\n\n\tconst applyFilters = () => {\n\t\tlet filtered = [...allSickDays];\n\n\t\t// Filter by employee\n\t\tif (selectedEmployee !== \"all\") {\n\t\t\tfiltered = filtered.filter(sd => sd.user_id === selectedEmployee);\n\t\t}\n\n\t\t// Filter by date\n\t\tif (dateFilter) {\n\t\t\tfiltered = filtered.filter(sd => sd.sick_date === dateFilter);\n\t\t}\n\n\t\tsetFilteredSickDays(filtered);\n\t};\n\n\tconst getUserName = (userId: string) => {\n\t\tconst user = users.find(u => u.id === userId);\n\t\treturn user?.name || \"Unknown\";\n\t};\n\n\tconst formatDate = (dateStr: string) => {\n\t\tconst date = new Date(dateStr);\n\t\treturn date.toLocaleDateString(language === 'es' ? 'es-ES' : 'en-US', {\n\t\t\tyear: 'numeric',\n\t\t\tmonth: 'long',\n\t\t\tday: 'numeric'\n\t\t});\n\t};\n\n\tconst handleDeleteSickDay = async (sickDay: SickDayModel) => {\n\t\tif (!window.confirm(t.confirmDeleteSickDay)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst sickDayORM = SickDayORM.getInstance();\n\t\tawait sickDayORM.deleteSickDayById(sickDay.id);\n\t\tawait loadAllSickDays();\n\t};\n\n\tconst calculateTotalSickHours = () => {\n\t\treturn filteredSickDays.reduce((sum, sd) => sum + sd.hours, 0);\n\t};\n\n\treturn (\n\t\t<Card>\n\t\t\t<CardHeader>\n\t\t\t\t<div className=\"flex justify-between items-center\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<CardTitle className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t<Heart className=\"w-5 h-5 text-red-500\" />\n\t\t\t\t\t\t\t{t.sickDayHistory}\n\t\t\t\t\t\t</CardTitle>\n\t\t\t\t\t\t<CardDescription>\n\t\t\t\t\t\t\t{t.totalSickDays}: {calculateTotalSickHours().toFixed(1)} {language === 'es' ? 'hrs' : 'hrs'}\n\t\t\t\t\t\t</CardDescription>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</CardHeader>\n\t\t\t<CardContent className=\"space-y-4\">\n\t\t\t\t<div className=\"flex gap-4 flex-wrap\">\n\t\t\t\t\t<div className=\"flex-1 min-w-[200px]\">\n\t\t\t\t\t\t<Label>{t.filterByEmployee}</Label>\n\t\t\t\t\t\t<Select value={selectedEmployee} onValueChange={setSelectedEmployee}>\n\t\t\t\t\t\t\t<SelectTrigger>\n\t\t\t\t\t\t\t\t<SelectValue />\n\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t<SelectItem value=\"all\">{t.allEmployees}</SelectItem>\n\t\t\t\t\t\t\t\t{users.filter(u => u.role === UserRole.Employee).map((u) => (\n\t\t\t\t\t\t\t\t\t<SelectItem key={u.id} value={u.id}>\n\t\t\t\t\t\t\t\t\t\t{u.name}\n\t\t\t\t\t\t\t\t\t</SelectItem>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t</Select>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div className=\"flex-1 min-w-[200px]\">\n\t\t\t\t\t\t<Label>{t.filterByDate}</Label>\n\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\ttype=\"date\"\n\t\t\t\t\t\t\tvalue={dateFilter}\n\t\t\t\t\t\t\tonChange={(e) => setDateFilter(e.target.value)}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{(selectedEmployee !== \"all\" || dateFilter) && (\n\t\t\t\t\t\t<div className=\"flex items-end\">\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\t\tsetSelectedEmployee(\"all\");\n\t\t\t\t\t\t\t\t\tsetDateFilter(\"\");\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{t.clearFilters}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\n\t\t\t\t{filteredSickDays.length === 0 ? (\n\t\t\t\t\t<p className=\"text-center text-muted-foreground py-8\">{t.noSickDays}</p>\n\t\t\t\t) : (\n\t\t\t\t\t<div className=\"overflow-x-auto\">\n\t\t\t\t\t\t<Table>\n\t\t\t\t\t\t\t<TableHeader>\n\t\t\t\t\t\t\t\t<TableRow>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.employeeName}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.sickDayDate}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.sickDayHours}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.sickDayNotes}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.actions}</TableHead>\n\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t</TableHeader>\n\t\t\t\t\t\t\t<TableBody>\n\t\t\t\t\t\t\t\t{filteredSickDays.map((sd) => (\n\t\t\t\t\t\t\t\t\t<TableRow key={sd.id}>\n\t\t\t\t\t\t\t\t\t\t<TableCell className=\"font-medium whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t{getUserName(sd.user_id)}\n\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t{formatDate(sd.sick_date)}\n\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell>{sd.hours} hrs</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell className=\"max-w-xs truncate\">{sd.notes || \"—\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => handleDeleteSickDay(sd)}\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"text-red-600 hover:text-red-700 hover:bg-red-50\"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<Trash2 className=\"w-4 h-4\" />\n\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</TableBody>\n\t\t\t\t\t\t</Table>\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\t\t\t</CardContent>\n\t\t</Card>\n\t);\n}\n\nfunction ReportsTab({ users, language }: { users: UserModel[]; language: Language }) {\n\tconst [weekStart, setWeekStart] = useState(\"\");\n\tconst [reportData, setReportData] = useState<{ user: UserModel; regularHours: number; overtimeHours: number; totalHours: number; regularPay: number; overtimePay: number; totalPay: number }[]>([]);\n\tconst [detailedTimeCards, setDetailedTimeCards] = useState<TimeCardEntryModel[]>([]);\n\n\tconst t = translations[language];\n\n\tuseEffect(() => {\n\t\t// Set default to current week\n\t\tconst today = new Date();\n\t\tconst monday = new Date(today);\n\t\tmonday.setDate(today.getDate() - today.getDay() + 1);\n\t\tsetWeekStart(monday.toISOString().slice(0, 10));\n\t}, []);\n\n\tuseEffect(() => {\n\t\tif (weekStart) {\n\t\t\tloadWeeklyReport();\n\t\t}\n\t}, [weekStart, users]);\n\n\tconst loadWeeklyReport = async () => {\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tconst allCards = await timeCardORM.getAllTimeCardEntry();\n\n\t\t// Normalize data from ORM\n\t\tconst normalized = normalizeTimeCardEntriesFromORM(allCards);\n\n\t\tconst weekStartDate = new Date(weekStart);\n\t\tconst weekStartTimestamp = Math.floor(weekStartDate.getTime() / 1000);\n\t\tconst weekEndTimestamp = weekStartTimestamp + 604800; // 7 days\n\n\t\tconst weekCards = normalized.filter(tc => {\n\t\t\tconst clockIn = parseInt(tc.clock_in_timestamp);\n\t\t\treturn clockIn >= weekStartTimestamp && clockIn < weekEndTimestamp && tc.total_hours;\n\t\t});\n\n\t\t// Store detailed time cards\n\t\tsetDetailedTimeCards(weekCards.sort((a, b) => parseInt(a.clock_in_timestamp) - parseInt(b.clock_in_timestamp)));\n\n\t\tconst employeeHours = users\n\t\t\t.filter(u => u.role === UserRole.Employee)\n\t\t\t.map(user => {\n\t\t\t\tconst userCards = weekCards.filter(tc => tc.user_id === user.id);\n\t\t\t\tconst totalHours = userCards.reduce((sum, tc) => sum + (tc.total_hours || 0), 0);\n\t\t\t\tconst regularHours = Math.min(totalHours, 40);\n\t\t\t\tconst overtimeHours = Math.max(totalHours - 40, 0);\n\n\t\t\t\t// Calculate pay\n\t\t\t\tconst hourlyRate = user.hourly_rate || 0;\n\t\t\t\tconst regularPay = regularHours * hourlyRate;\n\t\t\t\tconst overtimePay = overtimeHours * hourlyRate * 1.5;\n\t\t\t\tconst totalPay = regularPay + overtimePay;\n\n\t\t\t\treturn {\n\t\t\t\t\tuser,\n\t\t\t\t\tregularHours,\n\t\t\t\t\tovertimeHours,\n\t\t\t\t\ttotalHours,\n\t\t\t\t\tregularPay,\n\t\t\t\t\tovertimePay,\n\t\t\t\t\ttotalPay,\n\t\t\t\t};\n\t\t\t});\n\n\t\tsetReportData(employeeHours);\n\t};\n\n\tconst formatHours = (hours: number) => {\n\t\treturn `${hours.toFixed(2)} hrs`;\n\t};\n\n\tconst formatPay = (amount: number) => {\n\t\treturn `$${amount.toFixed(2)}`;\n\t};\n\n\tconst formatDate = (timestamp: string) => {\n\t\tconst date = new Date(parseInt(timestamp) * 1000);\n\t\treturn date.toLocaleString(language === 'es' ? 'es-ES' : 'en-US');\n\t};\n\n\tconst formatDateOnly = (timestamp: string) => {\n\t\tconst date = new Date(parseInt(timestamp) * 1000);\n\t\treturn date.toLocaleDateString(language === 'es' ? 'es-ES' : 'en-US');\n\t};\n\n\tconst getDayOfWeek = (timestamp: string) => {\n\t\tconst date = new Date(parseInt(timestamp) * 1000);\n\t\treturn date.toLocaleDateString(language === 'es' ? 'es-ES' : 'en-US', { weekday: 'long' });\n\t};\n\n\tconst getUserName = (userId: string) => {\n\t\tconst user = users.find(u => u.id === userId);\n\t\treturn user?.name || \"Unknown\";\n\t};\n\n\tconst handlePrint = () => {\n\t\twindow.print();\n\t};\n\n\tconst handleExportCSV = () => {\n\t\tif (detailedTimeCards.length === 0) return;\n\n\t\t// Create CSV header\n\t\tconst headers = [\n\t\t\tt.employeeName,\n\t\t\tt.date,\n\t\t\tt.day,\n\t\t\tt.clockInTime,\n\t\t\tt.clockOutTime,\n\t\t\tt.location,\n\t\t\tt.workDescription,\n\t\t\tt.lunchDuration,\n\t\t\tt.hours,\n\t\t\tt.hourlyRate,\n\t\t\tt.pay\n\t\t];\n\n\t\t// Create CSV rows\n\t\tconst rows = detailedTimeCards.map(tc => {\n\t\t\tconst user = users.find(u => u.id === tc.user_id);\n\t\t\tconst userName = user?.name || \"Unknown\";\n\t\t\tconst hourlyRate = user?.hourly_rate || 0;\n\t\t\tconst date = formatDateOnly(tc.clock_in_timestamp);\n\t\t\tconst day = getDayOfWeek(tc.clock_in_timestamp);\n\t\t\tconst clockIn = formatDate(tc.clock_in_timestamp);\n\t\t\tconst clockOut = tc.clock_out_timestamp ? formatDate(tc.clock_out_timestamp) : \"—\";\n\t\t\tconst location = tc.location || \"—\";\n\t\t\tconst workDescription = (tc.work_description || \"—\").replace(/\"/g, '\"\"'); // Escape quotes\n\t\t\tconst lunchDuration = tc.lunch_duration_minutes ? `${Math.round(tc.lunch_duration_minutes)} min` : \"—\";\n\t\t\tconst hours = tc.total_hours ? `${tc.total_hours.toFixed(2)} hrs` : \"—\";\n\t\t\tconst pay = tc.total_hours ? formatPay(tc.total_hours * hourlyRate) : \"—\";\n\n\t\t\treturn [\n\t\t\t\t`\"${userName}\"`,\n\t\t\t\t`\"${date}\"`,\n\t\t\t\t`\"${day}\"`,\n\t\t\t\t`\"${clockIn}\"`,\n\t\t\t\t`\"${clockOut}\"`,\n\t\t\t\t`\"${location}\"`,\n\t\t\t\t`\"${workDescription}\"`,\n\t\t\t\t`\"${lunchDuration}\"`,\n\t\t\t\t`\"${hours}\"`,\n\t\t\t\t`\"${formatPay(hourlyRate)}\"`,\n\t\t\t\t`\"${pay}\"`\n\t\t\t].join(',');\n\t\t});\n\n\t\t// Combine header and rows\n\t\tconst csv = [headers.join(','), ...rows].join('\\n');\n\n\t\t// Create blob and download\n\t\tconst blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });\n\t\tconst link = document.createElement('a');\n\t\tconst url = URL.createObjectURL(blob);\n\t\tlink.setAttribute('href', url);\n\t\tlink.setAttribute('download', `weekly-report-${weekStart}.csv`);\n\t\tlink.style.visibility = 'hidden';\n\t\tdocument.body.appendChild(link);\n\t\tlink.click();\n\t\tdocument.body.removeChild(link);\n\t};\n\n\treturn (\n\t\t<div className=\"space-y-4\">\n\t\t\t<Card>\n\t\t\t\t<CardHeader>\n\t\t\t\t\t<div className=\"flex justify-between items-center\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<CardTitle>{t.weeklyReport}</CardTitle>\n\t\t\t\t\t\t\t<CardDescription>\n\t\t\t\t\t\t\t\tOvertime calculated for hours worked beyond 40 hours/week\n\t\t\t\t\t\t\t\t<br />\n\t\t\t\t\t\t\t\t<span className=\"text-xs text-muted-foreground\">\n\t\t\t\t\t\t\t\t\tNote: Sick days are tracked separately in the \"Sick Days\" tab and are NOT included in this time card report.\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</CardDescription>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"flex gap-2 print:hidden\">\n\t\t\t\t\t\t\t<Button onClick={handleExportCSV} variant=\"outline\" disabled={detailedTimeCards.length === 0}>\n\t\t\t\t\t\t\t\t<FileText className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t\t\t\t{t.exportCSV}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t<Button onClick={handlePrint} variant=\"outline\" disabled={detailedTimeCards.length === 0}>\n\t\t\t\t\t\t\t\t<FileText className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t\t\t\t{t.printReport}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</CardHeader>\n\t\t\t\t<CardContent className=\"space-y-4\">\n\t\t\t\t\t<div className=\"max-w-xs print:hidden\">\n\t\t\t\t\t\t<Label>{t.selectWeek}</Label>\n\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\ttype=\"date\"\n\t\t\t\t\t\t\tvalue={weekStart}\n\t\t\t\t\t\t\tonChange={(e) => setWeekStart(e.target.value)}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{reportData.length === 0 ? (\n\t\t\t\t\t\t<p className=\"text-center text-muted-foreground py-8\">{t.noReportData}</p>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t{/* Summary Table */}\n\t\t\t\t\t\t\t<div className=\"overflow-x-auto\">\n\t\t\t\t\t\t\t\t<Table>\n\t\t\t\t\t\t\t\t\t<TableHeader>\n\t\t\t\t\t\t\t\t\t\t<TableRow>\n\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.employeeName}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.regularHours}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.overtimeHours}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.totalHours}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.regularPay}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.overtimePay}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.totalPay}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t<TableHead className=\"print:hidden\">{t.status}</TableHead>\n\t\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t\t</TableHeader>\n\t\t\t\t\t\t\t\t\t<TableBody>\n\t\t\t\t\t\t\t\t\t\t{reportData.map(({ user, regularHours, overtimeHours, totalHours, regularPay, overtimePay, totalPay }) => (\n\t\t\t\t\t\t\t\t\t\t\t<TableRow key={user.id}>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"font-medium\">{user.name}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableCell>{formatHours(regularHours)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{overtimeHours > 0 ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-orange-600 font-semibold\">{formatHours(overtimeHours)}</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tformatHours(0)\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"font-semibold\">{formatHours(totalHours)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableCell>{formatPay(regularPay)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{overtimePay > 0 ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-orange-600 font-semibold\">{formatPay(overtimePay)}</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tformatPay(0)\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"font-semibold\">{formatPay(totalPay)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"print:hidden\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{overtimeHours > 0 && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge className=\"bg-orange-500\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<AlertCircle className=\"w-3 h-3 mr-1\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{t.overtimeAlert}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t\t</TableBody>\n\t\t\t\t\t\t\t\t</Table>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t{/* Detailed Time Cards Table */}\n\t\t\t\t\t\t\t<div className=\"mt-8\">\n\t\t\t\t\t\t\t\t<h3 className=\"text-lg font-semibold mb-4\">{t.detailedReport}</h3>\n\t\t\t\t\t\t\t\t<div className=\"overflow-x-auto\">\n\t\t\t\t\t\t\t\t\t<Table className=\"print-table-responsive\">\n\t\t\t\t\t\t\t\t\t\t<TableHeader>\n\t\t\t\t\t\t\t\t\t\t\t<TableRow>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.employeeName}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.date}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.day}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.clockInTime}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.clockOutTime}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.location}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.workDescription}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.lunchDuration}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.hours}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.hourlyRate}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.pay}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t\t\t</TableHeader>\n\t\t\t\t\t\t\t\t\t\t<TableBody className=\"print-table-responsive\">\n\t\t\t\t\t\t\t\t\t\t\t{detailedTimeCards.map((tc) => {\n\t\t\t\t\t\t\t\t\t\t\t\tconst user = users.find(u => u.id === tc.user_id);\n\t\t\t\t\t\t\t\t\t\t\t\tconst hourlyRate = user?.hourly_rate || 0;\n\t\t\t\t\t\t\t\t\t\t\t\tconst pay = tc.total_hours ? tc.total_hours * hourlyRate : 0;\n\n\t\t\t\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<TableRow key={tc.id}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"font-medium whitespace-nowrap\">{user?.name || \"Unknown\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatDateOnly(tc.clock_in_timestamp)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{getDayOfWeek(tc.clock_in_timestamp)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatDate(tc.clock_in_timestamp)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{tc.clock_out_timestamp ? formatDate(tc.clock_out_timestamp) : \"—\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell>{tc.location || \"—\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"allow-wrap max-w-xs\">{tc.work_description || \"—\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{tc.lunch_duration_minutes ? `${Math.round(tc.lunch_duration_minutes)} min` : \"—\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{tc.total_hours ? `${tc.total_hours.toFixed(2)} hrs` : \"—\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{formatPay(hourlyRate)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{formatPay(pay)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t\t\t\t</TableBody>\n\t\t\t\t\t\t\t\t\t</Table>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</>\n\t\t\t\t\t)}\n\t\t\t\t</CardContent>\n\t\t\t</Card>\n\t\t</div>\n\t);\n}\n\nfunction EmployeesTab({ users, language, onUsersChange }: { users: UserModel[]; language: Language; onUsersChange: () => void }) {\n\tconst [showAddEmployee, setShowAddEmployee] = useState(false);\n\tconst [editingEmployee, setEditingEmployee] = useState<UserModel | null>(null);\n\tconst [employeeName, setEmployeeName] = useState(\"\");\n\tconst [employeeEmail, setEmployeeEmail] = useState(\"\");\n\tconst [employeePhone, setEmployeePhone] = useState(\"\");\n\tconst [employeeRole, setEmployeeRole] = useState<UserRole>(UserRole.Employee);\n\tconst [employeeHourlyRate, setEmployeeHourlyRate] = useState(\"\");\n\tconst [deleteConfirm, setDeleteConfirm] = useState<UserModel | null>(null);\n\n\tconst t = translations[language];\n\n\tconst handleAddEmployee = async () => {\n\t\tconst userORM = UserORM.getInstance();\n\t\tawait userORM.insertUser([{\n\t\t\tname: employeeName,\n\t\t\temail: employeeEmail,\n\t\t\tphone: employeePhone || null,\n\t\t\trole: employeeRole,\n\t\t\thourly_rate: employeeHourlyRate ? parseFloat(employeeHourlyRate) : null,\n\t\t} as UserModel]);\n\n\t\tsetShowAddEmployee(false);\n\t\tsetEmployeeName(\"\");\n\t\tsetEmployeeEmail(\"\");\n\t\tsetEmployeePhone(\"\");\n\t\tsetEmployeeRole(UserRole.Employee);\n\t\tsetEmployeeHourlyRate(\"\");\n\t\tonUsersChange();\n\t};\n\n\tconst handleEditEmployee = async () => {\n\t\tif (!editingEmployee) return;\n\n\t\tconst userORM = UserORM.getInstance();\n\t\tawait userORM.setUserById(editingEmployee.id, {\n\t\t\t...editingEmployee,\n\t\t\tname: employeeName,\n\t\t\temail: employeeEmail,\n\t\t\tphone: employeePhone || null,\n\t\t\trole: employeeRole,\n\t\t\thourly_rate: employeeHourlyRate ? parseFloat(employeeHourlyRate) : null,\n\t\t});\n\n\t\tsetEditingEmployee(null);\n\t\tsetEmployeeName(\"\");\n\t\tsetEmployeeEmail(\"\");\n\t\tsetEmployeePhone(\"\");\n\t\tsetEmployeeRole(UserRole.Employee);\n\t\tsetEmployeeHourlyRate(\"\");\n\t\tonUsersChange();\n\t};\n\n\tconst handleDeleteEmployee = async (user: UserModel) => {\n\t\tconst userORM = UserORM.getInstance();\n\t\tawait userORM.deleteUserById(user.id);\n\t\tsetDeleteConfirm(null);\n\t\tonUsersChange();\n\t};\n\n\tconst openEditDialog = (user: UserModel) => {\n\t\tsetEditingEmployee(user);\n\t\tsetEmployeeName(user.name);\n\t\tsetEmployeeEmail(user.email);\n\t\tsetEmployeePhone(user.phone || \"\");\n\t\tsetEmployeeRole(user.role);\n\t\tsetEmployeeHourlyRate(user.hourly_rate ? user.hourly_rate.toString() : \"\");\n\t};\n\n\treturn (\n\t\t<div className=\"space-y-4\">\n\t\t\t<Card>\n\t\t\t\t<CardHeader>\n\t\t\t\t\t<div className=\"flex justify-between items-center\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<CardTitle>{t.employees}</CardTitle>\n\t\t\t\t\t\t\t<CardDescription>Manage employee accounts</CardDescription>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<Button onClick={() => setShowAddEmployee(true)}>\n\t\t\t\t\t\t\t<UserPlus className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t\t\t{t.addEmployee}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t</CardHeader>\n\t\t\t\t<CardContent>\n\t\t\t\t\t<div className=\"overflow-x-auto\">\n\t\t\t\t\t\t<Table>\n\t\t\t\t\t\t\t<TableHeader>\n\t\t\t\t\t\t\t\t<TableRow>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.name}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.email}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.phone}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.role}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.hourlyRate}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.actions}</TableHead>\n\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t</TableHeader>\n\t\t\t\t\t\t\t<TableBody>\n\t\t\t\t\t\t\t\t{users.map((user) => (\n\t\t\t\t\t\t\t\t\t<TableRow key={user.id}>\n\t\t\t\t\t\t\t\t\t\t<TableCell className=\"font-medium\">{user.name}</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell>{user.email}</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell>{user.phone || \"—\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<Badge variant={user.role === UserRole.Manager ? \"default\" : \"secondary\"}>\n\t\t\t\t\t\t\t\t\t\t\t\t{user.role === UserRole.Manager ? t.manager : t.employee}\n\t\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t{user.hourly_rate ? `$${user.hourly_rate.toFixed(2)}/hr` : \"—\"}\n\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => openEditDialog(user)}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{t.edit}\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"destructive\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => setDeleteConfirm(user)}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{t.delete}\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</TableBody>\n\t\t\t\t\t\t</Table>\n\t\t\t\t\t</div>\n\t\t\t\t</CardContent>\n\t\t\t</Card>\n\n\t\t\t<Dialog open={showAddEmployee} onOpenChange={setShowAddEmployee}>\n\t\t\t\t<DialogContent>\n\t\t\t\t\t<DialogHeader>\n\t\t\t\t\t\t<DialogTitle>{t.addEmployee}</DialogTitle>\n\t\t\t\t\t</DialogHeader>\n\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.name}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\tvalue={employeeName}\n\t\t\t\t\t\t\t\tonChange={(e) => setEmployeeName(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder=\"John Doe\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.email}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"email\"\n\t\t\t\t\t\t\t\tvalue={employeeEmail}\n\t\t\t\t\t\t\t\tonChange={(e) => setEmployeeEmail(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder=\"john@example.com\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.phone}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"tel\"\n\t\t\t\t\t\t\t\tvalue={employeePhone}\n\t\t\t\t\t\t\t\tonChange={(e) => setEmployeePhone(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder=\"+1 (555) 123-4567\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.role}</Label>\n\t\t\t\t\t\t\t<Select value={employeeRole.toString()} onValueChange={(v) => setEmployeeRole(parseInt(v))}>\n\t\t\t\t\t\t\t\t<SelectTrigger>\n\t\t\t\t\t\t\t\t\t<SelectValue />\n\t\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t\t<SelectItem value={UserRole.Employee.toString()}>{t.employee}</SelectItem>\n\t\t\t\t\t\t\t\t\t<SelectItem value={UserRole.Manager.toString()}>{t.manager}</SelectItem>\n\t\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t\t</Select>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.hourlyRate}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\tmin=\"0\"\n\t\t\t\t\t\t\t\tstep=\"0.01\"\n\t\t\t\t\t\t\t\tvalue={employeeHourlyRate}\n\t\t\t\t\t\t\t\tonChange={(e) => setEmployeeHourlyRate(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder=\"15.00\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<DialogFooter>\n\t\t\t\t\t\t<Button variant=\"outline\" onClick={() => setShowAddEmployee(false)}>\n\t\t\t\t\t\t\t{t.cancel}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button onClick={handleAddEmployee} disabled={!employeeName || !employeeEmail}>\n\t\t\t\t\t\t\t{t.saveChanges}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</DialogFooter>\n\t\t\t\t</DialogContent>\n\t\t\t</Dialog>\n\n\t\t\t<Dialog open={!!editingEmployee} onOpenChange={(open) => !open && setEditingEmployee(null)}>\n\t\t\t\t<DialogContent>\n\t\t\t\t\t<DialogHeader>\n\t\t\t\t\t\t<DialogTitle>{t.editEmployee}</DialogTitle>\n\t\t\t\t\t</DialogHeader>\n\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.name}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\tvalue={employeeName}\n\t\t\t\t\t\t\t\tonChange={(e) => setEmployeeName(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.email}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"email\"\n\t\t\t\t\t\t\t\tvalue={employeeEmail}\n\t\t\t\t\t\t\t\tonChange={(e) => setEmployeeEmail(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.phone}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"tel\"\n\t\t\t\t\t\t\t\tvalue={employeePhone}\n\t\t\t\t\t\t\t\tonChange={(e) => setEmployeePhone(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder=\"+1 (555) 123-4567\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.role}</Label>\n\t\t\t\t\t\t\t<Select value={employeeRole.toString()} onValueChange={(v) => setEmployeeRole(parseInt(v))}>\n\t\t\t\t\t\t\t\t<SelectTrigger>\n\t\t\t\t\t\t\t\t\t<SelectValue />\n\t\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t\t<SelectItem value={UserRole.Employee.toString()}>{t.employee}</SelectItem>\n\t\t\t\t\t\t\t\t\t<SelectItem value={UserRole.Manager.toString()}>{t.manager}</SelectItem>\n\t\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t\t</Select>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.hourlyRate}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\tmin=\"0\"\n\t\t\t\t\t\t\t\tstep=\"0.01\"\n\t\t\t\t\t\t\t\tvalue={employeeHourlyRate}\n\t\t\t\t\t\t\t\tonChange={(e) => setEmployeeHourlyRate(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder=\"15.00\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<DialogFooter>\n\t\t\t\t\t\t<Button variant=\"outline\" onClick={() => setEditingEmployee(null)}>\n\t\t\t\t\t\t\t{t.cancel}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button onClick={handleEditEmployee}>\n\t\t\t\t\t\t\t{t.saveChanges}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</DialogFooter>\n\t\t\t\t</DialogContent>\n\t\t\t</Dialog>\n\n\t\t\t<Dialog open={!!deleteConfirm} onOpenChange={(open) => !open && setDeleteConfirm(null)}>\n\t\t\t\t<DialogContent>\n\t\t\t\t\t<DialogHeader>\n\t\t\t\t\t\t<DialogTitle>{t.deleteEmployee}</DialogTitle>\n\t\t\t\t\t</DialogHeader>\n\t\t\t\t\t<p>{t.confirmDelete}</p>\n\t\t\t\t\t<p className=\"font-semibold\">{deleteConfirm?.name}</p>\n\t\t\t\t\t<DialogFooter>\n\t\t\t\t\t\t<Button variant=\"outline\" onClick={() => setDeleteConfirm(null)}>\n\t\t\t\t\t\t\t{t.cancel}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button variant=\"destructive\" onClick={() => deleteConfirm && handleDeleteEmployee(deleteConfirm)}>\n\t\t\t\t\t\t\t{t.delete}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</DialogFooter>\n\t\t\t\t</DialogContent>\n\t\t\t</Dialog>\n\t\t</div>\n\t);\n}\n\nfunction ManualEntryDialog({\n\topen,\n\tonClose,\n\tuserId,\n\tonSave,\n\tlanguage,\n\tusers\n}: {\n\topen: boolean;\n\tonClose: () => void;\n\tuserId: string;\n\tonSave: () => void;\n\tlanguage: Language;\n\tusers?: UserModel[];\n}) {\n\tconst [selectedUser, setSelectedUser] = useState(userId);\n\tconst [clockIn, setClockIn] = useState(\"\");\n\tconst [clockOut, setClockOut] = useState(\"\");\n\tconst [location, setLocation] = useState(\"\");\n\tconst [workDescription, setWorkDescription] = useState(\"\");\n\tconst [lunchStart, setLunchStart] = useState(\"\");\n\tconst [lunchEnd, setLunchEnd] = useState(\"\");\n\n\tconst t = translations[language];\n\n\tuseEffect(() => {\n\t\tif (open) {\n\t\t\tsetSelectedUser(userId);\n\t\t\t// Set default to today\n\t\t\tconst now = new Date();\n\t\t\tconst today = now.toISOString().slice(0, 10);\n\t\t\tsetClockIn(`${today}T09:00`);\n\t\t\tsetClockOut(`${today}T17:00`);\n\t\t\tsetLocation(\"\");\n\t\t\tsetWorkDescription(\"\");\n\t\t\tsetLunchStart(`${today}T12:00`);\n\t\t\tsetLunchEnd(`${today}T13:00`);\n\t\t}\n\t}, [open, userId]);\n\n\tconst handleSave = async () => {\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\n\t\tconst clockInTimestamp = Math.floor(new Date(clockIn).getTime() / 1000).toString();\n\t\tconst clockOutTimestamp = clockOut ? Math.floor(new Date(clockOut).getTime() / 1000).toString() : undefined;\n\t\tconst lunchStartTimestamp = lunchStart ? Math.floor(new Date(lunchStart).getTime() / 1000).toString() : undefined;\n\t\tconst lunchEndTimestamp = lunchEnd ? Math.floor(new Date(lunchEnd).getTime() / 1000).toString() : undefined;\n\n\t\tlet totalHours: number | undefined = undefined;\n\t\tlet lunchDurationMinutes: number | undefined = undefined;\n\n\t\t// Calculate lunch duration\n\t\tif (lunchStartTimestamp && lunchEndTimestamp) {\n\t\t\tconst lunchStartTime = parseInt(lunchStartTimestamp);\n\t\t\tconst lunchEndTime = parseInt(lunchEndTimestamp);\n\t\t\tlunchDurationMinutes = (lunchEndTime - lunchStartTime) / 60;\n\t\t}\n\n\t\t// Calculate total hours\n\t\tif (clockOutTimestamp) {\n\t\t\tconst clockInTime = parseInt(clockInTimestamp);\n\t\t\tconst clockOutTime = parseInt(clockOutTimestamp);\n\t\t\ttotalHours = (clockOutTime - clockInTime) / 3600;\n\n\t\t\t// Deduct lunch time\n\t\t\tif (lunchDurationMinutes) {\n\t\t\t\ttotalHours -= lunchDurationMinutes / 60;\n\t\t\t}\n\t\t}\n\n\t\tconst entryData = {\n\t\t\tuser_id: selectedUser,\n\t\t\tclock_in_timestamp: clockInTimestamp,\n\t\t\tclock_out_timestamp: clockOutTimestamp,\n\t\t\ttotal_hours: totalHours,\n\t\t\tlocation: location || undefined,\n\t\t\twork_description: workDescription || undefined,\n\t\t\tlunch_start_timestamp: lunchStartTimestamp,\n\t\t\tlunch_end_timestamp: lunchEndTimestamp,\n\t\t\tlunch_duration_minutes: lunchDurationMinutes,\n\t\t} as TimeCardEntryModel;\n\n\t\tconst normalizedEntry = normalizeTimeCardEntryForSave(entryData);\n\t\tawait timeCardORM.insertTimeCardEntry([normalizedEntry as TimeCardEntryModel]);\n\n\t\tonSave();\n\t\tonClose();\n\t};\n\n\treturn (\n\t\t<Dialog open={open} onOpenChange={onClose}>\n\t\t\t<DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n\t\t\t\t<DialogHeader>\n\t\t\t\t\t<DialogTitle>{t.addManualEntry}</DialogTitle>\n\t\t\t\t</DialogHeader>\n\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t{users && (\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.employeeName}</Label>\n\t\t\t\t\t\t\t<Select value={selectedUser} onValueChange={setSelectedUser}>\n\t\t\t\t\t\t\t\t<SelectTrigger>\n\t\t\t\t\t\t\t\t\t<SelectValue />\n\t\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t\t{users.filter(u => u.role === UserRole.Employee).map((u) => (\n\t\t\t\t\t\t\t\t\t\t<SelectItem key={u.id} value={u.id}>\n\t\t\t\t\t\t\t\t\t\t\t{u.name}\n\t\t\t\t\t\t\t\t\t\t</SelectItem>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t\t</Select>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t\t<div className=\"grid grid-cols-2 gap-4\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.clockInTime}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\tvalue={clockIn}\n\t\t\t\t\t\t\t\tonChange={(e) => setClockIn(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.clockOutTime}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\tvalue={clockOut}\n\t\t\t\t\t\t\t\tonChange={(e) => setClockOut(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<Label>{t.location}</Label>\n\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\tvalue={location}\n\t\t\t\t\t\t\tonChange={(e) => setLocation(e.target.value)}\n\t\t\t\t\t\t\tplaceholder={t.locationPlaceholder}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<Label>{t.workDescription}</Label>\n\t\t\t\t\t\t<Textarea\n\t\t\t\t\t\t\tvalue={workDescription}\n\t\t\t\t\t\t\tonChange={(e) => setWorkDescription(e.target.value)}\n\t\t\t\t\t\t\tplaceholder={t.descriptionPlaceholder}\n\t\t\t\t\t\t\trows={4}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"grid grid-cols-2 gap-4\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.lunchStartTime} ({language === 'en' ? 'Optional' : 'Opcional'})</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\tvalue={lunchStart}\n\t\t\t\t\t\t\t\tonChange={(e) => setLunchStart(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.lunchEndTime} ({language === 'en' ? 'Optional' : 'Opcional'})</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\tvalue={lunchEnd}\n\t\t\t\t\t\t\t\tonChange={(e) => setLunchEnd(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<DialogFooter>\n\t\t\t\t\t<Button variant=\"outline\" onClick={onClose}>\n\t\t\t\t\t\t{t.cancel}\n\t\t\t\t\t</Button>\n\t\t\t\t\t<Button onClick={handleSave} disabled={!selectedUser || !clockIn}>\n\t\t\t\t\t\t{t.saveChanges}\n\t\t\t\t\t</Button>\n\t\t\t\t</DialogFooter>\n\t\t\t</DialogContent>\n\t\t</Dialog>\n\t);\n}\n","structuredPatch":[{"oldStart":230,"oldLines":6,"newStart":230,"newLines":10,"lines":["     totalPay: \"Pago Total\",","     regularPay: \"Pago Regular\",","     overtimePay: \"Pago Tiempo Extra\",","+    copyEmployeeLink: \"Copiar Enlace de Empleado\",","+    employeeLinkCopied: \"¡Enlace de empleado copiado!\",","+    myTimeTracking: \"Mi Registro de Tiempo\",","+    myHours: \"Mis Horas\",","   }"," };"," "]}],"userModified":false,"replaceAll":false}}
{"type":"assistant","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_vrtx_018vYYqAaDykWBGyFNxMd5CE","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_vrtx_01KCCL2QYwLFUPhHTim87Ghz","name":"TodoWrite","input":{"todos":[{"content":"Create shareable employee view with limited access","status":"in_progress","activeForm":"Creating employee view"},{"content":"Add employee link generation for managers","status":"in_progress","activeForm":"Adding link generation"},{"content":"Update translations for employee view","status":"completed","activeForm":"Updating translations"},{"content":"Test and validate changes","status":"pending","activeForm":"Testing changes"}]}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":2,"cache_creation_input_tokens":579,"cache_read_input_tokens":47981,"cache_creation":{"ephemeral_5m_input_tokens":579,"ephemeral_1h_input_tokens":0},"output_tokens":162},"context_management":null},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"1ecbe9c6-a668-4e1a-9da8-0149c51ef92b"}
{"type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_vrtx_01KCCL2QYwLFUPhHTim87Ghz","type":"tool_result","content":"Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable"}]},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"10b36d8b-60a2-4a48-8b85-c679ed4a560b","tool_use_result":{"oldTodos":[{"content":"Create shareable employee view with limited access","status":"in_progress","activeForm":"Creating employee view"},{"content":"Add employee link generation for managers","status":"pending","activeForm":"Adding link generation"},{"content":"Update translations for employee view","status":"pending","activeForm":"Updating translations"},{"content":"Test and validate changes","status":"pending","activeForm":"Testing changes"}],"newTodos":[{"content":"Create shareable employee view with limited access","status":"in_progress","activeForm":"Creating employee view"},{"content":"Add employee link generation for managers","status":"in_progress","activeForm":"Adding link generation"},{"content":"Update translations for employee view","status":"completed","activeForm":"Updating translations"},{"content":"Test and validate changes","status":"pending","activeForm":"Testing changes"}]}}
{"type":"assistant","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_vrtx_01FLAsjg178JTb7U9wCJ9Gc9","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me find where the main app view is rendered and update it to show employee-only mode when needed. Let me read the current manager/employee view:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":2,"cache_creation_input_tokens":204,"cache_read_input_tokens":48560,"cache_creation":{"ephemeral_5m_input_tokens":204,"ephemeral_1h_input_tokens":0},"output_tokens":1},"context_management":null},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"e051ec81-24df-4ebb-9c75-68f0c59c1eea"}
{"type":"assistant","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_vrtx_01FLAsjg178JTb7U9wCJ9Gc9","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_vrtx_01EsxnLXksmC8r41NfbLrvDA","name":"Read","input":{"file_path":"/home/user/vite-template/src/routes/index.tsx","offset":338,"limit":80}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":2,"cache_creation_input_tokens":204,"cache_read_input_tokens":48560,"cache_creation":{"ephemeral_5m_input_tokens":204,"ephemeral_1h_input_tokens":0},"output_tokens":137},"context_management":null},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"5844ae04-2786-496d-be14-d1684af661b8"}
{"type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_vrtx_01EsxnLXksmC8r41NfbLrvDA","type":"tool_result","content":"   338→\t\t\t\t\t\t\t\t\t{users.map((user) => (\n   339→\t\t\t\t\t\t\t\t\t\t<SelectItem key={user.id} value={user.id}>\n   340→\t\t\t\t\t\t\t\t\t\t\t{user.name} - {user.role === UserRole.Manager ? t.manager : t.employee}\n   341→\t\t\t\t\t\t\t\t\t\t</SelectItem>\n   342→\t\t\t\t\t\t\t\t\t))}\n   343→\t\t\t\t\t\t\t\t</SelectContent>\n   344→\t\t\t\t\t\t\t</Select>\n   345→\t\t\t\t\t\t</div>\n   346→\t\t\t\t\t</CardContent>\n   347→\t\t\t\t</Card>\n   348→\t\t\t</div>\n   349→\t\t);\n   350→\t}\n   351→\n   352→\treturn (\n   353→\t\t<div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800\">\n   354→\t\t\t<div className=\"container mx-auto p-6 space-y-6\">\n   355→\t\t\t\t<div className=\"flex justify-between items-center\">\n   356→\t\t\t\t\t<div>\n   357→\t\t\t\t\t\t<h1 className=\"text-3xl font-bold\">{t.timeTrackingSystem}</h1>\n   358→\t\t\t\t\t\t<p className=\"text-muted-foreground\">\n   359→\t\t\t\t\t\t\t{t.welcome}, {currentUser.name} ({currentUser.role === UserRole.Manager ? t.manager : t.employee})\n   360→\t\t\t\t\t\t</p>\n   361→\t\t\t\t\t</div>\n   362→\t\t\t\t\t<div className=\"flex gap-2\">\n   363→\t\t\t\t\t\t<Button onClick={toggleLanguage} variant=\"outline\" size=\"sm\">\n   364→\t\t\t\t\t\t\t<Languages className=\"w-4 h-4 mr-2\" />\n   365→\t\t\t\t\t\t\t{language === 'en' ? 'Español' : 'English'}\n   366→\t\t\t\t\t\t</Button>\n   367→\t\t\t\t\t\t<Button onClick={handleLogout} variant=\"outline\">\n   368→\t\t\t\t\t\t\t{t.switchUser}\n   369→\t\t\t\t\t\t</Button>\n   370→\t\t\t\t\t</div>\n   371→\t\t\t\t</div>\n   372→\n   373→\t\t\t\t{currentUser.role === UserRole.Employee ? (\n   374→\t\t\t\t\t<EmployeeView user={currentUser} language={language} />\n   375→\t\t\t\t) : (\n   376→\t\t\t\t\t<ManagerView user={currentUser} users={users} language={language} onUsersChange={loadUsers} />\n   377→\t\t\t\t)}\n   378→\t\t\t</div>\n   379→\t\t</div>\n   380→\t);\n   381→}\n   382→\n   383→function SickDayCard({ user, language }: { user: UserModel; language: Language }) {\n   384→\tconst [sickDays, setSickDays] = useState<SickDayModel[]>([]);\n   385→\tconst [showAddDialog, setShowAddDialog] = useState(false);\n   386→\tconst [sickDate, setSickDate] = useState(\"\");\n   387→\tconst [sickHours, setSickHours] = useState(\"8\");\n   388→\tconst [sickNotes, setSickNotes] = useState(\"\");\n   389→\n   390→\tconst t = translations[language];\n   391→\n   392→\tuseEffect(() => {\n   393→\t\tloadSickDays();\n   394→\t}, [user.id]);\n   395→\n   396→\tconst loadSickDays = async () => {\n   397→\t\tconst sickDayORM = SickDayORM.getInstance();\n   398→\t\tconst userSickDays = await sickDayORM.getSickDayByUserId(user.id);\n   399→\n   400→\t\t// Sort by date (newest first)\n   401→\t\tconst sorted = userSickDays.sort((a, b) =>\n   402→\t\t\tnew Date(b.sick_date).getTime() - new Date(a.sick_date).getTime()\n   403→\t\t);\n   404→\n   405→\t\tsetSickDays(sorted);\n   406→\t};\n   407→\n   408→\tconst handleAddSickDay = async () => {\n   409→\t\tif (!sickDate || !sickHours) {\n   410→\t\t\talert(\"Please fill in date and hours\");\n   411→\t\t\treturn;\n   412→\t\t}\n   413→\n   414→\t\tconst sickDayORM = SickDayORM.getInstance();\n   415→\t\tawait sickDayORM.insertSickDay([{\n   416→\t\t\tuser_id: user.id,\n   417→\t\t\tsick_date: sickDate,\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"3bdd2328-be4a-417e-89bd-ab07ae07d9aa","tool_use_result":{"type":"text","file":{"filePath":"/home/user/vite-template/src/routes/index.tsx","content":"\t\t\t\t\t\t\t\t\t{users.map((user) => (\n\t\t\t\t\t\t\t\t\t\t<SelectItem key={user.id} value={user.id}>\n\t\t\t\t\t\t\t\t\t\t\t{user.name} - {user.role === UserRole.Manager ? t.manager : t.employee}\n\t\t\t\t\t\t\t\t\t\t</SelectItem>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t\t</Select>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</CardContent>\n\t\t\t\t</Card>\n\t\t\t</div>\n\t\t);\n\t}\n\n\treturn (\n\t\t<div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800\">\n\t\t\t<div className=\"container mx-auto p-6 space-y-6\">\n\t\t\t\t<div className=\"flex justify-between items-center\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<h1 className=\"text-3xl font-bold\">{t.timeTrackingSystem}</h1>\n\t\t\t\t\t\t<p className=\"text-muted-foreground\">\n\t\t\t\t\t\t\t{t.welcome}, {currentUser.name} ({currentUser.role === UserRole.Manager ? t.manager : t.employee})\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"flex gap-2\">\n\t\t\t\t\t\t<Button onClick={toggleLanguage} variant=\"outline\" size=\"sm\">\n\t\t\t\t\t\t\t<Languages className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t\t\t{language === 'en' ? 'Español' : 'English'}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button onClick={handleLogout} variant=\"outline\">\n\t\t\t\t\t\t\t{t.switchUser}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t{currentUser.role === UserRole.Employee ? (\n\t\t\t\t\t<EmployeeView user={currentUser} language={language} />\n\t\t\t\t) : (\n\t\t\t\t\t<ManagerView user={currentUser} users={users} language={language} onUsersChange={loadUsers} />\n\t\t\t\t)}\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n\nfunction SickDayCard({ user, language }: { user: UserModel; language: Language }) {\n\tconst [sickDays, setSickDays] = useState<SickDayModel[]>([]);\n\tconst [showAddDialog, setShowAddDialog] = useState(false);\n\tconst [sickDate, setSickDate] = useState(\"\");\n\tconst [sickHours, setSickHours] = useState(\"8\");\n\tconst [sickNotes, setSickNotes] = useState(\"\");\n\n\tconst t = translations[language];\n\n\tuseEffect(() => {\n\t\tloadSickDays();\n\t}, [user.id]);\n\n\tconst loadSickDays = async () => {\n\t\tconst sickDayORM = SickDayORM.getInstance();\n\t\tconst userSickDays = await sickDayORM.getSickDayByUserId(user.id);\n\n\t\t// Sort by date (newest first)\n\t\tconst sorted = userSickDays.sort((a, b) =>\n\t\t\tnew Date(b.sick_date).getTime() - new Date(a.sick_date).getTime()\n\t\t);\n\n\t\tsetSickDays(sorted);\n\t};\n\n\tconst handleAddSickDay = async () => {\n\t\tif (!sickDate || !sickHours) {\n\t\t\talert(\"Please fill in date and hours\");\n\t\t\treturn;\n\t\t}\n\n\t\tconst sickDayORM = SickDayORM.getInstance();\n\t\tawait sickDayORM.insertSickDay([{\n\t\t\tuser_id: user.id,\n\t\t\tsick_date: sickDate,","numLines":80,"startLine":338,"totalLines":2465}}}
{"type":"assistant","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_vrtx_01B1ZbCAor7psH1dHTK7DLAs","type":"message","role":"assistant","content":[{"type":"text","text":"Good! I can see the app already separates views for employees and managers. Now I need to update the main return to hide the \"Switch User\" button in employee-only mode:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":2,"cache_creation_input_tokens":1329,"cache_read_input_tokens":48764,"cache_creation":{"ephemeral_5m_input_tokens":1329,"ephemeral_1h_input_tokens":0},"output_tokens":1},"context_management":null},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"992c1a6e-c3fd-4aae-94fa-9d8e2b57fbb3"}
{"type":"assistant","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_vrtx_01B1ZbCAor7psH1dHTK7DLAs","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_vrtx_01SLbctJHrVeBWkKmEK8FUfz","name":"Edit","input":{"file_path":"/home/user/vite-template/src/routes/index.tsx","old_string":"\treturn (\n\t\t<div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800\">\n\t\t\t<div className=\"container mx-auto p-6 space-y-6\">\n\t\t\t\t<div className=\"flex justify-between items-center\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<h1 className=\"text-3xl font-bold\">{t.timeTrackingSystem}</h1>\n\t\t\t\t\t\t<p className=\"text-muted-foreground\">\n\t\t\t\t\t\t\t{t.welcome}, {currentUser.name} ({currentUser.role === UserRole.Manager ? t.manager : t.employee})\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"flex gap-2\">\n\t\t\t\t\t\t<Button onClick={toggleLanguage} variant=\"outline\" size=\"sm\">\n\t\t\t\t\t\t\t<Languages className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t\t\t{language === 'en' ? 'Español' : 'English'}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button onClick={handleLogout} variant=\"outline\">\n\t\t\t\t\t\t\t{t.switchUser}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t{currentUser.role === UserRole.Employee ? (\n\t\t\t\t\t<EmployeeView user={currentUser} language={language} />\n\t\t\t\t) : (\n\t\t\t\t\t<ManagerView user={currentUser} users={users} language={language} onUsersChange={loadUsers} />\n\t\t\t\t)}\n\t\t\t</div>\n\t\t</div>\n\t);","new_string":"\treturn (\n\t\t<div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800\">\n\t\t\t<div className=\"container mx-auto p-6 space-y-6\">\n\t\t\t\t<div className=\"flex justify-between items-center\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<h1 className=\"text-3xl font-bold\">\n\t\t\t\t\t\t\t{employeeOnlyMode ? t.myTimeTracking : t.timeTrackingSystem}\n\t\t\t\t\t\t</h1>\n\t\t\t\t\t\t<p className=\"text-muted-foreground\">\n\t\t\t\t\t\t\t{t.welcome}, {currentUser.name} ({currentUser.role === UserRole.Manager ? t.manager : t.employee})\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"flex gap-2\">\n\t\t\t\t\t\t<Button onClick={toggleLanguage} variant=\"outline\" size=\"sm\">\n\t\t\t\t\t\t\t<Languages className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t\t\t{language === 'en' ? 'Español' : 'English'}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t{!employeeOnlyMode && (\n\t\t\t\t\t\t\t<Button onClick={handleLogout} variant=\"outline\">\n\t\t\t\t\t\t\t\t{t.switchUser}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t{currentUser.role === UserRole.Employee ? (\n\t\t\t\t\t<EmployeeView user={currentUser} language={language} />\n\t\t\t\t) : (\n\t\t\t\t\t<ManagerView user={currentUser} users={users} language={language} onUsersChange={loadUsers} />\n\t\t\t\t)}\n\t\t\t</div>\n\t\t</div>\n\t);"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":2,"cache_creation_input_tokens":1329,"cache_read_input_tokens":48764,"cache_creation":{"ephemeral_5m_input_tokens":1329,"ephemeral_1h_input_tokens":0},"output_tokens":902},"context_management":null},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"0c80663b-f189-493f-bb6a-07d9da2515df"}
{"type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_vrtx_01SLbctJHrVeBWkKmEK8FUfz","type":"tool_result","content":"The file /home/user/vite-template/src/routes/index.tsx has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n   348→\t\t\t</div>\n   349→\t\t);\n   350→\t}\n   351→\n   352→\treturn (\n   353→\t\t<div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800\">\n   354→\t\t\t<div className=\"container mx-auto p-6 space-y-6\">\n   355→\t\t\t\t<div className=\"flex justify-between items-center\">\n   356→\t\t\t\t\t<div>\n   357→\t\t\t\t\t\t<h1 className=\"text-3xl font-bold\">\n   358→\t\t\t\t\t\t\t{employeeOnlyMode ? t.myTimeTracking : t.timeTrackingSystem}\n   359→\t\t\t\t\t\t</h1>\n   360→\t\t\t\t\t\t<p className=\"text-muted-foreground\">\n   361→\t\t\t\t\t\t\t{t.welcome}, {currentUser.name} ({currentUser.role === UserRole.Manager ? t.manager : t.employee})\n   362→\t\t\t\t\t\t</p>\n   363→\t\t\t\t\t</div>\n   364→\t\t\t\t\t<div className=\"flex gap-2\">\n   365→\t\t\t\t\t\t<Button onClick={toggleLanguage} variant=\"outline\" size=\"sm\">\n   366→\t\t\t\t\t\t\t<Languages className=\"w-4 h-4 mr-2\" />\n   367→\t\t\t\t\t\t\t{language === 'en' ? 'Español' : 'English'}\n   368→\t\t\t\t\t\t</Button>\n   369→\t\t\t\t\t\t{!employeeOnlyMode && (\n   370→\t\t\t\t\t\t\t<Button onClick={handleLogout} variant=\"outline\">\n   371→\t\t\t\t\t\t\t\t{t.switchUser}\n   372→\t\t\t\t\t\t\t</Button>\n   373→\t\t\t\t\t\t)}\n   374→\t\t\t\t\t</div>\n   375→\t\t\t\t</div>\n   376→\n   377→\t\t\t\t{currentUser.role === UserRole.Employee ? (\n   378→\t\t\t\t\t<EmployeeView user={currentUser} language={language} />\n   379→\t\t\t\t) : (\n   380→\t\t\t\t\t<ManagerView user={currentUser} users={users} language={language} onUsersChange={loadUsers} />\n   381→\t\t\t\t)}\n   382→\t\t\t</div>\n   383→\t\t</div>\n   384→\t);\n   385→}\n   386→\n   387→function SickDayCard({ user, language }: { user: UserModel; language: Language }) {\n   388→\tconst [sickDays, setSickDays] = useState<SickDayModel[]>([]);"}]},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"9b15aee5-4fc6-452b-b6be-c7708158b1ad","tool_use_result":{"filePath":"/home/user/vite-template/src/routes/index.tsx","oldString":"\treturn (\n\t\t<div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800\">\n\t\t\t<div className=\"container mx-auto p-6 space-y-6\">\n\t\t\t\t<div className=\"flex justify-between items-center\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<h1 className=\"text-3xl font-bold\">{t.timeTrackingSystem}</h1>\n\t\t\t\t\t\t<p className=\"text-muted-foreground\">\n\t\t\t\t\t\t\t{t.welcome}, {currentUser.name} ({currentUser.role === UserRole.Manager ? t.manager : t.employee})\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"flex gap-2\">\n\t\t\t\t\t\t<Button onClick={toggleLanguage} variant=\"outline\" size=\"sm\">\n\t\t\t\t\t\t\t<Languages className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t\t\t{language === 'en' ? 'Español' : 'English'}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button onClick={handleLogout} variant=\"outline\">\n\t\t\t\t\t\t\t{t.switchUser}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t{currentUser.role === UserRole.Employee ? (\n\t\t\t\t\t<EmployeeView user={currentUser} language={language} />\n\t\t\t\t) : (\n\t\t\t\t\t<ManagerView user={currentUser} users={users} language={language} onUsersChange={loadUsers} />\n\t\t\t\t)}\n\t\t\t</div>\n\t\t</div>\n\t);","newString":"\treturn (\n\t\t<div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800\">\n\t\t\t<div className=\"container mx-auto p-6 space-y-6\">\n\t\t\t\t<div className=\"flex justify-between items-center\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<h1 className=\"text-3xl font-bold\">\n\t\t\t\t\t\t\t{employeeOnlyMode ? t.myTimeTracking : t.timeTrackingSystem}\n\t\t\t\t\t\t</h1>\n\t\t\t\t\t\t<p className=\"text-muted-foreground\">\n\t\t\t\t\t\t\t{t.welcome}, {currentUser.name} ({currentUser.role === UserRole.Manager ? t.manager : t.employee})\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"flex gap-2\">\n\t\t\t\t\t\t<Button onClick={toggleLanguage} variant=\"outline\" size=\"sm\">\n\t\t\t\t\t\t\t<Languages className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t\t\t{language === 'en' ? 'Español' : 'English'}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t{!employeeOnlyMode && (\n\t\t\t\t\t\t\t<Button onClick={handleLogout} variant=\"outline\">\n\t\t\t\t\t\t\t\t{t.switchUser}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t{currentUser.role === UserRole.Employee ? (\n\t\t\t\t\t<EmployeeView user={currentUser} language={language} />\n\t\t\t\t) : (\n\t\t\t\t\t<ManagerView user={currentUser} users={users} language={language} onUsersChange={loadUsers} />\n\t\t\t\t)}\n\t\t\t</div>\n\t\t</div>\n\t);","originalFile":"import { createFileRoute } from \"@tanstack/react-router\";\nimport { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from \"@/components/ui/dialog\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Clock, Users, CalendarDays, Timer, Languages, Coffee, UserPlus, FileText, AlertCircle, Plus, Trash2, Heart } from \"lucide-react\";\nimport { UserORM, type UserModel, UserRole } from \"@/sdk/database/orm/orm_user\";\nimport { TimeCardEntryORM, type TimeCardEntryModel } from \"@/sdk/database/orm/orm_time_card_entry\";\nimport { SickDayORM, type SickDayModel } from \"@/sdk/database/orm/orm_sick_day\";\nimport { normalizeTimeCardEntryForSave, normalizeTimeCardEntriesFromORM, isActiveShift, isOnLunchBreak } from \"@/lib/orm-data-helpers\";\n\nexport const Route = createFileRoute(\"/\")({\n\tcomponent: App,\n});\n\ntype Language = 'en' | 'es';\n\nconst translations = {\n\ten: {\n\t\tappTitle: \"Employee Time Tracking\",\n\t\tselectAccount: \"Select your account to continue\",\n\t\tselectUser: \"Select User\",\n\t\tchooseAccount: \"Choose your account\",\n\t\tmanager: \"Manager\",\n\t\temployee: \"Employee\",\n\t\tswitchUser: \"Switch User\",\n\t\ttimeTrackingSystem: \"Time Tracking System\",\n\t\twelcome: \"Welcome\",\n\t\tclockInOut: \"Clock In/Out\",\n\t\tcurrentlyClocked: \"Currently Clocked In\",\n\t\tsince: \"Since\",\n\t\telapsedTime: \"Elapsed Time\",\n\t\tclockOut: \"Clock Out\",\n\t\tnotClocked: \"Not currently clocked in\",\n\t\tclockIn: \"Clock In\",\n\t\ttimeCardHistory: \"Time Card History\",\n\t\trecentRecords: \"Your recent clock in/out records\",\n\t\tnoTimeCards: \"No time cards yet\",\n\t\tclockInTime: \"Clock In\",\n\t\tclockOutTime: \"Clock Out\",\n\t\thours: \"Hours\",\n\t\tstatus: \"Status\",\n\t\tcompleted: \"Completed\",\n\t\tactive: \"Active\",\n\t\ttotalEmployees: \"Total Employees\",\n\t\thoursToday: \"Hours Today\",\n\t\thoursThisWeek: \"Hours This Week\",\n\t\tallEmployeeTimeCards: \"All Employee Time Cards\",\n\t\tviewManageRecords: \"View and manage all employee time records\",\n\t\tfilterByEmployee: \"Filter by Employee\",\n\t\tallEmployees: \"All Employees\",\n\t\tfilterByDate: \"Filter by Date\",\n\t\tclearFilters: \"Clear Filters\",\n\t\tnoTimeCardsFound: \"No time cards found\",\n\t\temployeeName: \"Employee\",\n\t\tactions: \"Actions\",\n\t\tedit: \"Edit\",\n\t\teditTimeCard: \"Edit Time Card\",\n\t\tcancel: \"Cancel\",\n\t\tsaveChanges: \"Save Changes\",\n\t\tlocation: \"Location\",\n\t\twhereWorked: \"Where did you work?\",\n\t\tworkDescription: \"Work Description\",\n\t\twhatDid: \"What did you do today?\",\n\t\tlocationPlaceholder: \"e.g., Office, Remote, Client Site\",\n\t\tdescriptionPlaceholder: \"Describe your work activities...\",\n\t\tstartLunch: \"Start Lunch Break\",\n\t\tendLunch: \"End Lunch Break\",\n\t\tonLunchBreak: \"On Lunch Break\",\n\t\tlunchBreak: \"Lunch Break\",\n\t\tlunchDuration: \"Lunch\",\n\t\tlunchStartTime: \"Lunch Start\",\n\t\tlunchEndTime: \"Lunch End\",\n\t\ttimeCards: \"Time Cards\",\n\t\treports: \"Reports\",\n\t\temployees: \"Employees\",\n\t\taddEmployee: \"Add Employee\",\n\t\teditEmployee: \"Edit Employee\",\n\t\tdeleteEmployee: \"Delete Employee\",\n\t\tname: \"Name\",\n\t\temail: \"Email\",\n\t\tphone: \"Phone\",\n\t\trole: \"Role\",\n\t\tdelete: \"Delete\",\n\t\tweeklyReport: \"Weekly Report\",\n\t\tselectWeek: \"Select Week\",\n\t\tregularHours: \"Regular\",\n\t\tovertimeHours: \"Overtime\",\n\t\ttotalHours: \"Total\",\n\t\tnoReportData: \"No data for selected week\",\n\t\taddTimeCard: \"Add Time Card\",\n\t\tmanualEntry: \"Manual Entry\",\n\t\taddManualEntry: \"Add Manual Time Card\",\n\t\tconfirmDelete: \"Are you sure you want to delete this employee?\",\n\t\tovertimeAlert: \"Overtime Alert\",\n\t\tprintReport: \"Print Report\",\n\t\texportCSV: \"Export to CSV\",\n\t\tdetailedReport: \"Detailed Time Card Report\",\n\t\tdate: \"Date\",\n\t\tday: \"Day\",\n\t\tdeleteTimeCard: \"Delete Time Card\",\n\t\tconfirmDeleteTimeCard: \"Are you sure you want to delete this time card? This action cannot be undone.\",\n\t\tsickDays: \"Sick Days\",\n\t\taddSickDay: \"Add Sick Day\",\n\t\tsickDayDate: \"Sick Day Date\",\n\t\tsickDayHours: \"Hours\",\n\t\tsickDayNotes: \"Notes/Reason\",\n\t\tsickDayNotesPlaceholder: \"e.g., Doctor's appointment, flu, etc.\",\n\t\tmySickDays: \"My Sick Days\",\n\t\tnoSickDays: \"No sick days recorded\",\n\t\ttotalSickDays: \"Total Sick Days\",\n\t\tdeleteSickDay: \"Delete Sick Day\",\n\t\tconfirmDeleteSickDay: \"Are you sure you want to delete this sick day? This action cannot be undone.\",\n\t\tsickDayHistory: \"Sick Day History\",\n\t\thourlyRate: \"Hourly Rate\",\n\t\tpay: \"Pay\",\n\t\ttotalPay: \"Total Pay\",\n\t\tregularPay: \"Regular Pay\",\n\t\tovertimePay: \"Overtime Pay\",\n\t\tcopyEmployeeLink: \"Copy Employee Link\",\n\t\temployeeLinkCopied: \"Employee link copied!\",\n\t\tmyTimeTracking: \"My Time Tracking\",\n\t\tmyHours: \"My Hours\",\n\t},\n\tes: {\n\t\tappTitle: \"Registro de Tiempo de Empleados\",\n\t\tselectAccount: \"Selecciona tu cuenta para continuar\",\n\t\tselectUser: \"Seleccionar Usuario\",\n\t\tchooseAccount: \"Elige tu cuenta\",\n\t\tmanager: \"Gerente\",\n\t\temployee: \"Empleado\",\n\t\tswitchUser: \"Cambiar Usuario\",\n\t\ttimeTrackingSystem: \"Sistema de Registro de Tiempo\",\n\t\twelcome: \"Bienvenido\",\n\t\tclockInOut: \"Entrada/Salida\",\n\t\tcurrentlyClocked: \"Actualmente Registrado\",\n\t\tsince: \"Desde\",\n\t\telapsedTime: \"Tiempo Transcurrido\",\n\t\tclockOut: \"Registrar Salida\",\n\t\tnotClocked: \"No está registrado actualmente\",\n\t\tclockIn: \"Registrar Entrada\",\n\t\ttimeCardHistory: \"Historial de Tarjetas de Tiempo\",\n\t\trecentRecords: \"Tus registros recientes de entrada/salida\",\n\t\tnoTimeCards: \"No hay tarjetas de tiempo todavía\",\n\t\tclockInTime: \"Entrada\",\n\t\tclockOutTime: \"Salida\",\n\t\thours: \"Horas\",\n\t\tstatus: \"Estado\",\n\t\tcompleted: \"Completado\",\n\t\tactive: \"Activo\",\n\t\ttotalEmployees: \"Total de Empleados\",\n\t\thoursToday: \"Horas Hoy\",\n\t\thoursThisWeek: \"Horas Esta Semana\",\n\t\tallEmployeeTimeCards: \"Todas las Tarjetas de Tiempo\",\n\t\tviewManageRecords: \"Ver y gestionar todos los registros de empleados\",\n\t\tfilterByEmployee: \"Filtrar por Empleado\",\n\t\tallEmployees: \"Todos los Empleados\",\n\t\tfilterByDate: \"Filtrar por Fecha\",\n\t\tclearFilters: \"Limpiar Filtros\",\n\t\tnoTimeCardsFound: \"No se encontraron tarjetas de tiempo\",\n\t\temployeeName: \"Empleado\",\n\t\tactions: \"Acciones\",\n\t\tedit: \"Editar\",\n\t\teditTimeCard: \"Editar Tarjeta de Tiempo\",\n\t\tcancel: \"Cancelar\",\n\t\tsaveChanges: \"Guardar Cambios\",\n\t\tlocation: \"Ubicación\",\n\t\twhereWorked: \"¿Dónde trabajaste?\",\n\t\tworkDescription: \"Descripción del Trabajo\",\n\t\twhatDid: \"¿Qué hiciste hoy?\",\n\t\tlocationPlaceholder: \"ej., Oficina, Remoto, Sitio del Cliente\",\n\t\tdescriptionPlaceholder: \"Describe tus actividades laborales...\",\n\t\tstartLunch: \"Iniciar Almuerzo\",\n\t\tendLunch: \"Terminar Almuerzo\",\n\t\tonLunchBreak: \"En Almuerzo\",\n\t\tlunchBreak: \"Almuerzo\",\n\t\tlunchDuration: \"Almuerzo\",\n\t\tlunchStartTime: \"Inicio Almuerzo\",\n\t\tlunchEndTime: \"Fin Almuerzo\",\n\t\ttimeCards: \"Tarjetas de Tiempo\",\n\t\treports: \"Informes\",\n\t\temployees: \"Empleados\",\n\t\taddEmployee: \"Agregar Empleado\",\n\t\teditEmployee: \"Editar Empleado\",\n\t\tdeleteEmployee: \"Eliminar Empleado\",\n\t\tname: \"Nombre\",\n\t\temail: \"Correo\",\n\t\tphone: \"Teléfono\",\n\t\trole: \"Rol\",\n\t\tdelete: \"Eliminar\",\n\t\tweeklyReport: \"Informe Semanal\",\n\t\tselectWeek: \"Seleccionar Semana\",\n\t\tregularHours: \"Regular\",\n\t\tovertimeHours: \"Tiempo Extra\",\n\t\ttotalHours: \"Total\",\n\t\tnoReportData: \"No hay datos para la semana seleccionada\",\n\t\taddTimeCard: \"Agregar Tarjeta\",\n\t\tmanualEntry: \"Entrada Manual\",\n\t\taddManualEntry: \"Agregar Tarjeta Manual\",\n\t\tconfirmDelete: \"¿Está seguro de eliminar este empleado?\",\n\t\tovertimeAlert: \"Alerta de Tiempo Extra\",\n\t\tprintReport: \"Imprimir Informe\",\n\t\texportCSV: \"Exportar a CSV\",\n\t\tdetailedReport: \"Informe Detallado de Tarjetas de Tiempo\",\n\t\tdate: \"Fecha\",\n\t\tday: \"Día\",\n\t\tdeleteTimeCard: \"Eliminar Tarjeta de Tiempo\",\n\t\tconfirmDeleteTimeCard: \"¿Está seguro de eliminar esta tarjeta de tiempo? Esta acción no se puede deshacer.\",\n\t\tsickDays: \"Días de Enfermedad\",\n\t\taddSickDay: \"Agregar Día de Enfermedad\",\n\t\tsickDayDate: \"Fecha de Enfermedad\",\n\t\tsickDayHours: \"Horas\",\n\t\tsickDayNotes: \"Notas/Razón\",\n\t\tsickDayNotesPlaceholder: \"ej., Cita médica, gripe, etc.\",\n\t\tmySickDays: \"Mis Días de Enfermedad\",\n\t\tnoSickDays: \"No hay días de enfermedad registrados\",\n\t\ttotalSickDays: \"Total Días de Enfermedad\",\n\t\tdeleteSickDay: \"Eliminar Día de Enfermedad\",\n\t\tconfirmDeleteSickDay: \"¿Está seguro de eliminar este día de enfermedad? Esta acción no se puede deshacer.\",\n\t\tsickDayHistory: \"Historial de Días de Enfermedad\",\n\t\thourlyRate: \"Tarifa por Hora\",\n\t\tpay: \"Pago\",\n\t\ttotalPay: \"Pago Total\",\n\t\tregularPay: \"Pago Regular\",\n\t\tovertimePay: \"Pago Tiempo Extra\",\n\t\tcopyEmployeeLink: \"Copiar Enlace de Empleado\",\n\t\temployeeLinkCopied: \"¡Enlace de empleado copiado!\",\n\t\tmyTimeTracking: \"Mi Registro de Tiempo\",\n\t\tmyHours: \"Mis Horas\",\n\t}\n};\n\nfunction App() {\n\tconst [currentUser, setCurrentUser] = useState<UserModel | null>(null);\n\tconst [users, setUsers] = useState<UserModel[]>([]);\n\tconst [showUserSelect, setShowUserSelect] = useState(true);\n\tconst [language, setLanguage] = useState<Language>('en');\n\tconst [employeeOnlyMode, setEmployeeOnlyMode] = useState(false);\n\n\tconst t = translations[language];\n\n\tuseEffect(() => {\n\t\tloadUsers();\n\t}, []);\n\n\t// Check for employee URL parameter and auto-login\n\tuseEffect(() => {\n\t\tif (users.length > 0 && !currentUser) {\n\t\t\tconst urlParams = new URLSearchParams(window.location.search);\n\t\t\tconst employeeId = urlParams.get('employee');\n\n\t\t\tif (employeeId) {\n\t\t\t\tconst user = users.find(u => u.id === employeeId && u.role === UserRole.Employee);\n\t\t\t\tif (user) {\n\t\t\t\t\tsetCurrentUser(user);\n\t\t\t\t\tsetShowUserSelect(false);\n\t\t\t\t\tsetEmployeeOnlyMode(true);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}, [users, currentUser]);\n\n\tconst loadUsers = async () => {\n\t\tconst userORM = UserORM.getInstance();\n\t\tconst allUsers = await userORM.getAllUser();\n\n\t\t// If no users exist, create demo users\n\t\tif (allUsers.length === 0) {\n\t\t\tconst demoUsers = await userORM.insertUser([\n\t\t\t\t{\n\t\t\t\t\tname: \"John Smith\",\n\t\t\t\t\temail: \"john@example.com\",\n\t\t\t\t\trole: UserRole.Employee,\n\t\t\t\t} as UserModel,\n\t\t\t\t{\n\t\t\t\t\tname: \"Sarah Johnson\",\n\t\t\t\t\temail: \"sarah@example.com\",\n\t\t\t\t\trole: UserRole.Employee,\n\t\t\t\t} as UserModel,\n\t\t\t\t{\n\t\t\t\t\tname: \"Mike Manager\",\n\t\t\t\t\temail: \"mike@example.com\",\n\t\t\t\t\trole: UserRole.Manager,\n\t\t\t\t} as UserModel,\n\t\t\t]);\n\t\t\tsetUsers(demoUsers);\n\t\t} else {\n\t\t\tsetUsers(allUsers);\n\t\t}\n\t};\n\n\tconst handleUserSelect = (userId: string) => {\n\t\tconst user = users.find(u => u.id === userId);\n\t\tif (user) {\n\t\t\tsetCurrentUser(user);\n\t\t\tsetShowUserSelect(false);\n\t\t}\n\t};\n\n\tconst handleLogout = () => {\n\t\tsetCurrentUser(null);\n\t\tsetShowUserSelect(true);\n\t};\n\n\tconst toggleLanguage = () => {\n\t\tsetLanguage(prev => prev === 'en' ? 'es' : 'en');\n\t};\n\n\tif (showUserSelect || !currentUser) {\n\t\treturn (\n\t\t\t<div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800 flex items-center justify-center p-4\">\n\t\t\t\t<div className=\"absolute top-4 right-4\">\n\t\t\t\t\t<Button onClick={toggleLanguage} variant=\"outline\" size=\"sm\">\n\t\t\t\t\t\t<Languages className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t\t{language === 'en' ? 'Español' : 'English'}\n\t\t\t\t\t</Button>\n\t\t\t\t</div>\n\t\t\t\t<Card className=\"w-full max-w-md\">\n\t\t\t\t\t<CardHeader>\n\t\t\t\t\t\t<CardTitle className=\"text-2xl\">{t.appTitle}</CardTitle>\n\t\t\t\t\t\t<CardDescription>{t.selectAccount}</CardDescription>\n\t\t\t\t\t</CardHeader>\n\t\t\t\t\t<CardContent className=\"space-y-4\">\n\t\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t\t<Label>{t.selectUser}</Label>\n\t\t\t\t\t\t\t<Select onValueChange={handleUserSelect}>\n\t\t\t\t\t\t\t\t<SelectTrigger className=\"w-full\">\n\t\t\t\t\t\t\t\t\t<SelectValue placeholder={t.chooseAccount} />\n\t\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t\t{users.map((user) => (\n\t\t\t\t\t\t\t\t\t\t<SelectItem key={user.id} value={user.id}>\n\t\t\t\t\t\t\t\t\t\t\t{user.name} - {user.role === UserRole.Manager ? t.manager : t.employee}\n\t\t\t\t\t\t\t\t\t\t</SelectItem>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t\t</Select>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</CardContent>\n\t\t\t\t</Card>\n\t\t\t</div>\n\t\t);\n\t}\n\n\treturn (\n\t\t<div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800\">\n\t\t\t<div className=\"container mx-auto p-6 space-y-6\">\n\t\t\t\t<div className=\"flex justify-between items-center\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<h1 className=\"text-3xl font-bold\">{t.timeTrackingSystem}</h1>\n\t\t\t\t\t\t<p className=\"text-muted-foreground\">\n\t\t\t\t\t\t\t{t.welcome}, {currentUser.name} ({currentUser.role === UserRole.Manager ? t.manager : t.employee})\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"flex gap-2\">\n\t\t\t\t\t\t<Button onClick={toggleLanguage} variant=\"outline\" size=\"sm\">\n\t\t\t\t\t\t\t<Languages className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t\t\t{language === 'en' ? 'Español' : 'English'}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button onClick={handleLogout} variant=\"outline\">\n\t\t\t\t\t\t\t{t.switchUser}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t{currentUser.role === UserRole.Employee ? (\n\t\t\t\t\t<EmployeeView user={currentUser} language={language} />\n\t\t\t\t) : (\n\t\t\t\t\t<ManagerView user={currentUser} users={users} language={language} onUsersChange={loadUsers} />\n\t\t\t\t)}\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n\nfunction SickDayCard({ user, language }: { user: UserModel; language: Language }) {\n\tconst [sickDays, setSickDays] = useState<SickDayModel[]>([]);\n\tconst [showAddDialog, setShowAddDialog] = useState(false);\n\tconst [sickDate, setSickDate] = useState(\"\");\n\tconst [sickHours, setSickHours] = useState(\"8\");\n\tconst [sickNotes, setSickNotes] = useState(\"\");\n\n\tconst t = translations[language];\n\n\tuseEffect(() => {\n\t\tloadSickDays();\n\t}, [user.id]);\n\n\tconst loadSickDays = async () => {\n\t\tconst sickDayORM = SickDayORM.getInstance();\n\t\tconst userSickDays = await sickDayORM.getSickDayByUserId(user.id);\n\n\t\t// Sort by date (newest first)\n\t\tconst sorted = userSickDays.sort((a, b) =>\n\t\t\tnew Date(b.sick_date).getTime() - new Date(a.sick_date).getTime()\n\t\t);\n\n\t\tsetSickDays(sorted);\n\t};\n\n\tconst handleAddSickDay = async () => {\n\t\tif (!sickDate || !sickHours) {\n\t\t\talert(\"Please fill in date and hours\");\n\t\t\treturn;\n\t\t}\n\n\t\tconst sickDayORM = SickDayORM.getInstance();\n\t\tawait sickDayORM.insertSickDay([{\n\t\t\tuser_id: user.id,\n\t\t\tsick_date: sickDate,\n\t\t\thours: parseFloat(sickHours),\n\t\t\tnotes: sickNotes || null,\n\t\t} as SickDayModel]);\n\n\t\t// Reset form\n\t\tsetSickDate(\"\");\n\t\tsetSickHours(\"8\");\n\t\tsetSickNotes(\"\");\n\t\tsetShowAddDialog(false);\n\n\t\tawait loadSickDays();\n\t};\n\n\tconst handleDeleteSickDay = async (sickDay: SickDayModel) => {\n\t\tif (!window.confirm(t.confirmDeleteSickDay)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst sickDayORM = SickDayORM.getInstance();\n\t\tawait sickDayORM.deleteSickDayById(sickDay.id);\n\t\tawait loadSickDays();\n\t};\n\n\tconst formatDate = (dateStr: string) => {\n\t\tconst date = new Date(dateStr);\n\t\treturn date.toLocaleDateString(language === 'es' ? 'es-ES' : 'en-US', {\n\t\t\tyear: 'numeric',\n\t\t\tmonth: 'long',\n\t\t\tday: 'numeric'\n\t\t});\n\t};\n\n\tconst totalSickHours = sickDays.reduce((sum, sd) => sum + sd.hours, 0);\n\n\treturn (\n\t\t<>\n\t\t\t<Card>\n\t\t\t\t<CardHeader>\n\t\t\t\t\t<div className=\"flex justify-between items-center\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<CardTitle className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t<Heart className=\"w-5 h-5 text-red-500\" />\n\t\t\t\t\t\t\t\t{t.mySickDays}\n\t\t\t\t\t\t\t</CardTitle>\n\t\t\t\t\t\t\t<CardDescription>\n\t\t\t\t\t\t\t\t{t.totalSickDays}: {totalSickHours.toFixed(1)} {language === 'es' ? 'hrs' : 'hrs'}\n\t\t\t\t\t\t\t</CardDescription>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<Button onClick={() => setShowAddDialog(true)} size=\"sm\">\n\t\t\t\t\t\t\t<Plus className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t\t\t{t.addSickDay}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t</CardHeader>\n\t\t\t\t<CardContent>\n\t\t\t\t\t{sickDays.length === 0 ? (\n\t\t\t\t\t\t<p className=\"text-center text-muted-foreground py-8\">{t.noSickDays}</p>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<div className=\"overflow-x-auto\">\n\t\t\t\t\t\t\t<Table>\n\t\t\t\t\t\t\t\t<TableHeader>\n\t\t\t\t\t\t\t\t\t<TableRow>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.sickDayDate}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.sickDayHours}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.sickDayNotes}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.actions}</TableHead>\n\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t</TableHeader>\n\t\t\t\t\t\t\t\t<TableBody>\n\t\t\t\t\t\t\t\t\t{sickDays.map((sd) => (\n\t\t\t\t\t\t\t\t\t\t<TableRow key={sd.id}>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"font-medium whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t{formatDate(sd.sick_date)}\n\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell>{sd.hours} hrs</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"max-w-xs truncate\">{sd.notes || \"—\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => handleDeleteSickDay(sd)}\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"text-red-600 hover:text-red-700 hover:bg-red-50\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Trash2 className=\"w-4 h-4\" />\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</TableBody>\n\t\t\t\t\t\t\t</Table>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</CardContent>\n\t\t\t</Card>\n\n\t\t\t<Dialog open={showAddDialog} onOpenChange={setShowAddDialog}>\n\t\t\t\t<DialogContent>\n\t\t\t\t\t<DialogHeader>\n\t\t\t\t\t\t<DialogTitle>{t.addSickDay}</DialogTitle>\n\t\t\t\t\t</DialogHeader>\n\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.sickDayDate}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"date\"\n\t\t\t\t\t\t\t\tvalue={sickDate}\n\t\t\t\t\t\t\t\tonChange={(e) => setSickDate(e.target.value)}\n\t\t\t\t\t\t\t\tmax={new Date().toISOString().split('T')[0]}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.sickDayHours}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\tmin=\"0.5\"\n\t\t\t\t\t\t\t\tmax=\"24\"\n\t\t\t\t\t\t\t\tstep=\"0.5\"\n\t\t\t\t\t\t\t\tvalue={sickHours}\n\t\t\t\t\t\t\t\tonChange={(e) => setSickHours(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.sickDayNotes}</Label>\n\t\t\t\t\t\t\t<Textarea\n\t\t\t\t\t\t\t\tvalue={sickNotes}\n\t\t\t\t\t\t\t\tonChange={(e) => setSickNotes(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder={t.sickDayNotesPlaceholder}\n\t\t\t\t\t\t\t\trows={3}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<DialogFooter>\n\t\t\t\t\t\t<Button variant=\"outline\" onClick={() => setShowAddDialog(false)}>\n\t\t\t\t\t\t\t{t.cancel}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button onClick={handleAddSickDay} disabled={!sickDate || !sickHours}>\n\t\t\t\t\t\t\t{t.saveChanges}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</DialogFooter>\n\t\t\t\t</DialogContent>\n\t\t\t</Dialog>\n\t\t</>\n\t);\n}\n\nfunction EmployeeView({ user, language }: { user: UserModel; language: Language }) {\n\tconst [timeCards, setTimeCards] = useState<TimeCardEntryModel[]>([]);\n\tconst [activeShift, setActiveShift] = useState<TimeCardEntryModel | null>(null);\n\tconst [elapsedTime, setElapsedTime] = useState(0);\n\tconst [location, setLocation] = useState(\"\");\n\tconst [workDescription, setWorkDescription] = useState(\"\");\n\tconst [isOnLunch, setIsOnLunch] = useState(false);\n\tconst [isLoading, setIsLoading] = useState(false);\n\n\tconst t = translations[language];\n\n\tuseEffect(() => {\n\t\tloadTimeCards();\n\t}, [user.id]);\n\n\tuseEffect(() => {\n\t\tlet interval: NodeJS.Timeout;\n\t\tif (activeShift && !isOnLunch) {\n\t\t\tinterval = setInterval(() => {\n\t\t\t\tconst clockInTime = parseInt(activeShift.clock_in_timestamp) * 1000;\n\t\t\t\tconst elapsed = Date.now() - clockInTime;\n\t\t\t\tsetElapsedTime(elapsed);\n\t\t\t}, 1000);\n\t\t}\n\t\treturn () => clearInterval(interval);\n\t}, [activeShift, isOnLunch]);\n\n\tconst loadTimeCards = async () => {\n\t\tconsole.log(\"Loading time cards for user:\", user.id);\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tconst userTimeCards = await timeCardORM.getTimeCardEntryByUserId(user.id);\n\n\t\tconsole.log(\"Found\", userTimeCards.length, \"time cards\");\n\n\t\t// Normalize data retrieved from ORM to fix null-handling bugs\n\t\tconst normalized = normalizeTimeCardEntriesFromORM(userTimeCards);\n\n\t\t// Sort by clock in time (newest first)\n\t\tconst sorted = normalized.sort((a, b) =>\n\t\t\tparseInt(b.clock_in_timestamp) - parseInt(a.clock_in_timestamp)\n\t\t);\n\n\t\tsetTimeCards(sorted);\n\n\t\t// Find active shift using helper function\n\t\tconst active = sorted.find(tc => isActiveShift(tc));\n\t\tconsole.log(\"Active shift found:\", active ? `Yes (ID: ${active.id})` : \"No\");\n\n\t\tsetActiveShift(active || null);\n\t\tif (active) {\n\t\t\tsetLocation(active.location || \"\");\n\t\t\tsetWorkDescription(active.work_description || \"\");\n\t\t\t// Check if on lunch break using helper function\n\t\t\tconst onLunch = isOnLunchBreak(active);\n\t\t\tsetIsOnLunch(onLunch);\n\t\t\tconsole.log(\"On lunch:\", onLunch);\n\t\t} else {\n\t\t\tsetIsOnLunch(false);\n\t\t}\n\t};\n\n\tconst handleClockIn = async () => {\n\t\tconsole.log(\"=== CLOCK IN STARTED ===\");\n\t\tconsole.log(\"User ID:\", user.id);\n\t\tconsole.log(\"Location:\", location);\n\t\tconsole.log(\"Work Description:\", workDescription);\n\n\t\tsetIsLoading(true);\n\t\ttry {\n\t\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\t\tconst now = Math.floor(Date.now() / 1000).toString();\n\t\t\tconsole.log(\"Current timestamp:\", now);\n\n\t\t\tconst newEntry = {\n\t\t\t\tuser_id: user.id,\n\t\t\t\tclock_in_timestamp: now,\n\t\t\t\tlocation: location || undefined,\n\t\t\t\twork_description: workDescription || undefined,\n\t\t\t} as TimeCardEntryModel;\n\n\t\t\t// Normalize the entry to work around ORM null-handling bugs\n\t\t\tconst normalizedEntry = normalizeTimeCardEntryForSave(newEntry);\n\n\t\t\tconsole.log(\"Inserting time card entry:\", normalizedEntry);\n\n\t\t\tconst result = await timeCardORM.insertTimeCardEntry([normalizedEntry as TimeCardEntryModel]);\n\t\t\tconsole.log(\"Insert result:\", result);\n\n\t\t\t// Normalize the returned data\n\t\t\tconst normalizedResult = normalizeTimeCardEntriesFromORM(result);\n\t\t\tconsole.log(\"Normalized result:\", normalizedResult);\n\n\t\t\tconsole.log(\"Time card entry created successfully!\");\n\n\t\t\t// Clear form\n\t\t\tsetLocation(\"\");\n\t\t\tsetWorkDescription(\"\");\n\n\t\t\t// Reload time cards\n\t\t\tconsole.log(\"Reloading time cards...\");\n\t\t\tawait loadTimeCards();\n\n\t\t\tconsole.log(\"=== CLOCK IN COMPLETED ===\");\n\n\t\t\t// Show success feedback\n\t\t\tconst reloadedShifts = normalizeTimeCardEntriesFromORM(\n\t\t\t\tawait timeCardORM.getTimeCardEntryByUserId(user.id)\n\t\t\t);\n\t\t\tif (reloadedShifts.some(tc => isActiveShift(tc))) {\n\t\t\t\talert(\"✅ Successfully clocked in! You can now see the CLOCK OUT button.\");\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.error(\"=== CLOCK IN FAILED ===\");\n\t\t\tconsole.error(\"Error details:\", error);\n\t\t\talert(`Error clocking in: ${error instanceof Error ? error.message : 'Unknown error'}. Check console for details.`);\n\t\t} finally {\n\t\t\tsetIsLoading(false);\n\t\t}\n\t};\n\n\tconst handleClockOut = async () => {\n\t\tconsole.log(\"Clock Out clicked - activeShift:\", activeShift);\n\n\t\tif (!activeShift) {\n\t\t\tconsole.error(\"No active shift to clock out!\");\n\t\t\talert(\"Error: No active shift found. Please try clocking in first.\");\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\t\tconst now = Math.floor(Date.now() / 1000).toString();\n\n\t\t\tconst clockInTime = parseInt(activeShift.clock_in_timestamp);\n\t\t\tconst clockOutTime = parseInt(now);\n\t\t\tlet totalHours = (clockOutTime - clockInTime) / 3600;\n\n\t\t\t// Deduct lunch time if lunch was taken\n\t\t\tif (activeShift.lunch_duration_minutes && activeShift.lunch_duration_minutes > 0) {\n\t\t\t\ttotalHours -= activeShift.lunch_duration_minutes / 60;\n\t\t\t}\n\n\t\t\tconsole.log(\"Clocking out - Total hours:\", totalHours);\n\n\t\t\tconst updateData = {\n\t\t\t\t...activeShift,\n\t\t\t\tclock_out_timestamp: now,\n\t\t\t\ttotal_hours: totalHours,\n\t\t\t\tlocation: location || activeShift.location || undefined,\n\t\t\t\twork_description: workDescription || activeShift.work_description || undefined,\n\t\t\t};\n\n\t\t\t// Normalize before saving\n\t\t\tconst normalizedUpdate = normalizeTimeCardEntryForSave(updateData as TimeCardEntryModel);\n\n\t\t\tawait timeCardORM.setTimeCardEntryById(activeShift.id, normalizedUpdate as TimeCardEntryModel);\n\n\t\t\tconsole.log(\"Clock out successful!\");\n\t\t\tsetLocation(\"\");\n\t\t\tsetWorkDescription(\"\");\n\t\t\tawait loadTimeCards();\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Error clocking out:\", error);\n\t\t\talert(\"Error clocking out. Please try again.\");\n\t\t}\n\t};\n\n\tconst handleStartLunch = async () => {\n\t\tif (!activeShift) return;\n\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tconst now = Math.floor(Date.now() / 1000).toString();\n\n\t\tconst updateData = {\n\t\t\t...activeShift,\n\t\t\tlunch_start_timestamp: now,\n\t\t\tlocation: location || activeShift.location || undefined,\n\t\t\twork_description: workDescription || activeShift.work_description || undefined,\n\t\t};\n\n\t\tconst normalizedUpdate = normalizeTimeCardEntryForSave(updateData as TimeCardEntryModel);\n\t\tawait timeCardORM.setTimeCardEntryById(activeShift.id, normalizedUpdate as TimeCardEntryModel);\n\n\t\tawait loadTimeCards();\n\t};\n\n\tconst handleEndLunch = async () => {\n\t\tif (!activeShift || !activeShift.lunch_start_timestamp) return;\n\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tconst now = Math.floor(Date.now() / 1000).toString();\n\n\t\t// Handle case where lunch_start_timestamp might be the string \"null\"\n\t\tlet lunchStartTime: number;\n\t\tif (typeof activeShift.lunch_start_timestamp === 'string' && activeShift.lunch_start_timestamp !== 'null') {\n\t\t\tlunchStartTime = parseInt(activeShift.lunch_start_timestamp);\n\t\t} else {\n\t\t\treturn;\n\t\t}\n\n\t\tconst lunchEndTime = parseInt(now);\n\t\tconst lunchDurationMinutes = (lunchEndTime - lunchStartTime) / 60;\n\n\t\t// Add to existing lunch duration if there was already one\n\t\tconst totalLunchMinutes = (activeShift.lunch_duration_minutes && activeShift.lunch_duration_minutes > 0 ? activeShift.lunch_duration_minutes : 0) + lunchDurationMinutes;\n\n\t\tconst updateData = {\n\t\t\t...activeShift,\n\t\t\tlunch_end_timestamp: now,\n\t\t\tlunch_duration_minutes: totalLunchMinutes,\n\t\t};\n\n\t\tconst normalizedUpdate = normalizeTimeCardEntryForSave(updateData as TimeCardEntryModel);\n\t\tawait timeCardORM.setTimeCardEntryById(activeShift.id, normalizedUpdate as TimeCardEntryModel);\n\n\t\tawait loadTimeCards();\n\t};\n\n\tconst formatTime = (ms: number) => {\n\t\tconst seconds = Math.floor(ms / 1000);\n\t\tconst hours = Math.floor(seconds / 3600);\n\t\tconst minutes = Math.floor((seconds % 3600) / 60);\n\t\tconst secs = seconds % 60;\n\t\treturn `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\n\t};\n\n\tconst formatDate = (timestamp: string) => {\n\t\tconst date = new Date(parseInt(timestamp) * 1000);\n\t\treturn date.toLocaleString(language === 'es' ? 'es-ES' : 'en-US');\n\t};\n\n\tconst formatHours = (hours: number | null | undefined) => {\n\t\tif (hours === null || hours === undefined) return \"—\";\n\t\treturn `${hours.toFixed(2)} ${language === 'es' ? 'hrs' : 'hrs'}`;\n\t};\n\n\tconst formatMinutes = (minutes: number | null | undefined) => {\n\t\tif (minutes === null || minutes === undefined) return \"—\";\n\t\treturn `${Math.round(minutes)} min`;\n\t};\n\n\treturn (\n\t\t<div className=\"space-y-6\">\n\t\t\t<SickDayCard user={user} language={language} />\n\t\t\t<Card>\n\t\t\t\t<CardHeader>\n\t\t\t\t\t<CardTitle className=\"flex items-center gap-2\">\n\t\t\t\t\t\t<Clock className=\"w-5 h-5\" />\n\t\t\t\t\t\t{t.clockInOut}\n\t\t\t\t\t</CardTitle>\n\t\t\t\t\t<CardDescription>\n\t\t\t\t\t\t{activeShift ? \"✅ You are currently clocked in - Clock out button is below\" : \"❌ Not clocked in - Click CLOCK IN button to start\"}\n\t\t\t\t\t</CardDescription>\n\t\t\t\t</CardHeader>\n\t\t\t\t<CardContent className=\"space-y-6\">\n\t\t\t\t\t{/* Show current status */}\n\t\t\t\t\t<div className={`p-6 rounded-lg border-2 ${activeShift ? 'bg-green-50 border-green-300 dark:bg-green-900/20 dark:border-green-700' : 'bg-blue-50 border-blue-300 dark:bg-blue-900/20 dark:border-blue-700'}`}>\n\t\t\t\t\t\t<div className=\"flex items-center justify-between mb-4\">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<p className={`text-2xl font-bold ${activeShift ? 'text-green-700' : 'text-blue-700'}`}>\n\t\t\t\t\t\t\t\t\t{activeShift ? '🟢 CLOCKED IN' : '⚪ NOT CLOCKED IN'}\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t{!activeShift && (\n\t\t\t\t\t\t\t\t\t<p className=\"text-sm text-blue-600 dark:text-blue-400 mt-2 font-semibold\">\n\t\t\t\t\t\t\t\t\t\t👇 Fill out the form below and click \"CLOCK IN\"\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t{activeShift && (\n\t\t\t\t\t\t\t\t\t<p className=\"text-sm text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\tStarted: {formatDate(activeShift.clock_in_timestamp)}\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t{isOnLunch && (\n\t\t\t\t\t\t\t\t\t<p className=\"text-sm text-orange-600 font-semibold mt-1\">\n\t\t\t\t\t\t\t\t\t\t☕ On Lunch Break\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{activeShift && !isOnLunch && (\n\t\t\t\t\t\t\t\t<div className=\"text-right\">\n\t\t\t\t\t\t\t\t\t<p className=\"text-3xl font-mono font-bold tabular-nums\">\n\t\t\t\t\t\t\t\t\t\t{formatTime(elapsedTime)}\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t<p className=\"text-xs text-muted-foreground\">Time Elapsed</p>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Main Action Buttons */}\n\t\t\t\t\t{activeShift ? (\n\t\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t\t{/* Clock Out Button - ALWAYS VISIBLE when clocked in */}\n\t\t\t\t\t\t\t<div className=\"bg-red-50 dark:bg-red-950 p-4 rounded-lg border-2 border-red-300 dark:border-red-700\">\n\t\t\t\t\t\t\t\t<p className=\"text-center text-sm font-bold text-red-700 dark:text-red-300 mb-3\">\n\t\t\t\t\t\t\t\t\t⬇️ CLICK HERE TO END YOUR SHIFT ⬇️\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tonClick={handleClockOut}\n\t\t\t\t\t\t\t\t\tvariant=\"destructive\"\n\t\t\t\t\t\t\t\t\tsize=\"lg\"\n\t\t\t\t\t\t\t\t\tclassName=\"w-full h-20 text-2xl font-black shadow-lg hover:shadow-xl transition-all\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<Clock className=\"w-8 h-8 mr-3\" />\n\t\t\t\t\t\t\t\t\tCLOCK OUT\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t{/* Lunch Buttons */}\n\t\t\t\t\t\t\t<div className=\"border-t pt-4\">\n\t\t\t\t\t\t\t\t<p className=\"text-sm text-muted-foreground mb-3\">Lunch Break (Optional)</p>\n\t\t\t\t\t\t\t\t{isOnLunch ? (\n\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\tonClick={handleEndLunch}\n\t\t\t\t\t\t\t\t\t\tclassName=\"w-full h-12\"\n\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<Coffee className=\"w-5 h-5 mr-2\" />\n\t\t\t\t\t\t\t\t\t\tEnd Lunch Break\n\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\tonClick={handleStartLunch}\n\t\t\t\t\t\t\t\t\t\tclassName=\"w-full h-12\"\n\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<Coffee className=\"w-5 h-5 mr-2\" />\n\t\t\t\t\t\t\t\t\t\tStart Lunch Break\n\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t{/* Location and Description */}\n\t\t\t\t\t\t\t<div className=\"border-t pt-4 space-y-4\">\n\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t<Label>{t.location}</Label>\n\t\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\t\tvalue={location}\n\t\t\t\t\t\t\t\t\t\tonChange={(e) => setLocation(e.target.value)}\n\t\t\t\t\t\t\t\t\t\tplaceholder={t.locationPlaceholder}\n\t\t\t\t\t\t\t\t\t\tclassName=\"mt-2\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t<Label>{t.workDescription}</Label>\n\t\t\t\t\t\t\t\t\t<Textarea\n\t\t\t\t\t\t\t\t\t\tvalue={workDescription}\n\t\t\t\t\t\t\t\t\t\tonChange={(e) => setWorkDescription(e.target.value)}\n\t\t\t\t\t\t\t\t\t\tplaceholder={t.descriptionPlaceholder}\n\t\t\t\t\t\t\t\t\t\trows={3}\n\t\t\t\t\t\t\t\t\t\tclassName=\"mt-2\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t\t{/* Clock In Form */}\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<Label>{t.location}</Label>\n\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\tvalue={location}\n\t\t\t\t\t\t\t\t\tonChange={(e) => setLocation(e.target.value)}\n\t\t\t\t\t\t\t\t\tplaceholder={t.locationPlaceholder}\n\t\t\t\t\t\t\t\t\tclassName=\"mt-2\"\n\t\t\t\t\t\t\t\t\tdisabled={isLoading}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<Label>{t.workDescription}</Label>\n\t\t\t\t\t\t\t\t<Textarea\n\t\t\t\t\t\t\t\t\tvalue={workDescription}\n\t\t\t\t\t\t\t\t\tonChange={(e) => setWorkDescription(e.target.value)}\n\t\t\t\t\t\t\t\t\tplaceholder={t.descriptionPlaceholder}\n\t\t\t\t\t\t\t\t\trows={3}\n\t\t\t\t\t\t\t\t\tclassName=\"mt-2\"\n\t\t\t\t\t\t\t\t\tdisabled={isLoading}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tonClick={handleClockIn}\n\t\t\t\t\t\t\t\tsize=\"lg\"\n\t\t\t\t\t\t\t\tdisabled={isLoading}\n\t\t\t\t\t\t\t\tclassName=\"w-full h-16 text-xl font-bold bg-green-600 hover:bg-green-700 disabled:opacity-50\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Clock className=\"w-6 h-6 mr-2\" />\n\t\t\t\t\t\t\t\t{isLoading ? \"CLOCKING IN...\" : \"CLOCK IN\"}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t{isLoading && (\n\t\t\t\t\t\t\t\t<p className=\"text-center text-sm text-muted-foreground animate-pulse\">\n\t\t\t\t\t\t\t\t\tPlease wait, processing...\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</CardContent>\n\t\t\t</Card>\n\n\t\t\t<Card>\n\t\t\t\t<CardHeader>\n\t\t\t\t\t<CardTitle className=\"flex items-center gap-2\">\n\t\t\t\t\t\t<CalendarDays className=\"w-5 h-5\" />\n\t\t\t\t\t\t{t.timeCardHistory}\n\t\t\t\t\t</CardTitle>\n\t\t\t\t\t<CardDescription>{t.recentRecords}</CardDescription>\n\t\t\t\t</CardHeader>\n\t\t\t\t<CardContent>\n\t\t\t\t\t{timeCards.length === 0 ? (\n\t\t\t\t\t\t<p className=\"text-center text-muted-foreground py-8\">{t.noTimeCards}</p>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<div className=\"overflow-x-auto\">\n\t\t\t\t\t\t\t<Table>\n\t\t\t\t\t\t\t\t<TableHeader>\n\t\t\t\t\t\t\t\t\t<TableRow>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.clockInTime}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.clockOutTime}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.location}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.workDescription}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.lunchDuration}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.hours}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.status}</TableHead>\n\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t</TableHeader>\n\t\t\t\t\t\t\t\t<TableBody>\n\t\t\t\t\t\t\t\t\t{timeCards.map((tc) => (\n\t\t\t\t\t\t\t\t\t\t<TableRow key={tc.id}>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatDate(tc.clock_in_timestamp)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t{tc.clock_out_timestamp ? formatDate(tc.clock_out_timestamp) : \"—\"}\n\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell>{tc.location || \"—\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"max-w-xs truncate\">{tc.work_description || \"—\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatMinutes(tc.lunch_duration_minutes)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatHours(tc.total_hours)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t{tc.clock_out_timestamp ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge variant=\"secondary\">{t.completed}</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t) : tc.lunch_start_timestamp && !tc.lunch_end_timestamp ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge className=\"bg-orange-500\">{t.onLunchBreak}</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge className=\"bg-green-500\">{t.active}</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</TableBody>\n\t\t\t\t\t\t\t</Table>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</CardContent>\n\t\t\t</Card>\n\t\t</div>\n\t);\n}\n\nfunction ManagerView({ user, users, language, onUsersChange }: { user: UserModel; users: UserModel[]; language: Language; onUsersChange: () => void }) {\n\tconst [activeTab, setActiveTab] = useState(\"timecards\");\n\n\tconst t = translations[language];\n\n\treturn (\n\t\t<Tabs value={activeTab} onValueChange={setActiveTab}>\n\t\t\t<TabsList className=\"grid w-full grid-cols-4\">\n\t\t\t\t<TabsTrigger value=\"timecards\">\n\t\t\t\t\t<Clock className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t{t.timeCards}\n\t\t\t\t</TabsTrigger>\n\t\t\t\t<TabsTrigger value=\"sickdays\">\n\t\t\t\t\t<Heart className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t{t.sickDays}\n\t\t\t\t</TabsTrigger>\n\t\t\t\t<TabsTrigger value=\"reports\">\n\t\t\t\t\t<FileText className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t{t.reports}\n\t\t\t\t</TabsTrigger>\n\t\t\t\t<TabsTrigger value=\"employees\">\n\t\t\t\t\t<Users className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t{t.employees}\n\t\t\t\t</TabsTrigger>\n\t\t\t</TabsList>\n\n\t\t\t<TabsContent value=\"timecards\" className=\"space-y-4\">\n\t\t\t\t<TimeCardsTab users={users} language={language} />\n\t\t\t</TabsContent>\n\n\t\t\t<TabsContent value=\"sickdays\" className=\"space-y-4\">\n\t\t\t\t<SickDaysTab users={users} language={language} />\n\t\t\t</TabsContent>\n\n\t\t\t<TabsContent value=\"reports\" className=\"space-y-4\">\n\t\t\t\t<ReportsTab users={users} language={language} />\n\t\t\t</TabsContent>\n\n\t\t\t<TabsContent value=\"employees\" className=\"space-y-4\">\n\t\t\t\t<EmployeesTab users={users} language={language} onUsersChange={onUsersChange} />\n\t\t\t</TabsContent>\n\t\t</Tabs>\n\t);\n}\n\nfunction TimeCardsTab({ users, language }: { users: UserModel[]; language: Language }) {\n\tconst [allTimeCards, setAllTimeCards] = useState<TimeCardEntryModel[]>([]);\n\tconst [filteredCards, setFilteredCards] = useState<TimeCardEntryModel[]>([]);\n\tconst [selectedEmployee, setSelectedEmployee] = useState<string>(\"all\");\n\tconst [dateFilter, setDateFilter] = useState<string>(\"\");\n\tconst [editingCard, setEditingCard] = useState<TimeCardEntryModel | null>(null);\n\tconst [editClockIn, setEditClockIn] = useState(\"\");\n\tconst [editClockOut, setEditClockOut] = useState(\"\");\n\tconst [editLocation, setEditLocation] = useState(\"\");\n\tconst [editWorkDescription, setEditWorkDescription] = useState(\"\");\n\tconst [editLunchStart, setEditLunchStart] = useState(\"\");\n\tconst [editLunchEnd, setEditLunchEnd] = useState(\"\");\n\tconst [showManualEntry, setShowManualEntry] = useState(false);\n\tconst [manualEntryUserId, setManualEntryUserId] = useState<string>(\"\");\n\n\tconst t = translations[language];\n\n\tuseEffect(() => {\n\t\tloadAllTimeCards();\n\t}, []);\n\n\tuseEffect(() => {\n\t\tapplyFilters();\n\t}, [allTimeCards, selectedEmployee, dateFilter]);\n\n\tconst loadAllTimeCards = async () => {\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tconst allCards = await timeCardORM.getAllTimeCardEntry();\n\n\t\t// Normalize data from ORM\n\t\tconst normalized = normalizeTimeCardEntriesFromORM(allCards);\n\n\t\t// Sort by clock in time (newest first)\n\t\tconst sorted = normalized.sort((a, b) =>\n\t\t\tparseInt(b.clock_in_timestamp) - parseInt(a.clock_in_timestamp)\n\t\t);\n\n\t\tsetAllTimeCards(sorted);\n\t};\n\n\tconst applyFilters = () => {\n\t\tlet filtered = [...allTimeCards];\n\n\t\t// Filter by employee\n\t\tif (selectedEmployee !== \"all\") {\n\t\t\tfiltered = filtered.filter(tc => tc.user_id === selectedEmployee);\n\t\t}\n\n\t\t// Filter by date\n\t\tif (dateFilter) {\n\t\t\tconst filterDate = new Date(dateFilter);\n\t\t\tconst filterTimestamp = Math.floor(filterDate.getTime() / 1000);\n\t\t\tconst nextDayTimestamp = filterTimestamp + 86400; // +24 hours\n\n\t\t\tfiltered = filtered.filter(tc => {\n\t\t\t\tconst clockIn = parseInt(tc.clock_in_timestamp);\n\t\t\t\treturn clockIn >= filterTimestamp && clockIn < nextDayTimestamp;\n\t\t\t});\n\t\t}\n\n\t\tsetFilteredCards(filtered);\n\t};\n\n\tconst getUserName = (userId: string) => {\n\t\tconst user = users.find(u => u.id === userId);\n\t\treturn user?.name || \"Unknown\";\n\t};\n\n\tconst formatDate = (timestamp: string) => {\n\t\tconst date = new Date(parseInt(timestamp) * 1000);\n\t\treturn date.toLocaleString(language === 'es' ? 'es-ES' : 'en-US');\n\t};\n\n\tconst formatHours = (hours: number | null | undefined) => {\n\t\tif (hours === null || hours === undefined) return \"—\";\n\t\treturn `${hours.toFixed(2)} ${language === 'es' ? 'hrs' : 'hrs'}`;\n\t};\n\n\tconst formatMinutes = (minutes: number | null | undefined) => {\n\t\tif (minutes === null || minutes === undefined) return \"—\";\n\t\treturn `${Math.round(minutes)} min`;\n\t};\n\n\tconst calculateTotalHours = (period: 'day' | 'week') => {\n\t\tconst now = Date.now() / 1000;\n\t\tconst periodSeconds = period === 'day' ? 86400 : 604800; // 1 day or 7 days\n\t\tconst startTime = now - periodSeconds;\n\n\t\tconst relevantCards = allTimeCards.filter(tc => {\n\t\t\tconst clockIn = parseInt(tc.clock_in_timestamp);\n\t\t\treturn clockIn >= startTime && tc.total_hours;\n\t\t});\n\n\t\treturn relevantCards.reduce((sum, tc) => sum + (tc.total_hours || 0), 0);\n\t};\n\n\tconst handleEditCard = (card: TimeCardEntryModel) => {\n\t\tsetEditingCard(card);\n\n\t\t// Helper function to safely convert timestamp to ISO string\n\t\tconst safeTimestampToISO = (timestamp: string | null | undefined): string => {\n\t\t\tif (!timestamp) return \"\";\n\t\t\tconst parsed = parseInt(timestamp);\n\t\t\tif (isNaN(parsed) || parsed <= 0) return \"\";\n\t\t\tconst date = new Date(parsed * 1000);\n\t\t\tif (isNaN(date.getTime())) return \"\";\n\t\t\treturn date.toISOString().slice(0, 16);\n\t\t};\n\n\t\tsetEditClockIn(safeTimestampToISO(card.clock_in_timestamp) || new Date().toISOString().slice(0, 16));\n\t\tsetEditClockOut(safeTimestampToISO(card.clock_out_timestamp));\n\t\tsetEditLocation(card.location || \"\");\n\t\tsetEditWorkDescription(card.work_description || \"\");\n\t\tsetEditLunchStart(safeTimestampToISO(card.lunch_start_timestamp));\n\t\tsetEditLunchEnd(safeTimestampToISO(card.lunch_end_timestamp));\n\t};\n\n\tconst handleSaveEdit = async () => {\n\t\tif (!editingCard) return;\n\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tconst clockInTimestamp = Math.floor(new Date(editClockIn).getTime() / 1000).toString();\n\t\tconst clockOutTimestamp = editClockOut\n\t\t\t? Math.floor(new Date(editClockOut).getTime() / 1000).toString()\n\t\t\t: undefined;\n\t\tconst lunchStartTimestamp = editLunchStart\n\t\t\t? Math.floor(new Date(editLunchStart).getTime() / 1000).toString()\n\t\t\t: undefined;\n\t\tconst lunchEndTimestamp = editLunchEnd\n\t\t\t? Math.floor(new Date(editLunchEnd).getTime() / 1000).toString()\n\t\t\t: undefined;\n\n\t\tlet totalHours: number | undefined = undefined;\n\t\tlet lunchDurationMinutes: number | undefined = undefined;\n\n\t\t// Calculate lunch duration\n\t\tif (lunchStartTimestamp && lunchEndTimestamp) {\n\t\t\tconst lunchStart = parseInt(lunchStartTimestamp);\n\t\t\tconst lunchEnd = parseInt(lunchEndTimestamp);\n\t\t\tlunchDurationMinutes = (lunchEnd - lunchStart) / 60;\n\t\t}\n\n\t\t// Calculate total hours\n\t\tif (clockOutTimestamp) {\n\t\t\tconst clockInTime = parseInt(clockInTimestamp);\n\t\t\tconst clockOutTime = parseInt(clockOutTimestamp);\n\t\t\ttotalHours = (clockOutTime - clockInTime) / 3600;\n\n\t\t\t// Deduct lunch time\n\t\t\tif (lunchDurationMinutes) {\n\t\t\t\ttotalHours -= lunchDurationMinutes / 60;\n\t\t\t}\n\t\t}\n\n\t\tconst updateData = {\n\t\t\t...editingCard,\n\t\t\tclock_in_timestamp: clockInTimestamp,\n\t\t\tclock_out_timestamp: clockOutTimestamp,\n\t\t\ttotal_hours: totalHours,\n\t\t\tlocation: editLocation || undefined,\n\t\t\twork_description: editWorkDescription || undefined,\n\t\t\tlunch_start_timestamp: lunchStartTimestamp,\n\t\t\tlunch_end_timestamp: lunchEndTimestamp,\n\t\t\tlunch_duration_minutes: lunchDurationMinutes,\n\t\t};\n\n\t\tconst normalizedUpdate = normalizeTimeCardEntryForSave(updateData as TimeCardEntryModel);\n\t\tawait timeCardORM.setTimeCardEntryById(editingCard.id, normalizedUpdate as TimeCardEntryModel);\n\n\t\tsetEditingCard(null);\n\t\tawait loadAllTimeCards();\n\t};\n\n\tconst handleDeleteTimeCard = async (card: TimeCardEntryModel) => {\n\t\tif (!window.confirm(t.confirmDeleteTimeCard)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tawait timeCardORM.deleteTimeCardEntryById(card.id);\n\t\tawait loadAllTimeCards();\n\t};\n\n\tconst handleAddManualEntry = (userId: string) => {\n\t\tsetManualEntryUserId(userId);\n\t\tsetShowManualEntry(true);\n\t};\n\n\treturn (\n\t\t<>\n\t\t\t<div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n\t\t\t\t<Card>\n\t\t\t\t\t<CardHeader className=\"pb-3\">\n\t\t\t\t\t\t<CardTitle className=\"text-sm font-medium flex items-center gap-2\">\n\t\t\t\t\t\t\t<Users className=\"w-4 h-4\" />\n\t\t\t\t\t\t\t{t.totalEmployees}\n\t\t\t\t\t\t</CardTitle>\n\t\t\t\t\t</CardHeader>\n\t\t\t\t\t<CardContent>\n\t\t\t\t\t\t<div className=\"text-2xl font-bold\">{users.filter(u => u.role === UserRole.Employee).length}</div>\n\t\t\t\t\t</CardContent>\n\t\t\t\t</Card>\n\n\t\t\t\t<Card>\n\t\t\t\t\t<CardHeader className=\"pb-3\">\n\t\t\t\t\t\t<CardTitle className=\"text-sm font-medium flex items-center gap-2\">\n\t\t\t\t\t\t\t<Timer className=\"w-4 h-4\" />\n\t\t\t\t\t\t\t{t.hoursToday}\n\t\t\t\t\t\t</CardTitle>\n\t\t\t\t\t</CardHeader>\n\t\t\t\t\t<CardContent>\n\t\t\t\t\t\t<div className=\"text-2xl font-bold\">{calculateTotalHours('day').toFixed(2)}</div>\n\t\t\t\t\t</CardContent>\n\t\t\t\t</Card>\n\n\t\t\t\t<Card>\n\t\t\t\t\t<CardHeader className=\"pb-3\">\n\t\t\t\t\t\t<CardTitle className=\"text-sm font-medium flex items-center gap-2\">\n\t\t\t\t\t\t\t<CalendarDays className=\"w-4 h-4\" />\n\t\t\t\t\t\t\t{t.hoursThisWeek}\n\t\t\t\t\t\t</CardTitle>\n\t\t\t\t\t</CardHeader>\n\t\t\t\t\t<CardContent>\n\t\t\t\t\t\t<div className=\"text-2xl font-bold\">{calculateTotalHours('week').toFixed(2)}</div>\n\t\t\t\t\t</CardContent>\n\t\t\t\t</Card>\n\t\t\t</div>\n\n\t\t\t<Card>\n\t\t\t\t<CardHeader>\n\t\t\t\t\t<div className=\"flex justify-between items-center\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<CardTitle>{t.allEmployeeTimeCards}</CardTitle>\n\t\t\t\t\t\t\t<CardDescription>{t.viewManageRecords}</CardDescription>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<Button onClick={() => handleAddManualEntry(\"\")} variant=\"outline\" size=\"sm\">\n\t\t\t\t\t\t\t<Plus className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t\t\t{t.addTimeCard}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t</CardHeader>\n\t\t\t\t<CardContent className=\"space-y-4\">\n\t\t\t\t\t<div className=\"flex gap-4 flex-wrap\">\n\t\t\t\t\t\t<div className=\"flex-1 min-w-[200px]\">\n\t\t\t\t\t\t\t<Label>{t.filterByEmployee}</Label>\n\t\t\t\t\t\t\t<Select value={selectedEmployee} onValueChange={setSelectedEmployee}>\n\t\t\t\t\t\t\t\t<SelectTrigger>\n\t\t\t\t\t\t\t\t\t<SelectValue />\n\t\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t\t<SelectItem value=\"all\">{t.allEmployees}</SelectItem>\n\t\t\t\t\t\t\t\t\t{users.filter(u => u.role === UserRole.Employee).map((u) => (\n\t\t\t\t\t\t\t\t\t\t<SelectItem key={u.id} value={u.id}>\n\t\t\t\t\t\t\t\t\t\t\t{u.name}\n\t\t\t\t\t\t\t\t\t\t</SelectItem>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t\t</Select>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div className=\"flex-1 min-w-[200px]\">\n\t\t\t\t\t\t\t<Label>{t.filterByDate}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"date\"\n\t\t\t\t\t\t\t\tvalue={dateFilter}\n\t\t\t\t\t\t\t\tonChange={(e) => setDateFilter(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t{(selectedEmployee !== \"all\" || dateFilter) && (\n\t\t\t\t\t\t\t<div className=\"flex items-end\">\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\t\t\tsetSelectedEmployee(\"all\");\n\t\t\t\t\t\t\t\t\t\tsetDateFilter(\"\");\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{t.clearFilters}\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{filteredCards.length === 0 ? (\n\t\t\t\t\t\t<p className=\"text-center text-muted-foreground py-8\">{t.noTimeCardsFound}</p>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<div className=\"overflow-x-auto\">\n\t\t\t\t\t\t\t<Table>\n\t\t\t\t\t\t\t\t<TableHeader>\n\t\t\t\t\t\t\t\t\t<TableRow>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.employeeName}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.clockInTime}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.clockOutTime}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.location}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.workDescription}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.lunchDuration}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.hours}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.status}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.actions}</TableHead>\n\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t</TableHeader>\n\t\t\t\t\t\t\t\t<TableBody>\n\t\t\t\t\t\t\t\t\t{filteredCards.map((tc) => (\n\t\t\t\t\t\t\t\t\t\t<TableRow key={tc.id}>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"font-medium whitespace-nowrap\">{getUserName(tc.user_id)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatDate(tc.clock_in_timestamp)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t{tc.clock_out_timestamp ? formatDate(tc.clock_out_timestamp) : \"—\"}\n\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell>{tc.location || \"—\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"max-w-xs truncate\">{tc.work_description || \"—\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatMinutes(tc.lunch_duration_minutes)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatHours(tc.total_hours)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t{tc.clock_out_timestamp ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge variant=\"secondary\">{t.completed}</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t) : tc.lunch_start_timestamp && !tc.lunch_end_timestamp ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge className=\"bg-orange-500\">{t.onLunchBreak}</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge className=\"bg-green-500\">{t.active}</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => handleEditCard(tc)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{t.edit}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => handleDeleteTimeCard(tc)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"text-red-600 hover:text-red-700 hover:bg-red-50\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Trash2 className=\"w-4 h-4\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</TableBody>\n\t\t\t\t\t\t\t</Table>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</CardContent>\n\t\t\t</Card>\n\n\t\t\t<Dialog open={!!editingCard} onOpenChange={(open) => !open && setEditingCard(null)}>\n\t\t\t\t<DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n\t\t\t\t\t<DialogHeader>\n\t\t\t\t\t\t<DialogTitle>{t.editTimeCard}</DialogTitle>\n\t\t\t\t\t</DialogHeader>\n\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.employeeName}</Label>\n\t\t\t\t\t\t\t<Input value={editingCard ? getUserName(editingCard.user_id) : \"\"} disabled />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"grid grid-cols-2 gap-4\">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<Label>{t.clockInTime}</Label>\n\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\t\tvalue={editClockIn}\n\t\t\t\t\t\t\t\t\tonChange={(e) => setEditClockIn(e.target.value)}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<Label>{t.clockOutTime}</Label>\n\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\t\tvalue={editClockOut}\n\t\t\t\t\t\t\t\t\tonChange={(e) => setEditClockOut(e.target.value)}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.location}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\tvalue={editLocation}\n\t\t\t\t\t\t\t\tonChange={(e) => setEditLocation(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder={t.locationPlaceholder}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.workDescription}</Label>\n\t\t\t\t\t\t\t<Textarea\n\t\t\t\t\t\t\t\tvalue={editWorkDescription}\n\t\t\t\t\t\t\t\tonChange={(e) => setEditWorkDescription(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder={t.descriptionPlaceholder}\n\t\t\t\t\t\t\t\trows={4}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"grid grid-cols-2 gap-4\">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<Label>{t.lunchStartTime}</Label>\n\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\t\tvalue={editLunchStart}\n\t\t\t\t\t\t\t\t\tonChange={(e) => setEditLunchStart(e.target.value)}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<Label>{t.lunchEndTime}</Label>\n\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\t\tvalue={editLunchEnd}\n\t\t\t\t\t\t\t\t\tonChange={(e) => setEditLunchEnd(e.target.value)}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<DialogFooter>\n\t\t\t\t\t\t<Button variant=\"outline\" onClick={() => setEditingCard(null)}>\n\t\t\t\t\t\t\t{t.cancel}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button onClick={handleSaveEdit}>\n\t\t\t\t\t\t\t{t.saveChanges}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</DialogFooter>\n\t\t\t\t</DialogContent>\n\t\t\t</Dialog>\n\n\t\t\t<ManualEntryDialog\n\t\t\t\topen={showManualEntry}\n\t\t\t\tonClose={() => setShowManualEntry(false)}\n\t\t\t\tuserId={manualEntryUserId}\n\t\t\t\tonSave={loadAllTimeCards}\n\t\t\t\tlanguage={language}\n\t\t\t\tusers={users}\n\t\t\t/>\n\t\t</>\n\t);\n}\n\nfunction SickDaysTab({ users, language }: { users: UserModel[]; language: Language }) {\n\tconst [allSickDays, setAllSickDays] = useState<SickDayModel[]>([]);\n\tconst [filteredSickDays, setFilteredSickDays] = useState<SickDayModel[]>([]);\n\tconst [selectedEmployee, setSelectedEmployee] = useState<string>(\"all\");\n\tconst [dateFilter, setDateFilter] = useState<string>(\"\");\n\n\tconst t = translations[language];\n\n\tuseEffect(() => {\n\t\tloadAllSickDays();\n\t}, []);\n\n\tuseEffect(() => {\n\t\tapplyFilters();\n\t}, [allSickDays, selectedEmployee, dateFilter]);\n\n\tconst loadAllSickDays = async () => {\n\t\tconst sickDayORM = SickDayORM.getInstance();\n\t\tconst allDays = await sickDayORM.getAllSickDay();\n\n\t\t// Sort by date (newest first)\n\t\tconst sorted = allDays.sort((a, b) =>\n\t\t\tnew Date(b.sick_date).getTime() - new Date(a.sick_date).getTime()\n\t\t);\n\n\t\tsetAllSickDays(sorted);\n\t};\n\n\tconst applyFilters = () => {\n\t\tlet filtered = [...allSickDays];\n\n\t\t// Filter by employee\n\t\tif (selectedEmployee !== \"all\") {\n\t\t\tfiltered = filtered.filter(sd => sd.user_id === selectedEmployee);\n\t\t}\n\n\t\t// Filter by date\n\t\tif (dateFilter) {\n\t\t\tfiltered = filtered.filter(sd => sd.sick_date === dateFilter);\n\t\t}\n\n\t\tsetFilteredSickDays(filtered);\n\t};\n\n\tconst getUserName = (userId: string) => {\n\t\tconst user = users.find(u => u.id === userId);\n\t\treturn user?.name || \"Unknown\";\n\t};\n\n\tconst formatDate = (dateStr: string) => {\n\t\tconst date = new Date(dateStr);\n\t\treturn date.toLocaleDateString(language === 'es' ? 'es-ES' : 'en-US', {\n\t\t\tyear: 'numeric',\n\t\t\tmonth: 'long',\n\t\t\tday: 'numeric'\n\t\t});\n\t};\n\n\tconst handleDeleteSickDay = async (sickDay: SickDayModel) => {\n\t\tif (!window.confirm(t.confirmDeleteSickDay)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst sickDayORM = SickDayORM.getInstance();\n\t\tawait sickDayORM.deleteSickDayById(sickDay.id);\n\t\tawait loadAllSickDays();\n\t};\n\n\tconst calculateTotalSickHours = () => {\n\t\treturn filteredSickDays.reduce((sum, sd) => sum + sd.hours, 0);\n\t};\n\n\treturn (\n\t\t<Card>\n\t\t\t<CardHeader>\n\t\t\t\t<div className=\"flex justify-between items-center\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<CardTitle className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t<Heart className=\"w-5 h-5 text-red-500\" />\n\t\t\t\t\t\t\t{t.sickDayHistory}\n\t\t\t\t\t\t</CardTitle>\n\t\t\t\t\t\t<CardDescription>\n\t\t\t\t\t\t\t{t.totalSickDays}: {calculateTotalSickHours().toFixed(1)} {language === 'es' ? 'hrs' : 'hrs'}\n\t\t\t\t\t\t</CardDescription>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</CardHeader>\n\t\t\t<CardContent className=\"space-y-4\">\n\t\t\t\t<div className=\"flex gap-4 flex-wrap\">\n\t\t\t\t\t<div className=\"flex-1 min-w-[200px]\">\n\t\t\t\t\t\t<Label>{t.filterByEmployee}</Label>\n\t\t\t\t\t\t<Select value={selectedEmployee} onValueChange={setSelectedEmployee}>\n\t\t\t\t\t\t\t<SelectTrigger>\n\t\t\t\t\t\t\t\t<SelectValue />\n\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t<SelectItem value=\"all\">{t.allEmployees}</SelectItem>\n\t\t\t\t\t\t\t\t{users.filter(u => u.role === UserRole.Employee).map((u) => (\n\t\t\t\t\t\t\t\t\t<SelectItem key={u.id} value={u.id}>\n\t\t\t\t\t\t\t\t\t\t{u.name}\n\t\t\t\t\t\t\t\t\t</SelectItem>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t</Select>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div className=\"flex-1 min-w-[200px]\">\n\t\t\t\t\t\t<Label>{t.filterByDate}</Label>\n\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\ttype=\"date\"\n\t\t\t\t\t\t\tvalue={dateFilter}\n\t\t\t\t\t\t\tonChange={(e) => setDateFilter(e.target.value)}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{(selectedEmployee !== \"all\" || dateFilter) && (\n\t\t\t\t\t\t<div className=\"flex items-end\">\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\t\tsetSelectedEmployee(\"all\");\n\t\t\t\t\t\t\t\t\tsetDateFilter(\"\");\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{t.clearFilters}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\n\t\t\t\t{filteredSickDays.length === 0 ? (\n\t\t\t\t\t<p className=\"text-center text-muted-foreground py-8\">{t.noSickDays}</p>\n\t\t\t\t) : (\n\t\t\t\t\t<div className=\"overflow-x-auto\">\n\t\t\t\t\t\t<Table>\n\t\t\t\t\t\t\t<TableHeader>\n\t\t\t\t\t\t\t\t<TableRow>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.employeeName}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.sickDayDate}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.sickDayHours}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.sickDayNotes}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.actions}</TableHead>\n\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t</TableHeader>\n\t\t\t\t\t\t\t<TableBody>\n\t\t\t\t\t\t\t\t{filteredSickDays.map((sd) => (\n\t\t\t\t\t\t\t\t\t<TableRow key={sd.id}>\n\t\t\t\t\t\t\t\t\t\t<TableCell className=\"font-medium whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t{getUserName(sd.user_id)}\n\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t{formatDate(sd.sick_date)}\n\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell>{sd.hours} hrs</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell className=\"max-w-xs truncate\">{sd.notes || \"—\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => handleDeleteSickDay(sd)}\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"text-red-600 hover:text-red-700 hover:bg-red-50\"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<Trash2 className=\"w-4 h-4\" />\n\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</TableBody>\n\t\t\t\t\t\t</Table>\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\t\t\t</CardContent>\n\t\t</Card>\n\t);\n}\n\nfunction ReportsTab({ users, language }: { users: UserModel[]; language: Language }) {\n\tconst [weekStart, setWeekStart] = useState(\"\");\n\tconst [reportData, setReportData] = useState<{ user: UserModel; regularHours: number; overtimeHours: number; totalHours: number; regularPay: number; overtimePay: number; totalPay: number }[]>([]);\n\tconst [detailedTimeCards, setDetailedTimeCards] = useState<TimeCardEntryModel[]>([]);\n\n\tconst t = translations[language];\n\n\tuseEffect(() => {\n\t\t// Set default to current week\n\t\tconst today = new Date();\n\t\tconst monday = new Date(today);\n\t\tmonday.setDate(today.getDate() - today.getDay() + 1);\n\t\tsetWeekStart(monday.toISOString().slice(0, 10));\n\t}, []);\n\n\tuseEffect(() => {\n\t\tif (weekStart) {\n\t\t\tloadWeeklyReport();\n\t\t}\n\t}, [weekStart, users]);\n\n\tconst loadWeeklyReport = async () => {\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tconst allCards = await timeCardORM.getAllTimeCardEntry();\n\n\t\t// Normalize data from ORM\n\t\tconst normalized = normalizeTimeCardEntriesFromORM(allCards);\n\n\t\tconst weekStartDate = new Date(weekStart);\n\t\tconst weekStartTimestamp = Math.floor(weekStartDate.getTime() / 1000);\n\t\tconst weekEndTimestamp = weekStartTimestamp + 604800; // 7 days\n\n\t\tconst weekCards = normalized.filter(tc => {\n\t\t\tconst clockIn = parseInt(tc.clock_in_timestamp);\n\t\t\treturn clockIn >= weekStartTimestamp && clockIn < weekEndTimestamp && tc.total_hours;\n\t\t});\n\n\t\t// Store detailed time cards\n\t\tsetDetailedTimeCards(weekCards.sort((a, b) => parseInt(a.clock_in_timestamp) - parseInt(b.clock_in_timestamp)));\n\n\t\tconst employeeHours = users\n\t\t\t.filter(u => u.role === UserRole.Employee)\n\t\t\t.map(user => {\n\t\t\t\tconst userCards = weekCards.filter(tc => tc.user_id === user.id);\n\t\t\t\tconst totalHours = userCards.reduce((sum, tc) => sum + (tc.total_hours || 0), 0);\n\t\t\t\tconst regularHours = Math.min(totalHours, 40);\n\t\t\t\tconst overtimeHours = Math.max(totalHours - 40, 0);\n\n\t\t\t\t// Calculate pay\n\t\t\t\tconst hourlyRate = user.hourly_rate || 0;\n\t\t\t\tconst regularPay = regularHours * hourlyRate;\n\t\t\t\tconst overtimePay = overtimeHours * hourlyRate * 1.5;\n\t\t\t\tconst totalPay = regularPay + overtimePay;\n\n\t\t\t\treturn {\n\t\t\t\t\tuser,\n\t\t\t\t\tregularHours,\n\t\t\t\t\tovertimeHours,\n\t\t\t\t\ttotalHours,\n\t\t\t\t\tregularPay,\n\t\t\t\t\tovertimePay,\n\t\t\t\t\ttotalPay,\n\t\t\t\t};\n\t\t\t});\n\n\t\tsetReportData(employeeHours);\n\t};\n\n\tconst formatHours = (hours: number) => {\n\t\treturn `${hours.toFixed(2)} hrs`;\n\t};\n\n\tconst formatPay = (amount: number) => {\n\t\treturn `$${amount.toFixed(2)}`;\n\t};\n\n\tconst formatDate = (timestamp: string) => {\n\t\tconst date = new Date(parseInt(timestamp) * 1000);\n\t\treturn date.toLocaleString(language === 'es' ? 'es-ES' : 'en-US');\n\t};\n\n\tconst formatDateOnly = (timestamp: string) => {\n\t\tconst date = new Date(parseInt(timestamp) * 1000);\n\t\treturn date.toLocaleDateString(language === 'es' ? 'es-ES' : 'en-US');\n\t};\n\n\tconst getDayOfWeek = (timestamp: string) => {\n\t\tconst date = new Date(parseInt(timestamp) * 1000);\n\t\treturn date.toLocaleDateString(language === 'es' ? 'es-ES' : 'en-US', { weekday: 'long' });\n\t};\n\n\tconst getUserName = (userId: string) => {\n\t\tconst user = users.find(u => u.id === userId);\n\t\treturn user?.name || \"Unknown\";\n\t};\n\n\tconst handlePrint = () => {\n\t\twindow.print();\n\t};\n\n\tconst handleExportCSV = () => {\n\t\tif (detailedTimeCards.length === 0) return;\n\n\t\t// Create CSV header\n\t\tconst headers = [\n\t\t\tt.employeeName,\n\t\t\tt.date,\n\t\t\tt.day,\n\t\t\tt.clockInTime,\n\t\t\tt.clockOutTime,\n\t\t\tt.location,\n\t\t\tt.workDescription,\n\t\t\tt.lunchDuration,\n\t\t\tt.hours,\n\t\t\tt.hourlyRate,\n\t\t\tt.pay\n\t\t];\n\n\t\t// Create CSV rows\n\t\tconst rows = detailedTimeCards.map(tc => {\n\t\t\tconst user = users.find(u => u.id === tc.user_id);\n\t\t\tconst userName = user?.name || \"Unknown\";\n\t\t\tconst hourlyRate = user?.hourly_rate || 0;\n\t\t\tconst date = formatDateOnly(tc.clock_in_timestamp);\n\t\t\tconst day = getDayOfWeek(tc.clock_in_timestamp);\n\t\t\tconst clockIn = formatDate(tc.clock_in_timestamp);\n\t\t\tconst clockOut = tc.clock_out_timestamp ? formatDate(tc.clock_out_timestamp) : \"—\";\n\t\t\tconst location = tc.location || \"—\";\n\t\t\tconst workDescription = (tc.work_description || \"—\").replace(/\"/g, '\"\"'); // Escape quotes\n\t\t\tconst lunchDuration = tc.lunch_duration_minutes ? `${Math.round(tc.lunch_duration_minutes)} min` : \"—\";\n\t\t\tconst hours = tc.total_hours ? `${tc.total_hours.toFixed(2)} hrs` : \"—\";\n\t\t\tconst pay = tc.total_hours ? formatPay(tc.total_hours * hourlyRate) : \"—\";\n\n\t\t\treturn [\n\t\t\t\t`\"${userName}\"`,\n\t\t\t\t`\"${date}\"`,\n\t\t\t\t`\"${day}\"`,\n\t\t\t\t`\"${clockIn}\"`,\n\t\t\t\t`\"${clockOut}\"`,\n\t\t\t\t`\"${location}\"`,\n\t\t\t\t`\"${workDescription}\"`,\n\t\t\t\t`\"${lunchDuration}\"`,\n\t\t\t\t`\"${hours}\"`,\n\t\t\t\t`\"${formatPay(hourlyRate)}\"`,\n\t\t\t\t`\"${pay}\"`\n\t\t\t].join(',');\n\t\t});\n\n\t\t// Combine header and rows\n\t\tconst csv = [headers.join(','), ...rows].join('\\n');\n\n\t\t// Create blob and download\n\t\tconst blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });\n\t\tconst link = document.createElement('a');\n\t\tconst url = URL.createObjectURL(blob);\n\t\tlink.setAttribute('href', url);\n\t\tlink.setAttribute('download', `weekly-report-${weekStart}.csv`);\n\t\tlink.style.visibility = 'hidden';\n\t\tdocument.body.appendChild(link);\n\t\tlink.click();\n\t\tdocument.body.removeChild(link);\n\t};\n\n\treturn (\n\t\t<div className=\"space-y-4\">\n\t\t\t<Card>\n\t\t\t\t<CardHeader>\n\t\t\t\t\t<div className=\"flex justify-between items-center\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<CardTitle>{t.weeklyReport}</CardTitle>\n\t\t\t\t\t\t\t<CardDescription>\n\t\t\t\t\t\t\t\tOvertime calculated for hours worked beyond 40 hours/week\n\t\t\t\t\t\t\t\t<br />\n\t\t\t\t\t\t\t\t<span className=\"text-xs text-muted-foreground\">\n\t\t\t\t\t\t\t\t\tNote: Sick days are tracked separately in the \"Sick Days\" tab and are NOT included in this time card report.\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</CardDescription>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"flex gap-2 print:hidden\">\n\t\t\t\t\t\t\t<Button onClick={handleExportCSV} variant=\"outline\" disabled={detailedTimeCards.length === 0}>\n\t\t\t\t\t\t\t\t<FileText className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t\t\t\t{t.exportCSV}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t<Button onClick={handlePrint} variant=\"outline\" disabled={detailedTimeCards.length === 0}>\n\t\t\t\t\t\t\t\t<FileText className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t\t\t\t{t.printReport}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</CardHeader>\n\t\t\t\t<CardContent className=\"space-y-4\">\n\t\t\t\t\t<div className=\"max-w-xs print:hidden\">\n\t\t\t\t\t\t<Label>{t.selectWeek}</Label>\n\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\ttype=\"date\"\n\t\t\t\t\t\t\tvalue={weekStart}\n\t\t\t\t\t\t\tonChange={(e) => setWeekStart(e.target.value)}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{reportData.length === 0 ? (\n\t\t\t\t\t\t<p className=\"text-center text-muted-foreground py-8\">{t.noReportData}</p>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t{/* Summary Table */}\n\t\t\t\t\t\t\t<div className=\"overflow-x-auto\">\n\t\t\t\t\t\t\t\t<Table>\n\t\t\t\t\t\t\t\t\t<TableHeader>\n\t\t\t\t\t\t\t\t\t\t<TableRow>\n\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.employeeName}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.regularHours}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.overtimeHours}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.totalHours}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.regularPay}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.overtimePay}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.totalPay}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t<TableHead className=\"print:hidden\">{t.status}</TableHead>\n\t\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t\t</TableHeader>\n\t\t\t\t\t\t\t\t\t<TableBody>\n\t\t\t\t\t\t\t\t\t\t{reportData.map(({ user, regularHours, overtimeHours, totalHours, regularPay, overtimePay, totalPay }) => (\n\t\t\t\t\t\t\t\t\t\t\t<TableRow key={user.id}>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"font-medium\">{user.name}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableCell>{formatHours(regularHours)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{overtimeHours > 0 ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-orange-600 font-semibold\">{formatHours(overtimeHours)}</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tformatHours(0)\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"font-semibold\">{formatHours(totalHours)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableCell>{formatPay(regularPay)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{overtimePay > 0 ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-orange-600 font-semibold\">{formatPay(overtimePay)}</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tformatPay(0)\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"font-semibold\">{formatPay(totalPay)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"print:hidden\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{overtimeHours > 0 && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge className=\"bg-orange-500\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<AlertCircle className=\"w-3 h-3 mr-1\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{t.overtimeAlert}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t\t</TableBody>\n\t\t\t\t\t\t\t\t</Table>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t{/* Detailed Time Cards Table */}\n\t\t\t\t\t\t\t<div className=\"mt-8\">\n\t\t\t\t\t\t\t\t<h3 className=\"text-lg font-semibold mb-4\">{t.detailedReport}</h3>\n\t\t\t\t\t\t\t\t<div className=\"overflow-x-auto\">\n\t\t\t\t\t\t\t\t\t<Table className=\"print-table-responsive\">\n\t\t\t\t\t\t\t\t\t\t<TableHeader>\n\t\t\t\t\t\t\t\t\t\t\t<TableRow>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.employeeName}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.date}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.day}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.clockInTime}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.clockOutTime}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.location}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.workDescription}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.lunchDuration}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.hours}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.hourlyRate}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.pay}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t\t\t</TableHeader>\n\t\t\t\t\t\t\t\t\t\t<TableBody className=\"print-table-responsive\">\n\t\t\t\t\t\t\t\t\t\t\t{detailedTimeCards.map((tc) => {\n\t\t\t\t\t\t\t\t\t\t\t\tconst user = users.find(u => u.id === tc.user_id);\n\t\t\t\t\t\t\t\t\t\t\t\tconst hourlyRate = user?.hourly_rate || 0;\n\t\t\t\t\t\t\t\t\t\t\t\tconst pay = tc.total_hours ? tc.total_hours * hourlyRate : 0;\n\n\t\t\t\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<TableRow key={tc.id}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"font-medium whitespace-nowrap\">{user?.name || \"Unknown\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatDateOnly(tc.clock_in_timestamp)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{getDayOfWeek(tc.clock_in_timestamp)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatDate(tc.clock_in_timestamp)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{tc.clock_out_timestamp ? formatDate(tc.clock_out_timestamp) : \"—\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell>{tc.location || \"—\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"allow-wrap max-w-xs\">{tc.work_description || \"—\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{tc.lunch_duration_minutes ? `${Math.round(tc.lunch_duration_minutes)} min` : \"—\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{tc.total_hours ? `${tc.total_hours.toFixed(2)} hrs` : \"—\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{formatPay(hourlyRate)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{formatPay(pay)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t\t\t\t</TableBody>\n\t\t\t\t\t\t\t\t\t</Table>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</>\n\t\t\t\t\t)}\n\t\t\t\t</CardContent>\n\t\t\t</Card>\n\t\t</div>\n\t);\n}\n\nfunction EmployeesTab({ users, language, onUsersChange }: { users: UserModel[]; language: Language; onUsersChange: () => void }) {\n\tconst [showAddEmployee, setShowAddEmployee] = useState(false);\n\tconst [editingEmployee, setEditingEmployee] = useState<UserModel | null>(null);\n\tconst [employeeName, setEmployeeName] = useState(\"\");\n\tconst [employeeEmail, setEmployeeEmail] = useState(\"\");\n\tconst [employeePhone, setEmployeePhone] = useState(\"\");\n\tconst [employeeRole, setEmployeeRole] = useState<UserRole>(UserRole.Employee);\n\tconst [employeeHourlyRate, setEmployeeHourlyRate] = useState(\"\");\n\tconst [deleteConfirm, setDeleteConfirm] = useState<UserModel | null>(null);\n\n\tconst t = translations[language];\n\n\tconst handleAddEmployee = async () => {\n\t\tconst userORM = UserORM.getInstance();\n\t\tawait userORM.insertUser([{\n\t\t\tname: employeeName,\n\t\t\temail: employeeEmail,\n\t\t\tphone: employeePhone || null,\n\t\t\trole: employeeRole,\n\t\t\thourly_rate: employeeHourlyRate ? parseFloat(employeeHourlyRate) : null,\n\t\t} as UserModel]);\n\n\t\tsetShowAddEmployee(false);\n\t\tsetEmployeeName(\"\");\n\t\tsetEmployeeEmail(\"\");\n\t\tsetEmployeePhone(\"\");\n\t\tsetEmployeeRole(UserRole.Employee);\n\t\tsetEmployeeHourlyRate(\"\");\n\t\tonUsersChange();\n\t};\n\n\tconst handleEditEmployee = async () => {\n\t\tif (!editingEmployee) return;\n\n\t\tconst userORM = UserORM.getInstance();\n\t\tawait userORM.setUserById(editingEmployee.id, {\n\t\t\t...editingEmployee,\n\t\t\tname: employeeName,\n\t\t\temail: employeeEmail,\n\t\t\tphone: employeePhone || null,\n\t\t\trole: employeeRole,\n\t\t\thourly_rate: employeeHourlyRate ? parseFloat(employeeHourlyRate) : null,\n\t\t});\n\n\t\tsetEditingEmployee(null);\n\t\tsetEmployeeName(\"\");\n\t\tsetEmployeeEmail(\"\");\n\t\tsetEmployeePhone(\"\");\n\t\tsetEmployeeRole(UserRole.Employee);\n\t\tsetEmployeeHourlyRate(\"\");\n\t\tonUsersChange();\n\t};\n\n\tconst handleDeleteEmployee = async (user: UserModel) => {\n\t\tconst userORM = UserORM.getInstance();\n\t\tawait userORM.deleteUserById(user.id);\n\t\tsetDeleteConfirm(null);\n\t\tonUsersChange();\n\t};\n\n\tconst openEditDialog = (user: UserModel) => {\n\t\tsetEditingEmployee(user);\n\t\tsetEmployeeName(user.name);\n\t\tsetEmployeeEmail(user.email);\n\t\tsetEmployeePhone(user.phone || \"\");\n\t\tsetEmployeeRole(user.role);\n\t\tsetEmployeeHourlyRate(user.hourly_rate ? user.hourly_rate.toString() : \"\");\n\t};\n\n\treturn (\n\t\t<div className=\"space-y-4\">\n\t\t\t<Card>\n\t\t\t\t<CardHeader>\n\t\t\t\t\t<div className=\"flex justify-between items-center\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<CardTitle>{t.employees}</CardTitle>\n\t\t\t\t\t\t\t<CardDescription>Manage employee accounts</CardDescription>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<Button onClick={() => setShowAddEmployee(true)}>\n\t\t\t\t\t\t\t<UserPlus className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t\t\t{t.addEmployee}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t</CardHeader>\n\t\t\t\t<CardContent>\n\t\t\t\t\t<div className=\"overflow-x-auto\">\n\t\t\t\t\t\t<Table>\n\t\t\t\t\t\t\t<TableHeader>\n\t\t\t\t\t\t\t\t<TableRow>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.name}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.email}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.phone}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.role}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.hourlyRate}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.actions}</TableHead>\n\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t</TableHeader>\n\t\t\t\t\t\t\t<TableBody>\n\t\t\t\t\t\t\t\t{users.map((user) => (\n\t\t\t\t\t\t\t\t\t<TableRow key={user.id}>\n\t\t\t\t\t\t\t\t\t\t<TableCell className=\"font-medium\">{user.name}</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell>{user.email}</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell>{user.phone || \"—\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<Badge variant={user.role === UserRole.Manager ? \"default\" : \"secondary\"}>\n\t\t\t\t\t\t\t\t\t\t\t\t{user.role === UserRole.Manager ? t.manager : t.employee}\n\t\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t{user.hourly_rate ? `$${user.hourly_rate.toFixed(2)}/hr` : \"—\"}\n\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => openEditDialog(user)}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{t.edit}\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"destructive\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => setDeleteConfirm(user)}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{t.delete}\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</TableBody>\n\t\t\t\t\t\t</Table>\n\t\t\t\t\t</div>\n\t\t\t\t</CardContent>\n\t\t\t</Card>\n\n\t\t\t<Dialog open={showAddEmployee} onOpenChange={setShowAddEmployee}>\n\t\t\t\t<DialogContent>\n\t\t\t\t\t<DialogHeader>\n\t\t\t\t\t\t<DialogTitle>{t.addEmployee}</DialogTitle>\n\t\t\t\t\t</DialogHeader>\n\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.name}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\tvalue={employeeName}\n\t\t\t\t\t\t\t\tonChange={(e) => setEmployeeName(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder=\"John Doe\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.email}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"email\"\n\t\t\t\t\t\t\t\tvalue={employeeEmail}\n\t\t\t\t\t\t\t\tonChange={(e) => setEmployeeEmail(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder=\"john@example.com\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.phone}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"tel\"\n\t\t\t\t\t\t\t\tvalue={employeePhone}\n\t\t\t\t\t\t\t\tonChange={(e) => setEmployeePhone(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder=\"+1 (555) 123-4567\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.role}</Label>\n\t\t\t\t\t\t\t<Select value={employeeRole.toString()} onValueChange={(v) => setEmployeeRole(parseInt(v))}>\n\t\t\t\t\t\t\t\t<SelectTrigger>\n\t\t\t\t\t\t\t\t\t<SelectValue />\n\t\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t\t<SelectItem value={UserRole.Employee.toString()}>{t.employee}</SelectItem>\n\t\t\t\t\t\t\t\t\t<SelectItem value={UserRole.Manager.toString()}>{t.manager}</SelectItem>\n\t\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t\t</Select>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.hourlyRate}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\tmin=\"0\"\n\t\t\t\t\t\t\t\tstep=\"0.01\"\n\t\t\t\t\t\t\t\tvalue={employeeHourlyRate}\n\t\t\t\t\t\t\t\tonChange={(e) => setEmployeeHourlyRate(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder=\"15.00\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<DialogFooter>\n\t\t\t\t\t\t<Button variant=\"outline\" onClick={() => setShowAddEmployee(false)}>\n\t\t\t\t\t\t\t{t.cancel}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button onClick={handleAddEmployee} disabled={!employeeName || !employeeEmail}>\n\t\t\t\t\t\t\t{t.saveChanges}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</DialogFooter>\n\t\t\t\t</DialogContent>\n\t\t\t</Dialog>\n\n\t\t\t<Dialog open={!!editingEmployee} onOpenChange={(open) => !open && setEditingEmployee(null)}>\n\t\t\t\t<DialogContent>\n\t\t\t\t\t<DialogHeader>\n\t\t\t\t\t\t<DialogTitle>{t.editEmployee}</DialogTitle>\n\t\t\t\t\t</DialogHeader>\n\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.name}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\tvalue={employeeName}\n\t\t\t\t\t\t\t\tonChange={(e) => setEmployeeName(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.email}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"email\"\n\t\t\t\t\t\t\t\tvalue={employeeEmail}\n\t\t\t\t\t\t\t\tonChange={(e) => setEmployeeEmail(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.phone}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"tel\"\n\t\t\t\t\t\t\t\tvalue={employeePhone}\n\t\t\t\t\t\t\t\tonChange={(e) => setEmployeePhone(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder=\"+1 (555) 123-4567\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.role}</Label>\n\t\t\t\t\t\t\t<Select value={employeeRole.toString()} onValueChange={(v) => setEmployeeRole(parseInt(v))}>\n\t\t\t\t\t\t\t\t<SelectTrigger>\n\t\t\t\t\t\t\t\t\t<SelectValue />\n\t\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t\t<SelectItem value={UserRole.Employee.toString()}>{t.employee}</SelectItem>\n\t\t\t\t\t\t\t\t\t<SelectItem value={UserRole.Manager.toString()}>{t.manager}</SelectItem>\n\t\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t\t</Select>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.hourlyRate}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\tmin=\"0\"\n\t\t\t\t\t\t\t\tstep=\"0.01\"\n\t\t\t\t\t\t\t\tvalue={employeeHourlyRate}\n\t\t\t\t\t\t\t\tonChange={(e) => setEmployeeHourlyRate(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder=\"15.00\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<DialogFooter>\n\t\t\t\t\t\t<Button variant=\"outline\" onClick={() => setEditingEmployee(null)}>\n\t\t\t\t\t\t\t{t.cancel}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button onClick={handleEditEmployee}>\n\t\t\t\t\t\t\t{t.saveChanges}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</DialogFooter>\n\t\t\t\t</DialogContent>\n\t\t\t</Dialog>\n\n\t\t\t<Dialog open={!!deleteConfirm} onOpenChange={(open) => !open && setDeleteConfirm(null)}>\n\t\t\t\t<DialogContent>\n\t\t\t\t\t<DialogHeader>\n\t\t\t\t\t\t<DialogTitle>{t.deleteEmployee}</DialogTitle>\n\t\t\t\t\t</DialogHeader>\n\t\t\t\t\t<p>{t.confirmDelete}</p>\n\t\t\t\t\t<p className=\"font-semibold\">{deleteConfirm?.name}</p>\n\t\t\t\t\t<DialogFooter>\n\t\t\t\t\t\t<Button variant=\"outline\" onClick={() => setDeleteConfirm(null)}>\n\t\t\t\t\t\t\t{t.cancel}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button variant=\"destructive\" onClick={() => deleteConfirm && handleDeleteEmployee(deleteConfirm)}>\n\t\t\t\t\t\t\t{t.delete}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</DialogFooter>\n\t\t\t\t</DialogContent>\n\t\t\t</Dialog>\n\t\t</div>\n\t);\n}\n\nfunction ManualEntryDialog({\n\topen,\n\tonClose,\n\tuserId,\n\tonSave,\n\tlanguage,\n\tusers\n}: {\n\topen: boolean;\n\tonClose: () => void;\n\tuserId: string;\n\tonSave: () => void;\n\tlanguage: Language;\n\tusers?: UserModel[];\n}) {\n\tconst [selectedUser, setSelectedUser] = useState(userId);\n\tconst [clockIn, setClockIn] = useState(\"\");\n\tconst [clockOut, setClockOut] = useState(\"\");\n\tconst [location, setLocation] = useState(\"\");\n\tconst [workDescription, setWorkDescription] = useState(\"\");\n\tconst [lunchStart, setLunchStart] = useState(\"\");\n\tconst [lunchEnd, setLunchEnd] = useState(\"\");\n\n\tconst t = translations[language];\n\n\tuseEffect(() => {\n\t\tif (open) {\n\t\t\tsetSelectedUser(userId);\n\t\t\t// Set default to today\n\t\t\tconst now = new Date();\n\t\t\tconst today = now.toISOString().slice(0, 10);\n\t\t\tsetClockIn(`${today}T09:00`);\n\t\t\tsetClockOut(`${today}T17:00`);\n\t\t\tsetLocation(\"\");\n\t\t\tsetWorkDescription(\"\");\n\t\t\tsetLunchStart(`${today}T12:00`);\n\t\t\tsetLunchEnd(`${today}T13:00`);\n\t\t}\n\t}, [open, userId]);\n\n\tconst handleSave = async () => {\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\n\t\tconst clockInTimestamp = Math.floor(new Date(clockIn).getTime() / 1000).toString();\n\t\tconst clockOutTimestamp = clockOut ? Math.floor(new Date(clockOut).getTime() / 1000).toString() : undefined;\n\t\tconst lunchStartTimestamp = lunchStart ? Math.floor(new Date(lunchStart).getTime() / 1000).toString() : undefined;\n\t\tconst lunchEndTimestamp = lunchEnd ? Math.floor(new Date(lunchEnd).getTime() / 1000).toString() : undefined;\n\n\t\tlet totalHours: number | undefined = undefined;\n\t\tlet lunchDurationMinutes: number | undefined = undefined;\n\n\t\t// Calculate lunch duration\n\t\tif (lunchStartTimestamp && lunchEndTimestamp) {\n\t\t\tconst lunchStartTime = parseInt(lunchStartTimestamp);\n\t\t\tconst lunchEndTime = parseInt(lunchEndTimestamp);\n\t\t\tlunchDurationMinutes = (lunchEndTime - lunchStartTime) / 60;\n\t\t}\n\n\t\t// Calculate total hours\n\t\tif (clockOutTimestamp) {\n\t\t\tconst clockInTime = parseInt(clockInTimestamp);\n\t\t\tconst clockOutTime = parseInt(clockOutTimestamp);\n\t\t\ttotalHours = (clockOutTime - clockInTime) / 3600;\n\n\t\t\t// Deduct lunch time\n\t\t\tif (lunchDurationMinutes) {\n\t\t\t\ttotalHours -= lunchDurationMinutes / 60;\n\t\t\t}\n\t\t}\n\n\t\tconst entryData = {\n\t\t\tuser_id: selectedUser,\n\t\t\tclock_in_timestamp: clockInTimestamp,\n\t\t\tclock_out_timestamp: clockOutTimestamp,\n\t\t\ttotal_hours: totalHours,\n\t\t\tlocation: location || undefined,\n\t\t\twork_description: workDescription || undefined,\n\t\t\tlunch_start_timestamp: lunchStartTimestamp,\n\t\t\tlunch_end_timestamp: lunchEndTimestamp,\n\t\t\tlunch_duration_minutes: lunchDurationMinutes,\n\t\t} as TimeCardEntryModel;\n\n\t\tconst normalizedEntry = normalizeTimeCardEntryForSave(entryData);\n\t\tawait timeCardORM.insertTimeCardEntry([normalizedEntry as TimeCardEntryModel]);\n\n\t\tonSave();\n\t\tonClose();\n\t};\n\n\treturn (\n\t\t<Dialog open={open} onOpenChange={onClose}>\n\t\t\t<DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n\t\t\t\t<DialogHeader>\n\t\t\t\t\t<DialogTitle>{t.addManualEntry}</DialogTitle>\n\t\t\t\t</DialogHeader>\n\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t{users && (\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.employeeName}</Label>\n\t\t\t\t\t\t\t<Select value={selectedUser} onValueChange={setSelectedUser}>\n\t\t\t\t\t\t\t\t<SelectTrigger>\n\t\t\t\t\t\t\t\t\t<SelectValue />\n\t\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t\t{users.filter(u => u.role === UserRole.Employee).map((u) => (\n\t\t\t\t\t\t\t\t\t\t<SelectItem key={u.id} value={u.id}>\n\t\t\t\t\t\t\t\t\t\t\t{u.name}\n\t\t\t\t\t\t\t\t\t\t</SelectItem>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t\t</Select>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t\t<div className=\"grid grid-cols-2 gap-4\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.clockInTime}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\tvalue={clockIn}\n\t\t\t\t\t\t\t\tonChange={(e) => setClockIn(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.clockOutTime}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\tvalue={clockOut}\n\t\t\t\t\t\t\t\tonChange={(e) => setClockOut(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<Label>{t.location}</Label>\n\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\tvalue={location}\n\t\t\t\t\t\t\tonChange={(e) => setLocation(e.target.value)}\n\t\t\t\t\t\t\tplaceholder={t.locationPlaceholder}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<Label>{t.workDescription}</Label>\n\t\t\t\t\t\t<Textarea\n\t\t\t\t\t\t\tvalue={workDescription}\n\t\t\t\t\t\t\tonChange={(e) => setWorkDescription(e.target.value)}\n\t\t\t\t\t\t\tplaceholder={t.descriptionPlaceholder}\n\t\t\t\t\t\t\trows={4}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"grid grid-cols-2 gap-4\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.lunchStartTime} ({language === 'en' ? 'Optional' : 'Opcional'})</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\tvalue={lunchStart}\n\t\t\t\t\t\t\t\tonChange={(e) => setLunchStart(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.lunchEndTime} ({language === 'en' ? 'Optional' : 'Opcional'})</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\tvalue={lunchEnd}\n\t\t\t\t\t\t\t\tonChange={(e) => setLunchEnd(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<DialogFooter>\n\t\t\t\t\t<Button variant=\"outline\" onClick={onClose}>\n\t\t\t\t\t\t{t.cancel}\n\t\t\t\t\t</Button>\n\t\t\t\t\t<Button onClick={handleSave} disabled={!selectedUser || !clockIn}>\n\t\t\t\t\t\t{t.saveChanges}\n\t\t\t\t\t</Button>\n\t\t\t\t</DialogFooter>\n\t\t\t</DialogContent>\n\t\t</Dialog>\n\t);\n}\n","structuredPatch":[{"oldStart":354,"oldLines":7,"newStart":354,"newLines":9,"lines":["       <div className=\"container mx-auto p-6 space-y-6\">","         <div className=\"flex justify-between items-center\">","           <div>","-            <h1 className=\"text-3xl font-bold\">{t.timeTrackingSystem}</h1>","+            <h1 className=\"text-3xl font-bold\">","+              {employeeOnlyMode ? t.myTimeTracking : t.timeTrackingSystem}","+            </h1>","             <p className=\"text-muted-foreground\">","               {t.welcome}, {currentUser.name} ({currentUser.role === UserRole.Manager ? t.manager : t.employee})","             </p>"]},{"oldStart":364,"oldLines":9,"newStart":366,"newLines":11,"lines":["               <Languages className=\"w-4 h-4 mr-2\" />","               {language === 'en' ? 'Español' : 'English'}","             </Button>","-            <Button onClick={handleLogout} variant=\"outline\">","-              {t.switchUser}","-            </Button>","+            {!employeeOnlyMode && (","+              <Button onClick={handleLogout} variant=\"outline\">","+                {t.switchUser}","+              </Button>","+            )}","           </div>","         </div>"," "]}],"userModified":false,"replaceAll":false}}
{"type":"assistant","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_vrtx_01RS1HpH5YiQS28PDnp5Fdjv","type":"message","role":"assistant","content":[{"type":"text","text":"Now I need to find the EmployeesTab component in the ManagerView to add the \"Copy Employee Link\" button. Let me search for it:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":2,"cache_creation_input_tokens":1541,"cache_read_input_tokens":50093,"cache_creation":{"ephemeral_5m_input_tokens":1541,"ephemeral_1h_input_tokens":0},"output_tokens":5},"context_management":null},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"d480f7dd-9a7e-49ac-b789-9316e7b60b95"}
{"type":"assistant","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_vrtx_01RS1HpH5YiQS28PDnp5Fdjv","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_vrtx_01YCcTpeAzKkppjotmiUv5V5","name":"Grep","input":{"pattern":"function EmployeesTab","path":"/home/user/vite-template/src/routes/index.tsx","output_mode":"content"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":2,"cache_creation_input_tokens":1541,"cache_read_input_tokens":50093,"cache_creation":{"ephemeral_5m_input_tokens":1541,"ephemeral_1h_input_tokens":0},"output_tokens":143},"context_management":null},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"3c9f7620-6075-4dea-9945-b616eb8697ff"}
{"type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_vrtx_01YCcTpeAzKkppjotmiUv5V5","type":"tool_result","content":"2000:function EmployeesTab({ users, language, onUsersChange }: { users: UserModel[]; language: Language; onUsersChange: () => void }) {"}]},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"251d52b1-de12-4335-b1e7-2a4e0626de97","tool_use_result":{"mode":"content","numFiles":0,"filenames":[],"content":"2000:function EmployeesTab({ users, language, onUsersChange }: { users: UserModel[]; language: Language; onUsersChange: () => void }) {","numLines":1}}
{"type":"assistant","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_vrtx_014eCYUQzBniEwxzxJhEJzWL","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_vrtx_01BpcCEurhqR5uLYCbGaJ92r","name":"Read","input":{"file_path":"/home/user/vite-template/src/routes/index.tsx","offset":2000,"limit":120}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":364,"cache_read_input_tokens":51634,"cache_creation":{"ephemeral_5m_input_tokens":364,"ephemeral_1h_input_tokens":0},"output_tokens":104},"context_management":null},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"660ca443-1a22-46aa-93ff-ee18770aabe2"}
{"type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_vrtx_01BpcCEurhqR5uLYCbGaJ92r","type":"tool_result","content":"  2000→function EmployeesTab({ users, language, onUsersChange }: { users: UserModel[]; language: Language; onUsersChange: () => void }) {\n  2001→\tconst [showAddEmployee, setShowAddEmployee] = useState(false);\n  2002→\tconst [editingEmployee, setEditingEmployee] = useState<UserModel | null>(null);\n  2003→\tconst [employeeName, setEmployeeName] = useState(\"\");\n  2004→\tconst [employeeEmail, setEmployeeEmail] = useState(\"\");\n  2005→\tconst [employeePhone, setEmployeePhone] = useState(\"\");\n  2006→\tconst [employeeRole, setEmployeeRole] = useState<UserRole>(UserRole.Employee);\n  2007→\tconst [employeeHourlyRate, setEmployeeHourlyRate] = useState(\"\");\n  2008→\tconst [deleteConfirm, setDeleteConfirm] = useState<UserModel | null>(null);\n  2009→\n  2010→\tconst t = translations[language];\n  2011→\n  2012→\tconst handleAddEmployee = async () => {\n  2013→\t\tconst userORM = UserORM.getInstance();\n  2014→\t\tawait userORM.insertUser([{\n  2015→\t\t\tname: employeeName,\n  2016→\t\t\temail: employeeEmail,\n  2017→\t\t\tphone: employeePhone || null,\n  2018→\t\t\trole: employeeRole,\n  2019→\t\t\thourly_rate: employeeHourlyRate ? parseFloat(employeeHourlyRate) : null,\n  2020→\t\t} as UserModel]);\n  2021→\n  2022→\t\tsetShowAddEmployee(false);\n  2023→\t\tsetEmployeeName(\"\");\n  2024→\t\tsetEmployeeEmail(\"\");\n  2025→\t\tsetEmployeePhone(\"\");\n  2026→\t\tsetEmployeeRole(UserRole.Employee);\n  2027→\t\tsetEmployeeHourlyRate(\"\");\n  2028→\t\tonUsersChange();\n  2029→\t};\n  2030→\n  2031→\tconst handleEditEmployee = async () => {\n  2032→\t\tif (!editingEmployee) return;\n  2033→\n  2034→\t\tconst userORM = UserORM.getInstance();\n  2035→\t\tawait userORM.setUserById(editingEmployee.id, {\n  2036→\t\t\t...editingEmployee,\n  2037→\t\t\tname: employeeName,\n  2038→\t\t\temail: employeeEmail,\n  2039→\t\t\tphone: employeePhone || null,\n  2040→\t\t\trole: employeeRole,\n  2041→\t\t\thourly_rate: employeeHourlyRate ? parseFloat(employeeHourlyRate) : null,\n  2042→\t\t});\n  2043→\n  2044→\t\tsetEditingEmployee(null);\n  2045→\t\tsetEmployeeName(\"\");\n  2046→\t\tsetEmployeeEmail(\"\");\n  2047→\t\tsetEmployeePhone(\"\");\n  2048→\t\tsetEmployeeRole(UserRole.Employee);\n  2049→\t\tsetEmployeeHourlyRate(\"\");\n  2050→\t\tonUsersChange();\n  2051→\t};\n  2052→\n  2053→\tconst handleDeleteEmployee = async (user: UserModel) => {\n  2054→\t\tconst userORM = UserORM.getInstance();\n  2055→\t\tawait userORM.deleteUserById(user.id);\n  2056→\t\tsetDeleteConfirm(null);\n  2057→\t\tonUsersChange();\n  2058→\t};\n  2059→\n  2060→\tconst openEditDialog = (user: UserModel) => {\n  2061→\t\tsetEditingEmployee(user);\n  2062→\t\tsetEmployeeName(user.name);\n  2063→\t\tsetEmployeeEmail(user.email);\n  2064→\t\tsetEmployeePhone(user.phone || \"\");\n  2065→\t\tsetEmployeeRole(user.role);\n  2066→\t\tsetEmployeeHourlyRate(user.hourly_rate ? user.hourly_rate.toString() : \"\");\n  2067→\t};\n  2068→\n  2069→\treturn (\n  2070→\t\t<div className=\"space-y-4\">\n  2071→\t\t\t<Card>\n  2072→\t\t\t\t<CardHeader>\n  2073→\t\t\t\t\t<div className=\"flex justify-between items-center\">\n  2074→\t\t\t\t\t\t<div>\n  2075→\t\t\t\t\t\t\t<CardTitle>{t.employees}</CardTitle>\n  2076→\t\t\t\t\t\t\t<CardDescription>Manage employee accounts</CardDescription>\n  2077→\t\t\t\t\t\t</div>\n  2078→\t\t\t\t\t\t<Button onClick={() => setShowAddEmployee(true)}>\n  2079→\t\t\t\t\t\t\t<UserPlus className=\"w-4 h-4 mr-2\" />\n  2080→\t\t\t\t\t\t\t{t.addEmployee}\n  2081→\t\t\t\t\t\t</Button>\n  2082→\t\t\t\t\t</div>\n  2083→\t\t\t\t</CardHeader>\n  2084→\t\t\t\t<CardContent>\n  2085→\t\t\t\t\t<div className=\"overflow-x-auto\">\n  2086→\t\t\t\t\t\t<Table>\n  2087→\t\t\t\t\t\t\t<TableHeader>\n  2088→\t\t\t\t\t\t\t\t<TableRow>\n  2089→\t\t\t\t\t\t\t\t\t<TableHead>{t.name}</TableHead>\n  2090→\t\t\t\t\t\t\t\t\t<TableHead>{t.email}</TableHead>\n  2091→\t\t\t\t\t\t\t\t\t<TableHead>{t.phone}</TableHead>\n  2092→\t\t\t\t\t\t\t\t\t<TableHead>{t.role}</TableHead>\n  2093→\t\t\t\t\t\t\t\t\t<TableHead>{t.hourlyRate}</TableHead>\n  2094→\t\t\t\t\t\t\t\t\t<TableHead>{t.actions}</TableHead>\n  2095→\t\t\t\t\t\t\t\t</TableRow>\n  2096→\t\t\t\t\t\t\t</TableHeader>\n  2097→\t\t\t\t\t\t\t<TableBody>\n  2098→\t\t\t\t\t\t\t\t{users.map((user) => (\n  2099→\t\t\t\t\t\t\t\t\t<TableRow key={user.id}>\n  2100→\t\t\t\t\t\t\t\t\t\t<TableCell className=\"font-medium\">{user.name}</TableCell>\n  2101→\t\t\t\t\t\t\t\t\t\t<TableCell>{user.email}</TableCell>\n  2102→\t\t\t\t\t\t\t\t\t\t<TableCell>{user.phone || \"—\"}</TableCell>\n  2103→\t\t\t\t\t\t\t\t\t\t<TableCell>\n  2104→\t\t\t\t\t\t\t\t\t\t\t<Badge variant={user.role === UserRole.Manager ? \"default\" : \"secondary\"}>\n  2105→\t\t\t\t\t\t\t\t\t\t\t\t{user.role === UserRole.Manager ? t.manager : t.employee}\n  2106→\t\t\t\t\t\t\t\t\t\t\t</Badge>\n  2107→\t\t\t\t\t\t\t\t\t\t</TableCell>\n  2108→\t\t\t\t\t\t\t\t\t\t<TableCell>\n  2109→\t\t\t\t\t\t\t\t\t\t\t{user.hourly_rate ? `$${user.hourly_rate.toFixed(2)}/hr` : \"—\"}\n  2110→\t\t\t\t\t\t\t\t\t\t</TableCell>\n  2111→\t\t\t\t\t\t\t\t\t\t<TableCell>\n  2112→\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex gap-2\">\n  2113→\t\t\t\t\t\t\t\t\t\t\t\t<Button\n  2114→\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n  2115→\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n  2116→\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => openEditDialog(user)}\n  2117→\t\t\t\t\t\t\t\t\t\t\t\t>\n  2118→\t\t\t\t\t\t\t\t\t\t\t\t\t{t.edit}\n  2119→\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"29fc67e2-1e8e-4e49-b77b-fd145cc864b6","tool_use_result":{"type":"text","file":{"filePath":"/home/user/vite-template/src/routes/index.tsx","content":"function EmployeesTab({ users, language, onUsersChange }: { users: UserModel[]; language: Language; onUsersChange: () => void }) {\n\tconst [showAddEmployee, setShowAddEmployee] = useState(false);\n\tconst [editingEmployee, setEditingEmployee] = useState<UserModel | null>(null);\n\tconst [employeeName, setEmployeeName] = useState(\"\");\n\tconst [employeeEmail, setEmployeeEmail] = useState(\"\");\n\tconst [employeePhone, setEmployeePhone] = useState(\"\");\n\tconst [employeeRole, setEmployeeRole] = useState<UserRole>(UserRole.Employee);\n\tconst [employeeHourlyRate, setEmployeeHourlyRate] = useState(\"\");\n\tconst [deleteConfirm, setDeleteConfirm] = useState<UserModel | null>(null);\n\n\tconst t = translations[language];\n\n\tconst handleAddEmployee = async () => {\n\t\tconst userORM = UserORM.getInstance();\n\t\tawait userORM.insertUser([{\n\t\t\tname: employeeName,\n\t\t\temail: employeeEmail,\n\t\t\tphone: employeePhone || null,\n\t\t\trole: employeeRole,\n\t\t\thourly_rate: employeeHourlyRate ? parseFloat(employeeHourlyRate) : null,\n\t\t} as UserModel]);\n\n\t\tsetShowAddEmployee(false);\n\t\tsetEmployeeName(\"\");\n\t\tsetEmployeeEmail(\"\");\n\t\tsetEmployeePhone(\"\");\n\t\tsetEmployeeRole(UserRole.Employee);\n\t\tsetEmployeeHourlyRate(\"\");\n\t\tonUsersChange();\n\t};\n\n\tconst handleEditEmployee = async () => {\n\t\tif (!editingEmployee) return;\n\n\t\tconst userORM = UserORM.getInstance();\n\t\tawait userORM.setUserById(editingEmployee.id, {\n\t\t\t...editingEmployee,\n\t\t\tname: employeeName,\n\t\t\temail: employeeEmail,\n\t\t\tphone: employeePhone || null,\n\t\t\trole: employeeRole,\n\t\t\thourly_rate: employeeHourlyRate ? parseFloat(employeeHourlyRate) : null,\n\t\t});\n\n\t\tsetEditingEmployee(null);\n\t\tsetEmployeeName(\"\");\n\t\tsetEmployeeEmail(\"\");\n\t\tsetEmployeePhone(\"\");\n\t\tsetEmployeeRole(UserRole.Employee);\n\t\tsetEmployeeHourlyRate(\"\");\n\t\tonUsersChange();\n\t};\n\n\tconst handleDeleteEmployee = async (user: UserModel) => {\n\t\tconst userORM = UserORM.getInstance();\n\t\tawait userORM.deleteUserById(user.id);\n\t\tsetDeleteConfirm(null);\n\t\tonUsersChange();\n\t};\n\n\tconst openEditDialog = (user: UserModel) => {\n\t\tsetEditingEmployee(user);\n\t\tsetEmployeeName(user.name);\n\t\tsetEmployeeEmail(user.email);\n\t\tsetEmployeePhone(user.phone || \"\");\n\t\tsetEmployeeRole(user.role);\n\t\tsetEmployeeHourlyRate(user.hourly_rate ? user.hourly_rate.toString() : \"\");\n\t};\n\n\treturn (\n\t\t<div className=\"space-y-4\">\n\t\t\t<Card>\n\t\t\t\t<CardHeader>\n\t\t\t\t\t<div className=\"flex justify-between items-center\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<CardTitle>{t.employees}</CardTitle>\n\t\t\t\t\t\t\t<CardDescription>Manage employee accounts</CardDescription>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<Button onClick={() => setShowAddEmployee(true)}>\n\t\t\t\t\t\t\t<UserPlus className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t\t\t{t.addEmployee}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t</CardHeader>\n\t\t\t\t<CardContent>\n\t\t\t\t\t<div className=\"overflow-x-auto\">\n\t\t\t\t\t\t<Table>\n\t\t\t\t\t\t\t<TableHeader>\n\t\t\t\t\t\t\t\t<TableRow>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.name}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.email}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.phone}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.role}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.hourlyRate}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.actions}</TableHead>\n\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t</TableHeader>\n\t\t\t\t\t\t\t<TableBody>\n\t\t\t\t\t\t\t\t{users.map((user) => (\n\t\t\t\t\t\t\t\t\t<TableRow key={user.id}>\n\t\t\t\t\t\t\t\t\t\t<TableCell className=\"font-medium\">{user.name}</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell>{user.email}</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell>{user.phone || \"—\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<Badge variant={user.role === UserRole.Manager ? \"default\" : \"secondary\"}>\n\t\t\t\t\t\t\t\t\t\t\t\t{user.role === UserRole.Manager ? t.manager : t.employee}\n\t\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t{user.hourly_rate ? `$${user.hourly_rate.toFixed(2)}/hr` : \"—\"}\n\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => openEditDialog(user)}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{t.edit}\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>","numLines":120,"startLine":2000,"totalLines":2469}}}
{"type":"assistant","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_vrtx_014Fa4CCXBzvjNRdAKNXKYwE","type":"message","role":"assistant","content":[{"type":"text","text":"Now I need to add a function to copy the employee link and add a button in the actions column. Let me add the copy function first:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1913,"cache_read_input_tokens":51998,"cache_creation":{"ephemeral_5m_input_tokens":1913,"ephemeral_1h_input_tokens":0},"output_tokens":1},"context_management":null},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"04512481-c4e8-4a5c-9f7f-a688b73a51a9"}
{"type":"assistant","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_vrtx_014Fa4CCXBzvjNRdAKNXKYwE","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_vrtx_01F6m4ijxzATq2waKSkXcuVi","name":"Edit","input":{"file_path":"/home/user/vite-template/src/routes/index.tsx","old_string":"\tconst openEditDialog = (user: UserModel) => {\n\t\tsetEditingEmployee(user);\n\t\tsetEmployeeName(user.name);\n\t\tsetEmployeeEmail(user.email);\n\t\tsetEmployeePhone(user.phone || \"\");\n\t\tsetEmployeeRole(user.role);\n\t\tsetEmployeeHourlyRate(user.hourly_rate ? user.hourly_rate.toString() : \"\");\n\t};","new_string":"\tconst openEditDialog = (user: UserModel) => {\n\t\tsetEditingEmployee(user);\n\t\tsetEmployeeName(user.name);\n\t\tsetEmployeeEmail(user.email);\n\t\tsetEmployeePhone(user.phone || \"\");\n\t\tsetEmployeeRole(user.role);\n\t\tsetEmployeeHourlyRate(user.hourly_rate ? user.hourly_rate.toString() : \"\");\n\t};\n\n\tconst copyEmployeeLink = (userId: string) => {\n\t\tconst baseUrl = window.location.origin + window.location.pathname;\n\t\tconst employeeUrl = `${baseUrl}?employee=${userId}`;\n\n\t\tnavigator.clipboard.writeText(employeeUrl).then(() => {\n\t\t\talert(t.employeeLinkCopied);\n\t\t});\n\t};"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1913,"cache_read_input_tokens":51998,"cache_creation":{"ephemeral_5m_input_tokens":1913,"ephemeral_1h_input_tokens":0},"output_tokens":1},"context_management":null},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"27031ec1-d0f6-4c0c-a0bd-f2c99b6555d4"}
{"type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_vrtx_01F6m4ijxzATq2waKSkXcuVi","type":"tool_result","content":"The file /home/user/vite-template/src/routes/index.tsx has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n  2056→\t\tsetDeleteConfirm(null);\n  2057→\t\tonUsersChange();\n  2058→\t};\n  2059→\n  2060→\tconst openEditDialog = (user: UserModel) => {\n  2061→\t\tsetEditingEmployee(user);\n  2062→\t\tsetEmployeeName(user.name);\n  2063→\t\tsetEmployeeEmail(user.email);\n  2064→\t\tsetEmployeePhone(user.phone || \"\");\n  2065→\t\tsetEmployeeRole(user.role);\n  2066→\t\tsetEmployeeHourlyRate(user.hourly_rate ? user.hourly_rate.toString() : \"\");\n  2067→\t};\n  2068→\n  2069→\tconst copyEmployeeLink = (userId: string) => {\n  2070→\t\tconst baseUrl = window.location.origin + window.location.pathname;\n  2071→\t\tconst employeeUrl = `${baseUrl}?employee=${userId}`;\n  2072→\n  2073→\t\tnavigator.clipboard.writeText(employeeUrl).then(() => {\n  2074→\t\t\talert(t.employeeLinkCopied);\n  2075→\t\t});\n  2076→\t};\n  2077→\n  2078→\treturn (\n  2079→\t\t<div className=\"space-y-4\">\n  2080→\t\t\t<Card>"}]},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"cdf81c32-9ab6-4ed9-b064-ef1cf5d86d08","tool_use_result":{"filePath":"/home/user/vite-template/src/routes/index.tsx","oldString":"\tconst openEditDialog = (user: UserModel) => {\n\t\tsetEditingEmployee(user);\n\t\tsetEmployeeName(user.name);\n\t\tsetEmployeeEmail(user.email);\n\t\tsetEmployeePhone(user.phone || \"\");\n\t\tsetEmployeeRole(user.role);\n\t\tsetEmployeeHourlyRate(user.hourly_rate ? user.hourly_rate.toString() : \"\");\n\t};","newString":"\tconst openEditDialog = (user: UserModel) => {\n\t\tsetEditingEmployee(user);\n\t\tsetEmployeeName(user.name);\n\t\tsetEmployeeEmail(user.email);\n\t\tsetEmployeePhone(user.phone || \"\");\n\t\tsetEmployeeRole(user.role);\n\t\tsetEmployeeHourlyRate(user.hourly_rate ? user.hourly_rate.toString() : \"\");\n\t};\n\n\tconst copyEmployeeLink = (userId: string) => {\n\t\tconst baseUrl = window.location.origin + window.location.pathname;\n\t\tconst employeeUrl = `${baseUrl}?employee=${userId}`;\n\n\t\tnavigator.clipboard.writeText(employeeUrl).then(() => {\n\t\t\talert(t.employeeLinkCopied);\n\t\t});\n\t};","originalFile":"import { createFileRoute } from \"@tanstack/react-router\";\nimport { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from \"@/components/ui/dialog\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Clock, Users, CalendarDays, Timer, Languages, Coffee, UserPlus, FileText, AlertCircle, Plus, Trash2, Heart } from \"lucide-react\";\nimport { UserORM, type UserModel, UserRole } from \"@/sdk/database/orm/orm_user\";\nimport { TimeCardEntryORM, type TimeCardEntryModel } from \"@/sdk/database/orm/orm_time_card_entry\";\nimport { SickDayORM, type SickDayModel } from \"@/sdk/database/orm/orm_sick_day\";\nimport { normalizeTimeCardEntryForSave, normalizeTimeCardEntriesFromORM, isActiveShift, isOnLunchBreak } from \"@/lib/orm-data-helpers\";\n\nexport const Route = createFileRoute(\"/\")({\n\tcomponent: App,\n});\n\ntype Language = 'en' | 'es';\n\nconst translations = {\n\ten: {\n\t\tappTitle: \"Employee Time Tracking\",\n\t\tselectAccount: \"Select your account to continue\",\n\t\tselectUser: \"Select User\",\n\t\tchooseAccount: \"Choose your account\",\n\t\tmanager: \"Manager\",\n\t\temployee: \"Employee\",\n\t\tswitchUser: \"Switch User\",\n\t\ttimeTrackingSystem: \"Time Tracking System\",\n\t\twelcome: \"Welcome\",\n\t\tclockInOut: \"Clock In/Out\",\n\t\tcurrentlyClocked: \"Currently Clocked In\",\n\t\tsince: \"Since\",\n\t\telapsedTime: \"Elapsed Time\",\n\t\tclockOut: \"Clock Out\",\n\t\tnotClocked: \"Not currently clocked in\",\n\t\tclockIn: \"Clock In\",\n\t\ttimeCardHistory: \"Time Card History\",\n\t\trecentRecords: \"Your recent clock in/out records\",\n\t\tnoTimeCards: \"No time cards yet\",\n\t\tclockInTime: \"Clock In\",\n\t\tclockOutTime: \"Clock Out\",\n\t\thours: \"Hours\",\n\t\tstatus: \"Status\",\n\t\tcompleted: \"Completed\",\n\t\tactive: \"Active\",\n\t\ttotalEmployees: \"Total Employees\",\n\t\thoursToday: \"Hours Today\",\n\t\thoursThisWeek: \"Hours This Week\",\n\t\tallEmployeeTimeCards: \"All Employee Time Cards\",\n\t\tviewManageRecords: \"View and manage all employee time records\",\n\t\tfilterByEmployee: \"Filter by Employee\",\n\t\tallEmployees: \"All Employees\",\n\t\tfilterByDate: \"Filter by Date\",\n\t\tclearFilters: \"Clear Filters\",\n\t\tnoTimeCardsFound: \"No time cards found\",\n\t\temployeeName: \"Employee\",\n\t\tactions: \"Actions\",\n\t\tedit: \"Edit\",\n\t\teditTimeCard: \"Edit Time Card\",\n\t\tcancel: \"Cancel\",\n\t\tsaveChanges: \"Save Changes\",\n\t\tlocation: \"Location\",\n\t\twhereWorked: \"Where did you work?\",\n\t\tworkDescription: \"Work Description\",\n\t\twhatDid: \"What did you do today?\",\n\t\tlocationPlaceholder: \"e.g., Office, Remote, Client Site\",\n\t\tdescriptionPlaceholder: \"Describe your work activities...\",\n\t\tstartLunch: \"Start Lunch Break\",\n\t\tendLunch: \"End Lunch Break\",\n\t\tonLunchBreak: \"On Lunch Break\",\n\t\tlunchBreak: \"Lunch Break\",\n\t\tlunchDuration: \"Lunch\",\n\t\tlunchStartTime: \"Lunch Start\",\n\t\tlunchEndTime: \"Lunch End\",\n\t\ttimeCards: \"Time Cards\",\n\t\treports: \"Reports\",\n\t\temployees: \"Employees\",\n\t\taddEmployee: \"Add Employee\",\n\t\teditEmployee: \"Edit Employee\",\n\t\tdeleteEmployee: \"Delete Employee\",\n\t\tname: \"Name\",\n\t\temail: \"Email\",\n\t\tphone: \"Phone\",\n\t\trole: \"Role\",\n\t\tdelete: \"Delete\",\n\t\tweeklyReport: \"Weekly Report\",\n\t\tselectWeek: \"Select Week\",\n\t\tregularHours: \"Regular\",\n\t\tovertimeHours: \"Overtime\",\n\t\ttotalHours: \"Total\",\n\t\tnoReportData: \"No data for selected week\",\n\t\taddTimeCard: \"Add Time Card\",\n\t\tmanualEntry: \"Manual Entry\",\n\t\taddManualEntry: \"Add Manual Time Card\",\n\t\tconfirmDelete: \"Are you sure you want to delete this employee?\",\n\t\tovertimeAlert: \"Overtime Alert\",\n\t\tprintReport: \"Print Report\",\n\t\texportCSV: \"Export to CSV\",\n\t\tdetailedReport: \"Detailed Time Card Report\",\n\t\tdate: \"Date\",\n\t\tday: \"Day\",\n\t\tdeleteTimeCard: \"Delete Time Card\",\n\t\tconfirmDeleteTimeCard: \"Are you sure you want to delete this time card? This action cannot be undone.\",\n\t\tsickDays: \"Sick Days\",\n\t\taddSickDay: \"Add Sick Day\",\n\t\tsickDayDate: \"Sick Day Date\",\n\t\tsickDayHours: \"Hours\",\n\t\tsickDayNotes: \"Notes/Reason\",\n\t\tsickDayNotesPlaceholder: \"e.g., Doctor's appointment, flu, etc.\",\n\t\tmySickDays: \"My Sick Days\",\n\t\tnoSickDays: \"No sick days recorded\",\n\t\ttotalSickDays: \"Total Sick Days\",\n\t\tdeleteSickDay: \"Delete Sick Day\",\n\t\tconfirmDeleteSickDay: \"Are you sure you want to delete this sick day? This action cannot be undone.\",\n\t\tsickDayHistory: \"Sick Day History\",\n\t\thourlyRate: \"Hourly Rate\",\n\t\tpay: \"Pay\",\n\t\ttotalPay: \"Total Pay\",\n\t\tregularPay: \"Regular Pay\",\n\t\tovertimePay: \"Overtime Pay\",\n\t\tcopyEmployeeLink: \"Copy Employee Link\",\n\t\temployeeLinkCopied: \"Employee link copied!\",\n\t\tmyTimeTracking: \"My Time Tracking\",\n\t\tmyHours: \"My Hours\",\n\t},\n\tes: {\n\t\tappTitle: \"Registro de Tiempo de Empleados\",\n\t\tselectAccount: \"Selecciona tu cuenta para continuar\",\n\t\tselectUser: \"Seleccionar Usuario\",\n\t\tchooseAccount: \"Elige tu cuenta\",\n\t\tmanager: \"Gerente\",\n\t\temployee: \"Empleado\",\n\t\tswitchUser: \"Cambiar Usuario\",\n\t\ttimeTrackingSystem: \"Sistema de Registro de Tiempo\",\n\t\twelcome: \"Bienvenido\",\n\t\tclockInOut: \"Entrada/Salida\",\n\t\tcurrentlyClocked: \"Actualmente Registrado\",\n\t\tsince: \"Desde\",\n\t\telapsedTime: \"Tiempo Transcurrido\",\n\t\tclockOut: \"Registrar Salida\",\n\t\tnotClocked: \"No está registrado actualmente\",\n\t\tclockIn: \"Registrar Entrada\",\n\t\ttimeCardHistory: \"Historial de Tarjetas de Tiempo\",\n\t\trecentRecords: \"Tus registros recientes de entrada/salida\",\n\t\tnoTimeCards: \"No hay tarjetas de tiempo todavía\",\n\t\tclockInTime: \"Entrada\",\n\t\tclockOutTime: \"Salida\",\n\t\thours: \"Horas\",\n\t\tstatus: \"Estado\",\n\t\tcompleted: \"Completado\",\n\t\tactive: \"Activo\",\n\t\ttotalEmployees: \"Total de Empleados\",\n\t\thoursToday: \"Horas Hoy\",\n\t\thoursThisWeek: \"Horas Esta Semana\",\n\t\tallEmployeeTimeCards: \"Todas las Tarjetas de Tiempo\",\n\t\tviewManageRecords: \"Ver y gestionar todos los registros de empleados\",\n\t\tfilterByEmployee: \"Filtrar por Empleado\",\n\t\tallEmployees: \"Todos los Empleados\",\n\t\tfilterByDate: \"Filtrar por Fecha\",\n\t\tclearFilters: \"Limpiar Filtros\",\n\t\tnoTimeCardsFound: \"No se encontraron tarjetas de tiempo\",\n\t\temployeeName: \"Empleado\",\n\t\tactions: \"Acciones\",\n\t\tedit: \"Editar\",\n\t\teditTimeCard: \"Editar Tarjeta de Tiempo\",\n\t\tcancel: \"Cancelar\",\n\t\tsaveChanges: \"Guardar Cambios\",\n\t\tlocation: \"Ubicación\",\n\t\twhereWorked: \"¿Dónde trabajaste?\",\n\t\tworkDescription: \"Descripción del Trabajo\",\n\t\twhatDid: \"¿Qué hiciste hoy?\",\n\t\tlocationPlaceholder: \"ej., Oficina, Remoto, Sitio del Cliente\",\n\t\tdescriptionPlaceholder: \"Describe tus actividades laborales...\",\n\t\tstartLunch: \"Iniciar Almuerzo\",\n\t\tendLunch: \"Terminar Almuerzo\",\n\t\tonLunchBreak: \"En Almuerzo\",\n\t\tlunchBreak: \"Almuerzo\",\n\t\tlunchDuration: \"Almuerzo\",\n\t\tlunchStartTime: \"Inicio Almuerzo\",\n\t\tlunchEndTime: \"Fin Almuerzo\",\n\t\ttimeCards: \"Tarjetas de Tiempo\",\n\t\treports: \"Informes\",\n\t\temployees: \"Empleados\",\n\t\taddEmployee: \"Agregar Empleado\",\n\t\teditEmployee: \"Editar Empleado\",\n\t\tdeleteEmployee: \"Eliminar Empleado\",\n\t\tname: \"Nombre\",\n\t\temail: \"Correo\",\n\t\tphone: \"Teléfono\",\n\t\trole: \"Rol\",\n\t\tdelete: \"Eliminar\",\n\t\tweeklyReport: \"Informe Semanal\",\n\t\tselectWeek: \"Seleccionar Semana\",\n\t\tregularHours: \"Regular\",\n\t\tovertimeHours: \"Tiempo Extra\",\n\t\ttotalHours: \"Total\",\n\t\tnoReportData: \"No hay datos para la semana seleccionada\",\n\t\taddTimeCard: \"Agregar Tarjeta\",\n\t\tmanualEntry: \"Entrada Manual\",\n\t\taddManualEntry: \"Agregar Tarjeta Manual\",\n\t\tconfirmDelete: \"¿Está seguro de eliminar este empleado?\",\n\t\tovertimeAlert: \"Alerta de Tiempo Extra\",\n\t\tprintReport: \"Imprimir Informe\",\n\t\texportCSV: \"Exportar a CSV\",\n\t\tdetailedReport: \"Informe Detallado de Tarjetas de Tiempo\",\n\t\tdate: \"Fecha\",\n\t\tday: \"Día\",\n\t\tdeleteTimeCard: \"Eliminar Tarjeta de Tiempo\",\n\t\tconfirmDeleteTimeCard: \"¿Está seguro de eliminar esta tarjeta de tiempo? Esta acción no se puede deshacer.\",\n\t\tsickDays: \"Días de Enfermedad\",\n\t\taddSickDay: \"Agregar Día de Enfermedad\",\n\t\tsickDayDate: \"Fecha de Enfermedad\",\n\t\tsickDayHours: \"Horas\",\n\t\tsickDayNotes: \"Notas/Razón\",\n\t\tsickDayNotesPlaceholder: \"ej., Cita médica, gripe, etc.\",\n\t\tmySickDays: \"Mis Días de Enfermedad\",\n\t\tnoSickDays: \"No hay días de enfermedad registrados\",\n\t\ttotalSickDays: \"Total Días de Enfermedad\",\n\t\tdeleteSickDay: \"Eliminar Día de Enfermedad\",\n\t\tconfirmDeleteSickDay: \"¿Está seguro de eliminar este día de enfermedad? Esta acción no se puede deshacer.\",\n\t\tsickDayHistory: \"Historial de Días de Enfermedad\",\n\t\thourlyRate: \"Tarifa por Hora\",\n\t\tpay: \"Pago\",\n\t\ttotalPay: \"Pago Total\",\n\t\tregularPay: \"Pago Regular\",\n\t\tovertimePay: \"Pago Tiempo Extra\",\n\t\tcopyEmployeeLink: \"Copiar Enlace de Empleado\",\n\t\temployeeLinkCopied: \"¡Enlace de empleado copiado!\",\n\t\tmyTimeTracking: \"Mi Registro de Tiempo\",\n\t\tmyHours: \"Mis Horas\",\n\t}\n};\n\nfunction App() {\n\tconst [currentUser, setCurrentUser] = useState<UserModel | null>(null);\n\tconst [users, setUsers] = useState<UserModel[]>([]);\n\tconst [showUserSelect, setShowUserSelect] = useState(true);\n\tconst [language, setLanguage] = useState<Language>('en');\n\tconst [employeeOnlyMode, setEmployeeOnlyMode] = useState(false);\n\n\tconst t = translations[language];\n\n\tuseEffect(() => {\n\t\tloadUsers();\n\t}, []);\n\n\t// Check for employee URL parameter and auto-login\n\tuseEffect(() => {\n\t\tif (users.length > 0 && !currentUser) {\n\t\t\tconst urlParams = new URLSearchParams(window.location.search);\n\t\t\tconst employeeId = urlParams.get('employee');\n\n\t\t\tif (employeeId) {\n\t\t\t\tconst user = users.find(u => u.id === employeeId && u.role === UserRole.Employee);\n\t\t\t\tif (user) {\n\t\t\t\t\tsetCurrentUser(user);\n\t\t\t\t\tsetShowUserSelect(false);\n\t\t\t\t\tsetEmployeeOnlyMode(true);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}, [users, currentUser]);\n\n\tconst loadUsers = async () => {\n\t\tconst userORM = UserORM.getInstance();\n\t\tconst allUsers = await userORM.getAllUser();\n\n\t\t// If no users exist, create demo users\n\t\tif (allUsers.length === 0) {\n\t\t\tconst demoUsers = await userORM.insertUser([\n\t\t\t\t{\n\t\t\t\t\tname: \"John Smith\",\n\t\t\t\t\temail: \"john@example.com\",\n\t\t\t\t\trole: UserRole.Employee,\n\t\t\t\t} as UserModel,\n\t\t\t\t{\n\t\t\t\t\tname: \"Sarah Johnson\",\n\t\t\t\t\temail: \"sarah@example.com\",\n\t\t\t\t\trole: UserRole.Employee,\n\t\t\t\t} as UserModel,\n\t\t\t\t{\n\t\t\t\t\tname: \"Mike Manager\",\n\t\t\t\t\temail: \"mike@example.com\",\n\t\t\t\t\trole: UserRole.Manager,\n\t\t\t\t} as UserModel,\n\t\t\t]);\n\t\t\tsetUsers(demoUsers);\n\t\t} else {\n\t\t\tsetUsers(allUsers);\n\t\t}\n\t};\n\n\tconst handleUserSelect = (userId: string) => {\n\t\tconst user = users.find(u => u.id === userId);\n\t\tif (user) {\n\t\t\tsetCurrentUser(user);\n\t\t\tsetShowUserSelect(false);\n\t\t}\n\t};\n\n\tconst handleLogout = () => {\n\t\tsetCurrentUser(null);\n\t\tsetShowUserSelect(true);\n\t};\n\n\tconst toggleLanguage = () => {\n\t\tsetLanguage(prev => prev === 'en' ? 'es' : 'en');\n\t};\n\n\tif (showUserSelect || !currentUser) {\n\t\treturn (\n\t\t\t<div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800 flex items-center justify-center p-4\">\n\t\t\t\t<div className=\"absolute top-4 right-4\">\n\t\t\t\t\t<Button onClick={toggleLanguage} variant=\"outline\" size=\"sm\">\n\t\t\t\t\t\t<Languages className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t\t{language === 'en' ? 'Español' : 'English'}\n\t\t\t\t\t</Button>\n\t\t\t\t</div>\n\t\t\t\t<Card className=\"w-full max-w-md\">\n\t\t\t\t\t<CardHeader>\n\t\t\t\t\t\t<CardTitle className=\"text-2xl\">{t.appTitle}</CardTitle>\n\t\t\t\t\t\t<CardDescription>{t.selectAccount}</CardDescription>\n\t\t\t\t\t</CardHeader>\n\t\t\t\t\t<CardContent className=\"space-y-4\">\n\t\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t\t<Label>{t.selectUser}</Label>\n\t\t\t\t\t\t\t<Select onValueChange={handleUserSelect}>\n\t\t\t\t\t\t\t\t<SelectTrigger className=\"w-full\">\n\t\t\t\t\t\t\t\t\t<SelectValue placeholder={t.chooseAccount} />\n\t\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t\t{users.map((user) => (\n\t\t\t\t\t\t\t\t\t\t<SelectItem key={user.id} value={user.id}>\n\t\t\t\t\t\t\t\t\t\t\t{user.name} - {user.role === UserRole.Manager ? t.manager : t.employee}\n\t\t\t\t\t\t\t\t\t\t</SelectItem>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t\t</Select>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</CardContent>\n\t\t\t\t</Card>\n\t\t\t</div>\n\t\t);\n\t}\n\n\treturn (\n\t\t<div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800\">\n\t\t\t<div className=\"container mx-auto p-6 space-y-6\">\n\t\t\t\t<div className=\"flex justify-between items-center\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<h1 className=\"text-3xl font-bold\">\n\t\t\t\t\t\t\t{employeeOnlyMode ? t.myTimeTracking : t.timeTrackingSystem}\n\t\t\t\t\t\t</h1>\n\t\t\t\t\t\t<p className=\"text-muted-foreground\">\n\t\t\t\t\t\t\t{t.welcome}, {currentUser.name} ({currentUser.role === UserRole.Manager ? t.manager : t.employee})\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"flex gap-2\">\n\t\t\t\t\t\t<Button onClick={toggleLanguage} variant=\"outline\" size=\"sm\">\n\t\t\t\t\t\t\t<Languages className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t\t\t{language === 'en' ? 'Español' : 'English'}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t{!employeeOnlyMode && (\n\t\t\t\t\t\t\t<Button onClick={handleLogout} variant=\"outline\">\n\t\t\t\t\t\t\t\t{t.switchUser}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t{currentUser.role === UserRole.Employee ? (\n\t\t\t\t\t<EmployeeView user={currentUser} language={language} />\n\t\t\t\t) : (\n\t\t\t\t\t<ManagerView user={currentUser} users={users} language={language} onUsersChange={loadUsers} />\n\t\t\t\t)}\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n\nfunction SickDayCard({ user, language }: { user: UserModel; language: Language }) {\n\tconst [sickDays, setSickDays] = useState<SickDayModel[]>([]);\n\tconst [showAddDialog, setShowAddDialog] = useState(false);\n\tconst [sickDate, setSickDate] = useState(\"\");\n\tconst [sickHours, setSickHours] = useState(\"8\");\n\tconst [sickNotes, setSickNotes] = useState(\"\");\n\n\tconst t = translations[language];\n\n\tuseEffect(() => {\n\t\tloadSickDays();\n\t}, [user.id]);\n\n\tconst loadSickDays = async () => {\n\t\tconst sickDayORM = SickDayORM.getInstance();\n\t\tconst userSickDays = await sickDayORM.getSickDayByUserId(user.id);\n\n\t\t// Sort by date (newest first)\n\t\tconst sorted = userSickDays.sort((a, b) =>\n\t\t\tnew Date(b.sick_date).getTime() - new Date(a.sick_date).getTime()\n\t\t);\n\n\t\tsetSickDays(sorted);\n\t};\n\n\tconst handleAddSickDay = async () => {\n\t\tif (!sickDate || !sickHours) {\n\t\t\talert(\"Please fill in date and hours\");\n\t\t\treturn;\n\t\t}\n\n\t\tconst sickDayORM = SickDayORM.getInstance();\n\t\tawait sickDayORM.insertSickDay([{\n\t\t\tuser_id: user.id,\n\t\t\tsick_date: sickDate,\n\t\t\thours: parseFloat(sickHours),\n\t\t\tnotes: sickNotes || null,\n\t\t} as SickDayModel]);\n\n\t\t// Reset form\n\t\tsetSickDate(\"\");\n\t\tsetSickHours(\"8\");\n\t\tsetSickNotes(\"\");\n\t\tsetShowAddDialog(false);\n\n\t\tawait loadSickDays();\n\t};\n\n\tconst handleDeleteSickDay = async (sickDay: SickDayModel) => {\n\t\tif (!window.confirm(t.confirmDeleteSickDay)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst sickDayORM = SickDayORM.getInstance();\n\t\tawait sickDayORM.deleteSickDayById(sickDay.id);\n\t\tawait loadSickDays();\n\t};\n\n\tconst formatDate = (dateStr: string) => {\n\t\tconst date = new Date(dateStr);\n\t\treturn date.toLocaleDateString(language === 'es' ? 'es-ES' : 'en-US', {\n\t\t\tyear: 'numeric',\n\t\t\tmonth: 'long',\n\t\t\tday: 'numeric'\n\t\t});\n\t};\n\n\tconst totalSickHours = sickDays.reduce((sum, sd) => sum + sd.hours, 0);\n\n\treturn (\n\t\t<>\n\t\t\t<Card>\n\t\t\t\t<CardHeader>\n\t\t\t\t\t<div className=\"flex justify-between items-center\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<CardTitle className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t<Heart className=\"w-5 h-5 text-red-500\" />\n\t\t\t\t\t\t\t\t{t.mySickDays}\n\t\t\t\t\t\t\t</CardTitle>\n\t\t\t\t\t\t\t<CardDescription>\n\t\t\t\t\t\t\t\t{t.totalSickDays}: {totalSickHours.toFixed(1)} {language === 'es' ? 'hrs' : 'hrs'}\n\t\t\t\t\t\t\t</CardDescription>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<Button onClick={() => setShowAddDialog(true)} size=\"sm\">\n\t\t\t\t\t\t\t<Plus className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t\t\t{t.addSickDay}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t</CardHeader>\n\t\t\t\t<CardContent>\n\t\t\t\t\t{sickDays.length === 0 ? (\n\t\t\t\t\t\t<p className=\"text-center text-muted-foreground py-8\">{t.noSickDays}</p>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<div className=\"overflow-x-auto\">\n\t\t\t\t\t\t\t<Table>\n\t\t\t\t\t\t\t\t<TableHeader>\n\t\t\t\t\t\t\t\t\t<TableRow>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.sickDayDate}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.sickDayHours}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.sickDayNotes}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.actions}</TableHead>\n\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t</TableHeader>\n\t\t\t\t\t\t\t\t<TableBody>\n\t\t\t\t\t\t\t\t\t{sickDays.map((sd) => (\n\t\t\t\t\t\t\t\t\t\t<TableRow key={sd.id}>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"font-medium whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t{formatDate(sd.sick_date)}\n\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell>{sd.hours} hrs</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"max-w-xs truncate\">{sd.notes || \"—\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => handleDeleteSickDay(sd)}\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"text-red-600 hover:text-red-700 hover:bg-red-50\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Trash2 className=\"w-4 h-4\" />\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</TableBody>\n\t\t\t\t\t\t\t</Table>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</CardContent>\n\t\t\t</Card>\n\n\t\t\t<Dialog open={showAddDialog} onOpenChange={setShowAddDialog}>\n\t\t\t\t<DialogContent>\n\t\t\t\t\t<DialogHeader>\n\t\t\t\t\t\t<DialogTitle>{t.addSickDay}</DialogTitle>\n\t\t\t\t\t</DialogHeader>\n\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.sickDayDate}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"date\"\n\t\t\t\t\t\t\t\tvalue={sickDate}\n\t\t\t\t\t\t\t\tonChange={(e) => setSickDate(e.target.value)}\n\t\t\t\t\t\t\t\tmax={new Date().toISOString().split('T')[0]}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.sickDayHours}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\tmin=\"0.5\"\n\t\t\t\t\t\t\t\tmax=\"24\"\n\t\t\t\t\t\t\t\tstep=\"0.5\"\n\t\t\t\t\t\t\t\tvalue={sickHours}\n\t\t\t\t\t\t\t\tonChange={(e) => setSickHours(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.sickDayNotes}</Label>\n\t\t\t\t\t\t\t<Textarea\n\t\t\t\t\t\t\t\tvalue={sickNotes}\n\t\t\t\t\t\t\t\tonChange={(e) => setSickNotes(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder={t.sickDayNotesPlaceholder}\n\t\t\t\t\t\t\t\trows={3}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<DialogFooter>\n\t\t\t\t\t\t<Button variant=\"outline\" onClick={() => setShowAddDialog(false)}>\n\t\t\t\t\t\t\t{t.cancel}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button onClick={handleAddSickDay} disabled={!sickDate || !sickHours}>\n\t\t\t\t\t\t\t{t.saveChanges}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</DialogFooter>\n\t\t\t\t</DialogContent>\n\t\t\t</Dialog>\n\t\t</>\n\t);\n}\n\nfunction EmployeeView({ user, language }: { user: UserModel; language: Language }) {\n\tconst [timeCards, setTimeCards] = useState<TimeCardEntryModel[]>([]);\n\tconst [activeShift, setActiveShift] = useState<TimeCardEntryModel | null>(null);\n\tconst [elapsedTime, setElapsedTime] = useState(0);\n\tconst [location, setLocation] = useState(\"\");\n\tconst [workDescription, setWorkDescription] = useState(\"\");\n\tconst [isOnLunch, setIsOnLunch] = useState(false);\n\tconst [isLoading, setIsLoading] = useState(false);\n\n\tconst t = translations[language];\n\n\tuseEffect(() => {\n\t\tloadTimeCards();\n\t}, [user.id]);\n\n\tuseEffect(() => {\n\t\tlet interval: NodeJS.Timeout;\n\t\tif (activeShift && !isOnLunch) {\n\t\t\tinterval = setInterval(() => {\n\t\t\t\tconst clockInTime = parseInt(activeShift.clock_in_timestamp) * 1000;\n\t\t\t\tconst elapsed = Date.now() - clockInTime;\n\t\t\t\tsetElapsedTime(elapsed);\n\t\t\t}, 1000);\n\t\t}\n\t\treturn () => clearInterval(interval);\n\t}, [activeShift, isOnLunch]);\n\n\tconst loadTimeCards = async () => {\n\t\tconsole.log(\"Loading time cards for user:\", user.id);\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tconst userTimeCards = await timeCardORM.getTimeCardEntryByUserId(user.id);\n\n\t\tconsole.log(\"Found\", userTimeCards.length, \"time cards\");\n\n\t\t// Normalize data retrieved from ORM to fix null-handling bugs\n\t\tconst normalized = normalizeTimeCardEntriesFromORM(userTimeCards);\n\n\t\t// Sort by clock in time (newest first)\n\t\tconst sorted = normalized.sort((a, b) =>\n\t\t\tparseInt(b.clock_in_timestamp) - parseInt(a.clock_in_timestamp)\n\t\t);\n\n\t\tsetTimeCards(sorted);\n\n\t\t// Find active shift using helper function\n\t\tconst active = sorted.find(tc => isActiveShift(tc));\n\t\tconsole.log(\"Active shift found:\", active ? `Yes (ID: ${active.id})` : \"No\");\n\n\t\tsetActiveShift(active || null);\n\t\tif (active) {\n\t\t\tsetLocation(active.location || \"\");\n\t\t\tsetWorkDescription(active.work_description || \"\");\n\t\t\t// Check if on lunch break using helper function\n\t\t\tconst onLunch = isOnLunchBreak(active);\n\t\t\tsetIsOnLunch(onLunch);\n\t\t\tconsole.log(\"On lunch:\", onLunch);\n\t\t} else {\n\t\t\tsetIsOnLunch(false);\n\t\t}\n\t};\n\n\tconst handleClockIn = async () => {\n\t\tconsole.log(\"=== CLOCK IN STARTED ===\");\n\t\tconsole.log(\"User ID:\", user.id);\n\t\tconsole.log(\"Location:\", location);\n\t\tconsole.log(\"Work Description:\", workDescription);\n\n\t\tsetIsLoading(true);\n\t\ttry {\n\t\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\t\tconst now = Math.floor(Date.now() / 1000).toString();\n\t\t\tconsole.log(\"Current timestamp:\", now);\n\n\t\t\tconst newEntry = {\n\t\t\t\tuser_id: user.id,\n\t\t\t\tclock_in_timestamp: now,\n\t\t\t\tlocation: location || undefined,\n\t\t\t\twork_description: workDescription || undefined,\n\t\t\t} as TimeCardEntryModel;\n\n\t\t\t// Normalize the entry to work around ORM null-handling bugs\n\t\t\tconst normalizedEntry = normalizeTimeCardEntryForSave(newEntry);\n\n\t\t\tconsole.log(\"Inserting time card entry:\", normalizedEntry);\n\n\t\t\tconst result = await timeCardORM.insertTimeCardEntry([normalizedEntry as TimeCardEntryModel]);\n\t\t\tconsole.log(\"Insert result:\", result);\n\n\t\t\t// Normalize the returned data\n\t\t\tconst normalizedResult = normalizeTimeCardEntriesFromORM(result);\n\t\t\tconsole.log(\"Normalized result:\", normalizedResult);\n\n\t\t\tconsole.log(\"Time card entry created successfully!\");\n\n\t\t\t// Clear form\n\t\t\tsetLocation(\"\");\n\t\t\tsetWorkDescription(\"\");\n\n\t\t\t// Reload time cards\n\t\t\tconsole.log(\"Reloading time cards...\");\n\t\t\tawait loadTimeCards();\n\n\t\t\tconsole.log(\"=== CLOCK IN COMPLETED ===\");\n\n\t\t\t// Show success feedback\n\t\t\tconst reloadedShifts = normalizeTimeCardEntriesFromORM(\n\t\t\t\tawait timeCardORM.getTimeCardEntryByUserId(user.id)\n\t\t\t);\n\t\t\tif (reloadedShifts.some(tc => isActiveShift(tc))) {\n\t\t\t\talert(\"✅ Successfully clocked in! You can now see the CLOCK OUT button.\");\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.error(\"=== CLOCK IN FAILED ===\");\n\t\t\tconsole.error(\"Error details:\", error);\n\t\t\talert(`Error clocking in: ${error instanceof Error ? error.message : 'Unknown error'}. Check console for details.`);\n\t\t} finally {\n\t\t\tsetIsLoading(false);\n\t\t}\n\t};\n\n\tconst handleClockOut = async () => {\n\t\tconsole.log(\"Clock Out clicked - activeShift:\", activeShift);\n\n\t\tif (!activeShift) {\n\t\t\tconsole.error(\"No active shift to clock out!\");\n\t\t\talert(\"Error: No active shift found. Please try clocking in first.\");\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\t\tconst now = Math.floor(Date.now() / 1000).toString();\n\n\t\t\tconst clockInTime = parseInt(activeShift.clock_in_timestamp);\n\t\t\tconst clockOutTime = parseInt(now);\n\t\t\tlet totalHours = (clockOutTime - clockInTime) / 3600;\n\n\t\t\t// Deduct lunch time if lunch was taken\n\t\t\tif (activeShift.lunch_duration_minutes && activeShift.lunch_duration_minutes > 0) {\n\t\t\t\ttotalHours -= activeShift.lunch_duration_minutes / 60;\n\t\t\t}\n\n\t\t\tconsole.log(\"Clocking out - Total hours:\", totalHours);\n\n\t\t\tconst updateData = {\n\t\t\t\t...activeShift,\n\t\t\t\tclock_out_timestamp: now,\n\t\t\t\ttotal_hours: totalHours,\n\t\t\t\tlocation: location || activeShift.location || undefined,\n\t\t\t\twork_description: workDescription || activeShift.work_description || undefined,\n\t\t\t};\n\n\t\t\t// Normalize before saving\n\t\t\tconst normalizedUpdate = normalizeTimeCardEntryForSave(updateData as TimeCardEntryModel);\n\n\t\t\tawait timeCardORM.setTimeCardEntryById(activeShift.id, normalizedUpdate as TimeCardEntryModel);\n\n\t\t\tconsole.log(\"Clock out successful!\");\n\t\t\tsetLocation(\"\");\n\t\t\tsetWorkDescription(\"\");\n\t\t\tawait loadTimeCards();\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Error clocking out:\", error);\n\t\t\talert(\"Error clocking out. Please try again.\");\n\t\t}\n\t};\n\n\tconst handleStartLunch = async () => {\n\t\tif (!activeShift) return;\n\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tconst now = Math.floor(Date.now() / 1000).toString();\n\n\t\tconst updateData = {\n\t\t\t...activeShift,\n\t\t\tlunch_start_timestamp: now,\n\t\t\tlocation: location || activeShift.location || undefined,\n\t\t\twork_description: workDescription || activeShift.work_description || undefined,\n\t\t};\n\n\t\tconst normalizedUpdate = normalizeTimeCardEntryForSave(updateData as TimeCardEntryModel);\n\t\tawait timeCardORM.setTimeCardEntryById(activeShift.id, normalizedUpdate as TimeCardEntryModel);\n\n\t\tawait loadTimeCards();\n\t};\n\n\tconst handleEndLunch = async () => {\n\t\tif (!activeShift || !activeShift.lunch_start_timestamp) return;\n\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tconst now = Math.floor(Date.now() / 1000).toString();\n\n\t\t// Handle case where lunch_start_timestamp might be the string \"null\"\n\t\tlet lunchStartTime: number;\n\t\tif (typeof activeShift.lunch_start_timestamp === 'string' && activeShift.lunch_start_timestamp !== 'null') {\n\t\t\tlunchStartTime = parseInt(activeShift.lunch_start_timestamp);\n\t\t} else {\n\t\t\treturn;\n\t\t}\n\n\t\tconst lunchEndTime = parseInt(now);\n\t\tconst lunchDurationMinutes = (lunchEndTime - lunchStartTime) / 60;\n\n\t\t// Add to existing lunch duration if there was already one\n\t\tconst totalLunchMinutes = (activeShift.lunch_duration_minutes && activeShift.lunch_duration_minutes > 0 ? activeShift.lunch_duration_minutes : 0) + lunchDurationMinutes;\n\n\t\tconst updateData = {\n\t\t\t...activeShift,\n\t\t\tlunch_end_timestamp: now,\n\t\t\tlunch_duration_minutes: totalLunchMinutes,\n\t\t};\n\n\t\tconst normalizedUpdate = normalizeTimeCardEntryForSave(updateData as TimeCardEntryModel);\n\t\tawait timeCardORM.setTimeCardEntryById(activeShift.id, normalizedUpdate as TimeCardEntryModel);\n\n\t\tawait loadTimeCards();\n\t};\n\n\tconst formatTime = (ms: number) => {\n\t\tconst seconds = Math.floor(ms / 1000);\n\t\tconst hours = Math.floor(seconds / 3600);\n\t\tconst minutes = Math.floor((seconds % 3600) / 60);\n\t\tconst secs = seconds % 60;\n\t\treturn `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\n\t};\n\n\tconst formatDate = (timestamp: string) => {\n\t\tconst date = new Date(parseInt(timestamp) * 1000);\n\t\treturn date.toLocaleString(language === 'es' ? 'es-ES' : 'en-US');\n\t};\n\n\tconst formatHours = (hours: number | null | undefined) => {\n\t\tif (hours === null || hours === undefined) return \"—\";\n\t\treturn `${hours.toFixed(2)} ${language === 'es' ? 'hrs' : 'hrs'}`;\n\t};\n\n\tconst formatMinutes = (minutes: number | null | undefined) => {\n\t\tif (minutes === null || minutes === undefined) return \"—\";\n\t\treturn `${Math.round(minutes)} min`;\n\t};\n\n\treturn (\n\t\t<div className=\"space-y-6\">\n\t\t\t<SickDayCard user={user} language={language} />\n\t\t\t<Card>\n\t\t\t\t<CardHeader>\n\t\t\t\t\t<CardTitle className=\"flex items-center gap-2\">\n\t\t\t\t\t\t<Clock className=\"w-5 h-5\" />\n\t\t\t\t\t\t{t.clockInOut}\n\t\t\t\t\t</CardTitle>\n\t\t\t\t\t<CardDescription>\n\t\t\t\t\t\t{activeShift ? \"✅ You are currently clocked in - Clock out button is below\" : \"❌ Not clocked in - Click CLOCK IN button to start\"}\n\t\t\t\t\t</CardDescription>\n\t\t\t\t</CardHeader>\n\t\t\t\t<CardContent className=\"space-y-6\">\n\t\t\t\t\t{/* Show current status */}\n\t\t\t\t\t<div className={`p-6 rounded-lg border-2 ${activeShift ? 'bg-green-50 border-green-300 dark:bg-green-900/20 dark:border-green-700' : 'bg-blue-50 border-blue-300 dark:bg-blue-900/20 dark:border-blue-700'}`}>\n\t\t\t\t\t\t<div className=\"flex items-center justify-between mb-4\">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<p className={`text-2xl font-bold ${activeShift ? 'text-green-700' : 'text-blue-700'}`}>\n\t\t\t\t\t\t\t\t\t{activeShift ? '🟢 CLOCKED IN' : '⚪ NOT CLOCKED IN'}\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t{!activeShift && (\n\t\t\t\t\t\t\t\t\t<p className=\"text-sm text-blue-600 dark:text-blue-400 mt-2 font-semibold\">\n\t\t\t\t\t\t\t\t\t\t👇 Fill out the form below and click \"CLOCK IN\"\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t{activeShift && (\n\t\t\t\t\t\t\t\t\t<p className=\"text-sm text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\tStarted: {formatDate(activeShift.clock_in_timestamp)}\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t{isOnLunch && (\n\t\t\t\t\t\t\t\t\t<p className=\"text-sm text-orange-600 font-semibold mt-1\">\n\t\t\t\t\t\t\t\t\t\t☕ On Lunch Break\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{activeShift && !isOnLunch && (\n\t\t\t\t\t\t\t\t<div className=\"text-right\">\n\t\t\t\t\t\t\t\t\t<p className=\"text-3xl font-mono font-bold tabular-nums\">\n\t\t\t\t\t\t\t\t\t\t{formatTime(elapsedTime)}\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t<p className=\"text-xs text-muted-foreground\">Time Elapsed</p>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Main Action Buttons */}\n\t\t\t\t\t{activeShift ? (\n\t\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t\t{/* Clock Out Button - ALWAYS VISIBLE when clocked in */}\n\t\t\t\t\t\t\t<div className=\"bg-red-50 dark:bg-red-950 p-4 rounded-lg border-2 border-red-300 dark:border-red-700\">\n\t\t\t\t\t\t\t\t<p className=\"text-center text-sm font-bold text-red-700 dark:text-red-300 mb-3\">\n\t\t\t\t\t\t\t\t\t⬇️ CLICK HERE TO END YOUR SHIFT ⬇️\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tonClick={handleClockOut}\n\t\t\t\t\t\t\t\t\tvariant=\"destructive\"\n\t\t\t\t\t\t\t\t\tsize=\"lg\"\n\t\t\t\t\t\t\t\t\tclassName=\"w-full h-20 text-2xl font-black shadow-lg hover:shadow-xl transition-all\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<Clock className=\"w-8 h-8 mr-3\" />\n\t\t\t\t\t\t\t\t\tCLOCK OUT\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t{/* Lunch Buttons */}\n\t\t\t\t\t\t\t<div className=\"border-t pt-4\">\n\t\t\t\t\t\t\t\t<p className=\"text-sm text-muted-foreground mb-3\">Lunch Break (Optional)</p>\n\t\t\t\t\t\t\t\t{isOnLunch ? (\n\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\tonClick={handleEndLunch}\n\t\t\t\t\t\t\t\t\t\tclassName=\"w-full h-12\"\n\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<Coffee className=\"w-5 h-5 mr-2\" />\n\t\t\t\t\t\t\t\t\t\tEnd Lunch Break\n\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\tonClick={handleStartLunch}\n\t\t\t\t\t\t\t\t\t\tclassName=\"w-full h-12\"\n\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<Coffee className=\"w-5 h-5 mr-2\" />\n\t\t\t\t\t\t\t\t\t\tStart Lunch Break\n\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t{/* Location and Description */}\n\t\t\t\t\t\t\t<div className=\"border-t pt-4 space-y-4\">\n\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t<Label>{t.location}</Label>\n\t\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\t\tvalue={location}\n\t\t\t\t\t\t\t\t\t\tonChange={(e) => setLocation(e.target.value)}\n\t\t\t\t\t\t\t\t\t\tplaceholder={t.locationPlaceholder}\n\t\t\t\t\t\t\t\t\t\tclassName=\"mt-2\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t<Label>{t.workDescription}</Label>\n\t\t\t\t\t\t\t\t\t<Textarea\n\t\t\t\t\t\t\t\t\t\tvalue={workDescription}\n\t\t\t\t\t\t\t\t\t\tonChange={(e) => setWorkDescription(e.target.value)}\n\t\t\t\t\t\t\t\t\t\tplaceholder={t.descriptionPlaceholder}\n\t\t\t\t\t\t\t\t\t\trows={3}\n\t\t\t\t\t\t\t\t\t\tclassName=\"mt-2\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t\t{/* Clock In Form */}\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<Label>{t.location}</Label>\n\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\tvalue={location}\n\t\t\t\t\t\t\t\t\tonChange={(e) => setLocation(e.target.value)}\n\t\t\t\t\t\t\t\t\tplaceholder={t.locationPlaceholder}\n\t\t\t\t\t\t\t\t\tclassName=\"mt-2\"\n\t\t\t\t\t\t\t\t\tdisabled={isLoading}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<Label>{t.workDescription}</Label>\n\t\t\t\t\t\t\t\t<Textarea\n\t\t\t\t\t\t\t\t\tvalue={workDescription}\n\t\t\t\t\t\t\t\t\tonChange={(e) => setWorkDescription(e.target.value)}\n\t\t\t\t\t\t\t\t\tplaceholder={t.descriptionPlaceholder}\n\t\t\t\t\t\t\t\t\trows={3}\n\t\t\t\t\t\t\t\t\tclassName=\"mt-2\"\n\t\t\t\t\t\t\t\t\tdisabled={isLoading}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tonClick={handleClockIn}\n\t\t\t\t\t\t\t\tsize=\"lg\"\n\t\t\t\t\t\t\t\tdisabled={isLoading}\n\t\t\t\t\t\t\t\tclassName=\"w-full h-16 text-xl font-bold bg-green-600 hover:bg-green-700 disabled:opacity-50\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Clock className=\"w-6 h-6 mr-2\" />\n\t\t\t\t\t\t\t\t{isLoading ? \"CLOCKING IN...\" : \"CLOCK IN\"}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t{isLoading && (\n\t\t\t\t\t\t\t\t<p className=\"text-center text-sm text-muted-foreground animate-pulse\">\n\t\t\t\t\t\t\t\t\tPlease wait, processing...\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</CardContent>\n\t\t\t</Card>\n\n\t\t\t<Card>\n\t\t\t\t<CardHeader>\n\t\t\t\t\t<CardTitle className=\"flex items-center gap-2\">\n\t\t\t\t\t\t<CalendarDays className=\"w-5 h-5\" />\n\t\t\t\t\t\t{t.timeCardHistory}\n\t\t\t\t\t</CardTitle>\n\t\t\t\t\t<CardDescription>{t.recentRecords}</CardDescription>\n\t\t\t\t</CardHeader>\n\t\t\t\t<CardContent>\n\t\t\t\t\t{timeCards.length === 0 ? (\n\t\t\t\t\t\t<p className=\"text-center text-muted-foreground py-8\">{t.noTimeCards}</p>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<div className=\"overflow-x-auto\">\n\t\t\t\t\t\t\t<Table>\n\t\t\t\t\t\t\t\t<TableHeader>\n\t\t\t\t\t\t\t\t\t<TableRow>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.clockInTime}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.clockOutTime}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.location}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.workDescription}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.lunchDuration}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.hours}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.status}</TableHead>\n\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t</TableHeader>\n\t\t\t\t\t\t\t\t<TableBody>\n\t\t\t\t\t\t\t\t\t{timeCards.map((tc) => (\n\t\t\t\t\t\t\t\t\t\t<TableRow key={tc.id}>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatDate(tc.clock_in_timestamp)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t{tc.clock_out_timestamp ? formatDate(tc.clock_out_timestamp) : \"—\"}\n\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell>{tc.location || \"—\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"max-w-xs truncate\">{tc.work_description || \"—\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatMinutes(tc.lunch_duration_minutes)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatHours(tc.total_hours)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t{tc.clock_out_timestamp ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge variant=\"secondary\">{t.completed}</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t) : tc.lunch_start_timestamp && !tc.lunch_end_timestamp ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge className=\"bg-orange-500\">{t.onLunchBreak}</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge className=\"bg-green-500\">{t.active}</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</TableBody>\n\t\t\t\t\t\t\t</Table>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</CardContent>\n\t\t\t</Card>\n\t\t</div>\n\t);\n}\n\nfunction ManagerView({ user, users, language, onUsersChange }: { user: UserModel; users: UserModel[]; language: Language; onUsersChange: () => void }) {\n\tconst [activeTab, setActiveTab] = useState(\"timecards\");\n\n\tconst t = translations[language];\n\n\treturn (\n\t\t<Tabs value={activeTab} onValueChange={setActiveTab}>\n\t\t\t<TabsList className=\"grid w-full grid-cols-4\">\n\t\t\t\t<TabsTrigger value=\"timecards\">\n\t\t\t\t\t<Clock className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t{t.timeCards}\n\t\t\t\t</TabsTrigger>\n\t\t\t\t<TabsTrigger value=\"sickdays\">\n\t\t\t\t\t<Heart className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t{t.sickDays}\n\t\t\t\t</TabsTrigger>\n\t\t\t\t<TabsTrigger value=\"reports\">\n\t\t\t\t\t<FileText className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t{t.reports}\n\t\t\t\t</TabsTrigger>\n\t\t\t\t<TabsTrigger value=\"employees\">\n\t\t\t\t\t<Users className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t{t.employees}\n\t\t\t\t</TabsTrigger>\n\t\t\t</TabsList>\n\n\t\t\t<TabsContent value=\"timecards\" className=\"space-y-4\">\n\t\t\t\t<TimeCardsTab users={users} language={language} />\n\t\t\t</TabsContent>\n\n\t\t\t<TabsContent value=\"sickdays\" className=\"space-y-4\">\n\t\t\t\t<SickDaysTab users={users} language={language} />\n\t\t\t</TabsContent>\n\n\t\t\t<TabsContent value=\"reports\" className=\"space-y-4\">\n\t\t\t\t<ReportsTab users={users} language={language} />\n\t\t\t</TabsContent>\n\n\t\t\t<TabsContent value=\"employees\" className=\"space-y-4\">\n\t\t\t\t<EmployeesTab users={users} language={language} onUsersChange={onUsersChange} />\n\t\t\t</TabsContent>\n\t\t</Tabs>\n\t);\n}\n\nfunction TimeCardsTab({ users, language }: { users: UserModel[]; language: Language }) {\n\tconst [allTimeCards, setAllTimeCards] = useState<TimeCardEntryModel[]>([]);\n\tconst [filteredCards, setFilteredCards] = useState<TimeCardEntryModel[]>([]);\n\tconst [selectedEmployee, setSelectedEmployee] = useState<string>(\"all\");\n\tconst [dateFilter, setDateFilter] = useState<string>(\"\");\n\tconst [editingCard, setEditingCard] = useState<TimeCardEntryModel | null>(null);\n\tconst [editClockIn, setEditClockIn] = useState(\"\");\n\tconst [editClockOut, setEditClockOut] = useState(\"\");\n\tconst [editLocation, setEditLocation] = useState(\"\");\n\tconst [editWorkDescription, setEditWorkDescription] = useState(\"\");\n\tconst [editLunchStart, setEditLunchStart] = useState(\"\");\n\tconst [editLunchEnd, setEditLunchEnd] = useState(\"\");\n\tconst [showManualEntry, setShowManualEntry] = useState(false);\n\tconst [manualEntryUserId, setManualEntryUserId] = useState<string>(\"\");\n\n\tconst t = translations[language];\n\n\tuseEffect(() => {\n\t\tloadAllTimeCards();\n\t}, []);\n\n\tuseEffect(() => {\n\t\tapplyFilters();\n\t}, [allTimeCards, selectedEmployee, dateFilter]);\n\n\tconst loadAllTimeCards = async () => {\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tconst allCards = await timeCardORM.getAllTimeCardEntry();\n\n\t\t// Normalize data from ORM\n\t\tconst normalized = normalizeTimeCardEntriesFromORM(allCards);\n\n\t\t// Sort by clock in time (newest first)\n\t\tconst sorted = normalized.sort((a, b) =>\n\t\t\tparseInt(b.clock_in_timestamp) - parseInt(a.clock_in_timestamp)\n\t\t);\n\n\t\tsetAllTimeCards(sorted);\n\t};\n\n\tconst applyFilters = () => {\n\t\tlet filtered = [...allTimeCards];\n\n\t\t// Filter by employee\n\t\tif (selectedEmployee !== \"all\") {\n\t\t\tfiltered = filtered.filter(tc => tc.user_id === selectedEmployee);\n\t\t}\n\n\t\t// Filter by date\n\t\tif (dateFilter) {\n\t\t\tconst filterDate = new Date(dateFilter);\n\t\t\tconst filterTimestamp = Math.floor(filterDate.getTime() / 1000);\n\t\t\tconst nextDayTimestamp = filterTimestamp + 86400; // +24 hours\n\n\t\t\tfiltered = filtered.filter(tc => {\n\t\t\t\tconst clockIn = parseInt(tc.clock_in_timestamp);\n\t\t\t\treturn clockIn >= filterTimestamp && clockIn < nextDayTimestamp;\n\t\t\t});\n\t\t}\n\n\t\tsetFilteredCards(filtered);\n\t};\n\n\tconst getUserName = (userId: string) => {\n\t\tconst user = users.find(u => u.id === userId);\n\t\treturn user?.name || \"Unknown\";\n\t};\n\n\tconst formatDate = (timestamp: string) => {\n\t\tconst date = new Date(parseInt(timestamp) * 1000);\n\t\treturn date.toLocaleString(language === 'es' ? 'es-ES' : 'en-US');\n\t};\n\n\tconst formatHours = (hours: number | null | undefined) => {\n\t\tif (hours === null || hours === undefined) return \"—\";\n\t\treturn `${hours.toFixed(2)} ${language === 'es' ? 'hrs' : 'hrs'}`;\n\t};\n\n\tconst formatMinutes = (minutes: number | null | undefined) => {\n\t\tif (minutes === null || minutes === undefined) return \"—\";\n\t\treturn `${Math.round(minutes)} min`;\n\t};\n\n\tconst calculateTotalHours = (period: 'day' | 'week') => {\n\t\tconst now = Date.now() / 1000;\n\t\tconst periodSeconds = period === 'day' ? 86400 : 604800; // 1 day or 7 days\n\t\tconst startTime = now - periodSeconds;\n\n\t\tconst relevantCards = allTimeCards.filter(tc => {\n\t\t\tconst clockIn = parseInt(tc.clock_in_timestamp);\n\t\t\treturn clockIn >= startTime && tc.total_hours;\n\t\t});\n\n\t\treturn relevantCards.reduce((sum, tc) => sum + (tc.total_hours || 0), 0);\n\t};\n\n\tconst handleEditCard = (card: TimeCardEntryModel) => {\n\t\tsetEditingCard(card);\n\n\t\t// Helper function to safely convert timestamp to ISO string\n\t\tconst safeTimestampToISO = (timestamp: string | null | undefined): string => {\n\t\t\tif (!timestamp) return \"\";\n\t\t\tconst parsed = parseInt(timestamp);\n\t\t\tif (isNaN(parsed) || parsed <= 0) return \"\";\n\t\t\tconst date = new Date(parsed * 1000);\n\t\t\tif (isNaN(date.getTime())) return \"\";\n\t\t\treturn date.toISOString().slice(0, 16);\n\t\t};\n\n\t\tsetEditClockIn(safeTimestampToISO(card.clock_in_timestamp) || new Date().toISOString().slice(0, 16));\n\t\tsetEditClockOut(safeTimestampToISO(card.clock_out_timestamp));\n\t\tsetEditLocation(card.location || \"\");\n\t\tsetEditWorkDescription(card.work_description || \"\");\n\t\tsetEditLunchStart(safeTimestampToISO(card.lunch_start_timestamp));\n\t\tsetEditLunchEnd(safeTimestampToISO(card.lunch_end_timestamp));\n\t};\n\n\tconst handleSaveEdit = async () => {\n\t\tif (!editingCard) return;\n\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tconst clockInTimestamp = Math.floor(new Date(editClockIn).getTime() / 1000).toString();\n\t\tconst clockOutTimestamp = editClockOut\n\t\t\t? Math.floor(new Date(editClockOut).getTime() / 1000).toString()\n\t\t\t: undefined;\n\t\tconst lunchStartTimestamp = editLunchStart\n\t\t\t? Math.floor(new Date(editLunchStart).getTime() / 1000).toString()\n\t\t\t: undefined;\n\t\tconst lunchEndTimestamp = editLunchEnd\n\t\t\t? Math.floor(new Date(editLunchEnd).getTime() / 1000).toString()\n\t\t\t: undefined;\n\n\t\tlet totalHours: number | undefined = undefined;\n\t\tlet lunchDurationMinutes: number | undefined = undefined;\n\n\t\t// Calculate lunch duration\n\t\tif (lunchStartTimestamp && lunchEndTimestamp) {\n\t\t\tconst lunchStart = parseInt(lunchStartTimestamp);\n\t\t\tconst lunchEnd = parseInt(lunchEndTimestamp);\n\t\t\tlunchDurationMinutes = (lunchEnd - lunchStart) / 60;\n\t\t}\n\n\t\t// Calculate total hours\n\t\tif (clockOutTimestamp) {\n\t\t\tconst clockInTime = parseInt(clockInTimestamp);\n\t\t\tconst clockOutTime = parseInt(clockOutTimestamp);\n\t\t\ttotalHours = (clockOutTime - clockInTime) / 3600;\n\n\t\t\t// Deduct lunch time\n\t\t\tif (lunchDurationMinutes) {\n\t\t\t\ttotalHours -= lunchDurationMinutes / 60;\n\t\t\t}\n\t\t}\n\n\t\tconst updateData = {\n\t\t\t...editingCard,\n\t\t\tclock_in_timestamp: clockInTimestamp,\n\t\t\tclock_out_timestamp: clockOutTimestamp,\n\t\t\ttotal_hours: totalHours,\n\t\t\tlocation: editLocation || undefined,\n\t\t\twork_description: editWorkDescription || undefined,\n\t\t\tlunch_start_timestamp: lunchStartTimestamp,\n\t\t\tlunch_end_timestamp: lunchEndTimestamp,\n\t\t\tlunch_duration_minutes: lunchDurationMinutes,\n\t\t};\n\n\t\tconst normalizedUpdate = normalizeTimeCardEntryForSave(updateData as TimeCardEntryModel);\n\t\tawait timeCardORM.setTimeCardEntryById(editingCard.id, normalizedUpdate as TimeCardEntryModel);\n\n\t\tsetEditingCard(null);\n\t\tawait loadAllTimeCards();\n\t};\n\n\tconst handleDeleteTimeCard = async (card: TimeCardEntryModel) => {\n\t\tif (!window.confirm(t.confirmDeleteTimeCard)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tawait timeCardORM.deleteTimeCardEntryById(card.id);\n\t\tawait loadAllTimeCards();\n\t};\n\n\tconst handleAddManualEntry = (userId: string) => {\n\t\tsetManualEntryUserId(userId);\n\t\tsetShowManualEntry(true);\n\t};\n\n\treturn (\n\t\t<>\n\t\t\t<div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n\t\t\t\t<Card>\n\t\t\t\t\t<CardHeader className=\"pb-3\">\n\t\t\t\t\t\t<CardTitle className=\"text-sm font-medium flex items-center gap-2\">\n\t\t\t\t\t\t\t<Users className=\"w-4 h-4\" />\n\t\t\t\t\t\t\t{t.totalEmployees}\n\t\t\t\t\t\t</CardTitle>\n\t\t\t\t\t</CardHeader>\n\t\t\t\t\t<CardContent>\n\t\t\t\t\t\t<div className=\"text-2xl font-bold\">{users.filter(u => u.role === UserRole.Employee).length}</div>\n\t\t\t\t\t</CardContent>\n\t\t\t\t</Card>\n\n\t\t\t\t<Card>\n\t\t\t\t\t<CardHeader className=\"pb-3\">\n\t\t\t\t\t\t<CardTitle className=\"text-sm font-medium flex items-center gap-2\">\n\t\t\t\t\t\t\t<Timer className=\"w-4 h-4\" />\n\t\t\t\t\t\t\t{t.hoursToday}\n\t\t\t\t\t\t</CardTitle>\n\t\t\t\t\t</CardHeader>\n\t\t\t\t\t<CardContent>\n\t\t\t\t\t\t<div className=\"text-2xl font-bold\">{calculateTotalHours('day').toFixed(2)}</div>\n\t\t\t\t\t</CardContent>\n\t\t\t\t</Card>\n\n\t\t\t\t<Card>\n\t\t\t\t\t<CardHeader className=\"pb-3\">\n\t\t\t\t\t\t<CardTitle className=\"text-sm font-medium flex items-center gap-2\">\n\t\t\t\t\t\t\t<CalendarDays className=\"w-4 h-4\" />\n\t\t\t\t\t\t\t{t.hoursThisWeek}\n\t\t\t\t\t\t</CardTitle>\n\t\t\t\t\t</CardHeader>\n\t\t\t\t\t<CardContent>\n\t\t\t\t\t\t<div className=\"text-2xl font-bold\">{calculateTotalHours('week').toFixed(2)}</div>\n\t\t\t\t\t</CardContent>\n\t\t\t\t</Card>\n\t\t\t</div>\n\n\t\t\t<Card>\n\t\t\t\t<CardHeader>\n\t\t\t\t\t<div className=\"flex justify-between items-center\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<CardTitle>{t.allEmployeeTimeCards}</CardTitle>\n\t\t\t\t\t\t\t<CardDescription>{t.viewManageRecords}</CardDescription>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<Button onClick={() => handleAddManualEntry(\"\")} variant=\"outline\" size=\"sm\">\n\t\t\t\t\t\t\t<Plus className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t\t\t{t.addTimeCard}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t</CardHeader>\n\t\t\t\t<CardContent className=\"space-y-4\">\n\t\t\t\t\t<div className=\"flex gap-4 flex-wrap\">\n\t\t\t\t\t\t<div className=\"flex-1 min-w-[200px]\">\n\t\t\t\t\t\t\t<Label>{t.filterByEmployee}</Label>\n\t\t\t\t\t\t\t<Select value={selectedEmployee} onValueChange={setSelectedEmployee}>\n\t\t\t\t\t\t\t\t<SelectTrigger>\n\t\t\t\t\t\t\t\t\t<SelectValue />\n\t\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t\t<SelectItem value=\"all\">{t.allEmployees}</SelectItem>\n\t\t\t\t\t\t\t\t\t{users.filter(u => u.role === UserRole.Employee).map((u) => (\n\t\t\t\t\t\t\t\t\t\t<SelectItem key={u.id} value={u.id}>\n\t\t\t\t\t\t\t\t\t\t\t{u.name}\n\t\t\t\t\t\t\t\t\t\t</SelectItem>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t\t</Select>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div className=\"flex-1 min-w-[200px]\">\n\t\t\t\t\t\t\t<Label>{t.filterByDate}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"date\"\n\t\t\t\t\t\t\t\tvalue={dateFilter}\n\t\t\t\t\t\t\t\tonChange={(e) => setDateFilter(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t{(selectedEmployee !== \"all\" || dateFilter) && (\n\t\t\t\t\t\t\t<div className=\"flex items-end\">\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\t\t\tsetSelectedEmployee(\"all\");\n\t\t\t\t\t\t\t\t\t\tsetDateFilter(\"\");\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{t.clearFilters}\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{filteredCards.length === 0 ? (\n\t\t\t\t\t\t<p className=\"text-center text-muted-foreground py-8\">{t.noTimeCardsFound}</p>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<div className=\"overflow-x-auto\">\n\t\t\t\t\t\t\t<Table>\n\t\t\t\t\t\t\t\t<TableHeader>\n\t\t\t\t\t\t\t\t\t<TableRow>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.employeeName}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.clockInTime}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.clockOutTime}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.location}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.workDescription}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.lunchDuration}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.hours}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.status}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.actions}</TableHead>\n\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t</TableHeader>\n\t\t\t\t\t\t\t\t<TableBody>\n\t\t\t\t\t\t\t\t\t{filteredCards.map((tc) => (\n\t\t\t\t\t\t\t\t\t\t<TableRow key={tc.id}>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"font-medium whitespace-nowrap\">{getUserName(tc.user_id)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatDate(tc.clock_in_timestamp)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t{tc.clock_out_timestamp ? formatDate(tc.clock_out_timestamp) : \"—\"}\n\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell>{tc.location || \"—\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"max-w-xs truncate\">{tc.work_description || \"—\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatMinutes(tc.lunch_duration_minutes)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatHours(tc.total_hours)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t{tc.clock_out_timestamp ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge variant=\"secondary\">{t.completed}</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t) : tc.lunch_start_timestamp && !tc.lunch_end_timestamp ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge className=\"bg-orange-500\">{t.onLunchBreak}</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge className=\"bg-green-500\">{t.active}</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => handleEditCard(tc)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{t.edit}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => handleDeleteTimeCard(tc)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"text-red-600 hover:text-red-700 hover:bg-red-50\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Trash2 className=\"w-4 h-4\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</TableBody>\n\t\t\t\t\t\t\t</Table>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</CardContent>\n\t\t\t</Card>\n\n\t\t\t<Dialog open={!!editingCard} onOpenChange={(open) => !open && setEditingCard(null)}>\n\t\t\t\t<DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n\t\t\t\t\t<DialogHeader>\n\t\t\t\t\t\t<DialogTitle>{t.editTimeCard}</DialogTitle>\n\t\t\t\t\t</DialogHeader>\n\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.employeeName}</Label>\n\t\t\t\t\t\t\t<Input value={editingCard ? getUserName(editingCard.user_id) : \"\"} disabled />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"grid grid-cols-2 gap-4\">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<Label>{t.clockInTime}</Label>\n\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\t\tvalue={editClockIn}\n\t\t\t\t\t\t\t\t\tonChange={(e) => setEditClockIn(e.target.value)}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<Label>{t.clockOutTime}</Label>\n\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\t\tvalue={editClockOut}\n\t\t\t\t\t\t\t\t\tonChange={(e) => setEditClockOut(e.target.value)}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.location}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\tvalue={editLocation}\n\t\t\t\t\t\t\t\tonChange={(e) => setEditLocation(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder={t.locationPlaceholder}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.workDescription}</Label>\n\t\t\t\t\t\t\t<Textarea\n\t\t\t\t\t\t\t\tvalue={editWorkDescription}\n\t\t\t\t\t\t\t\tonChange={(e) => setEditWorkDescription(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder={t.descriptionPlaceholder}\n\t\t\t\t\t\t\t\trows={4}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"grid grid-cols-2 gap-4\">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<Label>{t.lunchStartTime}</Label>\n\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\t\tvalue={editLunchStart}\n\t\t\t\t\t\t\t\t\tonChange={(e) => setEditLunchStart(e.target.value)}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<Label>{t.lunchEndTime}</Label>\n\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\t\tvalue={editLunchEnd}\n\t\t\t\t\t\t\t\t\tonChange={(e) => setEditLunchEnd(e.target.value)}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<DialogFooter>\n\t\t\t\t\t\t<Button variant=\"outline\" onClick={() => setEditingCard(null)}>\n\t\t\t\t\t\t\t{t.cancel}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button onClick={handleSaveEdit}>\n\t\t\t\t\t\t\t{t.saveChanges}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</DialogFooter>\n\t\t\t\t</DialogContent>\n\t\t\t</Dialog>\n\n\t\t\t<ManualEntryDialog\n\t\t\t\topen={showManualEntry}\n\t\t\t\tonClose={() => setShowManualEntry(false)}\n\t\t\t\tuserId={manualEntryUserId}\n\t\t\t\tonSave={loadAllTimeCards}\n\t\t\t\tlanguage={language}\n\t\t\t\tusers={users}\n\t\t\t/>\n\t\t</>\n\t);\n}\n\nfunction SickDaysTab({ users, language }: { users: UserModel[]; language: Language }) {\n\tconst [allSickDays, setAllSickDays] = useState<SickDayModel[]>([]);\n\tconst [filteredSickDays, setFilteredSickDays] = useState<SickDayModel[]>([]);\n\tconst [selectedEmployee, setSelectedEmployee] = useState<string>(\"all\");\n\tconst [dateFilter, setDateFilter] = useState<string>(\"\");\n\n\tconst t = translations[language];\n\n\tuseEffect(() => {\n\t\tloadAllSickDays();\n\t}, []);\n\n\tuseEffect(() => {\n\t\tapplyFilters();\n\t}, [allSickDays, selectedEmployee, dateFilter]);\n\n\tconst loadAllSickDays = async () => {\n\t\tconst sickDayORM = SickDayORM.getInstance();\n\t\tconst allDays = await sickDayORM.getAllSickDay();\n\n\t\t// Sort by date (newest first)\n\t\tconst sorted = allDays.sort((a, b) =>\n\t\t\tnew Date(b.sick_date).getTime() - new Date(a.sick_date).getTime()\n\t\t);\n\n\t\tsetAllSickDays(sorted);\n\t};\n\n\tconst applyFilters = () => {\n\t\tlet filtered = [...allSickDays];\n\n\t\t// Filter by employee\n\t\tif (selectedEmployee !== \"all\") {\n\t\t\tfiltered = filtered.filter(sd => sd.user_id === selectedEmployee);\n\t\t}\n\n\t\t// Filter by date\n\t\tif (dateFilter) {\n\t\t\tfiltered = filtered.filter(sd => sd.sick_date === dateFilter);\n\t\t}\n\n\t\tsetFilteredSickDays(filtered);\n\t};\n\n\tconst getUserName = (userId: string) => {\n\t\tconst user = users.find(u => u.id === userId);\n\t\treturn user?.name || \"Unknown\";\n\t};\n\n\tconst formatDate = (dateStr: string) => {\n\t\tconst date = new Date(dateStr);\n\t\treturn date.toLocaleDateString(language === 'es' ? 'es-ES' : 'en-US', {\n\t\t\tyear: 'numeric',\n\t\t\tmonth: 'long',\n\t\t\tday: 'numeric'\n\t\t});\n\t};\n\n\tconst handleDeleteSickDay = async (sickDay: SickDayModel) => {\n\t\tif (!window.confirm(t.confirmDeleteSickDay)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst sickDayORM = SickDayORM.getInstance();\n\t\tawait sickDayORM.deleteSickDayById(sickDay.id);\n\t\tawait loadAllSickDays();\n\t};\n\n\tconst calculateTotalSickHours = () => {\n\t\treturn filteredSickDays.reduce((sum, sd) => sum + sd.hours, 0);\n\t};\n\n\treturn (\n\t\t<Card>\n\t\t\t<CardHeader>\n\t\t\t\t<div className=\"flex justify-between items-center\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<CardTitle className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t<Heart className=\"w-5 h-5 text-red-500\" />\n\t\t\t\t\t\t\t{t.sickDayHistory}\n\t\t\t\t\t\t</CardTitle>\n\t\t\t\t\t\t<CardDescription>\n\t\t\t\t\t\t\t{t.totalSickDays}: {calculateTotalSickHours().toFixed(1)} {language === 'es' ? 'hrs' : 'hrs'}\n\t\t\t\t\t\t</CardDescription>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</CardHeader>\n\t\t\t<CardContent className=\"space-y-4\">\n\t\t\t\t<div className=\"flex gap-4 flex-wrap\">\n\t\t\t\t\t<div className=\"flex-1 min-w-[200px]\">\n\t\t\t\t\t\t<Label>{t.filterByEmployee}</Label>\n\t\t\t\t\t\t<Select value={selectedEmployee} onValueChange={setSelectedEmployee}>\n\t\t\t\t\t\t\t<SelectTrigger>\n\t\t\t\t\t\t\t\t<SelectValue />\n\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t<SelectItem value=\"all\">{t.allEmployees}</SelectItem>\n\t\t\t\t\t\t\t\t{users.filter(u => u.role === UserRole.Employee).map((u) => (\n\t\t\t\t\t\t\t\t\t<SelectItem key={u.id} value={u.id}>\n\t\t\t\t\t\t\t\t\t\t{u.name}\n\t\t\t\t\t\t\t\t\t</SelectItem>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t</Select>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div className=\"flex-1 min-w-[200px]\">\n\t\t\t\t\t\t<Label>{t.filterByDate}</Label>\n\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\ttype=\"date\"\n\t\t\t\t\t\t\tvalue={dateFilter}\n\t\t\t\t\t\t\tonChange={(e) => setDateFilter(e.target.value)}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{(selectedEmployee !== \"all\" || dateFilter) && (\n\t\t\t\t\t\t<div className=\"flex items-end\">\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\t\tsetSelectedEmployee(\"all\");\n\t\t\t\t\t\t\t\t\tsetDateFilter(\"\");\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{t.clearFilters}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\n\t\t\t\t{filteredSickDays.length === 0 ? (\n\t\t\t\t\t<p className=\"text-center text-muted-foreground py-8\">{t.noSickDays}</p>\n\t\t\t\t) : (\n\t\t\t\t\t<div className=\"overflow-x-auto\">\n\t\t\t\t\t\t<Table>\n\t\t\t\t\t\t\t<TableHeader>\n\t\t\t\t\t\t\t\t<TableRow>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.employeeName}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.sickDayDate}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.sickDayHours}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.sickDayNotes}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.actions}</TableHead>\n\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t</TableHeader>\n\t\t\t\t\t\t\t<TableBody>\n\t\t\t\t\t\t\t\t{filteredSickDays.map((sd) => (\n\t\t\t\t\t\t\t\t\t<TableRow key={sd.id}>\n\t\t\t\t\t\t\t\t\t\t<TableCell className=\"font-medium whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t{getUserName(sd.user_id)}\n\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t{formatDate(sd.sick_date)}\n\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell>{sd.hours} hrs</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell className=\"max-w-xs truncate\">{sd.notes || \"—\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => handleDeleteSickDay(sd)}\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"text-red-600 hover:text-red-700 hover:bg-red-50\"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<Trash2 className=\"w-4 h-4\" />\n\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</TableBody>\n\t\t\t\t\t\t</Table>\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\t\t\t</CardContent>\n\t\t</Card>\n\t);\n}\n\nfunction ReportsTab({ users, language }: { users: UserModel[]; language: Language }) {\n\tconst [weekStart, setWeekStart] = useState(\"\");\n\tconst [reportData, setReportData] = useState<{ user: UserModel; regularHours: number; overtimeHours: number; totalHours: number; regularPay: number; overtimePay: number; totalPay: number }[]>([]);\n\tconst [detailedTimeCards, setDetailedTimeCards] = useState<TimeCardEntryModel[]>([]);\n\n\tconst t = translations[language];\n\n\tuseEffect(() => {\n\t\t// Set default to current week\n\t\tconst today = new Date();\n\t\tconst monday = new Date(today);\n\t\tmonday.setDate(today.getDate() - today.getDay() + 1);\n\t\tsetWeekStart(monday.toISOString().slice(0, 10));\n\t}, []);\n\n\tuseEffect(() => {\n\t\tif (weekStart) {\n\t\t\tloadWeeklyReport();\n\t\t}\n\t}, [weekStart, users]);\n\n\tconst loadWeeklyReport = async () => {\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tconst allCards = await timeCardORM.getAllTimeCardEntry();\n\n\t\t// Normalize data from ORM\n\t\tconst normalized = normalizeTimeCardEntriesFromORM(allCards);\n\n\t\tconst weekStartDate = new Date(weekStart);\n\t\tconst weekStartTimestamp = Math.floor(weekStartDate.getTime() / 1000);\n\t\tconst weekEndTimestamp = weekStartTimestamp + 604800; // 7 days\n\n\t\tconst weekCards = normalized.filter(tc => {\n\t\t\tconst clockIn = parseInt(tc.clock_in_timestamp);\n\t\t\treturn clockIn >= weekStartTimestamp && clockIn < weekEndTimestamp && tc.total_hours;\n\t\t});\n\n\t\t// Store detailed time cards\n\t\tsetDetailedTimeCards(weekCards.sort((a, b) => parseInt(a.clock_in_timestamp) - parseInt(b.clock_in_timestamp)));\n\n\t\tconst employeeHours = users\n\t\t\t.filter(u => u.role === UserRole.Employee)\n\t\t\t.map(user => {\n\t\t\t\tconst userCards = weekCards.filter(tc => tc.user_id === user.id);\n\t\t\t\tconst totalHours = userCards.reduce((sum, tc) => sum + (tc.total_hours || 0), 0);\n\t\t\t\tconst regularHours = Math.min(totalHours, 40);\n\t\t\t\tconst overtimeHours = Math.max(totalHours - 40, 0);\n\n\t\t\t\t// Calculate pay\n\t\t\t\tconst hourlyRate = user.hourly_rate || 0;\n\t\t\t\tconst regularPay = regularHours * hourlyRate;\n\t\t\t\tconst overtimePay = overtimeHours * hourlyRate * 1.5;\n\t\t\t\tconst totalPay = regularPay + overtimePay;\n\n\t\t\t\treturn {\n\t\t\t\t\tuser,\n\t\t\t\t\tregularHours,\n\t\t\t\t\tovertimeHours,\n\t\t\t\t\ttotalHours,\n\t\t\t\t\tregularPay,\n\t\t\t\t\tovertimePay,\n\t\t\t\t\ttotalPay,\n\t\t\t\t};\n\t\t\t});\n\n\t\tsetReportData(employeeHours);\n\t};\n\n\tconst formatHours = (hours: number) => {\n\t\treturn `${hours.toFixed(2)} hrs`;\n\t};\n\n\tconst formatPay = (amount: number) => {\n\t\treturn `$${amount.toFixed(2)}`;\n\t};\n\n\tconst formatDate = (timestamp: string) => {\n\t\tconst date = new Date(parseInt(timestamp) * 1000);\n\t\treturn date.toLocaleString(language === 'es' ? 'es-ES' : 'en-US');\n\t};\n\n\tconst formatDateOnly = (timestamp: string) => {\n\t\tconst date = new Date(parseInt(timestamp) * 1000);\n\t\treturn date.toLocaleDateString(language === 'es' ? 'es-ES' : 'en-US');\n\t};\n\n\tconst getDayOfWeek = (timestamp: string) => {\n\t\tconst date = new Date(parseInt(timestamp) * 1000);\n\t\treturn date.toLocaleDateString(language === 'es' ? 'es-ES' : 'en-US', { weekday: 'long' });\n\t};\n\n\tconst getUserName = (userId: string) => {\n\t\tconst user = users.find(u => u.id === userId);\n\t\treturn user?.name || \"Unknown\";\n\t};\n\n\tconst handlePrint = () => {\n\t\twindow.print();\n\t};\n\n\tconst handleExportCSV = () => {\n\t\tif (detailedTimeCards.length === 0) return;\n\n\t\t// Create CSV header\n\t\tconst headers = [\n\t\t\tt.employeeName,\n\t\t\tt.date,\n\t\t\tt.day,\n\t\t\tt.clockInTime,\n\t\t\tt.clockOutTime,\n\t\t\tt.location,\n\t\t\tt.workDescription,\n\t\t\tt.lunchDuration,\n\t\t\tt.hours,\n\t\t\tt.hourlyRate,\n\t\t\tt.pay\n\t\t];\n\n\t\t// Create CSV rows\n\t\tconst rows = detailedTimeCards.map(tc => {\n\t\t\tconst user = users.find(u => u.id === tc.user_id);\n\t\t\tconst userName = user?.name || \"Unknown\";\n\t\t\tconst hourlyRate = user?.hourly_rate || 0;\n\t\t\tconst date = formatDateOnly(tc.clock_in_timestamp);\n\t\t\tconst day = getDayOfWeek(tc.clock_in_timestamp);\n\t\t\tconst clockIn = formatDate(tc.clock_in_timestamp);\n\t\t\tconst clockOut = tc.clock_out_timestamp ? formatDate(tc.clock_out_timestamp) : \"—\";\n\t\t\tconst location = tc.location || \"—\";\n\t\t\tconst workDescription = (tc.work_description || \"—\").replace(/\"/g, '\"\"'); // Escape quotes\n\t\t\tconst lunchDuration = tc.lunch_duration_minutes ? `${Math.round(tc.lunch_duration_minutes)} min` : \"—\";\n\t\t\tconst hours = tc.total_hours ? `${tc.total_hours.toFixed(2)} hrs` : \"—\";\n\t\t\tconst pay = tc.total_hours ? formatPay(tc.total_hours * hourlyRate) : \"—\";\n\n\t\t\treturn [\n\t\t\t\t`\"${userName}\"`,\n\t\t\t\t`\"${date}\"`,\n\t\t\t\t`\"${day}\"`,\n\t\t\t\t`\"${clockIn}\"`,\n\t\t\t\t`\"${clockOut}\"`,\n\t\t\t\t`\"${location}\"`,\n\t\t\t\t`\"${workDescription}\"`,\n\t\t\t\t`\"${lunchDuration}\"`,\n\t\t\t\t`\"${hours}\"`,\n\t\t\t\t`\"${formatPay(hourlyRate)}\"`,\n\t\t\t\t`\"${pay}\"`\n\t\t\t].join(',');\n\t\t});\n\n\t\t// Combine header and rows\n\t\tconst csv = [headers.join(','), ...rows].join('\\n');\n\n\t\t// Create blob and download\n\t\tconst blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });\n\t\tconst link = document.createElement('a');\n\t\tconst url = URL.createObjectURL(blob);\n\t\tlink.setAttribute('href', url);\n\t\tlink.setAttribute('download', `weekly-report-${weekStart}.csv`);\n\t\tlink.style.visibility = 'hidden';\n\t\tdocument.body.appendChild(link);\n\t\tlink.click();\n\t\tdocument.body.removeChild(link);\n\t};\n\n\treturn (\n\t\t<div className=\"space-y-4\">\n\t\t\t<Card>\n\t\t\t\t<CardHeader>\n\t\t\t\t\t<div className=\"flex justify-between items-center\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<CardTitle>{t.weeklyReport}</CardTitle>\n\t\t\t\t\t\t\t<CardDescription>\n\t\t\t\t\t\t\t\tOvertime calculated for hours worked beyond 40 hours/week\n\t\t\t\t\t\t\t\t<br />\n\t\t\t\t\t\t\t\t<span className=\"text-xs text-muted-foreground\">\n\t\t\t\t\t\t\t\t\tNote: Sick days are tracked separately in the \"Sick Days\" tab and are NOT included in this time card report.\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</CardDescription>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"flex gap-2 print:hidden\">\n\t\t\t\t\t\t\t<Button onClick={handleExportCSV} variant=\"outline\" disabled={detailedTimeCards.length === 0}>\n\t\t\t\t\t\t\t\t<FileText className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t\t\t\t{t.exportCSV}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t<Button onClick={handlePrint} variant=\"outline\" disabled={detailedTimeCards.length === 0}>\n\t\t\t\t\t\t\t\t<FileText className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t\t\t\t{t.printReport}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</CardHeader>\n\t\t\t\t<CardContent className=\"space-y-4\">\n\t\t\t\t\t<div className=\"max-w-xs print:hidden\">\n\t\t\t\t\t\t<Label>{t.selectWeek}</Label>\n\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\ttype=\"date\"\n\t\t\t\t\t\t\tvalue={weekStart}\n\t\t\t\t\t\t\tonChange={(e) => setWeekStart(e.target.value)}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{reportData.length === 0 ? (\n\t\t\t\t\t\t<p className=\"text-center text-muted-foreground py-8\">{t.noReportData}</p>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t{/* Summary Table */}\n\t\t\t\t\t\t\t<div className=\"overflow-x-auto\">\n\t\t\t\t\t\t\t\t<Table>\n\t\t\t\t\t\t\t\t\t<TableHeader>\n\t\t\t\t\t\t\t\t\t\t<TableRow>\n\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.employeeName}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.regularHours}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.overtimeHours}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.totalHours}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.regularPay}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.overtimePay}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.totalPay}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t<TableHead className=\"print:hidden\">{t.status}</TableHead>\n\t\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t\t</TableHeader>\n\t\t\t\t\t\t\t\t\t<TableBody>\n\t\t\t\t\t\t\t\t\t\t{reportData.map(({ user, regularHours, overtimeHours, totalHours, regularPay, overtimePay, totalPay }) => (\n\t\t\t\t\t\t\t\t\t\t\t<TableRow key={user.id}>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"font-medium\">{user.name}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableCell>{formatHours(regularHours)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{overtimeHours > 0 ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-orange-600 font-semibold\">{formatHours(overtimeHours)}</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tformatHours(0)\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"font-semibold\">{formatHours(totalHours)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableCell>{formatPay(regularPay)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{overtimePay > 0 ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-orange-600 font-semibold\">{formatPay(overtimePay)}</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tformatPay(0)\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"font-semibold\">{formatPay(totalPay)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"print:hidden\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{overtimeHours > 0 && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge className=\"bg-orange-500\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<AlertCircle className=\"w-3 h-3 mr-1\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{t.overtimeAlert}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t\t</TableBody>\n\t\t\t\t\t\t\t\t</Table>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t{/* Detailed Time Cards Table */}\n\t\t\t\t\t\t\t<div className=\"mt-8\">\n\t\t\t\t\t\t\t\t<h3 className=\"text-lg font-semibold mb-4\">{t.detailedReport}</h3>\n\t\t\t\t\t\t\t\t<div className=\"overflow-x-auto\">\n\t\t\t\t\t\t\t\t\t<Table className=\"print-table-responsive\">\n\t\t\t\t\t\t\t\t\t\t<TableHeader>\n\t\t\t\t\t\t\t\t\t\t\t<TableRow>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.employeeName}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.date}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.day}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.clockInTime}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.clockOutTime}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.location}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.workDescription}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.lunchDuration}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.hours}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.hourlyRate}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.pay}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t\t\t</TableHeader>\n\t\t\t\t\t\t\t\t\t\t<TableBody className=\"print-table-responsive\">\n\t\t\t\t\t\t\t\t\t\t\t{detailedTimeCards.map((tc) => {\n\t\t\t\t\t\t\t\t\t\t\t\tconst user = users.find(u => u.id === tc.user_id);\n\t\t\t\t\t\t\t\t\t\t\t\tconst hourlyRate = user?.hourly_rate || 0;\n\t\t\t\t\t\t\t\t\t\t\t\tconst pay = tc.total_hours ? tc.total_hours * hourlyRate : 0;\n\n\t\t\t\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<TableRow key={tc.id}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"font-medium whitespace-nowrap\">{user?.name || \"Unknown\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatDateOnly(tc.clock_in_timestamp)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{getDayOfWeek(tc.clock_in_timestamp)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatDate(tc.clock_in_timestamp)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{tc.clock_out_timestamp ? formatDate(tc.clock_out_timestamp) : \"—\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell>{tc.location || \"—\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"allow-wrap max-w-xs\">{tc.work_description || \"—\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{tc.lunch_duration_minutes ? `${Math.round(tc.lunch_duration_minutes)} min` : \"—\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{tc.total_hours ? `${tc.total_hours.toFixed(2)} hrs` : \"—\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{formatPay(hourlyRate)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{formatPay(pay)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t\t\t\t</TableBody>\n\t\t\t\t\t\t\t\t\t</Table>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</>\n\t\t\t\t\t)}\n\t\t\t\t</CardContent>\n\t\t\t</Card>\n\t\t</div>\n\t);\n}\n\nfunction EmployeesTab({ users, language, onUsersChange }: { users: UserModel[]; language: Language; onUsersChange: () => void }) {\n\tconst [showAddEmployee, setShowAddEmployee] = useState(false);\n\tconst [editingEmployee, setEditingEmployee] = useState<UserModel | null>(null);\n\tconst [employeeName, setEmployeeName] = useState(\"\");\n\tconst [employeeEmail, setEmployeeEmail] = useState(\"\");\n\tconst [employeePhone, setEmployeePhone] = useState(\"\");\n\tconst [employeeRole, setEmployeeRole] = useState<UserRole>(UserRole.Employee);\n\tconst [employeeHourlyRate, setEmployeeHourlyRate] = useState(\"\");\n\tconst [deleteConfirm, setDeleteConfirm] = useState<UserModel | null>(null);\n\n\tconst t = translations[language];\n\n\tconst handleAddEmployee = async () => {\n\t\tconst userORM = UserORM.getInstance();\n\t\tawait userORM.insertUser([{\n\t\t\tname: employeeName,\n\t\t\temail: employeeEmail,\n\t\t\tphone: employeePhone || null,\n\t\t\trole: employeeRole,\n\t\t\thourly_rate: employeeHourlyRate ? parseFloat(employeeHourlyRate) : null,\n\t\t} as UserModel]);\n\n\t\tsetShowAddEmployee(false);\n\t\tsetEmployeeName(\"\");\n\t\tsetEmployeeEmail(\"\");\n\t\tsetEmployeePhone(\"\");\n\t\tsetEmployeeRole(UserRole.Employee);\n\t\tsetEmployeeHourlyRate(\"\");\n\t\tonUsersChange();\n\t};\n\n\tconst handleEditEmployee = async () => {\n\t\tif (!editingEmployee) return;\n\n\t\tconst userORM = UserORM.getInstance();\n\t\tawait userORM.setUserById(editingEmployee.id, {\n\t\t\t...editingEmployee,\n\t\t\tname: employeeName,\n\t\t\temail: employeeEmail,\n\t\t\tphone: employeePhone || null,\n\t\t\trole: employeeRole,\n\t\t\thourly_rate: employeeHourlyRate ? parseFloat(employeeHourlyRate) : null,\n\t\t});\n\n\t\tsetEditingEmployee(null);\n\t\tsetEmployeeName(\"\");\n\t\tsetEmployeeEmail(\"\");\n\t\tsetEmployeePhone(\"\");\n\t\tsetEmployeeRole(UserRole.Employee);\n\t\tsetEmployeeHourlyRate(\"\");\n\t\tonUsersChange();\n\t};\n\n\tconst handleDeleteEmployee = async (user: UserModel) => {\n\t\tconst userORM = UserORM.getInstance();\n\t\tawait userORM.deleteUserById(user.id);\n\t\tsetDeleteConfirm(null);\n\t\tonUsersChange();\n\t};\n\n\tconst openEditDialog = (user: UserModel) => {\n\t\tsetEditingEmployee(user);\n\t\tsetEmployeeName(user.name);\n\t\tsetEmployeeEmail(user.email);\n\t\tsetEmployeePhone(user.phone || \"\");\n\t\tsetEmployeeRole(user.role);\n\t\tsetEmployeeHourlyRate(user.hourly_rate ? user.hourly_rate.toString() : \"\");\n\t};\n\n\treturn (\n\t\t<div className=\"space-y-4\">\n\t\t\t<Card>\n\t\t\t\t<CardHeader>\n\t\t\t\t\t<div className=\"flex justify-between items-center\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<CardTitle>{t.employees}</CardTitle>\n\t\t\t\t\t\t\t<CardDescription>Manage employee accounts</CardDescription>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<Button onClick={() => setShowAddEmployee(true)}>\n\t\t\t\t\t\t\t<UserPlus className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t\t\t{t.addEmployee}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t</CardHeader>\n\t\t\t\t<CardContent>\n\t\t\t\t\t<div className=\"overflow-x-auto\">\n\t\t\t\t\t\t<Table>\n\t\t\t\t\t\t\t<TableHeader>\n\t\t\t\t\t\t\t\t<TableRow>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.name}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.email}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.phone}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.role}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.hourlyRate}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.actions}</TableHead>\n\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t</TableHeader>\n\t\t\t\t\t\t\t<TableBody>\n\t\t\t\t\t\t\t\t{users.map((user) => (\n\t\t\t\t\t\t\t\t\t<TableRow key={user.id}>\n\t\t\t\t\t\t\t\t\t\t<TableCell className=\"font-medium\">{user.name}</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell>{user.email}</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell>{user.phone || \"—\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<Badge variant={user.role === UserRole.Manager ? \"default\" : \"secondary\"}>\n\t\t\t\t\t\t\t\t\t\t\t\t{user.role === UserRole.Manager ? t.manager : t.employee}\n\t\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t{user.hourly_rate ? `$${user.hourly_rate.toFixed(2)}/hr` : \"—\"}\n\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => openEditDialog(user)}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{t.edit}\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"destructive\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => setDeleteConfirm(user)}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{t.delete}\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</TableBody>\n\t\t\t\t\t\t</Table>\n\t\t\t\t\t</div>\n\t\t\t\t</CardContent>\n\t\t\t</Card>\n\n\t\t\t<Dialog open={showAddEmployee} onOpenChange={setShowAddEmployee}>\n\t\t\t\t<DialogContent>\n\t\t\t\t\t<DialogHeader>\n\t\t\t\t\t\t<DialogTitle>{t.addEmployee}</DialogTitle>\n\t\t\t\t\t</DialogHeader>\n\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.name}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\tvalue={employeeName}\n\t\t\t\t\t\t\t\tonChange={(e) => setEmployeeName(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder=\"John Doe\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.email}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"email\"\n\t\t\t\t\t\t\t\tvalue={employeeEmail}\n\t\t\t\t\t\t\t\tonChange={(e) => setEmployeeEmail(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder=\"john@example.com\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.phone}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"tel\"\n\t\t\t\t\t\t\t\tvalue={employeePhone}\n\t\t\t\t\t\t\t\tonChange={(e) => setEmployeePhone(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder=\"+1 (555) 123-4567\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.role}</Label>\n\t\t\t\t\t\t\t<Select value={employeeRole.toString()} onValueChange={(v) => setEmployeeRole(parseInt(v))}>\n\t\t\t\t\t\t\t\t<SelectTrigger>\n\t\t\t\t\t\t\t\t\t<SelectValue />\n\t\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t\t<SelectItem value={UserRole.Employee.toString()}>{t.employee}</SelectItem>\n\t\t\t\t\t\t\t\t\t<SelectItem value={UserRole.Manager.toString()}>{t.manager}</SelectItem>\n\t\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t\t</Select>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.hourlyRate}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\tmin=\"0\"\n\t\t\t\t\t\t\t\tstep=\"0.01\"\n\t\t\t\t\t\t\t\tvalue={employeeHourlyRate}\n\t\t\t\t\t\t\t\tonChange={(e) => setEmployeeHourlyRate(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder=\"15.00\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<DialogFooter>\n\t\t\t\t\t\t<Button variant=\"outline\" onClick={() => setShowAddEmployee(false)}>\n\t\t\t\t\t\t\t{t.cancel}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button onClick={handleAddEmployee} disabled={!employeeName || !employeeEmail}>\n\t\t\t\t\t\t\t{t.saveChanges}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</DialogFooter>\n\t\t\t\t</DialogContent>\n\t\t\t</Dialog>\n\n\t\t\t<Dialog open={!!editingEmployee} onOpenChange={(open) => !open && setEditingEmployee(null)}>\n\t\t\t\t<DialogContent>\n\t\t\t\t\t<DialogHeader>\n\t\t\t\t\t\t<DialogTitle>{t.editEmployee}</DialogTitle>\n\t\t\t\t\t</DialogHeader>\n\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.name}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\tvalue={employeeName}\n\t\t\t\t\t\t\t\tonChange={(e) => setEmployeeName(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.email}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"email\"\n\t\t\t\t\t\t\t\tvalue={employeeEmail}\n\t\t\t\t\t\t\t\tonChange={(e) => setEmployeeEmail(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.phone}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"tel\"\n\t\t\t\t\t\t\t\tvalue={employeePhone}\n\t\t\t\t\t\t\t\tonChange={(e) => setEmployeePhone(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder=\"+1 (555) 123-4567\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.role}</Label>\n\t\t\t\t\t\t\t<Select value={employeeRole.toString()} onValueChange={(v) => setEmployeeRole(parseInt(v))}>\n\t\t\t\t\t\t\t\t<SelectTrigger>\n\t\t\t\t\t\t\t\t\t<SelectValue />\n\t\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t\t<SelectItem value={UserRole.Employee.toString()}>{t.employee}</SelectItem>\n\t\t\t\t\t\t\t\t\t<SelectItem value={UserRole.Manager.toString()}>{t.manager}</SelectItem>\n\t\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t\t</Select>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.hourlyRate}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\tmin=\"0\"\n\t\t\t\t\t\t\t\tstep=\"0.01\"\n\t\t\t\t\t\t\t\tvalue={employeeHourlyRate}\n\t\t\t\t\t\t\t\tonChange={(e) => setEmployeeHourlyRate(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder=\"15.00\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<DialogFooter>\n\t\t\t\t\t\t<Button variant=\"outline\" onClick={() => setEditingEmployee(null)}>\n\t\t\t\t\t\t\t{t.cancel}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button onClick={handleEditEmployee}>\n\t\t\t\t\t\t\t{t.saveChanges}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</DialogFooter>\n\t\t\t\t</DialogContent>\n\t\t\t</Dialog>\n\n\t\t\t<Dialog open={!!deleteConfirm} onOpenChange={(open) => !open && setDeleteConfirm(null)}>\n\t\t\t\t<DialogContent>\n\t\t\t\t\t<DialogHeader>\n\t\t\t\t\t\t<DialogTitle>{t.deleteEmployee}</DialogTitle>\n\t\t\t\t\t</DialogHeader>\n\t\t\t\t\t<p>{t.confirmDelete}</p>\n\t\t\t\t\t<p className=\"font-semibold\">{deleteConfirm?.name}</p>\n\t\t\t\t\t<DialogFooter>\n\t\t\t\t\t\t<Button variant=\"outline\" onClick={() => setDeleteConfirm(null)}>\n\t\t\t\t\t\t\t{t.cancel}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button variant=\"destructive\" onClick={() => deleteConfirm && handleDeleteEmployee(deleteConfirm)}>\n\t\t\t\t\t\t\t{t.delete}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</DialogFooter>\n\t\t\t\t</DialogContent>\n\t\t\t</Dialog>\n\t\t</div>\n\t);\n}\n\nfunction ManualEntryDialog({\n\topen,\n\tonClose,\n\tuserId,\n\tonSave,\n\tlanguage,\n\tusers\n}: {\n\topen: boolean;\n\tonClose: () => void;\n\tuserId: string;\n\tonSave: () => void;\n\tlanguage: Language;\n\tusers?: UserModel[];\n}) {\n\tconst [selectedUser, setSelectedUser] = useState(userId);\n\tconst [clockIn, setClockIn] = useState(\"\");\n\tconst [clockOut, setClockOut] = useState(\"\");\n\tconst [location, setLocation] = useState(\"\");\n\tconst [workDescription, setWorkDescription] = useState(\"\");\n\tconst [lunchStart, setLunchStart] = useState(\"\");\n\tconst [lunchEnd, setLunchEnd] = useState(\"\");\n\n\tconst t = translations[language];\n\n\tuseEffect(() => {\n\t\tif (open) {\n\t\t\tsetSelectedUser(userId);\n\t\t\t// Set default to today\n\t\t\tconst now = new Date();\n\t\t\tconst today = now.toISOString().slice(0, 10);\n\t\t\tsetClockIn(`${today}T09:00`);\n\t\t\tsetClockOut(`${today}T17:00`);\n\t\t\tsetLocation(\"\");\n\t\t\tsetWorkDescription(\"\");\n\t\t\tsetLunchStart(`${today}T12:00`);\n\t\t\tsetLunchEnd(`${today}T13:00`);\n\t\t}\n\t}, [open, userId]);\n\n\tconst handleSave = async () => {\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\n\t\tconst clockInTimestamp = Math.floor(new Date(clockIn).getTime() / 1000).toString();\n\t\tconst clockOutTimestamp = clockOut ? Math.floor(new Date(clockOut).getTime() / 1000).toString() : undefined;\n\t\tconst lunchStartTimestamp = lunchStart ? Math.floor(new Date(lunchStart).getTime() / 1000).toString() : undefined;\n\t\tconst lunchEndTimestamp = lunchEnd ? Math.floor(new Date(lunchEnd).getTime() / 1000).toString() : undefined;\n\n\t\tlet totalHours: number | undefined = undefined;\n\t\tlet lunchDurationMinutes: number | undefined = undefined;\n\n\t\t// Calculate lunch duration\n\t\tif (lunchStartTimestamp && lunchEndTimestamp) {\n\t\t\tconst lunchStartTime = parseInt(lunchStartTimestamp);\n\t\t\tconst lunchEndTime = parseInt(lunchEndTimestamp);\n\t\t\tlunchDurationMinutes = (lunchEndTime - lunchStartTime) / 60;\n\t\t}\n\n\t\t// Calculate total hours\n\t\tif (clockOutTimestamp) {\n\t\t\tconst clockInTime = parseInt(clockInTimestamp);\n\t\t\tconst clockOutTime = parseInt(clockOutTimestamp);\n\t\t\ttotalHours = (clockOutTime - clockInTime) / 3600;\n\n\t\t\t// Deduct lunch time\n\t\t\tif (lunchDurationMinutes) {\n\t\t\t\ttotalHours -= lunchDurationMinutes / 60;\n\t\t\t}\n\t\t}\n\n\t\tconst entryData = {\n\t\t\tuser_id: selectedUser,\n\t\t\tclock_in_timestamp: clockInTimestamp,\n\t\t\tclock_out_timestamp: clockOutTimestamp,\n\t\t\ttotal_hours: totalHours,\n\t\t\tlocation: location || undefined,\n\t\t\twork_description: workDescription || undefined,\n\t\t\tlunch_start_timestamp: lunchStartTimestamp,\n\t\t\tlunch_end_timestamp: lunchEndTimestamp,\n\t\t\tlunch_duration_minutes: lunchDurationMinutes,\n\t\t} as TimeCardEntryModel;\n\n\t\tconst normalizedEntry = normalizeTimeCardEntryForSave(entryData);\n\t\tawait timeCardORM.insertTimeCardEntry([normalizedEntry as TimeCardEntryModel]);\n\n\t\tonSave();\n\t\tonClose();\n\t};\n\n\treturn (\n\t\t<Dialog open={open} onOpenChange={onClose}>\n\t\t\t<DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n\t\t\t\t<DialogHeader>\n\t\t\t\t\t<DialogTitle>{t.addManualEntry}</DialogTitle>\n\t\t\t\t</DialogHeader>\n\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t{users && (\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.employeeName}</Label>\n\t\t\t\t\t\t\t<Select value={selectedUser} onValueChange={setSelectedUser}>\n\t\t\t\t\t\t\t\t<SelectTrigger>\n\t\t\t\t\t\t\t\t\t<SelectValue />\n\t\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t\t{users.filter(u => u.role === UserRole.Employee).map((u) => (\n\t\t\t\t\t\t\t\t\t\t<SelectItem key={u.id} value={u.id}>\n\t\t\t\t\t\t\t\t\t\t\t{u.name}\n\t\t\t\t\t\t\t\t\t\t</SelectItem>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t\t</Select>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t\t<div className=\"grid grid-cols-2 gap-4\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.clockInTime}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\tvalue={clockIn}\n\t\t\t\t\t\t\t\tonChange={(e) => setClockIn(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.clockOutTime}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\tvalue={clockOut}\n\t\t\t\t\t\t\t\tonChange={(e) => setClockOut(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<Label>{t.location}</Label>\n\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\tvalue={location}\n\t\t\t\t\t\t\tonChange={(e) => setLocation(e.target.value)}\n\t\t\t\t\t\t\tplaceholder={t.locationPlaceholder}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<Label>{t.workDescription}</Label>\n\t\t\t\t\t\t<Textarea\n\t\t\t\t\t\t\tvalue={workDescription}\n\t\t\t\t\t\t\tonChange={(e) => setWorkDescription(e.target.value)}\n\t\t\t\t\t\t\tplaceholder={t.descriptionPlaceholder}\n\t\t\t\t\t\t\trows={4}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"grid grid-cols-2 gap-4\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.lunchStartTime} ({language === 'en' ? 'Optional' : 'Opcional'})</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\tvalue={lunchStart}\n\t\t\t\t\t\t\t\tonChange={(e) => setLunchStart(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.lunchEndTime} ({language === 'en' ? 'Optional' : 'Opcional'})</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\tvalue={lunchEnd}\n\t\t\t\t\t\t\t\tonChange={(e) => setLunchEnd(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<DialogFooter>\n\t\t\t\t\t<Button variant=\"outline\" onClick={onClose}>\n\t\t\t\t\t\t{t.cancel}\n\t\t\t\t\t</Button>\n\t\t\t\t\t<Button onClick={handleSave} disabled={!selectedUser || !clockIn}>\n\t\t\t\t\t\t{t.saveChanges}\n\t\t\t\t\t</Button>\n\t\t\t\t</DialogFooter>\n\t\t\t</DialogContent>\n\t\t</Dialog>\n\t);\n}\n","structuredPatch":[{"oldStart":2066,"oldLines":6,"newStart":2066,"newLines":15,"lines":["     setEmployeeHourlyRate(user.hourly_rate ? user.hourly_rate.toString() : \"\");","   };"," ","+  const copyEmployeeLink = (userId: string) => {","+    const baseUrl = window.location.origin + window.location.pathname;","+    const employeeUrl = `${baseUrl}?employee=${userId}`;","+","+    navigator.clipboard.writeText(employeeUrl).then(() => {","+      alert(t.employeeLinkCopied);","+    });","+  };","+","   return (","     <div className=\"space-y-4\">","       <Card>"]}],"userModified":false,"replaceAll":false}}
{"type":"assistant","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_vrtx_01HVAQAoPWYSm7uPkMm2t9Gx","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me read the table body section to add the copy link button:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":0,"cache_creation_input_tokens":982,"cache_read_input_tokens":53911,"cache_creation":{"ephemeral_5m_input_tokens":982,"ephemeral_1h_input_tokens":0},"output_tokens":2},"context_management":null},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"9c3d6bae-1d8c-40f2-b778-f093291b0013"}
{"type":"assistant","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_vrtx_01HVAQAoPWYSm7uPkMm2t9Gx","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_vrtx_01TQweYnCxbDuMJ12bXrtesb","name":"Read","input":{"file_path":"/home/user/vite-template/src/routes/index.tsx","offset":2111,"limit":30}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":0,"cache_creation_input_tokens":982,"cache_read_input_tokens":53911,"cache_creation":{"ephemeral_5m_input_tokens":982,"ephemeral_1h_input_tokens":0},"output_tokens":120},"context_management":null},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"53e5bc90-e6bc-498e-b8ee-464dfc385506"}
{"type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_vrtx_01TQweYnCxbDuMJ12bXrtesb","type":"tool_result","content":"  2111→\t\t\t\t\t\t\t\t\t\t<TableCell>{user.phone || \"—\"}</TableCell>\n  2112→\t\t\t\t\t\t\t\t\t\t<TableCell>\n  2113→\t\t\t\t\t\t\t\t\t\t\t<Badge variant={user.role === UserRole.Manager ? \"default\" : \"secondary\"}>\n  2114→\t\t\t\t\t\t\t\t\t\t\t\t{user.role === UserRole.Manager ? t.manager : t.employee}\n  2115→\t\t\t\t\t\t\t\t\t\t\t</Badge>\n  2116→\t\t\t\t\t\t\t\t\t\t</TableCell>\n  2117→\t\t\t\t\t\t\t\t\t\t<TableCell>\n  2118→\t\t\t\t\t\t\t\t\t\t\t{user.hourly_rate ? `$${user.hourly_rate.toFixed(2)}/hr` : \"—\"}\n  2119→\t\t\t\t\t\t\t\t\t\t</TableCell>\n  2120→\t\t\t\t\t\t\t\t\t\t<TableCell>\n  2121→\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex gap-2\">\n  2122→\t\t\t\t\t\t\t\t\t\t\t\t<Button\n  2123→\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n  2124→\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n  2125→\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => openEditDialog(user)}\n  2126→\t\t\t\t\t\t\t\t\t\t\t\t>\n  2127→\t\t\t\t\t\t\t\t\t\t\t\t\t{t.edit}\n  2128→\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n  2129→\t\t\t\t\t\t\t\t\t\t\t\t<Button\n  2130→\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"destructive\"\n  2131→\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n  2132→\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => setDeleteConfirm(user)}\n  2133→\t\t\t\t\t\t\t\t\t\t\t\t>\n  2134→\t\t\t\t\t\t\t\t\t\t\t\t\t{t.delete}\n  2135→\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n  2136→\t\t\t\t\t\t\t\t\t\t\t</div>\n  2137→\t\t\t\t\t\t\t\t\t\t</TableCell>\n  2138→\t\t\t\t\t\t\t\t\t</TableRow>\n  2139→\t\t\t\t\t\t\t\t))}\n  2140→\t\t\t\t\t\t\t</TableBody>\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"a835b82c-6ae1-4930-8f21-ff5475ab4001","tool_use_result":{"type":"text","file":{"filePath":"/home/user/vite-template/src/routes/index.tsx","content":"\t\t\t\t\t\t\t\t\t\t<TableCell>{user.phone || \"—\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<Badge variant={user.role === UserRole.Manager ? \"default\" : \"secondary\"}>\n\t\t\t\t\t\t\t\t\t\t\t\t{user.role === UserRole.Manager ? t.manager : t.employee}\n\t\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t{user.hourly_rate ? `$${user.hourly_rate.toFixed(2)}/hr` : \"—\"}\n\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => openEditDialog(user)}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{t.edit}\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"destructive\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => setDeleteConfirm(user)}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{t.delete}\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</TableBody>","numLines":30,"startLine":2111,"totalLines":2478}}}
{"type":"assistant","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_vrtx_01EJKJcLe3XREyhYMC7JrZLg","type":"message","role":"assistant","content":[{"type":"text","text":"Now I'll add the \"Copy Employee Link\" button for employees only:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":0,"cache_creation_input_tokens":583,"cache_read_input_tokens":54893,"cache_creation":{"ephemeral_5m_input_tokens":583,"ephemeral_1h_input_tokens":0},"output_tokens":1},"context_management":null},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"90f2a32e-45ec-42ee-a2c5-369f37cf37dc"}
{"type":"assistant","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_vrtx_01EJKJcLe3XREyhYMC7JrZLg","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_vrtx_01YQRBcTwKCmntpxAHK3svRU","name":"Edit","input":{"file_path":"/home/user/vite-template/src/routes/index.tsx","old_string":"\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => openEditDialog(user)}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{t.edit}\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"destructive\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => setDeleteConfirm(user)}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{t.delete}\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</TableCell>","new_string":"\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex gap-2 flex-wrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t{user.role === UserRole.Employee && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"secondary\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => copyEmployeeLink(user.id)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{t.copyEmployeeLink}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => openEditDialog(user)}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{t.edit}\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"destructive\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => setDeleteConfirm(user)}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{t.delete}\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</TableCell>"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":0,"cache_creation_input_tokens":583,"cache_read_input_tokens":54893,"cache_creation":{"ephemeral_5m_input_tokens":583,"ephemeral_1h_input_tokens":0},"output_tokens":1},"context_management":null},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"548fe114-cc2b-4745-994b-01f20c01ddeb"}
{"type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_vrtx_01YQRBcTwKCmntpxAHK3svRU","type":"tool_result","content":"The file /home/user/vite-template/src/routes/index.tsx has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n  2116→\t\t\t\t\t\t\t\t\t\t</TableCell>\n  2117→\t\t\t\t\t\t\t\t\t\t<TableCell>\n  2118→\t\t\t\t\t\t\t\t\t\t\t{user.hourly_rate ? `$${user.hourly_rate.toFixed(2)}/hr` : \"—\"}\n  2119→\t\t\t\t\t\t\t\t\t\t</TableCell>\n  2120→\t\t\t\t\t\t\t\t\t\t<TableCell>\n  2121→\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex gap-2 flex-wrap\">\n  2122→\t\t\t\t\t\t\t\t\t\t\t\t{user.role === UserRole.Employee && (\n  2123→\t\t\t\t\t\t\t\t\t\t\t\t\t<Button\n  2124→\t\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"secondary\"\n  2125→\t\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n  2126→\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => copyEmployeeLink(user.id)}\n  2127→\t\t\t\t\t\t\t\t\t\t\t\t\t>\n  2128→\t\t\t\t\t\t\t\t\t\t\t\t\t\t{t.copyEmployeeLink}\n  2129→\t\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n  2130→\t\t\t\t\t\t\t\t\t\t\t\t)}\n  2131→\t\t\t\t\t\t\t\t\t\t\t\t<Button\n  2132→\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n  2133→\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n  2134→\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => openEditDialog(user)}\n  2135→\t\t\t\t\t\t\t\t\t\t\t\t>\n  2136→\t\t\t\t\t\t\t\t\t\t\t\t\t{t.edit}\n  2137→\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n  2138→\t\t\t\t\t\t\t\t\t\t\t\t<Button\n  2139→\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"destructive\"\n  2140→\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n  2141→\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => setDeleteConfirm(user)}\n  2142→\t\t\t\t\t\t\t\t\t\t\t\t>\n  2143→\t\t\t\t\t\t\t\t\t\t\t\t\t{t.delete}\n  2144→\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n  2145→\t\t\t\t\t\t\t\t\t\t\t</div>\n  2146→\t\t\t\t\t\t\t\t\t\t</TableCell>\n  2147→\t\t\t\t\t\t\t\t\t</TableRow>\n  2148→\t\t\t\t\t\t\t\t))}\n  2149→\t\t\t\t\t\t\t</TableBody>\n  2150→\t\t\t\t\t\t</Table>"}]},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"b3ef68b8-7acc-4b10-a583-db5ca242e109","tool_use_result":{"filePath":"/home/user/vite-template/src/routes/index.tsx","oldString":"\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => openEditDialog(user)}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{t.edit}\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"destructive\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => setDeleteConfirm(user)}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{t.delete}\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</TableCell>","newString":"\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex gap-2 flex-wrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t{user.role === UserRole.Employee && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"secondary\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => copyEmployeeLink(user.id)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{t.copyEmployeeLink}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => openEditDialog(user)}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{t.edit}\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"destructive\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => setDeleteConfirm(user)}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{t.delete}\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</TableCell>","originalFile":"import { createFileRoute } from \"@tanstack/react-router\";\nimport { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from \"@/components/ui/dialog\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Clock, Users, CalendarDays, Timer, Languages, Coffee, UserPlus, FileText, AlertCircle, Plus, Trash2, Heart } from \"lucide-react\";\nimport { UserORM, type UserModel, UserRole } from \"@/sdk/database/orm/orm_user\";\nimport { TimeCardEntryORM, type TimeCardEntryModel } from \"@/sdk/database/orm/orm_time_card_entry\";\nimport { SickDayORM, type SickDayModel } from \"@/sdk/database/orm/orm_sick_day\";\nimport { normalizeTimeCardEntryForSave, normalizeTimeCardEntriesFromORM, isActiveShift, isOnLunchBreak } from \"@/lib/orm-data-helpers\";\n\nexport const Route = createFileRoute(\"/\")({\n\tcomponent: App,\n});\n\ntype Language = 'en' | 'es';\n\nconst translations = {\n\ten: {\n\t\tappTitle: \"Employee Time Tracking\",\n\t\tselectAccount: \"Select your account to continue\",\n\t\tselectUser: \"Select User\",\n\t\tchooseAccount: \"Choose your account\",\n\t\tmanager: \"Manager\",\n\t\temployee: \"Employee\",\n\t\tswitchUser: \"Switch User\",\n\t\ttimeTrackingSystem: \"Time Tracking System\",\n\t\twelcome: \"Welcome\",\n\t\tclockInOut: \"Clock In/Out\",\n\t\tcurrentlyClocked: \"Currently Clocked In\",\n\t\tsince: \"Since\",\n\t\telapsedTime: \"Elapsed Time\",\n\t\tclockOut: \"Clock Out\",\n\t\tnotClocked: \"Not currently clocked in\",\n\t\tclockIn: \"Clock In\",\n\t\ttimeCardHistory: \"Time Card History\",\n\t\trecentRecords: \"Your recent clock in/out records\",\n\t\tnoTimeCards: \"No time cards yet\",\n\t\tclockInTime: \"Clock In\",\n\t\tclockOutTime: \"Clock Out\",\n\t\thours: \"Hours\",\n\t\tstatus: \"Status\",\n\t\tcompleted: \"Completed\",\n\t\tactive: \"Active\",\n\t\ttotalEmployees: \"Total Employees\",\n\t\thoursToday: \"Hours Today\",\n\t\thoursThisWeek: \"Hours This Week\",\n\t\tallEmployeeTimeCards: \"All Employee Time Cards\",\n\t\tviewManageRecords: \"View and manage all employee time records\",\n\t\tfilterByEmployee: \"Filter by Employee\",\n\t\tallEmployees: \"All Employees\",\n\t\tfilterByDate: \"Filter by Date\",\n\t\tclearFilters: \"Clear Filters\",\n\t\tnoTimeCardsFound: \"No time cards found\",\n\t\temployeeName: \"Employee\",\n\t\tactions: \"Actions\",\n\t\tedit: \"Edit\",\n\t\teditTimeCard: \"Edit Time Card\",\n\t\tcancel: \"Cancel\",\n\t\tsaveChanges: \"Save Changes\",\n\t\tlocation: \"Location\",\n\t\twhereWorked: \"Where did you work?\",\n\t\tworkDescription: \"Work Description\",\n\t\twhatDid: \"What did you do today?\",\n\t\tlocationPlaceholder: \"e.g., Office, Remote, Client Site\",\n\t\tdescriptionPlaceholder: \"Describe your work activities...\",\n\t\tstartLunch: \"Start Lunch Break\",\n\t\tendLunch: \"End Lunch Break\",\n\t\tonLunchBreak: \"On Lunch Break\",\n\t\tlunchBreak: \"Lunch Break\",\n\t\tlunchDuration: \"Lunch\",\n\t\tlunchStartTime: \"Lunch Start\",\n\t\tlunchEndTime: \"Lunch End\",\n\t\ttimeCards: \"Time Cards\",\n\t\treports: \"Reports\",\n\t\temployees: \"Employees\",\n\t\taddEmployee: \"Add Employee\",\n\t\teditEmployee: \"Edit Employee\",\n\t\tdeleteEmployee: \"Delete Employee\",\n\t\tname: \"Name\",\n\t\temail: \"Email\",\n\t\tphone: \"Phone\",\n\t\trole: \"Role\",\n\t\tdelete: \"Delete\",\n\t\tweeklyReport: \"Weekly Report\",\n\t\tselectWeek: \"Select Week\",\n\t\tregularHours: \"Regular\",\n\t\tovertimeHours: \"Overtime\",\n\t\ttotalHours: \"Total\",\n\t\tnoReportData: \"No data for selected week\",\n\t\taddTimeCard: \"Add Time Card\",\n\t\tmanualEntry: \"Manual Entry\",\n\t\taddManualEntry: \"Add Manual Time Card\",\n\t\tconfirmDelete: \"Are you sure you want to delete this employee?\",\n\t\tovertimeAlert: \"Overtime Alert\",\n\t\tprintReport: \"Print Report\",\n\t\texportCSV: \"Export to CSV\",\n\t\tdetailedReport: \"Detailed Time Card Report\",\n\t\tdate: \"Date\",\n\t\tday: \"Day\",\n\t\tdeleteTimeCard: \"Delete Time Card\",\n\t\tconfirmDeleteTimeCard: \"Are you sure you want to delete this time card? This action cannot be undone.\",\n\t\tsickDays: \"Sick Days\",\n\t\taddSickDay: \"Add Sick Day\",\n\t\tsickDayDate: \"Sick Day Date\",\n\t\tsickDayHours: \"Hours\",\n\t\tsickDayNotes: \"Notes/Reason\",\n\t\tsickDayNotesPlaceholder: \"e.g., Doctor's appointment, flu, etc.\",\n\t\tmySickDays: \"My Sick Days\",\n\t\tnoSickDays: \"No sick days recorded\",\n\t\ttotalSickDays: \"Total Sick Days\",\n\t\tdeleteSickDay: \"Delete Sick Day\",\n\t\tconfirmDeleteSickDay: \"Are you sure you want to delete this sick day? This action cannot be undone.\",\n\t\tsickDayHistory: \"Sick Day History\",\n\t\thourlyRate: \"Hourly Rate\",\n\t\tpay: \"Pay\",\n\t\ttotalPay: \"Total Pay\",\n\t\tregularPay: \"Regular Pay\",\n\t\tovertimePay: \"Overtime Pay\",\n\t\tcopyEmployeeLink: \"Copy Employee Link\",\n\t\temployeeLinkCopied: \"Employee link copied!\",\n\t\tmyTimeTracking: \"My Time Tracking\",\n\t\tmyHours: \"My Hours\",\n\t},\n\tes: {\n\t\tappTitle: \"Registro de Tiempo de Empleados\",\n\t\tselectAccount: \"Selecciona tu cuenta para continuar\",\n\t\tselectUser: \"Seleccionar Usuario\",\n\t\tchooseAccount: \"Elige tu cuenta\",\n\t\tmanager: \"Gerente\",\n\t\temployee: \"Empleado\",\n\t\tswitchUser: \"Cambiar Usuario\",\n\t\ttimeTrackingSystem: \"Sistema de Registro de Tiempo\",\n\t\twelcome: \"Bienvenido\",\n\t\tclockInOut: \"Entrada/Salida\",\n\t\tcurrentlyClocked: \"Actualmente Registrado\",\n\t\tsince: \"Desde\",\n\t\telapsedTime: \"Tiempo Transcurrido\",\n\t\tclockOut: \"Registrar Salida\",\n\t\tnotClocked: \"No está registrado actualmente\",\n\t\tclockIn: \"Registrar Entrada\",\n\t\ttimeCardHistory: \"Historial de Tarjetas de Tiempo\",\n\t\trecentRecords: \"Tus registros recientes de entrada/salida\",\n\t\tnoTimeCards: \"No hay tarjetas de tiempo todavía\",\n\t\tclockInTime: \"Entrada\",\n\t\tclockOutTime: \"Salida\",\n\t\thours: \"Horas\",\n\t\tstatus: \"Estado\",\n\t\tcompleted: \"Completado\",\n\t\tactive: \"Activo\",\n\t\ttotalEmployees: \"Total de Empleados\",\n\t\thoursToday: \"Horas Hoy\",\n\t\thoursThisWeek: \"Horas Esta Semana\",\n\t\tallEmployeeTimeCards: \"Todas las Tarjetas de Tiempo\",\n\t\tviewManageRecords: \"Ver y gestionar todos los registros de empleados\",\n\t\tfilterByEmployee: \"Filtrar por Empleado\",\n\t\tallEmployees: \"Todos los Empleados\",\n\t\tfilterByDate: \"Filtrar por Fecha\",\n\t\tclearFilters: \"Limpiar Filtros\",\n\t\tnoTimeCardsFound: \"No se encontraron tarjetas de tiempo\",\n\t\temployeeName: \"Empleado\",\n\t\tactions: \"Acciones\",\n\t\tedit: \"Editar\",\n\t\teditTimeCard: \"Editar Tarjeta de Tiempo\",\n\t\tcancel: \"Cancelar\",\n\t\tsaveChanges: \"Guardar Cambios\",\n\t\tlocation: \"Ubicación\",\n\t\twhereWorked: \"¿Dónde trabajaste?\",\n\t\tworkDescription: \"Descripción del Trabajo\",\n\t\twhatDid: \"¿Qué hiciste hoy?\",\n\t\tlocationPlaceholder: \"ej., Oficina, Remoto, Sitio del Cliente\",\n\t\tdescriptionPlaceholder: \"Describe tus actividades laborales...\",\n\t\tstartLunch: \"Iniciar Almuerzo\",\n\t\tendLunch: \"Terminar Almuerzo\",\n\t\tonLunchBreak: \"En Almuerzo\",\n\t\tlunchBreak: \"Almuerzo\",\n\t\tlunchDuration: \"Almuerzo\",\n\t\tlunchStartTime: \"Inicio Almuerzo\",\n\t\tlunchEndTime: \"Fin Almuerzo\",\n\t\ttimeCards: \"Tarjetas de Tiempo\",\n\t\treports: \"Informes\",\n\t\temployees: \"Empleados\",\n\t\taddEmployee: \"Agregar Empleado\",\n\t\teditEmployee: \"Editar Empleado\",\n\t\tdeleteEmployee: \"Eliminar Empleado\",\n\t\tname: \"Nombre\",\n\t\temail: \"Correo\",\n\t\tphone: \"Teléfono\",\n\t\trole: \"Rol\",\n\t\tdelete: \"Eliminar\",\n\t\tweeklyReport: \"Informe Semanal\",\n\t\tselectWeek: \"Seleccionar Semana\",\n\t\tregularHours: \"Regular\",\n\t\tovertimeHours: \"Tiempo Extra\",\n\t\ttotalHours: \"Total\",\n\t\tnoReportData: \"No hay datos para la semana seleccionada\",\n\t\taddTimeCard: \"Agregar Tarjeta\",\n\t\tmanualEntry: \"Entrada Manual\",\n\t\taddManualEntry: \"Agregar Tarjeta Manual\",\n\t\tconfirmDelete: \"¿Está seguro de eliminar este empleado?\",\n\t\tovertimeAlert: \"Alerta de Tiempo Extra\",\n\t\tprintReport: \"Imprimir Informe\",\n\t\texportCSV: \"Exportar a CSV\",\n\t\tdetailedReport: \"Informe Detallado de Tarjetas de Tiempo\",\n\t\tdate: \"Fecha\",\n\t\tday: \"Día\",\n\t\tdeleteTimeCard: \"Eliminar Tarjeta de Tiempo\",\n\t\tconfirmDeleteTimeCard: \"¿Está seguro de eliminar esta tarjeta de tiempo? Esta acción no se puede deshacer.\",\n\t\tsickDays: \"Días de Enfermedad\",\n\t\taddSickDay: \"Agregar Día de Enfermedad\",\n\t\tsickDayDate: \"Fecha de Enfermedad\",\n\t\tsickDayHours: \"Horas\",\n\t\tsickDayNotes: \"Notas/Razón\",\n\t\tsickDayNotesPlaceholder: \"ej., Cita médica, gripe, etc.\",\n\t\tmySickDays: \"Mis Días de Enfermedad\",\n\t\tnoSickDays: \"No hay días de enfermedad registrados\",\n\t\ttotalSickDays: \"Total Días de Enfermedad\",\n\t\tdeleteSickDay: \"Eliminar Día de Enfermedad\",\n\t\tconfirmDeleteSickDay: \"¿Está seguro de eliminar este día de enfermedad? Esta acción no se puede deshacer.\",\n\t\tsickDayHistory: \"Historial de Días de Enfermedad\",\n\t\thourlyRate: \"Tarifa por Hora\",\n\t\tpay: \"Pago\",\n\t\ttotalPay: \"Pago Total\",\n\t\tregularPay: \"Pago Regular\",\n\t\tovertimePay: \"Pago Tiempo Extra\",\n\t\tcopyEmployeeLink: \"Copiar Enlace de Empleado\",\n\t\temployeeLinkCopied: \"¡Enlace de empleado copiado!\",\n\t\tmyTimeTracking: \"Mi Registro de Tiempo\",\n\t\tmyHours: \"Mis Horas\",\n\t}\n};\n\nfunction App() {\n\tconst [currentUser, setCurrentUser] = useState<UserModel | null>(null);\n\tconst [users, setUsers] = useState<UserModel[]>([]);\n\tconst [showUserSelect, setShowUserSelect] = useState(true);\n\tconst [language, setLanguage] = useState<Language>('en');\n\tconst [employeeOnlyMode, setEmployeeOnlyMode] = useState(false);\n\n\tconst t = translations[language];\n\n\tuseEffect(() => {\n\t\tloadUsers();\n\t}, []);\n\n\t// Check for employee URL parameter and auto-login\n\tuseEffect(() => {\n\t\tif (users.length > 0 && !currentUser) {\n\t\t\tconst urlParams = new URLSearchParams(window.location.search);\n\t\t\tconst employeeId = urlParams.get('employee');\n\n\t\t\tif (employeeId) {\n\t\t\t\tconst user = users.find(u => u.id === employeeId && u.role === UserRole.Employee);\n\t\t\t\tif (user) {\n\t\t\t\t\tsetCurrentUser(user);\n\t\t\t\t\tsetShowUserSelect(false);\n\t\t\t\t\tsetEmployeeOnlyMode(true);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}, [users, currentUser]);\n\n\tconst loadUsers = async () => {\n\t\tconst userORM = UserORM.getInstance();\n\t\tconst allUsers = await userORM.getAllUser();\n\n\t\t// If no users exist, create demo users\n\t\tif (allUsers.length === 0) {\n\t\t\tconst demoUsers = await userORM.insertUser([\n\t\t\t\t{\n\t\t\t\t\tname: \"John Smith\",\n\t\t\t\t\temail: \"john@example.com\",\n\t\t\t\t\trole: UserRole.Employee,\n\t\t\t\t} as UserModel,\n\t\t\t\t{\n\t\t\t\t\tname: \"Sarah Johnson\",\n\t\t\t\t\temail: \"sarah@example.com\",\n\t\t\t\t\trole: UserRole.Employee,\n\t\t\t\t} as UserModel,\n\t\t\t\t{\n\t\t\t\t\tname: \"Mike Manager\",\n\t\t\t\t\temail: \"mike@example.com\",\n\t\t\t\t\trole: UserRole.Manager,\n\t\t\t\t} as UserModel,\n\t\t\t]);\n\t\t\tsetUsers(demoUsers);\n\t\t} else {\n\t\t\tsetUsers(allUsers);\n\t\t}\n\t};\n\n\tconst handleUserSelect = (userId: string) => {\n\t\tconst user = users.find(u => u.id === userId);\n\t\tif (user) {\n\t\t\tsetCurrentUser(user);\n\t\t\tsetShowUserSelect(false);\n\t\t}\n\t};\n\n\tconst handleLogout = () => {\n\t\tsetCurrentUser(null);\n\t\tsetShowUserSelect(true);\n\t};\n\n\tconst toggleLanguage = () => {\n\t\tsetLanguage(prev => prev === 'en' ? 'es' : 'en');\n\t};\n\n\tif (showUserSelect || !currentUser) {\n\t\treturn (\n\t\t\t<div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800 flex items-center justify-center p-4\">\n\t\t\t\t<div className=\"absolute top-4 right-4\">\n\t\t\t\t\t<Button onClick={toggleLanguage} variant=\"outline\" size=\"sm\">\n\t\t\t\t\t\t<Languages className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t\t{language === 'en' ? 'Español' : 'English'}\n\t\t\t\t\t</Button>\n\t\t\t\t</div>\n\t\t\t\t<Card className=\"w-full max-w-md\">\n\t\t\t\t\t<CardHeader>\n\t\t\t\t\t\t<CardTitle className=\"text-2xl\">{t.appTitle}</CardTitle>\n\t\t\t\t\t\t<CardDescription>{t.selectAccount}</CardDescription>\n\t\t\t\t\t</CardHeader>\n\t\t\t\t\t<CardContent className=\"space-y-4\">\n\t\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t\t<Label>{t.selectUser}</Label>\n\t\t\t\t\t\t\t<Select onValueChange={handleUserSelect}>\n\t\t\t\t\t\t\t\t<SelectTrigger className=\"w-full\">\n\t\t\t\t\t\t\t\t\t<SelectValue placeholder={t.chooseAccount} />\n\t\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t\t{users.map((user) => (\n\t\t\t\t\t\t\t\t\t\t<SelectItem key={user.id} value={user.id}>\n\t\t\t\t\t\t\t\t\t\t\t{user.name} - {user.role === UserRole.Manager ? t.manager : t.employee}\n\t\t\t\t\t\t\t\t\t\t</SelectItem>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t\t</Select>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</CardContent>\n\t\t\t\t</Card>\n\t\t\t</div>\n\t\t);\n\t}\n\n\treturn (\n\t\t<div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800\">\n\t\t\t<div className=\"container mx-auto p-6 space-y-6\">\n\t\t\t\t<div className=\"flex justify-between items-center\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<h1 className=\"text-3xl font-bold\">\n\t\t\t\t\t\t\t{employeeOnlyMode ? t.myTimeTracking : t.timeTrackingSystem}\n\t\t\t\t\t\t</h1>\n\t\t\t\t\t\t<p className=\"text-muted-foreground\">\n\t\t\t\t\t\t\t{t.welcome}, {currentUser.name} ({currentUser.role === UserRole.Manager ? t.manager : t.employee})\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"flex gap-2\">\n\t\t\t\t\t\t<Button onClick={toggleLanguage} variant=\"outline\" size=\"sm\">\n\t\t\t\t\t\t\t<Languages className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t\t\t{language === 'en' ? 'Español' : 'English'}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t{!employeeOnlyMode && (\n\t\t\t\t\t\t\t<Button onClick={handleLogout} variant=\"outline\">\n\t\t\t\t\t\t\t\t{t.switchUser}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t{currentUser.role === UserRole.Employee ? (\n\t\t\t\t\t<EmployeeView user={currentUser} language={language} />\n\t\t\t\t) : (\n\t\t\t\t\t<ManagerView user={currentUser} users={users} language={language} onUsersChange={loadUsers} />\n\t\t\t\t)}\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n\nfunction SickDayCard({ user, language }: { user: UserModel; language: Language }) {\n\tconst [sickDays, setSickDays] = useState<SickDayModel[]>([]);\n\tconst [showAddDialog, setShowAddDialog] = useState(false);\n\tconst [sickDate, setSickDate] = useState(\"\");\n\tconst [sickHours, setSickHours] = useState(\"8\");\n\tconst [sickNotes, setSickNotes] = useState(\"\");\n\n\tconst t = translations[language];\n\n\tuseEffect(() => {\n\t\tloadSickDays();\n\t}, [user.id]);\n\n\tconst loadSickDays = async () => {\n\t\tconst sickDayORM = SickDayORM.getInstance();\n\t\tconst userSickDays = await sickDayORM.getSickDayByUserId(user.id);\n\n\t\t// Sort by date (newest first)\n\t\tconst sorted = userSickDays.sort((a, b) =>\n\t\t\tnew Date(b.sick_date).getTime() - new Date(a.sick_date).getTime()\n\t\t);\n\n\t\tsetSickDays(sorted);\n\t};\n\n\tconst handleAddSickDay = async () => {\n\t\tif (!sickDate || !sickHours) {\n\t\t\talert(\"Please fill in date and hours\");\n\t\t\treturn;\n\t\t}\n\n\t\tconst sickDayORM = SickDayORM.getInstance();\n\t\tawait sickDayORM.insertSickDay([{\n\t\t\tuser_id: user.id,\n\t\t\tsick_date: sickDate,\n\t\t\thours: parseFloat(sickHours),\n\t\t\tnotes: sickNotes || null,\n\t\t} as SickDayModel]);\n\n\t\t// Reset form\n\t\tsetSickDate(\"\");\n\t\tsetSickHours(\"8\");\n\t\tsetSickNotes(\"\");\n\t\tsetShowAddDialog(false);\n\n\t\tawait loadSickDays();\n\t};\n\n\tconst handleDeleteSickDay = async (sickDay: SickDayModel) => {\n\t\tif (!window.confirm(t.confirmDeleteSickDay)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst sickDayORM = SickDayORM.getInstance();\n\t\tawait sickDayORM.deleteSickDayById(sickDay.id);\n\t\tawait loadSickDays();\n\t};\n\n\tconst formatDate = (dateStr: string) => {\n\t\tconst date = new Date(dateStr);\n\t\treturn date.toLocaleDateString(language === 'es' ? 'es-ES' : 'en-US', {\n\t\t\tyear: 'numeric',\n\t\t\tmonth: 'long',\n\t\t\tday: 'numeric'\n\t\t});\n\t};\n\n\tconst totalSickHours = sickDays.reduce((sum, sd) => sum + sd.hours, 0);\n\n\treturn (\n\t\t<>\n\t\t\t<Card>\n\t\t\t\t<CardHeader>\n\t\t\t\t\t<div className=\"flex justify-between items-center\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<CardTitle className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t\t<Heart className=\"w-5 h-5 text-red-500\" />\n\t\t\t\t\t\t\t\t{t.mySickDays}\n\t\t\t\t\t\t\t</CardTitle>\n\t\t\t\t\t\t\t<CardDescription>\n\t\t\t\t\t\t\t\t{t.totalSickDays}: {totalSickHours.toFixed(1)} {language === 'es' ? 'hrs' : 'hrs'}\n\t\t\t\t\t\t\t</CardDescription>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<Button onClick={() => setShowAddDialog(true)} size=\"sm\">\n\t\t\t\t\t\t\t<Plus className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t\t\t{t.addSickDay}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t</CardHeader>\n\t\t\t\t<CardContent>\n\t\t\t\t\t{sickDays.length === 0 ? (\n\t\t\t\t\t\t<p className=\"text-center text-muted-foreground py-8\">{t.noSickDays}</p>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<div className=\"overflow-x-auto\">\n\t\t\t\t\t\t\t<Table>\n\t\t\t\t\t\t\t\t<TableHeader>\n\t\t\t\t\t\t\t\t\t<TableRow>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.sickDayDate}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.sickDayHours}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.sickDayNotes}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.actions}</TableHead>\n\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t</TableHeader>\n\t\t\t\t\t\t\t\t<TableBody>\n\t\t\t\t\t\t\t\t\t{sickDays.map((sd) => (\n\t\t\t\t\t\t\t\t\t\t<TableRow key={sd.id}>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"font-medium whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t{formatDate(sd.sick_date)}\n\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell>{sd.hours} hrs</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"max-w-xs truncate\">{sd.notes || \"—\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => handleDeleteSickDay(sd)}\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"text-red-600 hover:text-red-700 hover:bg-red-50\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Trash2 className=\"w-4 h-4\" />\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</TableBody>\n\t\t\t\t\t\t\t</Table>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</CardContent>\n\t\t\t</Card>\n\n\t\t\t<Dialog open={showAddDialog} onOpenChange={setShowAddDialog}>\n\t\t\t\t<DialogContent>\n\t\t\t\t\t<DialogHeader>\n\t\t\t\t\t\t<DialogTitle>{t.addSickDay}</DialogTitle>\n\t\t\t\t\t</DialogHeader>\n\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.sickDayDate}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"date\"\n\t\t\t\t\t\t\t\tvalue={sickDate}\n\t\t\t\t\t\t\t\tonChange={(e) => setSickDate(e.target.value)}\n\t\t\t\t\t\t\t\tmax={new Date().toISOString().split('T')[0]}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.sickDayHours}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\tmin=\"0.5\"\n\t\t\t\t\t\t\t\tmax=\"24\"\n\t\t\t\t\t\t\t\tstep=\"0.5\"\n\t\t\t\t\t\t\t\tvalue={sickHours}\n\t\t\t\t\t\t\t\tonChange={(e) => setSickHours(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.sickDayNotes}</Label>\n\t\t\t\t\t\t\t<Textarea\n\t\t\t\t\t\t\t\tvalue={sickNotes}\n\t\t\t\t\t\t\t\tonChange={(e) => setSickNotes(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder={t.sickDayNotesPlaceholder}\n\t\t\t\t\t\t\t\trows={3}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<DialogFooter>\n\t\t\t\t\t\t<Button variant=\"outline\" onClick={() => setShowAddDialog(false)}>\n\t\t\t\t\t\t\t{t.cancel}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button onClick={handleAddSickDay} disabled={!sickDate || !sickHours}>\n\t\t\t\t\t\t\t{t.saveChanges}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</DialogFooter>\n\t\t\t\t</DialogContent>\n\t\t\t</Dialog>\n\t\t</>\n\t);\n}\n\nfunction EmployeeView({ user, language }: { user: UserModel; language: Language }) {\n\tconst [timeCards, setTimeCards] = useState<TimeCardEntryModel[]>([]);\n\tconst [activeShift, setActiveShift] = useState<TimeCardEntryModel | null>(null);\n\tconst [elapsedTime, setElapsedTime] = useState(0);\n\tconst [location, setLocation] = useState(\"\");\n\tconst [workDescription, setWorkDescription] = useState(\"\");\n\tconst [isOnLunch, setIsOnLunch] = useState(false);\n\tconst [isLoading, setIsLoading] = useState(false);\n\n\tconst t = translations[language];\n\n\tuseEffect(() => {\n\t\tloadTimeCards();\n\t}, [user.id]);\n\n\tuseEffect(() => {\n\t\tlet interval: NodeJS.Timeout;\n\t\tif (activeShift && !isOnLunch) {\n\t\t\tinterval = setInterval(() => {\n\t\t\t\tconst clockInTime = parseInt(activeShift.clock_in_timestamp) * 1000;\n\t\t\t\tconst elapsed = Date.now() - clockInTime;\n\t\t\t\tsetElapsedTime(elapsed);\n\t\t\t}, 1000);\n\t\t}\n\t\treturn () => clearInterval(interval);\n\t}, [activeShift, isOnLunch]);\n\n\tconst loadTimeCards = async () => {\n\t\tconsole.log(\"Loading time cards for user:\", user.id);\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tconst userTimeCards = await timeCardORM.getTimeCardEntryByUserId(user.id);\n\n\t\tconsole.log(\"Found\", userTimeCards.length, \"time cards\");\n\n\t\t// Normalize data retrieved from ORM to fix null-handling bugs\n\t\tconst normalized = normalizeTimeCardEntriesFromORM(userTimeCards);\n\n\t\t// Sort by clock in time (newest first)\n\t\tconst sorted = normalized.sort((a, b) =>\n\t\t\tparseInt(b.clock_in_timestamp) - parseInt(a.clock_in_timestamp)\n\t\t);\n\n\t\tsetTimeCards(sorted);\n\n\t\t// Find active shift using helper function\n\t\tconst active = sorted.find(tc => isActiveShift(tc));\n\t\tconsole.log(\"Active shift found:\", active ? `Yes (ID: ${active.id})` : \"No\");\n\n\t\tsetActiveShift(active || null);\n\t\tif (active) {\n\t\t\tsetLocation(active.location || \"\");\n\t\t\tsetWorkDescription(active.work_description || \"\");\n\t\t\t// Check if on lunch break using helper function\n\t\t\tconst onLunch = isOnLunchBreak(active);\n\t\t\tsetIsOnLunch(onLunch);\n\t\t\tconsole.log(\"On lunch:\", onLunch);\n\t\t} else {\n\t\t\tsetIsOnLunch(false);\n\t\t}\n\t};\n\n\tconst handleClockIn = async () => {\n\t\tconsole.log(\"=== CLOCK IN STARTED ===\");\n\t\tconsole.log(\"User ID:\", user.id);\n\t\tconsole.log(\"Location:\", location);\n\t\tconsole.log(\"Work Description:\", workDescription);\n\n\t\tsetIsLoading(true);\n\t\ttry {\n\t\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\t\tconst now = Math.floor(Date.now() / 1000).toString();\n\t\t\tconsole.log(\"Current timestamp:\", now);\n\n\t\t\tconst newEntry = {\n\t\t\t\tuser_id: user.id,\n\t\t\t\tclock_in_timestamp: now,\n\t\t\t\tlocation: location || undefined,\n\t\t\t\twork_description: workDescription || undefined,\n\t\t\t} as TimeCardEntryModel;\n\n\t\t\t// Normalize the entry to work around ORM null-handling bugs\n\t\t\tconst normalizedEntry = normalizeTimeCardEntryForSave(newEntry);\n\n\t\t\tconsole.log(\"Inserting time card entry:\", normalizedEntry);\n\n\t\t\tconst result = await timeCardORM.insertTimeCardEntry([normalizedEntry as TimeCardEntryModel]);\n\t\t\tconsole.log(\"Insert result:\", result);\n\n\t\t\t// Normalize the returned data\n\t\t\tconst normalizedResult = normalizeTimeCardEntriesFromORM(result);\n\t\t\tconsole.log(\"Normalized result:\", normalizedResult);\n\n\t\t\tconsole.log(\"Time card entry created successfully!\");\n\n\t\t\t// Clear form\n\t\t\tsetLocation(\"\");\n\t\t\tsetWorkDescription(\"\");\n\n\t\t\t// Reload time cards\n\t\t\tconsole.log(\"Reloading time cards...\");\n\t\t\tawait loadTimeCards();\n\n\t\t\tconsole.log(\"=== CLOCK IN COMPLETED ===\");\n\n\t\t\t// Show success feedback\n\t\t\tconst reloadedShifts = normalizeTimeCardEntriesFromORM(\n\t\t\t\tawait timeCardORM.getTimeCardEntryByUserId(user.id)\n\t\t\t);\n\t\t\tif (reloadedShifts.some(tc => isActiveShift(tc))) {\n\t\t\t\talert(\"✅ Successfully clocked in! You can now see the CLOCK OUT button.\");\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.error(\"=== CLOCK IN FAILED ===\");\n\t\t\tconsole.error(\"Error details:\", error);\n\t\t\talert(`Error clocking in: ${error instanceof Error ? error.message : 'Unknown error'}. Check console for details.`);\n\t\t} finally {\n\t\t\tsetIsLoading(false);\n\t\t}\n\t};\n\n\tconst handleClockOut = async () => {\n\t\tconsole.log(\"Clock Out clicked - activeShift:\", activeShift);\n\n\t\tif (!activeShift) {\n\t\t\tconsole.error(\"No active shift to clock out!\");\n\t\t\talert(\"Error: No active shift found. Please try clocking in first.\");\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\t\tconst now = Math.floor(Date.now() / 1000).toString();\n\n\t\t\tconst clockInTime = parseInt(activeShift.clock_in_timestamp);\n\t\t\tconst clockOutTime = parseInt(now);\n\t\t\tlet totalHours = (clockOutTime - clockInTime) / 3600;\n\n\t\t\t// Deduct lunch time if lunch was taken\n\t\t\tif (activeShift.lunch_duration_minutes && activeShift.lunch_duration_minutes > 0) {\n\t\t\t\ttotalHours -= activeShift.lunch_duration_minutes / 60;\n\t\t\t}\n\n\t\t\tconsole.log(\"Clocking out - Total hours:\", totalHours);\n\n\t\t\tconst updateData = {\n\t\t\t\t...activeShift,\n\t\t\t\tclock_out_timestamp: now,\n\t\t\t\ttotal_hours: totalHours,\n\t\t\t\tlocation: location || activeShift.location || undefined,\n\t\t\t\twork_description: workDescription || activeShift.work_description || undefined,\n\t\t\t};\n\n\t\t\t// Normalize before saving\n\t\t\tconst normalizedUpdate = normalizeTimeCardEntryForSave(updateData as TimeCardEntryModel);\n\n\t\t\tawait timeCardORM.setTimeCardEntryById(activeShift.id, normalizedUpdate as TimeCardEntryModel);\n\n\t\t\tconsole.log(\"Clock out successful!\");\n\t\t\tsetLocation(\"\");\n\t\t\tsetWorkDescription(\"\");\n\t\t\tawait loadTimeCards();\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Error clocking out:\", error);\n\t\t\talert(\"Error clocking out. Please try again.\");\n\t\t}\n\t};\n\n\tconst handleStartLunch = async () => {\n\t\tif (!activeShift) return;\n\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tconst now = Math.floor(Date.now() / 1000).toString();\n\n\t\tconst updateData = {\n\t\t\t...activeShift,\n\t\t\tlunch_start_timestamp: now,\n\t\t\tlocation: location || activeShift.location || undefined,\n\t\t\twork_description: workDescription || activeShift.work_description || undefined,\n\t\t};\n\n\t\tconst normalizedUpdate = normalizeTimeCardEntryForSave(updateData as TimeCardEntryModel);\n\t\tawait timeCardORM.setTimeCardEntryById(activeShift.id, normalizedUpdate as TimeCardEntryModel);\n\n\t\tawait loadTimeCards();\n\t};\n\n\tconst handleEndLunch = async () => {\n\t\tif (!activeShift || !activeShift.lunch_start_timestamp) return;\n\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tconst now = Math.floor(Date.now() / 1000).toString();\n\n\t\t// Handle case where lunch_start_timestamp might be the string \"null\"\n\t\tlet lunchStartTime: number;\n\t\tif (typeof activeShift.lunch_start_timestamp === 'string' && activeShift.lunch_start_timestamp !== 'null') {\n\t\t\tlunchStartTime = parseInt(activeShift.lunch_start_timestamp);\n\t\t} else {\n\t\t\treturn;\n\t\t}\n\n\t\tconst lunchEndTime = parseInt(now);\n\t\tconst lunchDurationMinutes = (lunchEndTime - lunchStartTime) / 60;\n\n\t\t// Add to existing lunch duration if there was already one\n\t\tconst totalLunchMinutes = (activeShift.lunch_duration_minutes && activeShift.lunch_duration_minutes > 0 ? activeShift.lunch_duration_minutes : 0) + lunchDurationMinutes;\n\n\t\tconst updateData = {\n\t\t\t...activeShift,\n\t\t\tlunch_end_timestamp: now,\n\t\t\tlunch_duration_minutes: totalLunchMinutes,\n\t\t};\n\n\t\tconst normalizedUpdate = normalizeTimeCardEntryForSave(updateData as TimeCardEntryModel);\n\t\tawait timeCardORM.setTimeCardEntryById(activeShift.id, normalizedUpdate as TimeCardEntryModel);\n\n\t\tawait loadTimeCards();\n\t};\n\n\tconst formatTime = (ms: number) => {\n\t\tconst seconds = Math.floor(ms / 1000);\n\t\tconst hours = Math.floor(seconds / 3600);\n\t\tconst minutes = Math.floor((seconds % 3600) / 60);\n\t\tconst secs = seconds % 60;\n\t\treturn `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\n\t};\n\n\tconst formatDate = (timestamp: string) => {\n\t\tconst date = new Date(parseInt(timestamp) * 1000);\n\t\treturn date.toLocaleString(language === 'es' ? 'es-ES' : 'en-US');\n\t};\n\n\tconst formatHours = (hours: number | null | undefined) => {\n\t\tif (hours === null || hours === undefined) return \"—\";\n\t\treturn `${hours.toFixed(2)} ${language === 'es' ? 'hrs' : 'hrs'}`;\n\t};\n\n\tconst formatMinutes = (minutes: number | null | undefined) => {\n\t\tif (minutes === null || minutes === undefined) return \"—\";\n\t\treturn `${Math.round(minutes)} min`;\n\t};\n\n\treturn (\n\t\t<div className=\"space-y-6\">\n\t\t\t<SickDayCard user={user} language={language} />\n\t\t\t<Card>\n\t\t\t\t<CardHeader>\n\t\t\t\t\t<CardTitle className=\"flex items-center gap-2\">\n\t\t\t\t\t\t<Clock className=\"w-5 h-5\" />\n\t\t\t\t\t\t{t.clockInOut}\n\t\t\t\t\t</CardTitle>\n\t\t\t\t\t<CardDescription>\n\t\t\t\t\t\t{activeShift ? \"✅ You are currently clocked in - Clock out button is below\" : \"❌ Not clocked in - Click CLOCK IN button to start\"}\n\t\t\t\t\t</CardDescription>\n\t\t\t\t</CardHeader>\n\t\t\t\t<CardContent className=\"space-y-6\">\n\t\t\t\t\t{/* Show current status */}\n\t\t\t\t\t<div className={`p-6 rounded-lg border-2 ${activeShift ? 'bg-green-50 border-green-300 dark:bg-green-900/20 dark:border-green-700' : 'bg-blue-50 border-blue-300 dark:bg-blue-900/20 dark:border-blue-700'}`}>\n\t\t\t\t\t\t<div className=\"flex items-center justify-between mb-4\">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<p className={`text-2xl font-bold ${activeShift ? 'text-green-700' : 'text-blue-700'}`}>\n\t\t\t\t\t\t\t\t\t{activeShift ? '🟢 CLOCKED IN' : '⚪ NOT CLOCKED IN'}\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t{!activeShift && (\n\t\t\t\t\t\t\t\t\t<p className=\"text-sm text-blue-600 dark:text-blue-400 mt-2 font-semibold\">\n\t\t\t\t\t\t\t\t\t\t👇 Fill out the form below and click \"CLOCK IN\"\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t{activeShift && (\n\t\t\t\t\t\t\t\t\t<p className=\"text-sm text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\tStarted: {formatDate(activeShift.clock_in_timestamp)}\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t{isOnLunch && (\n\t\t\t\t\t\t\t\t\t<p className=\"text-sm text-orange-600 font-semibold mt-1\">\n\t\t\t\t\t\t\t\t\t\t☕ On Lunch Break\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{activeShift && !isOnLunch && (\n\t\t\t\t\t\t\t\t<div className=\"text-right\">\n\t\t\t\t\t\t\t\t\t<p className=\"text-3xl font-mono font-bold tabular-nums\">\n\t\t\t\t\t\t\t\t\t\t{formatTime(elapsedTime)}\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t<p className=\"text-xs text-muted-foreground\">Time Elapsed</p>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Main Action Buttons */}\n\t\t\t\t\t{activeShift ? (\n\t\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t\t{/* Clock Out Button - ALWAYS VISIBLE when clocked in */}\n\t\t\t\t\t\t\t<div className=\"bg-red-50 dark:bg-red-950 p-4 rounded-lg border-2 border-red-300 dark:border-red-700\">\n\t\t\t\t\t\t\t\t<p className=\"text-center text-sm font-bold text-red-700 dark:text-red-300 mb-3\">\n\t\t\t\t\t\t\t\t\t⬇️ CLICK HERE TO END YOUR SHIFT ⬇️\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tonClick={handleClockOut}\n\t\t\t\t\t\t\t\t\tvariant=\"destructive\"\n\t\t\t\t\t\t\t\t\tsize=\"lg\"\n\t\t\t\t\t\t\t\t\tclassName=\"w-full h-20 text-2xl font-black shadow-lg hover:shadow-xl transition-all\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<Clock className=\"w-8 h-8 mr-3\" />\n\t\t\t\t\t\t\t\t\tCLOCK OUT\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t{/* Lunch Buttons */}\n\t\t\t\t\t\t\t<div className=\"border-t pt-4\">\n\t\t\t\t\t\t\t\t<p className=\"text-sm text-muted-foreground mb-3\">Lunch Break (Optional)</p>\n\t\t\t\t\t\t\t\t{isOnLunch ? (\n\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\tonClick={handleEndLunch}\n\t\t\t\t\t\t\t\t\t\tclassName=\"w-full h-12\"\n\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<Coffee className=\"w-5 h-5 mr-2\" />\n\t\t\t\t\t\t\t\t\t\tEnd Lunch Break\n\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\tonClick={handleStartLunch}\n\t\t\t\t\t\t\t\t\t\tclassName=\"w-full h-12\"\n\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<Coffee className=\"w-5 h-5 mr-2\" />\n\t\t\t\t\t\t\t\t\t\tStart Lunch Break\n\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t{/* Location and Description */}\n\t\t\t\t\t\t\t<div className=\"border-t pt-4 space-y-4\">\n\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t<Label>{t.location}</Label>\n\t\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\t\tvalue={location}\n\t\t\t\t\t\t\t\t\t\tonChange={(e) => setLocation(e.target.value)}\n\t\t\t\t\t\t\t\t\t\tplaceholder={t.locationPlaceholder}\n\t\t\t\t\t\t\t\t\t\tclassName=\"mt-2\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t<Label>{t.workDescription}</Label>\n\t\t\t\t\t\t\t\t\t<Textarea\n\t\t\t\t\t\t\t\t\t\tvalue={workDescription}\n\t\t\t\t\t\t\t\t\t\tonChange={(e) => setWorkDescription(e.target.value)}\n\t\t\t\t\t\t\t\t\t\tplaceholder={t.descriptionPlaceholder}\n\t\t\t\t\t\t\t\t\t\trows={3}\n\t\t\t\t\t\t\t\t\t\tclassName=\"mt-2\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t\t{/* Clock In Form */}\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<Label>{t.location}</Label>\n\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\tvalue={location}\n\t\t\t\t\t\t\t\t\tonChange={(e) => setLocation(e.target.value)}\n\t\t\t\t\t\t\t\t\tplaceholder={t.locationPlaceholder}\n\t\t\t\t\t\t\t\t\tclassName=\"mt-2\"\n\t\t\t\t\t\t\t\t\tdisabled={isLoading}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<Label>{t.workDescription}</Label>\n\t\t\t\t\t\t\t\t<Textarea\n\t\t\t\t\t\t\t\t\tvalue={workDescription}\n\t\t\t\t\t\t\t\t\tonChange={(e) => setWorkDescription(e.target.value)}\n\t\t\t\t\t\t\t\t\tplaceholder={t.descriptionPlaceholder}\n\t\t\t\t\t\t\t\t\trows={3}\n\t\t\t\t\t\t\t\t\tclassName=\"mt-2\"\n\t\t\t\t\t\t\t\t\tdisabled={isLoading}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tonClick={handleClockIn}\n\t\t\t\t\t\t\t\tsize=\"lg\"\n\t\t\t\t\t\t\t\tdisabled={isLoading}\n\t\t\t\t\t\t\t\tclassName=\"w-full h-16 text-xl font-bold bg-green-600 hover:bg-green-700 disabled:opacity-50\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Clock className=\"w-6 h-6 mr-2\" />\n\t\t\t\t\t\t\t\t{isLoading ? \"CLOCKING IN...\" : \"CLOCK IN\"}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t{isLoading && (\n\t\t\t\t\t\t\t\t<p className=\"text-center text-sm text-muted-foreground animate-pulse\">\n\t\t\t\t\t\t\t\t\tPlease wait, processing...\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</CardContent>\n\t\t\t</Card>\n\n\t\t\t<Card>\n\t\t\t\t<CardHeader>\n\t\t\t\t\t<CardTitle className=\"flex items-center gap-2\">\n\t\t\t\t\t\t<CalendarDays className=\"w-5 h-5\" />\n\t\t\t\t\t\t{t.timeCardHistory}\n\t\t\t\t\t</CardTitle>\n\t\t\t\t\t<CardDescription>{t.recentRecords}</CardDescription>\n\t\t\t\t</CardHeader>\n\t\t\t\t<CardContent>\n\t\t\t\t\t{timeCards.length === 0 ? (\n\t\t\t\t\t\t<p className=\"text-center text-muted-foreground py-8\">{t.noTimeCards}</p>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<div className=\"overflow-x-auto\">\n\t\t\t\t\t\t\t<Table>\n\t\t\t\t\t\t\t\t<TableHeader>\n\t\t\t\t\t\t\t\t\t<TableRow>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.clockInTime}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.clockOutTime}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.location}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.workDescription}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.lunchDuration}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.hours}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.status}</TableHead>\n\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t</TableHeader>\n\t\t\t\t\t\t\t\t<TableBody>\n\t\t\t\t\t\t\t\t\t{timeCards.map((tc) => (\n\t\t\t\t\t\t\t\t\t\t<TableRow key={tc.id}>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatDate(tc.clock_in_timestamp)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t{tc.clock_out_timestamp ? formatDate(tc.clock_out_timestamp) : \"—\"}\n\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell>{tc.location || \"—\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"max-w-xs truncate\">{tc.work_description || \"—\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatMinutes(tc.lunch_duration_minutes)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatHours(tc.total_hours)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t{tc.clock_out_timestamp ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge variant=\"secondary\">{t.completed}</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t) : tc.lunch_start_timestamp && !tc.lunch_end_timestamp ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge className=\"bg-orange-500\">{t.onLunchBreak}</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge className=\"bg-green-500\">{t.active}</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</TableBody>\n\t\t\t\t\t\t\t</Table>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</CardContent>\n\t\t\t</Card>\n\t\t</div>\n\t);\n}\n\nfunction ManagerView({ user, users, language, onUsersChange }: { user: UserModel; users: UserModel[]; language: Language; onUsersChange: () => void }) {\n\tconst [activeTab, setActiveTab] = useState(\"timecards\");\n\n\tconst t = translations[language];\n\n\treturn (\n\t\t<Tabs value={activeTab} onValueChange={setActiveTab}>\n\t\t\t<TabsList className=\"grid w-full grid-cols-4\">\n\t\t\t\t<TabsTrigger value=\"timecards\">\n\t\t\t\t\t<Clock className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t{t.timeCards}\n\t\t\t\t</TabsTrigger>\n\t\t\t\t<TabsTrigger value=\"sickdays\">\n\t\t\t\t\t<Heart className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t{t.sickDays}\n\t\t\t\t</TabsTrigger>\n\t\t\t\t<TabsTrigger value=\"reports\">\n\t\t\t\t\t<FileText className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t{t.reports}\n\t\t\t\t</TabsTrigger>\n\t\t\t\t<TabsTrigger value=\"employees\">\n\t\t\t\t\t<Users className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t{t.employees}\n\t\t\t\t</TabsTrigger>\n\t\t\t</TabsList>\n\n\t\t\t<TabsContent value=\"timecards\" className=\"space-y-4\">\n\t\t\t\t<TimeCardsTab users={users} language={language} />\n\t\t\t</TabsContent>\n\n\t\t\t<TabsContent value=\"sickdays\" className=\"space-y-4\">\n\t\t\t\t<SickDaysTab users={users} language={language} />\n\t\t\t</TabsContent>\n\n\t\t\t<TabsContent value=\"reports\" className=\"space-y-4\">\n\t\t\t\t<ReportsTab users={users} language={language} />\n\t\t\t</TabsContent>\n\n\t\t\t<TabsContent value=\"employees\" className=\"space-y-4\">\n\t\t\t\t<EmployeesTab users={users} language={language} onUsersChange={onUsersChange} />\n\t\t\t</TabsContent>\n\t\t</Tabs>\n\t);\n}\n\nfunction TimeCardsTab({ users, language }: { users: UserModel[]; language: Language }) {\n\tconst [allTimeCards, setAllTimeCards] = useState<TimeCardEntryModel[]>([]);\n\tconst [filteredCards, setFilteredCards] = useState<TimeCardEntryModel[]>([]);\n\tconst [selectedEmployee, setSelectedEmployee] = useState<string>(\"all\");\n\tconst [dateFilter, setDateFilter] = useState<string>(\"\");\n\tconst [editingCard, setEditingCard] = useState<TimeCardEntryModel | null>(null);\n\tconst [editClockIn, setEditClockIn] = useState(\"\");\n\tconst [editClockOut, setEditClockOut] = useState(\"\");\n\tconst [editLocation, setEditLocation] = useState(\"\");\n\tconst [editWorkDescription, setEditWorkDescription] = useState(\"\");\n\tconst [editLunchStart, setEditLunchStart] = useState(\"\");\n\tconst [editLunchEnd, setEditLunchEnd] = useState(\"\");\n\tconst [showManualEntry, setShowManualEntry] = useState(false);\n\tconst [manualEntryUserId, setManualEntryUserId] = useState<string>(\"\");\n\n\tconst t = translations[language];\n\n\tuseEffect(() => {\n\t\tloadAllTimeCards();\n\t}, []);\n\n\tuseEffect(() => {\n\t\tapplyFilters();\n\t}, [allTimeCards, selectedEmployee, dateFilter]);\n\n\tconst loadAllTimeCards = async () => {\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tconst allCards = await timeCardORM.getAllTimeCardEntry();\n\n\t\t// Normalize data from ORM\n\t\tconst normalized = normalizeTimeCardEntriesFromORM(allCards);\n\n\t\t// Sort by clock in time (newest first)\n\t\tconst sorted = normalized.sort((a, b) =>\n\t\t\tparseInt(b.clock_in_timestamp) - parseInt(a.clock_in_timestamp)\n\t\t);\n\n\t\tsetAllTimeCards(sorted);\n\t};\n\n\tconst applyFilters = () => {\n\t\tlet filtered = [...allTimeCards];\n\n\t\t// Filter by employee\n\t\tif (selectedEmployee !== \"all\") {\n\t\t\tfiltered = filtered.filter(tc => tc.user_id === selectedEmployee);\n\t\t}\n\n\t\t// Filter by date\n\t\tif (dateFilter) {\n\t\t\tconst filterDate = new Date(dateFilter);\n\t\t\tconst filterTimestamp = Math.floor(filterDate.getTime() / 1000);\n\t\t\tconst nextDayTimestamp = filterTimestamp + 86400; // +24 hours\n\n\t\t\tfiltered = filtered.filter(tc => {\n\t\t\t\tconst clockIn = parseInt(tc.clock_in_timestamp);\n\t\t\t\treturn clockIn >= filterTimestamp && clockIn < nextDayTimestamp;\n\t\t\t});\n\t\t}\n\n\t\tsetFilteredCards(filtered);\n\t};\n\n\tconst getUserName = (userId: string) => {\n\t\tconst user = users.find(u => u.id === userId);\n\t\treturn user?.name || \"Unknown\";\n\t};\n\n\tconst formatDate = (timestamp: string) => {\n\t\tconst date = new Date(parseInt(timestamp) * 1000);\n\t\treturn date.toLocaleString(language === 'es' ? 'es-ES' : 'en-US');\n\t};\n\n\tconst formatHours = (hours: number | null | undefined) => {\n\t\tif (hours === null || hours === undefined) return \"—\";\n\t\treturn `${hours.toFixed(2)} ${language === 'es' ? 'hrs' : 'hrs'}`;\n\t};\n\n\tconst formatMinutes = (minutes: number | null | undefined) => {\n\t\tif (minutes === null || minutes === undefined) return \"—\";\n\t\treturn `${Math.round(minutes)} min`;\n\t};\n\n\tconst calculateTotalHours = (period: 'day' | 'week') => {\n\t\tconst now = Date.now() / 1000;\n\t\tconst periodSeconds = period === 'day' ? 86400 : 604800; // 1 day or 7 days\n\t\tconst startTime = now - periodSeconds;\n\n\t\tconst relevantCards = allTimeCards.filter(tc => {\n\t\t\tconst clockIn = parseInt(tc.clock_in_timestamp);\n\t\t\treturn clockIn >= startTime && tc.total_hours;\n\t\t});\n\n\t\treturn relevantCards.reduce((sum, tc) => sum + (tc.total_hours || 0), 0);\n\t};\n\n\tconst handleEditCard = (card: TimeCardEntryModel) => {\n\t\tsetEditingCard(card);\n\n\t\t// Helper function to safely convert timestamp to ISO string\n\t\tconst safeTimestampToISO = (timestamp: string | null | undefined): string => {\n\t\t\tif (!timestamp) return \"\";\n\t\t\tconst parsed = parseInt(timestamp);\n\t\t\tif (isNaN(parsed) || parsed <= 0) return \"\";\n\t\t\tconst date = new Date(parsed * 1000);\n\t\t\tif (isNaN(date.getTime())) return \"\";\n\t\t\treturn date.toISOString().slice(0, 16);\n\t\t};\n\n\t\tsetEditClockIn(safeTimestampToISO(card.clock_in_timestamp) || new Date().toISOString().slice(0, 16));\n\t\tsetEditClockOut(safeTimestampToISO(card.clock_out_timestamp));\n\t\tsetEditLocation(card.location || \"\");\n\t\tsetEditWorkDescription(card.work_description || \"\");\n\t\tsetEditLunchStart(safeTimestampToISO(card.lunch_start_timestamp));\n\t\tsetEditLunchEnd(safeTimestampToISO(card.lunch_end_timestamp));\n\t};\n\n\tconst handleSaveEdit = async () => {\n\t\tif (!editingCard) return;\n\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tconst clockInTimestamp = Math.floor(new Date(editClockIn).getTime() / 1000).toString();\n\t\tconst clockOutTimestamp = editClockOut\n\t\t\t? Math.floor(new Date(editClockOut).getTime() / 1000).toString()\n\t\t\t: undefined;\n\t\tconst lunchStartTimestamp = editLunchStart\n\t\t\t? Math.floor(new Date(editLunchStart).getTime() / 1000).toString()\n\t\t\t: undefined;\n\t\tconst lunchEndTimestamp = editLunchEnd\n\t\t\t? Math.floor(new Date(editLunchEnd).getTime() / 1000).toString()\n\t\t\t: undefined;\n\n\t\tlet totalHours: number | undefined = undefined;\n\t\tlet lunchDurationMinutes: number | undefined = undefined;\n\n\t\t// Calculate lunch duration\n\t\tif (lunchStartTimestamp && lunchEndTimestamp) {\n\t\t\tconst lunchStart = parseInt(lunchStartTimestamp);\n\t\t\tconst lunchEnd = parseInt(lunchEndTimestamp);\n\t\t\tlunchDurationMinutes = (lunchEnd - lunchStart) / 60;\n\t\t}\n\n\t\t// Calculate total hours\n\t\tif (clockOutTimestamp) {\n\t\t\tconst clockInTime = parseInt(clockInTimestamp);\n\t\t\tconst clockOutTime = parseInt(clockOutTimestamp);\n\t\t\ttotalHours = (clockOutTime - clockInTime) / 3600;\n\n\t\t\t// Deduct lunch time\n\t\t\tif (lunchDurationMinutes) {\n\t\t\t\ttotalHours -= lunchDurationMinutes / 60;\n\t\t\t}\n\t\t}\n\n\t\tconst updateData = {\n\t\t\t...editingCard,\n\t\t\tclock_in_timestamp: clockInTimestamp,\n\t\t\tclock_out_timestamp: clockOutTimestamp,\n\t\t\ttotal_hours: totalHours,\n\t\t\tlocation: editLocation || undefined,\n\t\t\twork_description: editWorkDescription || undefined,\n\t\t\tlunch_start_timestamp: lunchStartTimestamp,\n\t\t\tlunch_end_timestamp: lunchEndTimestamp,\n\t\t\tlunch_duration_minutes: lunchDurationMinutes,\n\t\t};\n\n\t\tconst normalizedUpdate = normalizeTimeCardEntryForSave(updateData as TimeCardEntryModel);\n\t\tawait timeCardORM.setTimeCardEntryById(editingCard.id, normalizedUpdate as TimeCardEntryModel);\n\n\t\tsetEditingCard(null);\n\t\tawait loadAllTimeCards();\n\t};\n\n\tconst handleDeleteTimeCard = async (card: TimeCardEntryModel) => {\n\t\tif (!window.confirm(t.confirmDeleteTimeCard)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tawait timeCardORM.deleteTimeCardEntryById(card.id);\n\t\tawait loadAllTimeCards();\n\t};\n\n\tconst handleAddManualEntry = (userId: string) => {\n\t\tsetManualEntryUserId(userId);\n\t\tsetShowManualEntry(true);\n\t};\n\n\treturn (\n\t\t<>\n\t\t\t<div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n\t\t\t\t<Card>\n\t\t\t\t\t<CardHeader className=\"pb-3\">\n\t\t\t\t\t\t<CardTitle className=\"text-sm font-medium flex items-center gap-2\">\n\t\t\t\t\t\t\t<Users className=\"w-4 h-4\" />\n\t\t\t\t\t\t\t{t.totalEmployees}\n\t\t\t\t\t\t</CardTitle>\n\t\t\t\t\t</CardHeader>\n\t\t\t\t\t<CardContent>\n\t\t\t\t\t\t<div className=\"text-2xl font-bold\">{users.filter(u => u.role === UserRole.Employee).length}</div>\n\t\t\t\t\t</CardContent>\n\t\t\t\t</Card>\n\n\t\t\t\t<Card>\n\t\t\t\t\t<CardHeader className=\"pb-3\">\n\t\t\t\t\t\t<CardTitle className=\"text-sm font-medium flex items-center gap-2\">\n\t\t\t\t\t\t\t<Timer className=\"w-4 h-4\" />\n\t\t\t\t\t\t\t{t.hoursToday}\n\t\t\t\t\t\t</CardTitle>\n\t\t\t\t\t</CardHeader>\n\t\t\t\t\t<CardContent>\n\t\t\t\t\t\t<div className=\"text-2xl font-bold\">{calculateTotalHours('day').toFixed(2)}</div>\n\t\t\t\t\t</CardContent>\n\t\t\t\t</Card>\n\n\t\t\t\t<Card>\n\t\t\t\t\t<CardHeader className=\"pb-3\">\n\t\t\t\t\t\t<CardTitle className=\"text-sm font-medium flex items-center gap-2\">\n\t\t\t\t\t\t\t<CalendarDays className=\"w-4 h-4\" />\n\t\t\t\t\t\t\t{t.hoursThisWeek}\n\t\t\t\t\t\t</CardTitle>\n\t\t\t\t\t</CardHeader>\n\t\t\t\t\t<CardContent>\n\t\t\t\t\t\t<div className=\"text-2xl font-bold\">{calculateTotalHours('week').toFixed(2)}</div>\n\t\t\t\t\t</CardContent>\n\t\t\t\t</Card>\n\t\t\t</div>\n\n\t\t\t<Card>\n\t\t\t\t<CardHeader>\n\t\t\t\t\t<div className=\"flex justify-between items-center\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<CardTitle>{t.allEmployeeTimeCards}</CardTitle>\n\t\t\t\t\t\t\t<CardDescription>{t.viewManageRecords}</CardDescription>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<Button onClick={() => handleAddManualEntry(\"\")} variant=\"outline\" size=\"sm\">\n\t\t\t\t\t\t\t<Plus className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t\t\t{t.addTimeCard}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t</CardHeader>\n\t\t\t\t<CardContent className=\"space-y-4\">\n\t\t\t\t\t<div className=\"flex gap-4 flex-wrap\">\n\t\t\t\t\t\t<div className=\"flex-1 min-w-[200px]\">\n\t\t\t\t\t\t\t<Label>{t.filterByEmployee}</Label>\n\t\t\t\t\t\t\t<Select value={selectedEmployee} onValueChange={setSelectedEmployee}>\n\t\t\t\t\t\t\t\t<SelectTrigger>\n\t\t\t\t\t\t\t\t\t<SelectValue />\n\t\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t\t<SelectItem value=\"all\">{t.allEmployees}</SelectItem>\n\t\t\t\t\t\t\t\t\t{users.filter(u => u.role === UserRole.Employee).map((u) => (\n\t\t\t\t\t\t\t\t\t\t<SelectItem key={u.id} value={u.id}>\n\t\t\t\t\t\t\t\t\t\t\t{u.name}\n\t\t\t\t\t\t\t\t\t\t</SelectItem>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t\t</Select>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div className=\"flex-1 min-w-[200px]\">\n\t\t\t\t\t\t\t<Label>{t.filterByDate}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"date\"\n\t\t\t\t\t\t\t\tvalue={dateFilter}\n\t\t\t\t\t\t\t\tonChange={(e) => setDateFilter(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t{(selectedEmployee !== \"all\" || dateFilter) && (\n\t\t\t\t\t\t\t<div className=\"flex items-end\">\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\t\t\tsetSelectedEmployee(\"all\");\n\t\t\t\t\t\t\t\t\t\tsetDateFilter(\"\");\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{t.clearFilters}\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{filteredCards.length === 0 ? (\n\t\t\t\t\t\t<p className=\"text-center text-muted-foreground py-8\">{t.noTimeCardsFound}</p>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<div className=\"overflow-x-auto\">\n\t\t\t\t\t\t\t<Table>\n\t\t\t\t\t\t\t\t<TableHeader>\n\t\t\t\t\t\t\t\t\t<TableRow>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.employeeName}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.clockInTime}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.clockOutTime}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.location}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.workDescription}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.lunchDuration}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.hours}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.status}</TableHead>\n\t\t\t\t\t\t\t\t\t\t<TableHead>{t.actions}</TableHead>\n\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t</TableHeader>\n\t\t\t\t\t\t\t\t<TableBody>\n\t\t\t\t\t\t\t\t\t{filteredCards.map((tc) => (\n\t\t\t\t\t\t\t\t\t\t<TableRow key={tc.id}>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"font-medium whitespace-nowrap\">{getUserName(tc.user_id)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatDate(tc.clock_in_timestamp)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t{tc.clock_out_timestamp ? formatDate(tc.clock_out_timestamp) : \"—\"}\n\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell>{tc.location || \"—\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"max-w-xs truncate\">{tc.work_description || \"—\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatMinutes(tc.lunch_duration_minutes)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatHours(tc.total_hours)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t{tc.clock_out_timestamp ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge variant=\"secondary\">{t.completed}</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t) : tc.lunch_start_timestamp && !tc.lunch_end_timestamp ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge className=\"bg-orange-500\">{t.onLunchBreak}</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge className=\"bg-green-500\">{t.active}</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => handleEditCard(tc)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{t.edit}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => handleDeleteTimeCard(tc)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"text-red-600 hover:text-red-700 hover:bg-red-50\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Trash2 className=\"w-4 h-4\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</TableBody>\n\t\t\t\t\t\t\t</Table>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</CardContent>\n\t\t\t</Card>\n\n\t\t\t<Dialog open={!!editingCard} onOpenChange={(open) => !open && setEditingCard(null)}>\n\t\t\t\t<DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n\t\t\t\t\t<DialogHeader>\n\t\t\t\t\t\t<DialogTitle>{t.editTimeCard}</DialogTitle>\n\t\t\t\t\t</DialogHeader>\n\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.employeeName}</Label>\n\t\t\t\t\t\t\t<Input value={editingCard ? getUserName(editingCard.user_id) : \"\"} disabled />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"grid grid-cols-2 gap-4\">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<Label>{t.clockInTime}</Label>\n\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\t\tvalue={editClockIn}\n\t\t\t\t\t\t\t\t\tonChange={(e) => setEditClockIn(e.target.value)}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<Label>{t.clockOutTime}</Label>\n\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\t\tvalue={editClockOut}\n\t\t\t\t\t\t\t\t\tonChange={(e) => setEditClockOut(e.target.value)}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.location}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\tvalue={editLocation}\n\t\t\t\t\t\t\t\tonChange={(e) => setEditLocation(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder={t.locationPlaceholder}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.workDescription}</Label>\n\t\t\t\t\t\t\t<Textarea\n\t\t\t\t\t\t\t\tvalue={editWorkDescription}\n\t\t\t\t\t\t\t\tonChange={(e) => setEditWorkDescription(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder={t.descriptionPlaceholder}\n\t\t\t\t\t\t\t\trows={4}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"grid grid-cols-2 gap-4\">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<Label>{t.lunchStartTime}</Label>\n\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\t\tvalue={editLunchStart}\n\t\t\t\t\t\t\t\t\tonChange={(e) => setEditLunchStart(e.target.value)}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<Label>{t.lunchEndTime}</Label>\n\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\t\tvalue={editLunchEnd}\n\t\t\t\t\t\t\t\t\tonChange={(e) => setEditLunchEnd(e.target.value)}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<DialogFooter>\n\t\t\t\t\t\t<Button variant=\"outline\" onClick={() => setEditingCard(null)}>\n\t\t\t\t\t\t\t{t.cancel}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button onClick={handleSaveEdit}>\n\t\t\t\t\t\t\t{t.saveChanges}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</DialogFooter>\n\t\t\t\t</DialogContent>\n\t\t\t</Dialog>\n\n\t\t\t<ManualEntryDialog\n\t\t\t\topen={showManualEntry}\n\t\t\t\tonClose={() => setShowManualEntry(false)}\n\t\t\t\tuserId={manualEntryUserId}\n\t\t\t\tonSave={loadAllTimeCards}\n\t\t\t\tlanguage={language}\n\t\t\t\tusers={users}\n\t\t\t/>\n\t\t</>\n\t);\n}\n\nfunction SickDaysTab({ users, language }: { users: UserModel[]; language: Language }) {\n\tconst [allSickDays, setAllSickDays] = useState<SickDayModel[]>([]);\n\tconst [filteredSickDays, setFilteredSickDays] = useState<SickDayModel[]>([]);\n\tconst [selectedEmployee, setSelectedEmployee] = useState<string>(\"all\");\n\tconst [dateFilter, setDateFilter] = useState<string>(\"\");\n\n\tconst t = translations[language];\n\n\tuseEffect(() => {\n\t\tloadAllSickDays();\n\t}, []);\n\n\tuseEffect(() => {\n\t\tapplyFilters();\n\t}, [allSickDays, selectedEmployee, dateFilter]);\n\n\tconst loadAllSickDays = async () => {\n\t\tconst sickDayORM = SickDayORM.getInstance();\n\t\tconst allDays = await sickDayORM.getAllSickDay();\n\n\t\t// Sort by date (newest first)\n\t\tconst sorted = allDays.sort((a, b) =>\n\t\t\tnew Date(b.sick_date).getTime() - new Date(a.sick_date).getTime()\n\t\t);\n\n\t\tsetAllSickDays(sorted);\n\t};\n\n\tconst applyFilters = () => {\n\t\tlet filtered = [...allSickDays];\n\n\t\t// Filter by employee\n\t\tif (selectedEmployee !== \"all\") {\n\t\t\tfiltered = filtered.filter(sd => sd.user_id === selectedEmployee);\n\t\t}\n\n\t\t// Filter by date\n\t\tif (dateFilter) {\n\t\t\tfiltered = filtered.filter(sd => sd.sick_date === dateFilter);\n\t\t}\n\n\t\tsetFilteredSickDays(filtered);\n\t};\n\n\tconst getUserName = (userId: string) => {\n\t\tconst user = users.find(u => u.id === userId);\n\t\treturn user?.name || \"Unknown\";\n\t};\n\n\tconst formatDate = (dateStr: string) => {\n\t\tconst date = new Date(dateStr);\n\t\treturn date.toLocaleDateString(language === 'es' ? 'es-ES' : 'en-US', {\n\t\t\tyear: 'numeric',\n\t\t\tmonth: 'long',\n\t\t\tday: 'numeric'\n\t\t});\n\t};\n\n\tconst handleDeleteSickDay = async (sickDay: SickDayModel) => {\n\t\tif (!window.confirm(t.confirmDeleteSickDay)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst sickDayORM = SickDayORM.getInstance();\n\t\tawait sickDayORM.deleteSickDayById(sickDay.id);\n\t\tawait loadAllSickDays();\n\t};\n\n\tconst calculateTotalSickHours = () => {\n\t\treturn filteredSickDays.reduce((sum, sd) => sum + sd.hours, 0);\n\t};\n\n\treturn (\n\t\t<Card>\n\t\t\t<CardHeader>\n\t\t\t\t<div className=\"flex justify-between items-center\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<CardTitle className=\"flex items-center gap-2\">\n\t\t\t\t\t\t\t<Heart className=\"w-5 h-5 text-red-500\" />\n\t\t\t\t\t\t\t{t.sickDayHistory}\n\t\t\t\t\t\t</CardTitle>\n\t\t\t\t\t\t<CardDescription>\n\t\t\t\t\t\t\t{t.totalSickDays}: {calculateTotalSickHours().toFixed(1)} {language === 'es' ? 'hrs' : 'hrs'}\n\t\t\t\t\t\t</CardDescription>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</CardHeader>\n\t\t\t<CardContent className=\"space-y-4\">\n\t\t\t\t<div className=\"flex gap-4 flex-wrap\">\n\t\t\t\t\t<div className=\"flex-1 min-w-[200px]\">\n\t\t\t\t\t\t<Label>{t.filterByEmployee}</Label>\n\t\t\t\t\t\t<Select value={selectedEmployee} onValueChange={setSelectedEmployee}>\n\t\t\t\t\t\t\t<SelectTrigger>\n\t\t\t\t\t\t\t\t<SelectValue />\n\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t<SelectItem value=\"all\">{t.allEmployees}</SelectItem>\n\t\t\t\t\t\t\t\t{users.filter(u => u.role === UserRole.Employee).map((u) => (\n\t\t\t\t\t\t\t\t\t<SelectItem key={u.id} value={u.id}>\n\t\t\t\t\t\t\t\t\t\t{u.name}\n\t\t\t\t\t\t\t\t\t</SelectItem>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t</Select>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div className=\"flex-1 min-w-[200px]\">\n\t\t\t\t\t\t<Label>{t.filterByDate}</Label>\n\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\ttype=\"date\"\n\t\t\t\t\t\t\tvalue={dateFilter}\n\t\t\t\t\t\t\tonChange={(e) => setDateFilter(e.target.value)}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{(selectedEmployee !== \"all\" || dateFilter) && (\n\t\t\t\t\t\t<div className=\"flex items-end\">\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\t\tsetSelectedEmployee(\"all\");\n\t\t\t\t\t\t\t\t\tsetDateFilter(\"\");\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{t.clearFilters}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\n\t\t\t\t{filteredSickDays.length === 0 ? (\n\t\t\t\t\t<p className=\"text-center text-muted-foreground py-8\">{t.noSickDays}</p>\n\t\t\t\t) : (\n\t\t\t\t\t<div className=\"overflow-x-auto\">\n\t\t\t\t\t\t<Table>\n\t\t\t\t\t\t\t<TableHeader>\n\t\t\t\t\t\t\t\t<TableRow>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.employeeName}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.sickDayDate}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.sickDayHours}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.sickDayNotes}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.actions}</TableHead>\n\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t</TableHeader>\n\t\t\t\t\t\t\t<TableBody>\n\t\t\t\t\t\t\t\t{filteredSickDays.map((sd) => (\n\t\t\t\t\t\t\t\t\t<TableRow key={sd.id}>\n\t\t\t\t\t\t\t\t\t\t<TableCell className=\"font-medium whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t{getUserName(sd.user_id)}\n\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t{formatDate(sd.sick_date)}\n\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell>{sd.hours} hrs</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell className=\"max-w-xs truncate\">{sd.notes || \"—\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => handleDeleteSickDay(sd)}\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"text-red-600 hover:text-red-700 hover:bg-red-50\"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<Trash2 className=\"w-4 h-4\" />\n\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</TableBody>\n\t\t\t\t\t\t</Table>\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\t\t\t</CardContent>\n\t\t</Card>\n\t);\n}\n\nfunction ReportsTab({ users, language }: { users: UserModel[]; language: Language }) {\n\tconst [weekStart, setWeekStart] = useState(\"\");\n\tconst [reportData, setReportData] = useState<{ user: UserModel; regularHours: number; overtimeHours: number; totalHours: number; regularPay: number; overtimePay: number; totalPay: number }[]>([]);\n\tconst [detailedTimeCards, setDetailedTimeCards] = useState<TimeCardEntryModel[]>([]);\n\n\tconst t = translations[language];\n\n\tuseEffect(() => {\n\t\t// Set default to current week\n\t\tconst today = new Date();\n\t\tconst monday = new Date(today);\n\t\tmonday.setDate(today.getDate() - today.getDay() + 1);\n\t\tsetWeekStart(monday.toISOString().slice(0, 10));\n\t}, []);\n\n\tuseEffect(() => {\n\t\tif (weekStart) {\n\t\t\tloadWeeklyReport();\n\t\t}\n\t}, [weekStart, users]);\n\n\tconst loadWeeklyReport = async () => {\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\t\tconst allCards = await timeCardORM.getAllTimeCardEntry();\n\n\t\t// Normalize data from ORM\n\t\tconst normalized = normalizeTimeCardEntriesFromORM(allCards);\n\n\t\tconst weekStartDate = new Date(weekStart);\n\t\tconst weekStartTimestamp = Math.floor(weekStartDate.getTime() / 1000);\n\t\tconst weekEndTimestamp = weekStartTimestamp + 604800; // 7 days\n\n\t\tconst weekCards = normalized.filter(tc => {\n\t\t\tconst clockIn = parseInt(tc.clock_in_timestamp);\n\t\t\treturn clockIn >= weekStartTimestamp && clockIn < weekEndTimestamp && tc.total_hours;\n\t\t});\n\n\t\t// Store detailed time cards\n\t\tsetDetailedTimeCards(weekCards.sort((a, b) => parseInt(a.clock_in_timestamp) - parseInt(b.clock_in_timestamp)));\n\n\t\tconst employeeHours = users\n\t\t\t.filter(u => u.role === UserRole.Employee)\n\t\t\t.map(user => {\n\t\t\t\tconst userCards = weekCards.filter(tc => tc.user_id === user.id);\n\t\t\t\tconst totalHours = userCards.reduce((sum, tc) => sum + (tc.total_hours || 0), 0);\n\t\t\t\tconst regularHours = Math.min(totalHours, 40);\n\t\t\t\tconst overtimeHours = Math.max(totalHours - 40, 0);\n\n\t\t\t\t// Calculate pay\n\t\t\t\tconst hourlyRate = user.hourly_rate || 0;\n\t\t\t\tconst regularPay = regularHours * hourlyRate;\n\t\t\t\tconst overtimePay = overtimeHours * hourlyRate * 1.5;\n\t\t\t\tconst totalPay = regularPay + overtimePay;\n\n\t\t\t\treturn {\n\t\t\t\t\tuser,\n\t\t\t\t\tregularHours,\n\t\t\t\t\tovertimeHours,\n\t\t\t\t\ttotalHours,\n\t\t\t\t\tregularPay,\n\t\t\t\t\tovertimePay,\n\t\t\t\t\ttotalPay,\n\t\t\t\t};\n\t\t\t});\n\n\t\tsetReportData(employeeHours);\n\t};\n\n\tconst formatHours = (hours: number) => {\n\t\treturn `${hours.toFixed(2)} hrs`;\n\t};\n\n\tconst formatPay = (amount: number) => {\n\t\treturn `$${amount.toFixed(2)}`;\n\t};\n\n\tconst formatDate = (timestamp: string) => {\n\t\tconst date = new Date(parseInt(timestamp) * 1000);\n\t\treturn date.toLocaleString(language === 'es' ? 'es-ES' : 'en-US');\n\t};\n\n\tconst formatDateOnly = (timestamp: string) => {\n\t\tconst date = new Date(parseInt(timestamp) * 1000);\n\t\treturn date.toLocaleDateString(language === 'es' ? 'es-ES' : 'en-US');\n\t};\n\n\tconst getDayOfWeek = (timestamp: string) => {\n\t\tconst date = new Date(parseInt(timestamp) * 1000);\n\t\treturn date.toLocaleDateString(language === 'es' ? 'es-ES' : 'en-US', { weekday: 'long' });\n\t};\n\n\tconst getUserName = (userId: string) => {\n\t\tconst user = users.find(u => u.id === userId);\n\t\treturn user?.name || \"Unknown\";\n\t};\n\n\tconst handlePrint = () => {\n\t\twindow.print();\n\t};\n\n\tconst handleExportCSV = () => {\n\t\tif (detailedTimeCards.length === 0) return;\n\n\t\t// Create CSV header\n\t\tconst headers = [\n\t\t\tt.employeeName,\n\t\t\tt.date,\n\t\t\tt.day,\n\t\t\tt.clockInTime,\n\t\t\tt.clockOutTime,\n\t\t\tt.location,\n\t\t\tt.workDescription,\n\t\t\tt.lunchDuration,\n\t\t\tt.hours,\n\t\t\tt.hourlyRate,\n\t\t\tt.pay\n\t\t];\n\n\t\t// Create CSV rows\n\t\tconst rows = detailedTimeCards.map(tc => {\n\t\t\tconst user = users.find(u => u.id === tc.user_id);\n\t\t\tconst userName = user?.name || \"Unknown\";\n\t\t\tconst hourlyRate = user?.hourly_rate || 0;\n\t\t\tconst date = formatDateOnly(tc.clock_in_timestamp);\n\t\t\tconst day = getDayOfWeek(tc.clock_in_timestamp);\n\t\t\tconst clockIn = formatDate(tc.clock_in_timestamp);\n\t\t\tconst clockOut = tc.clock_out_timestamp ? formatDate(tc.clock_out_timestamp) : \"—\";\n\t\t\tconst location = tc.location || \"—\";\n\t\t\tconst workDescription = (tc.work_description || \"—\").replace(/\"/g, '\"\"'); // Escape quotes\n\t\t\tconst lunchDuration = tc.lunch_duration_minutes ? `${Math.round(tc.lunch_duration_minutes)} min` : \"—\";\n\t\t\tconst hours = tc.total_hours ? `${tc.total_hours.toFixed(2)} hrs` : \"—\";\n\t\t\tconst pay = tc.total_hours ? formatPay(tc.total_hours * hourlyRate) : \"—\";\n\n\t\t\treturn [\n\t\t\t\t`\"${userName}\"`,\n\t\t\t\t`\"${date}\"`,\n\t\t\t\t`\"${day}\"`,\n\t\t\t\t`\"${clockIn}\"`,\n\t\t\t\t`\"${clockOut}\"`,\n\t\t\t\t`\"${location}\"`,\n\t\t\t\t`\"${workDescription}\"`,\n\t\t\t\t`\"${lunchDuration}\"`,\n\t\t\t\t`\"${hours}\"`,\n\t\t\t\t`\"${formatPay(hourlyRate)}\"`,\n\t\t\t\t`\"${pay}\"`\n\t\t\t].join(',');\n\t\t});\n\n\t\t// Combine header and rows\n\t\tconst csv = [headers.join(','), ...rows].join('\\n');\n\n\t\t// Create blob and download\n\t\tconst blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });\n\t\tconst link = document.createElement('a');\n\t\tconst url = URL.createObjectURL(blob);\n\t\tlink.setAttribute('href', url);\n\t\tlink.setAttribute('download', `weekly-report-${weekStart}.csv`);\n\t\tlink.style.visibility = 'hidden';\n\t\tdocument.body.appendChild(link);\n\t\tlink.click();\n\t\tdocument.body.removeChild(link);\n\t};\n\n\treturn (\n\t\t<div className=\"space-y-4\">\n\t\t\t<Card>\n\t\t\t\t<CardHeader>\n\t\t\t\t\t<div className=\"flex justify-between items-center\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<CardTitle>{t.weeklyReport}</CardTitle>\n\t\t\t\t\t\t\t<CardDescription>\n\t\t\t\t\t\t\t\tOvertime calculated for hours worked beyond 40 hours/week\n\t\t\t\t\t\t\t\t<br />\n\t\t\t\t\t\t\t\t<span className=\"text-xs text-muted-foreground\">\n\t\t\t\t\t\t\t\t\tNote: Sick days are tracked separately in the \"Sick Days\" tab and are NOT included in this time card report.\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</CardDescription>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"flex gap-2 print:hidden\">\n\t\t\t\t\t\t\t<Button onClick={handleExportCSV} variant=\"outline\" disabled={detailedTimeCards.length === 0}>\n\t\t\t\t\t\t\t\t<FileText className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t\t\t\t{t.exportCSV}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t<Button onClick={handlePrint} variant=\"outline\" disabled={detailedTimeCards.length === 0}>\n\t\t\t\t\t\t\t\t<FileText className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t\t\t\t{t.printReport}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</CardHeader>\n\t\t\t\t<CardContent className=\"space-y-4\">\n\t\t\t\t\t<div className=\"max-w-xs print:hidden\">\n\t\t\t\t\t\t<Label>{t.selectWeek}</Label>\n\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\ttype=\"date\"\n\t\t\t\t\t\t\tvalue={weekStart}\n\t\t\t\t\t\t\tonChange={(e) => setWeekStart(e.target.value)}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{reportData.length === 0 ? (\n\t\t\t\t\t\t<p className=\"text-center text-muted-foreground py-8\">{t.noReportData}</p>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t{/* Summary Table */}\n\t\t\t\t\t\t\t<div className=\"overflow-x-auto\">\n\t\t\t\t\t\t\t\t<Table>\n\t\t\t\t\t\t\t\t\t<TableHeader>\n\t\t\t\t\t\t\t\t\t\t<TableRow>\n\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.employeeName}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.regularHours}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.overtimeHours}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.totalHours}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.regularPay}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.overtimePay}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.totalPay}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t<TableHead className=\"print:hidden\">{t.status}</TableHead>\n\t\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t\t</TableHeader>\n\t\t\t\t\t\t\t\t\t<TableBody>\n\t\t\t\t\t\t\t\t\t\t{reportData.map(({ user, regularHours, overtimeHours, totalHours, regularPay, overtimePay, totalPay }) => (\n\t\t\t\t\t\t\t\t\t\t\t<TableRow key={user.id}>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"font-medium\">{user.name}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableCell>{formatHours(regularHours)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{overtimeHours > 0 ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-orange-600 font-semibold\">{formatHours(overtimeHours)}</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tformatHours(0)\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"font-semibold\">{formatHours(totalHours)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableCell>{formatPay(regularPay)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{overtimePay > 0 ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-orange-600 font-semibold\">{formatPay(overtimePay)}</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tformatPay(0)\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"font-semibold\">{formatPay(totalPay)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"print:hidden\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{overtimeHours > 0 && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Badge className=\"bg-orange-500\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<AlertCircle className=\"w-3 h-3 mr-1\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{t.overtimeAlert}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t\t</TableBody>\n\t\t\t\t\t\t\t\t</Table>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t{/* Detailed Time Cards Table */}\n\t\t\t\t\t\t\t<div className=\"mt-8\">\n\t\t\t\t\t\t\t\t<h3 className=\"text-lg font-semibold mb-4\">{t.detailedReport}</h3>\n\t\t\t\t\t\t\t\t<div className=\"overflow-x-auto\">\n\t\t\t\t\t\t\t\t\t<Table className=\"print-table-responsive\">\n\t\t\t\t\t\t\t\t\t\t<TableHeader>\n\t\t\t\t\t\t\t\t\t\t\t<TableRow>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.employeeName}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.date}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.day}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.clockInTime}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.clockOutTime}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.location}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.workDescription}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.lunchDuration}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.hours}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.hourlyRate}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t\t<TableHead>{t.pay}</TableHead>\n\t\t\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t\t\t</TableHeader>\n\t\t\t\t\t\t\t\t\t\t<TableBody className=\"print-table-responsive\">\n\t\t\t\t\t\t\t\t\t\t\t{detailedTimeCards.map((tc) => {\n\t\t\t\t\t\t\t\t\t\t\t\tconst user = users.find(u => u.id === tc.user_id);\n\t\t\t\t\t\t\t\t\t\t\t\tconst hourlyRate = user?.hourly_rate || 0;\n\t\t\t\t\t\t\t\t\t\t\t\tconst pay = tc.total_hours ? tc.total_hours * hourlyRate : 0;\n\n\t\t\t\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<TableRow key={tc.id}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"font-medium whitespace-nowrap\">{user?.name || \"Unknown\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatDateOnly(tc.clock_in_timestamp)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{getDayOfWeek(tc.clock_in_timestamp)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">{formatDate(tc.clock_in_timestamp)}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{tc.clock_out_timestamp ? formatDate(tc.clock_out_timestamp) : \"—\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell>{tc.location || \"—\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"allow-wrap max-w-xs\">{tc.work_description || \"—\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{tc.lunch_duration_minutes ? `${Math.round(tc.lunch_duration_minutes)} min` : \"—\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{tc.total_hours ? `${tc.total_hours.toFixed(2)} hrs` : \"—\"}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{formatPay(hourlyRate)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TableCell className=\"whitespace-nowrap\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{formatPay(pay)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t\t\t\t</TableBody>\n\t\t\t\t\t\t\t\t\t</Table>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</>\n\t\t\t\t\t)}\n\t\t\t\t</CardContent>\n\t\t\t</Card>\n\t\t</div>\n\t);\n}\n\nfunction EmployeesTab({ users, language, onUsersChange }: { users: UserModel[]; language: Language; onUsersChange: () => void }) {\n\tconst [showAddEmployee, setShowAddEmployee] = useState(false);\n\tconst [editingEmployee, setEditingEmployee] = useState<UserModel | null>(null);\n\tconst [employeeName, setEmployeeName] = useState(\"\");\n\tconst [employeeEmail, setEmployeeEmail] = useState(\"\");\n\tconst [employeePhone, setEmployeePhone] = useState(\"\");\n\tconst [employeeRole, setEmployeeRole] = useState<UserRole>(UserRole.Employee);\n\tconst [employeeHourlyRate, setEmployeeHourlyRate] = useState(\"\");\n\tconst [deleteConfirm, setDeleteConfirm] = useState<UserModel | null>(null);\n\n\tconst t = translations[language];\n\n\tconst handleAddEmployee = async () => {\n\t\tconst userORM = UserORM.getInstance();\n\t\tawait userORM.insertUser([{\n\t\t\tname: employeeName,\n\t\t\temail: employeeEmail,\n\t\t\tphone: employeePhone || null,\n\t\t\trole: employeeRole,\n\t\t\thourly_rate: employeeHourlyRate ? parseFloat(employeeHourlyRate) : null,\n\t\t} as UserModel]);\n\n\t\tsetShowAddEmployee(false);\n\t\tsetEmployeeName(\"\");\n\t\tsetEmployeeEmail(\"\");\n\t\tsetEmployeePhone(\"\");\n\t\tsetEmployeeRole(UserRole.Employee);\n\t\tsetEmployeeHourlyRate(\"\");\n\t\tonUsersChange();\n\t};\n\n\tconst handleEditEmployee = async () => {\n\t\tif (!editingEmployee) return;\n\n\t\tconst userORM = UserORM.getInstance();\n\t\tawait userORM.setUserById(editingEmployee.id, {\n\t\t\t...editingEmployee,\n\t\t\tname: employeeName,\n\t\t\temail: employeeEmail,\n\t\t\tphone: employeePhone || null,\n\t\t\trole: employeeRole,\n\t\t\thourly_rate: employeeHourlyRate ? parseFloat(employeeHourlyRate) : null,\n\t\t});\n\n\t\tsetEditingEmployee(null);\n\t\tsetEmployeeName(\"\");\n\t\tsetEmployeeEmail(\"\");\n\t\tsetEmployeePhone(\"\");\n\t\tsetEmployeeRole(UserRole.Employee);\n\t\tsetEmployeeHourlyRate(\"\");\n\t\tonUsersChange();\n\t};\n\n\tconst handleDeleteEmployee = async (user: UserModel) => {\n\t\tconst userORM = UserORM.getInstance();\n\t\tawait userORM.deleteUserById(user.id);\n\t\tsetDeleteConfirm(null);\n\t\tonUsersChange();\n\t};\n\n\tconst openEditDialog = (user: UserModel) => {\n\t\tsetEditingEmployee(user);\n\t\tsetEmployeeName(user.name);\n\t\tsetEmployeeEmail(user.email);\n\t\tsetEmployeePhone(user.phone || \"\");\n\t\tsetEmployeeRole(user.role);\n\t\tsetEmployeeHourlyRate(user.hourly_rate ? user.hourly_rate.toString() : \"\");\n\t};\n\n\tconst copyEmployeeLink = (userId: string) => {\n\t\tconst baseUrl = window.location.origin + window.location.pathname;\n\t\tconst employeeUrl = `${baseUrl}?employee=${userId}`;\n\n\t\tnavigator.clipboard.writeText(employeeUrl).then(() => {\n\t\t\talert(t.employeeLinkCopied);\n\t\t});\n\t};\n\n\treturn (\n\t\t<div className=\"space-y-4\">\n\t\t\t<Card>\n\t\t\t\t<CardHeader>\n\t\t\t\t\t<div className=\"flex justify-between items-center\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<CardTitle>{t.employees}</CardTitle>\n\t\t\t\t\t\t\t<CardDescription>Manage employee accounts</CardDescription>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<Button onClick={() => setShowAddEmployee(true)}>\n\t\t\t\t\t\t\t<UserPlus className=\"w-4 h-4 mr-2\" />\n\t\t\t\t\t\t\t{t.addEmployee}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t</CardHeader>\n\t\t\t\t<CardContent>\n\t\t\t\t\t<div className=\"overflow-x-auto\">\n\t\t\t\t\t\t<Table>\n\t\t\t\t\t\t\t<TableHeader>\n\t\t\t\t\t\t\t\t<TableRow>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.name}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.email}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.phone}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.role}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.hourlyRate}</TableHead>\n\t\t\t\t\t\t\t\t\t<TableHead>{t.actions}</TableHead>\n\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t</TableHeader>\n\t\t\t\t\t\t\t<TableBody>\n\t\t\t\t\t\t\t\t{users.map((user) => (\n\t\t\t\t\t\t\t\t\t<TableRow key={user.id}>\n\t\t\t\t\t\t\t\t\t\t<TableCell className=\"font-medium\">{user.name}</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell>{user.email}</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell>{user.phone || \"—\"}</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<Badge variant={user.role === UserRole.Manager ? \"default\" : \"secondary\"}>\n\t\t\t\t\t\t\t\t\t\t\t\t{user.role === UserRole.Manager ? t.manager : t.employee}\n\t\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t{user.hourly_rate ? `$${user.hourly_rate.toFixed(2)}/hr` : \"—\"}\n\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t\t<TableCell>\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => openEditDialog(user)}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{t.edit}\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"destructive\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => setDeleteConfirm(user)}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{t.delete}\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</TableCell>\n\t\t\t\t\t\t\t\t\t</TableRow>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</TableBody>\n\t\t\t\t\t\t</Table>\n\t\t\t\t\t</div>\n\t\t\t\t</CardContent>\n\t\t\t</Card>\n\n\t\t\t<Dialog open={showAddEmployee} onOpenChange={setShowAddEmployee}>\n\t\t\t\t<DialogContent>\n\t\t\t\t\t<DialogHeader>\n\t\t\t\t\t\t<DialogTitle>{t.addEmployee}</DialogTitle>\n\t\t\t\t\t</DialogHeader>\n\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.name}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\tvalue={employeeName}\n\t\t\t\t\t\t\t\tonChange={(e) => setEmployeeName(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder=\"John Doe\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.email}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"email\"\n\t\t\t\t\t\t\t\tvalue={employeeEmail}\n\t\t\t\t\t\t\t\tonChange={(e) => setEmployeeEmail(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder=\"john@example.com\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.phone}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"tel\"\n\t\t\t\t\t\t\t\tvalue={employeePhone}\n\t\t\t\t\t\t\t\tonChange={(e) => setEmployeePhone(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder=\"+1 (555) 123-4567\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.role}</Label>\n\t\t\t\t\t\t\t<Select value={employeeRole.toString()} onValueChange={(v) => setEmployeeRole(parseInt(v))}>\n\t\t\t\t\t\t\t\t<SelectTrigger>\n\t\t\t\t\t\t\t\t\t<SelectValue />\n\t\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t\t<SelectItem value={UserRole.Employee.toString()}>{t.employee}</SelectItem>\n\t\t\t\t\t\t\t\t\t<SelectItem value={UserRole.Manager.toString()}>{t.manager}</SelectItem>\n\t\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t\t</Select>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.hourlyRate}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\tmin=\"0\"\n\t\t\t\t\t\t\t\tstep=\"0.01\"\n\t\t\t\t\t\t\t\tvalue={employeeHourlyRate}\n\t\t\t\t\t\t\t\tonChange={(e) => setEmployeeHourlyRate(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder=\"15.00\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<DialogFooter>\n\t\t\t\t\t\t<Button variant=\"outline\" onClick={() => setShowAddEmployee(false)}>\n\t\t\t\t\t\t\t{t.cancel}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button onClick={handleAddEmployee} disabled={!employeeName || !employeeEmail}>\n\t\t\t\t\t\t\t{t.saveChanges}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</DialogFooter>\n\t\t\t\t</DialogContent>\n\t\t\t</Dialog>\n\n\t\t\t<Dialog open={!!editingEmployee} onOpenChange={(open) => !open && setEditingEmployee(null)}>\n\t\t\t\t<DialogContent>\n\t\t\t\t\t<DialogHeader>\n\t\t\t\t\t\t<DialogTitle>{t.editEmployee}</DialogTitle>\n\t\t\t\t\t</DialogHeader>\n\t\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.name}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\tvalue={employeeName}\n\t\t\t\t\t\t\t\tonChange={(e) => setEmployeeName(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.email}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"email\"\n\t\t\t\t\t\t\t\tvalue={employeeEmail}\n\t\t\t\t\t\t\t\tonChange={(e) => setEmployeeEmail(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.phone}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"tel\"\n\t\t\t\t\t\t\t\tvalue={employeePhone}\n\t\t\t\t\t\t\t\tonChange={(e) => setEmployeePhone(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder=\"+1 (555) 123-4567\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.role}</Label>\n\t\t\t\t\t\t\t<Select value={employeeRole.toString()} onValueChange={(v) => setEmployeeRole(parseInt(v))}>\n\t\t\t\t\t\t\t\t<SelectTrigger>\n\t\t\t\t\t\t\t\t\t<SelectValue />\n\t\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t\t<SelectItem value={UserRole.Employee.toString()}>{t.employee}</SelectItem>\n\t\t\t\t\t\t\t\t\t<SelectItem value={UserRole.Manager.toString()}>{t.manager}</SelectItem>\n\t\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t\t</Select>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.hourlyRate}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\tmin=\"0\"\n\t\t\t\t\t\t\t\tstep=\"0.01\"\n\t\t\t\t\t\t\t\tvalue={employeeHourlyRate}\n\t\t\t\t\t\t\t\tonChange={(e) => setEmployeeHourlyRate(e.target.value)}\n\t\t\t\t\t\t\t\tplaceholder=\"15.00\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<DialogFooter>\n\t\t\t\t\t\t<Button variant=\"outline\" onClick={() => setEditingEmployee(null)}>\n\t\t\t\t\t\t\t{t.cancel}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button onClick={handleEditEmployee}>\n\t\t\t\t\t\t\t{t.saveChanges}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</DialogFooter>\n\t\t\t\t</DialogContent>\n\t\t\t</Dialog>\n\n\t\t\t<Dialog open={!!deleteConfirm} onOpenChange={(open) => !open && setDeleteConfirm(null)}>\n\t\t\t\t<DialogContent>\n\t\t\t\t\t<DialogHeader>\n\t\t\t\t\t\t<DialogTitle>{t.deleteEmployee}</DialogTitle>\n\t\t\t\t\t</DialogHeader>\n\t\t\t\t\t<p>{t.confirmDelete}</p>\n\t\t\t\t\t<p className=\"font-semibold\">{deleteConfirm?.name}</p>\n\t\t\t\t\t<DialogFooter>\n\t\t\t\t\t\t<Button variant=\"outline\" onClick={() => setDeleteConfirm(null)}>\n\t\t\t\t\t\t\t{t.cancel}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button variant=\"destructive\" onClick={() => deleteConfirm && handleDeleteEmployee(deleteConfirm)}>\n\t\t\t\t\t\t\t{t.delete}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</DialogFooter>\n\t\t\t\t</DialogContent>\n\t\t\t</Dialog>\n\t\t</div>\n\t);\n}\n\nfunction ManualEntryDialog({\n\topen,\n\tonClose,\n\tuserId,\n\tonSave,\n\tlanguage,\n\tusers\n}: {\n\topen: boolean;\n\tonClose: () => void;\n\tuserId: string;\n\tonSave: () => void;\n\tlanguage: Language;\n\tusers?: UserModel[];\n}) {\n\tconst [selectedUser, setSelectedUser] = useState(userId);\n\tconst [clockIn, setClockIn] = useState(\"\");\n\tconst [clockOut, setClockOut] = useState(\"\");\n\tconst [location, setLocation] = useState(\"\");\n\tconst [workDescription, setWorkDescription] = useState(\"\");\n\tconst [lunchStart, setLunchStart] = useState(\"\");\n\tconst [lunchEnd, setLunchEnd] = useState(\"\");\n\n\tconst t = translations[language];\n\n\tuseEffect(() => {\n\t\tif (open) {\n\t\t\tsetSelectedUser(userId);\n\t\t\t// Set default to today\n\t\t\tconst now = new Date();\n\t\t\tconst today = now.toISOString().slice(0, 10);\n\t\t\tsetClockIn(`${today}T09:00`);\n\t\t\tsetClockOut(`${today}T17:00`);\n\t\t\tsetLocation(\"\");\n\t\t\tsetWorkDescription(\"\");\n\t\t\tsetLunchStart(`${today}T12:00`);\n\t\t\tsetLunchEnd(`${today}T13:00`);\n\t\t}\n\t}, [open, userId]);\n\n\tconst handleSave = async () => {\n\t\tconst timeCardORM = TimeCardEntryORM.getInstance();\n\n\t\tconst clockInTimestamp = Math.floor(new Date(clockIn).getTime() / 1000).toString();\n\t\tconst clockOutTimestamp = clockOut ? Math.floor(new Date(clockOut).getTime() / 1000).toString() : undefined;\n\t\tconst lunchStartTimestamp = lunchStart ? Math.floor(new Date(lunchStart).getTime() / 1000).toString() : undefined;\n\t\tconst lunchEndTimestamp = lunchEnd ? Math.floor(new Date(lunchEnd).getTime() / 1000).toString() : undefined;\n\n\t\tlet totalHours: number | undefined = undefined;\n\t\tlet lunchDurationMinutes: number | undefined = undefined;\n\n\t\t// Calculate lunch duration\n\t\tif (lunchStartTimestamp && lunchEndTimestamp) {\n\t\t\tconst lunchStartTime = parseInt(lunchStartTimestamp);\n\t\t\tconst lunchEndTime = parseInt(lunchEndTimestamp);\n\t\t\tlunchDurationMinutes = (lunchEndTime - lunchStartTime) / 60;\n\t\t}\n\n\t\t// Calculate total hours\n\t\tif (clockOutTimestamp) {\n\t\t\tconst clockInTime = parseInt(clockInTimestamp);\n\t\t\tconst clockOutTime = parseInt(clockOutTimestamp);\n\t\t\ttotalHours = (clockOutTime - clockInTime) / 3600;\n\n\t\t\t// Deduct lunch time\n\t\t\tif (lunchDurationMinutes) {\n\t\t\t\ttotalHours -= lunchDurationMinutes / 60;\n\t\t\t}\n\t\t}\n\n\t\tconst entryData = {\n\t\t\tuser_id: selectedUser,\n\t\t\tclock_in_timestamp: clockInTimestamp,\n\t\t\tclock_out_timestamp: clockOutTimestamp,\n\t\t\ttotal_hours: totalHours,\n\t\t\tlocation: location || undefined,\n\t\t\twork_description: workDescription || undefined,\n\t\t\tlunch_start_timestamp: lunchStartTimestamp,\n\t\t\tlunch_end_timestamp: lunchEndTimestamp,\n\t\t\tlunch_duration_minutes: lunchDurationMinutes,\n\t\t} as TimeCardEntryModel;\n\n\t\tconst normalizedEntry = normalizeTimeCardEntryForSave(entryData);\n\t\tawait timeCardORM.insertTimeCardEntry([normalizedEntry as TimeCardEntryModel]);\n\n\t\tonSave();\n\t\tonClose();\n\t};\n\n\treturn (\n\t\t<Dialog open={open} onOpenChange={onClose}>\n\t\t\t<DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n\t\t\t\t<DialogHeader>\n\t\t\t\t\t<DialogTitle>{t.addManualEntry}</DialogTitle>\n\t\t\t\t</DialogHeader>\n\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t{users && (\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.employeeName}</Label>\n\t\t\t\t\t\t\t<Select value={selectedUser} onValueChange={setSelectedUser}>\n\t\t\t\t\t\t\t\t<SelectTrigger>\n\t\t\t\t\t\t\t\t\t<SelectValue />\n\t\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t\t{users.filter(u => u.role === UserRole.Employee).map((u) => (\n\t\t\t\t\t\t\t\t\t\t<SelectItem key={u.id} value={u.id}>\n\t\t\t\t\t\t\t\t\t\t\t{u.name}\n\t\t\t\t\t\t\t\t\t\t</SelectItem>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t\t</Select>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t\t<div className=\"grid grid-cols-2 gap-4\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.clockInTime}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\tvalue={clockIn}\n\t\t\t\t\t\t\t\tonChange={(e) => setClockIn(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.clockOutTime}</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\tvalue={clockOut}\n\t\t\t\t\t\t\t\tonChange={(e) => setClockOut(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<Label>{t.location}</Label>\n\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\tvalue={location}\n\t\t\t\t\t\t\tonChange={(e) => setLocation(e.target.value)}\n\t\t\t\t\t\t\tplaceholder={t.locationPlaceholder}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<Label>{t.workDescription}</Label>\n\t\t\t\t\t\t<Textarea\n\t\t\t\t\t\t\tvalue={workDescription}\n\t\t\t\t\t\t\tonChange={(e) => setWorkDescription(e.target.value)}\n\t\t\t\t\t\t\tplaceholder={t.descriptionPlaceholder}\n\t\t\t\t\t\t\trows={4}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"grid grid-cols-2 gap-4\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.lunchStartTime} ({language === 'en' ? 'Optional' : 'Opcional'})</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\tvalue={lunchStart}\n\t\t\t\t\t\t\t\tonChange={(e) => setLunchStart(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Label>{t.lunchEndTime} ({language === 'en' ? 'Optional' : 'Opcional'})</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"datetime-local\"\n\t\t\t\t\t\t\t\tvalue={lunchEnd}\n\t\t\t\t\t\t\t\tonChange={(e) => setLunchEnd(e.target.value)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<DialogFooter>\n\t\t\t\t\t<Button variant=\"outline\" onClick={onClose}>\n\t\t\t\t\t\t{t.cancel}\n\t\t\t\t\t</Button>\n\t\t\t\t\t<Button onClick={handleSave} disabled={!selectedUser || !clockIn}>\n\t\t\t\t\t\t{t.saveChanges}\n\t\t\t\t\t</Button>\n\t\t\t\t</DialogFooter>\n\t\t\t</DialogContent>\n\t\t</Dialog>\n\t);\n}\n","structuredPatch":[{"oldStart":2118,"oldLines":7,"newStart":2118,"newLines":16,"lines":["                       {user.hourly_rate ? `$${user.hourly_rate.toFixed(2)}/hr` : \"—\"}","                     </TableCell>","                     <TableCell>","-                      <div className=\"flex gap-2\">","+                      <div className=\"flex gap-2 flex-wrap\">","+                        {user.role === UserRole.Employee && (","+                          <Button","+                            variant=\"secondary\"","+                            size=\"sm\"","+                            onClick={() => copyEmployeeLink(user.id)}","+                          >","+                            {t.copyEmployeeLink}","+                          </Button>","+                        )}","                         <Button","                           variant=\"outline\"","                           size=\"sm\""]}],"userModified":false,"replaceAll":false}}
{"type":"assistant","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_vrtx_01LvYg5RDHLBnoc8TCZCdEXm","type":"message","role":"assistant","content":[{"type":"text","text":"Perfect! Now let me update the todo list and run validation:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":0,"cache_creation_input_tokens":1030,"cache_read_input_tokens":55476,"cache_creation":{"ephemeral_5m_input_tokens":1030,"ephemeral_1h_input_tokens":0},"output_tokens":1},"context_management":null},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"1a5d0297-4fe1-4784-bf1b-ecacb26134da"}
{"type":"assistant","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_vrtx_01LvYg5RDHLBnoc8TCZCdEXm","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_vrtx_01Lb1jSmcrKzFXJZonWH8hPc","name":"TodoWrite","input":{"todos":[{"content":"Create shareable employee view with limited access","status":"completed","activeForm":"Creating employee view"},{"content":"Add employee link generation for managers","status":"completed","activeForm":"Adding link generation"},{"content":"Update translations for employee view","status":"completed","activeForm":"Updating translations"},{"content":"Test and validate changes","status":"in_progress","activeForm":"Testing changes"}]}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":0,"cache_creation_input_tokens":1030,"cache_read_input_tokens":55476,"cache_creation":{"ephemeral_5m_input_tokens":1030,"ephemeral_1h_input_tokens":0},"output_tokens":174},"context_management":null},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"b9d2aafa-5576-4cc3-83d9-cb108b09f8a9"}
{"type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_vrtx_01Lb1jSmcrKzFXJZonWH8hPc","type":"tool_result","content":"Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable"}]},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"5ae83c05-d62e-43d0-a119-e8357cdb91be","tool_use_result":{"oldTodos":[{"content":"Create shareable employee view with limited access","status":"in_progress","activeForm":"Creating employee view"},{"content":"Add employee link generation for managers","status":"in_progress","activeForm":"Adding link generation"},{"content":"Update translations for employee view","status":"completed","activeForm":"Updating translations"},{"content":"Test and validate changes","status":"pending","activeForm":"Testing changes"}],"newTodos":[{"content":"Create shareable employee view with limited access","status":"completed","activeForm":"Creating employee view"},{"content":"Add employee link generation for managers","status":"completed","activeForm":"Adding link generation"},{"content":"Update translations for employee view","status":"completed","activeForm":"Updating translations"},{"content":"Test and validate changes","status":"in_progress","activeForm":"Testing changes"}]}}
{"type":"assistant","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_vrtx_01VrJqWotkWE9mFRjSdyvcb8","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_vrtx_01M22WEga2gKURcjbjxdUkKK","name":"Bash","input":{"command":"npm run check:safe","description":"Run TypeScript and ESLint validation"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":0,"cache_creation_input_tokens":216,"cache_read_input_tokens":56506,"cache_creation":{"ephemeral_5m_input_tokens":216,"ephemeral_1h_input_tokens":0},"output_tokens":80},"context_management":null},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"cdf33550-6342-4302-a12f-48ed8d8bf48e"}
{"type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_vrtx_01M22WEga2gKURcjbjxdUkKK","type":"tool_result","content":"> check:safe\n> timeout 20 npm run check || (echo 'Check timed out after 20 seconds' && exit 1)\n\n\n> check\n> tsgo --noEmit && npm run lint:radix -- --fix && npm run format\n\n\n> lint:radix\n> grep -l -r '<SelectItem' src | xargs eslint --config config/eslint/eslint.radix.config.js --fix\n\n\n> format\n> biome check --write --unsafe\n\nChecked 6 files in 58ms. No fixes applied.","is_error":false}]},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"fb98750e-00eb-41db-a56b-193e9d6ea7eb","tool_use_result":{"stdout":"> check:safe\n> timeout 20 npm run check || (echo 'Check timed out after 20 seconds' && exit 1)\n\n\n> check\n> tsgo --noEmit && npm run lint:radix -- --fix && npm run format\n\n\n> lint:radix\n> grep -l -r '<SelectItem' src | xargs eslint --config config/eslint/eslint.radix.config.js --fix\n\n\n> format\n> biome check --write --unsafe\n\nChecked 6 files in 58ms. No fixes applied.","stderr":"","interrupted":false,"isImage":false}}
{"type":"assistant","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_vrtx_01GTPfixebx9gWUQBZGgszjT","type":"message","role":"assistant","content":[{"type":"text","text":"Excellent! All checks pass. Let me mark the final task as complete:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":0,"cache_creation_input_tokens":217,"cache_read_input_tokens":56722,"cache_creation":{"ephemeral_5m_input_tokens":217,"ephemeral_1h_input_tokens":0},"output_tokens":5},"context_management":null},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"08887ca9-99da-43e6-ac9b-ad34d05cb80e"}
{"type":"assistant","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_vrtx_01GTPfixebx9gWUQBZGgszjT","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_vrtx_013LjZhPzMcqSd8nwZtus5Vu","name":"TodoWrite","input":{"todos":[{"content":"Create shareable employee view with limited access","status":"completed","activeForm":"Creating employee view"},{"content":"Add employee link generation for managers","status":"completed","activeForm":"Adding link generation"},{"content":"Update translations for employee view","status":"completed","activeForm":"Updating translations"},{"content":"Test and validate changes","status":"completed","activeForm":"Testing changes"}]}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":0,"cache_creation_input_tokens":217,"cache_read_input_tokens":56722,"cache_creation":{"ephemeral_5m_input_tokens":217,"ephemeral_1h_input_tokens":0},"output_tokens":175},"context_management":null},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"58995e52-0adc-41ec-ab2f-080004513b4f"}
{"type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_vrtx_013LjZhPzMcqSd8nwZtus5Vu","type":"tool_result","content":"Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable"}]},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"8b1eebfa-9791-43e1-84f6-96e701446b6b","tool_use_result":{"oldTodos":[{"content":"Create shareable employee view with limited access","status":"completed","activeForm":"Creating employee view"},{"content":"Add employee link generation for managers","status":"completed","activeForm":"Adding link generation"},{"content":"Update translations for employee view","status":"completed","activeForm":"Updating translations"},{"content":"Test and validate changes","status":"in_progress","activeForm":"Testing changes"}],"newTodos":[{"content":"Create shareable employee view with limited access","status":"completed","activeForm":"Creating employee view"},{"content":"Add employee link generation for managers","status":"completed","activeForm":"Adding link generation"},{"content":"Update translations for employee view","status":"completed","activeForm":"Updating translations"},{"content":"Test and validate changes","status":"completed","activeForm":"Testing changes"}]}}
{"type":"assistant","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_vrtx_018wLZWwMiwz5bXpheg9vnFR","type":"message","role":"assistant","content":[{"type":"text","text":"Perfect! I've successfully implemented the employee-only shareable link feature. Here's what was added:\n\n## Employee-Only Shareable Links Feature ✓\n\n### 1. **URL Parameter Auto-Login** ✓\n- Employees can now access the app via a special URL with their ID: `?employee={user_id}`\n- When visiting this URL, employees are automatically logged in to their account\n- No need to select from the user dropdown - they go directly to their view\n\n### 2. **Employee-Only Mode** ✓\n- When accessing via the employee link, the app enters \"employee-only mode\"\n- In this mode:\n  - **Title changes** to \"My Time Tracking\" (instead of \"Time Tracking System\")\n  - **No \"Switch User\" button** - employees can't switch to other accounts\n  - **Language toggle still available** - employees can choose English/Spanish\n  - **Only their own data visible**:\n    - Their own clock in/out records\n    - Their own time cards\n    - Their own sick days\n    - Their own hours worked\n  - **No access to**:\n    - Other employees' information\n    - Manager features\n    - Pay rate information\n    - Reports\n\n### 3. **Manager Features** ✓\n- **\"Copy Employee Link\" button** added to the Employees tab\n- Button only appears for Employee role users (not for managers)\n- Clicking the button:\n  - Generates the unique employee URL\n  - Copies it to clipboard\n  - Shows confirmation alert\n- Managers can then share these links via email, text, or any method\n\n### 4. **Bilingual Support** ✓\n- All new features translated to English and Spanish:\n  - \"Copy Employee Link\" / \"Copiar Enlace de Empleado\"\n  - \"Employee link copied!\" / \"¡Enlace de empleado copiado!\"\n  - \"My Time Tracking\" / \"Mi Registro de Tiempo\"\n\n### How It Works:\n\n1. **Manager generates link**: \n   - Go to Employees tab\n   - Click \"Copy Employee Link\" for any employee\n   - Link is copied to clipboard (e.g., `https://yoursite.com/?employee=abc123`)\n\n2. **Share with employee**:\n   - Send the link via email, text message, or any communication method\n\n3. **Employee accesses their view**:\n   - Opens the link\n   - Automatically logged in as themselves\n   - Can only see and manage their own:\n     - Clock in/out\n     - Time tracking\n     - Sick days\n     - Hours worked\n   - **Cannot see**:\n     - Other employees' data\n     - Their hourly pay rate\n     - Manager features\n\nThis provides secure, isolated access for each employee while maintaining full control for managers!"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":0,"cache_creation_input_tokens":217,"cache_read_input_tokens":56939,"cache_creation":{"ephemeral_5m_input_tokens":217,"ephemeral_1h_input_tokens":0},"output_tokens":644},"context_management":null},"parent_tool_use_id":null,"session_id":"752928d6-a510-485a-bbfe-46da4a277f96","uuid":"9af5c1a2-4e4c-4c84-b2c9-5cae1d2bef7b"}
{"type":"result","subtype":"success","is_error":false,"duration_ms":143673,"duration_api_ms":136594,"num_turns":20,"result":"Perfect! I've successfully implemented the employee-only shareable link feature. Here's what was added:\n\n## Employee-Only Shareable Links Feature ✓\n\n### 1. **URL Parameter Auto-Login** ✓\n- Employees can now access the app via a special URL with their ID: `?employee={user_id}`\n- When visiting this URL, employees are automatically logged in to their account\n- No need to select from the user dropdown - they go directly to their view\n\n### 2. **Employee-Only Mode** ✓\n- When accessing via the employee link, the app enters \"employee-only mode\"\n- In this mode:\n  - **Title changes** to \"My Time Tracking\" (instead of \"Time Tracking System\")\n  - **No \"Switch User\" button** - employees can't switch to other accounts\n  - **Language toggle still available** - employees can choose English/Spanish\n  - **Only their own data visible**:\n    - Their own clock in/out records\n    - Their own time cards\n    - Their own sick days\n    - Their own hours worked\n  - **No access to**:\n    - Other employees' information\n    - Manager features\n    - Pay rate information\n    - Reports\n\n### 3. **Manager Features** ✓\n- **\"Copy Employee Link\" button** added to the Employees tab\n- Button only appears for Employee role users (not for managers)\n- Clicking the button:\n  - Generates the unique employee URL\n  - Copies it to clipboard\n  - Shows confirmation alert\n- Managers can then share these links via email, text, or any method\n\n### 4. **Bilingual Support** ✓\n- All new features translated to English and Spanish:\n  - \"Copy Employee Link\" / \"Copiar Enlace de Empleado\"\n  - \"Employee link copied!\" / \"¡Enlace de empleado copiado!\"\n  - \"My Time Tracking\" / \"Mi Registro de Tiempo\"\n\n### How It Works:\n\n1. **Manager generates link**: \n   - Go to Employees tab\n   - Click \"Copy Employee Link\" for any employee\n   - Link is copied to clipboard (e.g., `https://yoursite.com/?employee=abc123`)\n\n2. **Share with employee**:\n   - Send the link via email, text message, or any communication method\n\n3. **Employee accesses their view**:\n   - Opens the link\n   - Automatically logged in as themselves\n   - Can only see and manage their own:\n     - Clock in/out\n     - Time tracking\n     - Sick days\n     - Hours worked\n   - **Cannot see**:\n     - Other employees' data\n     - Their hourly pay rate\n     - Manager features\n\nThis provides secure, isolated access for each employee while maintaining full control for managers!","session_id":"752928d6-a510-485a-bbfe-46da4a277f96","total_cost_usd":0.5275289,"usage":{"input_tokens":35,"cache_creation_input_tokens":40846,"cache_read_input_tokens":954952,"output_tokens":5209,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":0,"ephemeral_5m_input_tokens":40846}},"modelUsage":{"claude-haiku-4-5-20251001":{"inputTokens":3369,"outputTokens":295,"cacheReadInputTokens":0,"cacheCreationInputTokens":0,"webSearchRequests":0,"costUSD":0.004844,"contextWindow":200000},"claude-sonnet-4-5":{"inputTokens":35,"outputTokens":5209,"cacheReadInputTokens":954952,"cacheCreationInputTokens":40846,"webSearchRequests":0,"costUSD":0.5178981,"contextWindow":200000},"claude-sonnet-4-5-20250929":{"inputTokens":2,"outputTokens":274,"cacheReadInputTokens":2236,"cacheCreationInputTokens":0,"webSearchRequests":0,"costUSD":0.0047868,"contextWindow":200000}},"permission_denials":[],"uuid":"8df6fcad-3216-4bc5-9b20-3211a2e41366"}
